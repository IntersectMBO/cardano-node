<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                    #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs                  #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE InstanceSigs           #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf             #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables    #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TupleSections          #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies           #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="annot"><span class="hs-comment">-- | Template Haskell splices</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Gen.Splice</span><span class="hs-special">(</span><span>
</span><span id="line-23"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedSplice"><span class="hs-identifier">tcTypedSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier">tcTypedBracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier">tcUntypedBracket</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runAnnotation"><span class="hs-identifier">runAnnotation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier">runMetaE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier">runMetaP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier">runMetaT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier">runMetaD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier">runQuasi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier">tcTopSpliceExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier">lookupThName_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier">defaultRunMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier">runMeta'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier">runRemoteModFinalizers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier">finishTH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTopSplice"><span class="hs-identifier">runTopSplice</span></a></span><span>
</span><span id="line-30"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html"><span class="hs-identifier">GHC.Driver.Errors</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html"><span class="hs-identifier">GHC.Driver.Main</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Finder.html"><span class="hs-identifier">GHC.Driver.Config.Finder</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier">etaExpandCoAxBranch</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TyCoRep</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InstEnv</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html"><span class="hs-identifier">GHC.Builtin.Names.TH</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ThToHs.html"><span class="hs-identifier">GHC.ThToHs</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Docs.html"><span class="hs-identifier">GHC.HsToCore.Docs</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html"><span class="hs-identifier">GHC.HsToCore.Expr</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#/GHCi.Message.html"><span class="hs-identifier">GHCi.Message</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#/GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html"><span class="hs-identifier">GHC.Rename.Splice</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier">traceSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier">SpliceInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html"><span class="hs-identifier">GHC.Rename.Expr</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html"><span class="hs-identifier">GHC.Rename.Fixity</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#lookupFixityRn_help"><span class="hs-identifier">lookupFixityRn_help</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html"><span class="hs-identifier">GHC.Rename.HsType</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DataCon</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html"><span class="hs-identifier">GHC.Types.FieldLabel</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html"><span class="hs-identifier">GHC.Types.Name.Occurrence</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OccName</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Meta.html"><span class="hs-identifier">GHC.Types.Meta</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-keyword">hiding</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier">SuccessFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.html"><span class="hs-identifier">GHC.Types.Fixity</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hs</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html"><span class="hs-identifier">GHC.Types.Annotations</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html"><span class="hs-identifier">GHC.Types.Unique.Map</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#/GHC.Serialized.html"><span class="hs-identifier">GHC.Serialized</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html"><span class="hs-identifier">GHC.Unit.Finder</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html"><span class="hs-identifier">GHC.Unit.Module.Deps</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Panic</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Lexeme.html"><span class="hs-identifier">GHC.Utils.Lexeme</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#throwIO/GHC.IO.html#throwIO"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Exception.html#ErrorCall/GHC.Exception.html#ErrorCall"><span class="hs-identifier">ErrorCall</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Exception.Type.html#SomeException/GHC.Exception.Type.html#SomeException"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier">newTempName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier">TempFileLifetime</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier">MaybeErr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.EnumSet.html"><span class="hs-identifier">GHC.Data.EnumSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EnumSet</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier">FieldLabelString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.html#/Language.Haskell.TH.html"><span class="hs-identifier">Language.Haskell.TH</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- THSyntax gives access to internal functions and data types</span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#/Language.Haskell.TH.Syntax.html"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span class="hs-cpp">

#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span class="hs-comment">-- Because GHC.Desugar might not be in the base library of the bootstrapping compiler</span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Desugar.html#/GHC.Desugar.html"><span class="hs-identifier">GHC.Desugar</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Desugar.html#AnnotationWrapper/GHC.Desugar.html#AnnotationWrapper"><span class="hs-identifier">AnnotationWrapper</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Unsafe.Coerce.html#/Unsafe.Coerce.html"><span class="hs-identifier">Unsafe.Coerce</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Unsafe.Coerce.html#unsafeCoerce/Unsafe.Coerce.html#unsafeCoerce"><span class="hs-identifier">unsafeCoerce</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../binary-0.8.9.1/src/Data.Binary.html#/Data.Binary.html"><span class="hs-identifier">Data.Binary</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../binary-0.8.9.1/src/Data.Binary.Get.html#/Data.Binary.Get.html"><span class="hs-identifier">Data.Binary.Get</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Foldable.html#find/Data.Foldable.html#find"><span class="hs-identifier">find</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.4/src/Data.ByteString.html#/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.4/src/Data.ByteString.Lazy.html#/Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LB</span></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Dynamic.html#/Data.Dynamic.html"><span class="hs-identifier">Data.Dynamic</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Dynamic.html#fromDynamic/Data.Dynamic.html#fromDynamic"><span class="hs-identifier">fromDynamic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Dynamic.html#toDyn/Data.Dynamic.html#toDyn"><span class="hs-identifier">toDyn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.IntMap.html#/Data.IntMap.html"><span class="hs-identifier">Data.IntMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.html#/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Typeable.html#/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Typeable.html#typeOf/Data.Typeable.html#typeOf"><span class="hs-identifier">typeOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Typeable.Internal.html#Typeable/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Typeable.html#TypeRep/Data.Typeable.html#TypeRep"><span class="hs-identifier">TypeRep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Typeable.html#typeRep/Data.Typeable.html#typeRep"><span class="hs-identifier">typeRep</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Data.html#/Data.Data.html"><span class="hs-identifier">Data.Data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Data.html#Data/Data.Data.html#Data"><span class="hs-identifier">Data</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Proxy.html#/Data.Proxy.html"><span class="hs-identifier">Data.Proxy</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Proxy.html#Proxy/Data.Proxy.html#Proxy"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.HaddockLex.html"><span class="hs-identifier">GHC.Parser.HaddockLex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.HaddockLex.html#lexHsDoc"><span class="hs-identifier">lexHsDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.html"><span class="hs-identifier">GHC.Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.html#parseIdentifier"><span class="hs-identifier">parseIdentifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Doc.html"><span class="hs-identifier">GHC.Rename.Doc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Doc.html#rnHsDoc"><span class="hs-identifier">rnHsDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">{-
Note [Template Haskell state diagram]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Here are the ThStages, s, their corresponding level numbers
(the result of (thLevel s)), and their state transitions.
The top level of the program is stage Comp:

     Start here
         |
         V
      -----------     $      ------------   $
      |  Comp   | ---------&gt; |  Splice  | -----|
      |   1     |            |    0     | &lt;----|
      -----------            ------------
        ^     |                ^      |
      $ |     | [||]         $ |      | [||]
        |     v                |      v
   --------------          ----------------
   | Brack Comp |          | Brack Splice |
   |     2      |          |      1       |
   --------------          ----------------

* Normal top-level declarations start in state Comp
       (which has level 1).
  Annotations start in state Splice, since they are
       treated very like a splice (only without a '$')

* Code compiled in state Splice (and only such code)
  will be *run at compile time*, with the result replacing
  the splice

* The original paper used level -1 instead of 0, etc.

* The original paper did not allow a splice within a
  splice, but there is no reason not to. This is the
  $ transition in the top right.

Note [Template Haskell levels]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Imported things are impLevel (= 0)

* However things at level 0 are not *necessarily* imported.
      eg  $( \b -&gt; ... )   here b is bound at level 0

* In GHCi, variables bound by a previous command are treated
  as impLevel, because we have bytecode for them.

* Variables are bound at the &quot;current level&quot;

* The current level starts off at outerLevel (= 1)

* The level is decremented by splicing $(..)
               incremented by brackets [| |]
               incremented by name-quoting 'f

* When a variable is used, checkWellStaged compares
        bind:  binding level, and
        use:   current level at usage site

  Generally
        bind &gt; use      Always error (bound later than used)
                        [| \x -&gt; $(f x) |]

        bind = use      Always OK (bound same stage as used)
                        [| \x -&gt; $(f [| x |]) |]

        bind &lt; use      Inside brackets, it depends
                        Inside splice, OK
                        Inside neither, OK

  For (bind &lt; use) inside brackets, there are three cases:
    - Imported things   OK      f = [| map |]
    - Top-level things  OK      g = [| f |]
    - Non-top-level     Only if there is a liftable instance
                                h = \(x:Int) -&gt; [| x |]

  To track top-level-ness we use the ThBindEnv in TcLclEnv

  For example:
           f = ...
           g1 = $(map ...)         is OK
           g2 = $(f ...)           is not OK; because we haven't compiled f yet


Note [How top-level splices are handled]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Top-level splices (those not inside a [| .. |] quotation bracket) are handled
very straightforwardly:

  1. tcTopSpliceExpr: typecheck the body e of the splice $(e)

  2. runMetaT: desugar, compile, run it, and convert result back to
     GHC.Hs syntax RdrName (of the appropriate flavour, eg HsType RdrName,
     HsExpr RdrName etc)

  3. treat the result as if that's what you saw in the first place
     e.g for HsType, rename and kind-check
         for HsExpr, rename and type-check

     (The last step is different for decls, because they can *only* be
      top-level: we return the result of step 2.)

Note [Warnings for TH splices]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We only produce warnings for TH splices when the user requests so
(-fenable-th-splice-warnings). There are multiple reasons:

  * It's not clear that the user that compiles a splice is the author of the code
    that produces the warning. Think of the situation where they just splice in
    code from a third-party library that produces incomplete pattern matches.
    In this scenario, the user isn't even able to fix that warning.
  * Gathering information for producing the warnings (pattern-match check
    warnings in particular) is costly. There's no point in doing so if the user
    is not interested in those warnings.

That's why we store Origin flags in the Haskell AST. The functions from ThToHs
take such a flag and depending on whether TH splice warnings were enabled or
not, we pass FromSource (if the user requests warnings) or Generated
(otherwise). This is implemented in getThSpliceOrigin.

For correct pattern-match warnings it's crucial that we annotate the Origin
consistently (#17270). In the future we could offer the Origin as part of the
TH AST. That would enable us to give quotes from the current module get
FromSource origin, and/or third library authors to tag certain parts of
generated code as FromSource to enable warnings.
That effort is tracked in #14838.

Note [The life cycle of a TH quotation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When desugaring a bracket (aka quotation), we want to produce Core
code that, when run, will produce the TH syntax tree for the quotation.
To that end, we want to desugar /renamed/ but not /typechecked/ code;
the latter is cluttered with the typechecker's elaboration that should
not appear in the TH syntax tree. So in (HsExpr GhcTc) tree, we must
have a (HsExpr GhcRn) for the quotation itself.

As such, when typechecking both typed and untyped brackets,
we keep a /renamed/ bracket in the extension field.

The HsBracketTc, the GhcTc ext field for both typed and untyped
brackets, contains:
  - The renamed quote :: HsQuote GhcRn -- for the desugarer
  - [PendingTcSplice]
  - The type of the quote
  - Maybe QuoteWrapper

Note that HsBracketTc stores the untyped (HsQuote GhcRn) for both typed and
untyped brackets. They are treated uniformly by the desugarer, and we can
easily construct untyped brackets from typed ones (with ExpBr).

See Note [Desugaring of brackets].

------------
Typed quotes
------------
Here is the life cycle of a /typed/ quote [|| e ||], whose datacon is
  HsTypedBracket (XTypedBracket p) (LHsExpr p)

  In pass p   (XTypedBracket p)       (LHsExpr p)
  -------------------------------------------
  GhcPs       Annotations only        LHsExpr GhcPs
  GhcRn       Annotations only        LHsExpr GhcRn
  GhcTc       HsBracketTc             LHsExpr GhcTc: unused!

Note that in the GhcTc tree, the second field (HsExpr GhcTc)
is entirely unused; the desugarer uses the (HsExpr GhcRn) from the
first field.

--------------
Untyped quotes
--------------
Here is the life cycle of an /untyped/ quote, whose datacon is
   HsUntypedBracket (XUntypedBracket p) (HsQuote p)

Here HsQuote is a sum-type of expressions [| e |], patterns [| p |],
types [| t |] etc.

  In pass p   (XUntypedBracket p)          (HsQuote p)
  -------------------------------------------------------
  GhcPs   Annotations only                 HsQuote GhcPs
  GhcRn   Annotations, [PendingRnSplice]   HsQuote GhcRn
  GhcTc   HsBracketTc                      HsQuote GhcTc: unused!

The difficulty is: the typechecker does not typecheck the body of an
untyped quote, so how do we make a (HsQuote GhcTc) to put in the
second field?

Answer: we use the extension constructor of HsQuote, namely XQuote,
and make all the other constructors into DataConCantHappen.  That is,
the only non-bottom value of type (HsQuote GhcTc) is (XQuote noExtField).
Hence the instances

  type instance XExpBr GhcTc = DataConCantHappen
  ...etc...

See the related Note [How brackets and nested splices are handled]

Note [Typechecking Overloaded Quotes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The main function for typechecking untyped quotations is `tcUntypedBracket`.

Consider an expression quote, `[| e |]`, its type is `forall m . Quote m =&gt; m Exp`.
Note carefully that this is overloaded: its type is not `Q Exp` for some fixed Q.

When we typecheck it we therefore create a template of a metavariable
`m` applied to `Exp` and emit a constraint `Quote m`. All this is done
in the `brackTy` function.  `brackTy` also selects the correct
contents type for the quotation (Exp, Type, Decs etc).

The meta variable and the constraint evidence variable are
returned together in a `QuoteWrapper` and then passed along to two further places
during compilation:

1. Typechecking nested splices (immediately in tcPendingSplice)
2. Desugaring quotations (see GHC.HsToCore.Quote)

`tcPendingSplice` takes the `m` type variable as an argument and
checks each nested splice against this variable `m`. During this
process the variable `m` can either be fixed to a specific value or
further constrained by the nested splices.

Once we have checked all the nested splices, the quote type is checked against
the expected return type.

The process is very simple and like typechecking a list where the quotation is
like the container and the splices are the elements of the list which must have
a specific type.

After the typechecking process is completed, the evidence variable for `Quote m`
and the type `m` is stored in a `QuoteWrapper` which is passed through the pipeline
and used when desugaring quotations.

Typechecking typed quotations is a similar idea but the `QuoteWrapper` is stored
in the `PendingStuff` as the nested splices are gathered up in a different way
to untyped splices. Untyped splices are found in the renamer but typed splices are
not typechecked and extracted until during typechecking.

Note [Lifecycle of an untyped splice, and PendingRnSplice]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Untyped splices $(f x) and quasiquotes [p| stuff |] have the following
life cycle. Remember, quasi-quotes are very like splices; see Note [Quasi-quote overview]).

The type structure is

  data HsExpr p = ...
    | HsUntypedSplice (XUntypedSplice p) (HsUntypedSplice p)

  data HsUntypedSplice p
    = HsUntypedSpliceExpr (XUntypedSpliceExpr p) (LHsExpr p)
    | HsQuasiQuote (XQuasiQuote p) (IdP id) (XRec p FastString)

Remember that untyped splices can occur in expressions, patterns,
types, and declarations.  So we have a HsUntypedSplice data
constructor in all four of these types.

Untyped splices never occur in (HsExpr GhcTc), and similarly
patterns etc. So we have

   type instance XUntypedSplice GhcTc = DataConCantHappen

Top-level and nested splices are handled differently.

-------------------------------------
Nested untyped splices/quasiquotes
----------------------------------
When we rename an /untyped/ bracket, such as
     [| f $(g x) |]
we name and lift out all the nested splices, so that when the
typechecker hits the bracket, it can typecheck those nested splices
without having to walk over the untyped bracket code.  Our example
[| f $(g x) |] parses as

    HsUntypedBracket _
       (HsApp (HsVar &quot;f&quot;)
              (HsUntypedSplice _ (HsUntypedSpliceExpr _ (g x :: LHsExpr GhcPs)))

RENAMER (rnUntypedBracket):

* Set the ThStage to (Brack s (RnPendingUntyped ps_var))

* Rename the body

* Nested splices (which must be untyped) are renamed (rnUntypedSplice),
  and the results accumulated in ps_var. Each gets a fresh
  SplicePointName, 'spn'

* The SplicePointName connects the `PendingRnSplice` with the particular point
  in the syntax tree where that expression should be spliced in.  That point
  in the tree is identified by `(HsUntypedSpliceNested spn)`.  It is used by
  the desugarer, so that we ultimately generate something like
       let spn = g x
       in App (Var &quot;f&quot;) spn

The result is
    HsUntypedBracket
        [PendingRnSplice UntypedExpSplice spn (g x  :: LHsExpr GHcRn)]
        (HsApp (HsVar f) (HsUntypedSplice (HsUntypedSpliceNested spn)
                                          (HsUntypedSpliceExpr _ (g x :: LHsExpr GhcRn))))

Note that a nested splice, such as the `$(g x)` now appears twice:
  - In the PendingRnSplice: this is the version that will later be typechecked
  - In the HsUntypedSpliceExpr in the body of the bracket. This copy is used
    only for pretty printing.

NB: a single untyped bracket can contain many splices, each of a different
`UntypedSpliceFlavour`. For example

   [| let $e0 in (f :: $e1) $e2 (\ $e -&gt; body ) |] + 1

Here $e0 is a declaration splice, $e1 is a type splice, $e2 is an
expression splice, and $e3 is a pattern splice.  The `PendingRnSplice`
keeps track of which is which through its `UntypedSpliceFlavour`
field.

TYPECHECKER (tcUntypedBracket): see also Note [Typechecking Overloaded Quotes]

* Typecheck the [PendingRnSplice] individually, to give [PendingTcSplice]
  So PendingTcSplice is used for both typed and untyped splices.

* Ignore the body of the bracket; just check that the context
  expects a bracket of that type (e.g. a [p| pat |] bracket should
  be in a context needing a (m Pat)

* Stash the whole lot inside a HsBracketTc

Result is:
    HsUntypedBracket
        (HsBracketTc { hsb_splices = [PendingTcSplice spn (g x  :: LHsExpr GHcTc)]
                     , hsb_quote = HsApp (HsVar f)
                                         (HsUntypedSplice (HsUntypedSpliceNested spn)
                                            (HsUntypedSpliceExpr _ (g x :: LHsExpr GhcRn)))
                     })
        (XQuote noExtField)

NB in the typechecker output, the original payload (which would now
have type (HsQuote GhcTc) is stubbed off with (XQuote noExtField). The payload
is now in the hsb_quote field of the HsBracketTc.


-------------------------------------
Top-level untyped splices/quasiquotes
-------------------------------------
A top-level splice (not inside a bracket) does not need a SpliceName,
nor does a top-level splice ever end up inside a PendingRnSplice;
hence HsUntypedSpliceTop does not have a SplicePointName field.

Example $(g x).  This is parsed as

  HsUntypedSplice _ (HsUntypedSpliceExpr _ ((g x) :: LHsExpr GhcPs))

Renamer: the renamer runs the splice, so the output of the renamer looks like

  HsUntypedSplice (HsUntypedSpliceTop fins (e2 :: LHsExpr GhcRn))
                  (HsUntypedSpliceExpr ((g x) :: LHsExpr GhcRn))

where 'e2' is the result of running (g x) to
             produce the syntax tree for 'e2'
      'fins' is a bunch of TH finalisers, to be run later.

Typechecker: the typechecker simply adds the finalisers, and
typechecks e2, discarding the HsUntypedSplice altogether.


Note [Lifecycle of an typed splice, and PendingTcSplice]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

----------------------
Nested, typed splices
----------------------
When we typecheck a /typed/ bracket, we lift nested splices out as
`PendingTcSplice`, very similar to Note [PendingRnSplice]. Again, the
splice needs a SplicePointName, for the desguarer to use to connect
the splice expression with the point in the syntax tree where it is
used.  Example:
     [||  f $$(g 2)||]

Parser: this is parsed as

    HsTypedBracket _ (HsApp (HsVar &quot;f&quot;)
                            (HsTypedSplice _ (g 2 :: LHsExpr GhcPs)))

RENAMER (rnTypedSplice): the renamer adds a SplicePointName, spn:

    HsTypedBracket _ (HsApp (HsVar &quot;f&quot;)
                            (HsTypedSplice spn (g x :: LHsExpr GhcRn)))

TYPECHECKER (tcTypedBracket):

* Set the ThStage to (Brack s (TcPending ps_var lie_var))

* Typecheck the body, and keep the elaborated result (despite never using it!)

* Nested splices (which must be typed) are typechecked by tcNestedSplice, and
  the results accumulated in ps_var; their constraints accumulate in lie_var

* Result is a HsTypedBracket (HsBracketTc rn_brack ty quote_wrapper pending_splices) tc_brack
  where rn_brack is the untyped renamed exp quote constructed from the typed renamed expression :: HsQuote GhcRn

Just like untyped brackets, dump the output into a HsBracketTc.

    HsTypedBracket
        (HsBracketTc { hsb_splices = [PendingTcSplice spn (g x  :: LHsExpr GHcTc)]
                     , hsb_quote = HsApp (HsVar f)
                                         (HsUntypedSplice (HsUntypedSpliceNested spn)
                                            (HsUntypedSpliceExpr _ (g x :: LHsExpr GhcRn)))
                     })
        (panic &quot;should never be looked at&quot;)

NB: we never need to represent typed /nested/ splices in phase GhcTc.

There are only typed expression splices so `PendingTcSplice` doesn't have a
flavour field.


--------------------------------
Top-level, typed splices $$(f x)
--------------------------------
Typed splices are renamed and typechecked, but only actually run in
the zonker, after typechecking. See Note [Running typed splices in the zonker]

* Output of parser:
  HsTypedSplice _ (e :: HsExpr GhcPs)

* Output of renamer:
  HsTypedSplice (n :: SplicePointName) (e :: HsExpr GhcRn)

* Output of typechecker: (top-level splices only)
  HsTypedSplice (del_splice :: DelayedSplice) (e :: HsExpr GhcTc)
  where 'del_splice' is something the zonker can run to produce
           the syntax tree to splice in.
           See Note [Running typed splices in the zonker]

Note [Desugaring of brackets]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In both cases, desugaring happens like this:
  * Hs*Bracket is desugared by GHC.HsToCore.Quote.dsBracket using the renamed
    expression held in `HsBracketTc` (`type instance X*Bracket GhcTc = HsBracketTc`). It

      a) Extends the ds_meta environment with the PendingSplices
         attached to the bracket

      b) Converts the quoted (HsExpr Name) to a CoreExpr that, when
         run, will produce a suitable TH expression/type/decl.  This
         is why we leave the *renamed* expression attached to the bracket:
         the quoted expression should not be decorated with all the goop
         added by the type checker

  * Each splice carries a unique Name, called a &quot;splice point&quot;, thus
    ${n}(e).  The name is initialised to an (Unqual &quot;splice&quot;) when the
    splice is created; the renamer gives it a unique.

  * When GHC.HsToCore.Quote (used to desugar the body of the bracket) comes across
    a splice, it looks up the splice's Name, n, in the ds_meta envt,
    to find an (HsExpr Id) that should be substituted for the splice;
    it just desugars it to get a CoreExpr (GHC.HsToCore.Quote.repSplice).

Example:
    Source:       f = [| Just $(g 3) |]
      The [| |] part is a HsUntypedBracket GhcPs

    Typechecked:  f = [| Just ${s7}(g 3) |]{s7 = g Int 3}
      The [| |] part is a HsUntypedBracket GhcTc, containing *renamed*
        (not typechecked) expression (see Note [The life cycle of a TH quotation])
      The &quot;s7&quot; is the &quot;splice point&quot;; the (g Int 3) part
        is a typechecked expression

    Desugared:    f = do { s7 &lt;- g Int 3
                         ; return (ConE &quot;Data.Maybe.Just&quot; s7) }

-}</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Main interface + stubs for the non-GHCI case
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-type">tcTypedBracket</span></a></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier hs-type">tcUntypedBracket</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuote"><span class="hs-identifier hs-type">HsQuote</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-645"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedSplice"><span class="hs-identifier hs-type">tcTypedSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-comment">-- None of these functions add constraints to the LIE</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runAnnotation"><span class="hs-identifier hs-type">runAnnotation</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#CoreAnnTarget"><span class="hs-identifier hs-type">CoreAnnTarget</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span>
</span><span id="line-650"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Quoting an expression}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span class="hs-comment">-- See Note [How brackets and nested splices are handled]</span><span>
</span><span id="line-659"></span><span id="tcTypedBracket"><span class="annot"><span class="annottext">tcTypedBracket :: HsExpr GhcRn -&gt; LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-var hs-var">tcTypedBracket</span></a></span></span><span> </span><span id="local-6989586621682113129"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682113129"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621682113130"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113130"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682113131"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113131"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-var">quotationCtxtDoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113130"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113134"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113134"><span class="hs-identifier hs-var">cur_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-662"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113136"><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621682113136"><span class="hs-identifier hs-var">ps_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef [PendingTcSplice])
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-663"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113138"><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621682113138"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (TcRef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>   </span><span class="hs-comment">-- Any constraints arising from nested splices</span><span>
</span><span id="line-664"></span><span>                                       </span><span class="hs-comment">-- should get thrown into the constraint set</span><span>
</span><span id="line-665"></span><span>                                       </span><span class="hs-comment">-- from outside the bracket</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>       </span><span class="hs-comment">-- Make a new type variable for the type of the overall quote</span><span>
</span><span id="line-668"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113140"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113140"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-var">mkMetaTyVar</span></a></span><span>
</span><span id="line-669"></span><span>       </span><span class="hs-comment">-- Make sure the type variable satisfies Quote</span><span>
</span><span id="line-670"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113144"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113144"><span class="hs-identifier hs-var">ev_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-var">emitQuoteWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113140"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-671"></span><span>       </span><span class="hs-comment">-- Bundle them together so they can be used in GHC.HsToCore.Quote for desugaring</span><span>
</span><span id="line-672"></span><span>       </span><span class="hs-comment">-- brackets.</span><span>
</span><span id="line-673"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113146"><span class="annot"><span class="annottext">wrapper :: QuoteWrapper
</span><a href="#local-6989586621682113146"><span class="hs-identifier hs-var hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type -&gt; QuoteWrapper
</span><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-var">QuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113144"><span class="hs-identifier hs-var">ev_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113140"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-674"></span><span>       </span><span class="hs-comment">-- Typecheck expr to make sure it is valid.</span><span>
</span><span id="line-675"></span><span>       </span><span class="hs-comment">-- The typechecked expression won't be used, so we just discard it</span><span>
</span><span id="line-676"></span><span>       </span><span class="hs-comment">--   (See Note [The life cycle of a TH quotation] in GHC.Hs.Expr)</span><span>
</span><span id="line-677"></span><span>       </span><span class="hs-comment">-- We'll typecheck it again when we splice it in somewhere</span><span>
</span><span id="line-678"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113148"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113148"><span class="hs-identifier hs-var">tc_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113149"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113149"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; PendingStuff -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-var">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113134"><span class="hs-identifier hs-var">cur_stage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
-&gt; TcRef WantedConstraints -&gt; QuoteWrapper -&gt; PendingStuff
</span><a href="GHC.Tc.Types.html#TcPending"><span class="hs-identifier hs-var">TcPending</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621682113136"><span class="hs-identifier hs-var">ps_ref</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621682113138"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621682113146"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
 -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-679"></span><span>                                </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-680"></span><span>                                </span><span class="hs-comment">-- Scale by Many, TH lifting is currently nonlinear (#18465)</span><span>
</span><span id="line-681"></span><span>                                </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113130"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-682"></span><span>                                </span><span class="hs-comment">-- NC for no context; tcBracket does that</span><span>
</span><span id="line-683"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113156"><span class="annot"><span class="annottext">rep :: Type
</span><a href="#local-6989586621682113156"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113149"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-684"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113158"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113158"><span class="hs-identifier hs-var">meta_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var">tcTExpTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113140"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113149"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-685"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113160"><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621682113160"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621682113136"><span class="hs-identifier hs-var">ps_ref</span></a></span><span>
</span><span id="line-686"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113162"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113162"><span class="hs-identifier hs-var">codeco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#unsafeCodeCoerceName"><span class="hs-identifier hs-var">unsafeCodeCoerceName</span></a></span><span>
</span><span id="line-687"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113165"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113165"><span class="hs-identifier hs-var">bracket_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113140"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#expTyConName"><span class="hs-identifier hs-var">expTyConName</span></a></span><span>
</span><span id="line-688"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113169"><span class="annot"><span class="annottext">brack_tc :: HsBracketTc
</span><a href="#local-6989586621682113169"><span class="hs-identifier hs-var hs-var">brack_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsBracketTc"><span class="hs-identifier hs-type">HsBracketTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsb_quote :: HsQuote GhcRn
</span><a href="GHC.Hs.Expr.html#hsb_quote"><span class="hs-identifier hs-var">hsb_quote</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XExpBr GhcRn -&gt; LHsExpr GhcRn -&gt; HsQuote GhcRn
forall p. XExpBr p -&gt; LHsExpr p -&gt; HsQuote p
</span><a href="Language.Haskell.Syntax.Expr.html#ExpBr"><span class="hs-identifier hs-var">ExpBr</span></a></span><span> </span><span class="annot"><span class="annottext">XExpBr GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113130"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsb_ty :: Type
</span><a href="GHC.Hs.Expr.html#hsb_ty"><span class="hs-identifier hs-var">hsb_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113165"><span class="hs-identifier hs-var">bracket_ty</span></a></span><span>
</span><span id="line-689"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsb_wrap :: Maybe QuoteWrapper
</span><a href="GHC.Hs.Expr.html#hsb_wrap"><span class="hs-identifier hs-var">hsb_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QuoteWrapper -&gt; Maybe QuoteWrapper
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621682113146"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsb_splices :: [PendingTcSplice]
</span><a href="GHC.Hs.Expr.html#hsb_splices"><span class="hs-identifier hs-var">hsb_splices</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621682113160"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-690"></span><span>             </span><span class="hs-comment">-- The tc_expr is stored here so that the expression can be used in HIE files.</span><span>
</span><span id="line-691"></span><span>             </span><span id="local-6989586621682113177"><span class="annot"><span class="annottext">brack_expr :: HsExpr GhcTc
</span><a href="#local-6989586621682113177"><span class="hs-identifier hs-var hs-var">brack_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XTypedBracket GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XTypedBracket p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsTypedBracket"><span class="hs-identifier hs-var">HsTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">XTypedBracket GhcTc
HsBracketTc
</span><a href="#local-6989586621682113169"><span class="hs-identifier hs-var">brack_tc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113148"><span class="hs-identifier hs-var">tc_expr</span></a></span><span>
</span><span id="line-692"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; Type
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultO"><span class="hs-identifier hs-var">tcWrapResultO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TH typed bracket expression&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>                       </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682113129"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-694"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#mkHsApp"><span class="hs-identifier hs-var">mkHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#applyQuoteWrapper"><span class="hs-identifier hs-var">applyQuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621682113146"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [Type] -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#nlHsTyApp"><span class="hs-identifier hs-var">nlHsTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113162"><span class="hs-identifier hs-var">codeco</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113156"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113149"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682113177"><span class="hs-identifier hs-var">brack_expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>                       </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113158"><span class="hs-identifier hs-var">meta_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113131"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="hs-comment">-- See Note [Typechecking Overloaded Quotes]</span><span>
</span><span id="line-700"></span><span id="tcUntypedBracket"><span class="annot"><span class="annottext">tcUntypedBracket :: HsExpr GhcRn
-&gt; HsQuote GhcRn
-&gt; [PendingRnSplice]
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier hs-var hs-var">tcUntypedBracket</span></a></span></span><span> </span><span id="local-6989586621682113187"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682113187"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621682113188"><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682113188"><span class="hs-identifier hs-var">brack</span></a></span></span><span> </span><span id="local-6989586621682113189"><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621682113189"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682113190"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113190"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_bracket untyped&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsQuote GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682113188"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621682113189"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>       </span><span class="hs-comment">-- Create the type m Exp for expression bracket, m Type for a type</span><span>
</span><span id="line-704"></span><span>       </span><span class="hs-comment">-- bracket and so on. The brack_info is a Maybe because the</span><span>
</span><span id="line-705"></span><span>       </span><span class="hs-comment">-- VarBracket ('a) isn't overloaded, but also shouldn't contain any</span><span>
</span><span id="line-706"></span><span>       </span><span class="hs-comment">-- splices.</span><span>
</span><span id="line-707"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113194"><span class="annot"><span class="annottext">Maybe QuoteWrapper
</span><a href="#local-6989586621682113194"><span class="hs-identifier hs-var">brack_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113195"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113195"><span class="hs-identifier hs-var">expected_type</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsQuote GhcRn -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="GHC.Tc.Gen.Splice.html#brackTy"><span class="hs-identifier hs-var">brackTy</span></a></span><span> </span><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682113188"><span class="hs-identifier hs-var">brack</span></a></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>       </span><span class="hs-comment">-- Match the expected type with the type of all the internal</span><span>
</span><span id="line-710"></span><span>       </span><span class="hs-comment">-- splices. They might have further constrained types and if they do</span><span>
</span><span id="line-711"></span><span>       </span><span class="hs-comment">-- we want to reflect that in the overall type of the bracket.</span><span>
</span><span id="line-712"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113197"><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621682113197"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QuoteWrapper -&gt; Type
</span><a href="GHC.Tc.Types.Evidence.html#quoteWrapperTyVarTy"><span class="hs-identifier hs-var">quoteWrapperTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(QuoteWrapper -&gt; Type) -&gt; Maybe QuoteWrapper -&gt; DFunInstType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QuoteWrapper
</span><a href="#local-6989586621682113194"><span class="hs-identifier hs-var">brack_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-713"></span><span>                  </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682113199"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113199"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PendingRnSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice)
-&gt; [PendingRnSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
-&gt; PendingRnSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice
</span><a href="GHC.Tc.Gen.Splice.html#tcPendingSplice"><span class="hs-identifier hs-var">tcPendingSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113199"><span class="hs-identifier hs-var">m_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621682113189"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-714"></span><span>                  </span><span class="annot"><span class="annottext">DFunInstType
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PendingRnSplice] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621682113189"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>       </span><span class="hs-comment">-- Notice that we don't attempt to typecheck the body</span><span>
</span><span id="line-717"></span><span>       </span><span class="hs-comment">-- of the bracket, which is in brack.</span><span>
</span><span id="line-718"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_bracket done untyped&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113195"><span class="hs-identifier hs-var">expected_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>       </span><span class="hs-comment">-- Unify the overall type of the bracket with the expected result type</span><span>
</span><span id="line-721"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; Type
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultO"><span class="hs-identifier hs-var">tcWrapResultO</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#BracketOrigin"><span class="hs-identifier hs-var">BracketOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682113187"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-722"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUntypedBracket GhcTc -&gt; HsQuote GhcTc -&gt; HsExpr GhcTc
forall p. XUntypedBracket p -&gt; HsQuote p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsUntypedBracket"><span class="hs-identifier hs-var">HsUntypedBracket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsBracketTc"><span class="hs-identifier hs-type">HsBracketTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsb_quote :: HsQuote GhcRn
</span><a href="GHC.Hs.Expr.html#hsb_quote"><span class="hs-identifier hs-var">hsb_quote</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682113188"><span class="hs-identifier hs-var">brack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsb_ty :: Type
</span><a href="GHC.Hs.Expr.html#hsb_ty"><span class="hs-identifier hs-var">hsb_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113195"><span class="hs-identifier hs-var">expected_type</span></a></span><span>
</span><span id="line-723"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsb_wrap :: Maybe QuoteWrapper
</span><a href="GHC.Hs.Expr.html#hsb_wrap"><span class="hs-identifier hs-var">hsb_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe QuoteWrapper
</span><a href="#local-6989586621682113194"><span class="hs-identifier hs-var">brack_info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsb_splices :: [PendingTcSplice]
</span><a href="GHC.Hs.Expr.html#hsb_splices"><span class="hs-identifier hs-var">hsb_splices</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621682113197"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XXQuote GhcTc -&gt; HsQuote GhcTc
forall p. XXQuote p -&gt; HsQuote p
</span><a href="Language.Haskell.Syntax.Expr.html#XQuote"><span class="hs-identifier hs-var">XQuote</span></a></span><span> </span><span class="annot"><span class="annottext">XXQuote GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>                </span><span class="hs-comment">-- (XQuote noExtField): see Note [The life cycle of a TH quotation] in GHC.Hs.Expr</span><span>
</span><span id="line-726"></span><span>            </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113195"><span class="hs-identifier hs-var">expected_type</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113190"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="annot"><span class="hs-comment">-- | A type variable with kind * -&gt; * named &quot;m&quot;</span></span><span>
</span><span id="line-731"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-type">mkMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>
</span><span id="line-732"></span><span id="mkMetaTyVar"><span class="annot"><span class="annottext">mkMetaTyVar :: IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-var hs-var">mkMetaTyVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-733"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.TcMType.html#newNamedFlexiTyVar"><span class="hs-identifier hs-var">newNamedFlexiTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;m&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type -&gt; Type
Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-var">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="annot"><span class="hs-comment">-- | For a type 'm', emit the constraint 'Quote m'.</span></span><span>
</span><span id="line-737"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-type">emitQuoteWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-738"></span><span id="emitQuoteWanted"><span class="annot"><span class="annottext">emitQuoteWanted :: Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-var hs-var">emitQuoteWanted</span></a></span></span><span> </span><span id="local-6989586621682113213"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113213"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-739"></span><span>        </span><span id="local-6989586621682113214"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682113214"><span class="hs-identifier hs-var">quote_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#quoteClassName"><span class="hs-identifier hs-var">quoteClassName</span></a></span><span>
</span><span id="line-740"></span><span>        </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#BracketOrigin"><span class="hs-identifier hs-var">BracketOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id)
-&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-741"></span><span>          </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682113214"><span class="hs-identifier hs-var">quote_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113213"><span class="hs-identifier hs-var">m_var</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-744"></span><span class="hs-comment">-- | Compute the expected type of a quotation, and also the QuoteWrapper in</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- the case where it is an overloaded quotation. All quotation forms are</span><span>
</span><span id="line-746"></span><span class="hs-comment">-- overloaded aprt from Variable quotations ('foo)</span><span>
</span><span id="line-747"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#brackTy"><span class="hs-identifier hs-type">brackTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuote"><span class="hs-identifier hs-type">HsQuote</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-type">QuoteWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span id="brackTy"><span class="annot"><span class="annottext">brackTy :: HsQuote GhcRn -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="GHC.Tc.Gen.Splice.html#brackTy"><span class="hs-identifier hs-var hs-var">brackTy</span></a></span></span><span> </span><span id="local-6989586621682113219"><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682113219"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113226"><span class="annot"><span class="annottext">mkTy :: Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621682113226"><span class="hs-identifier hs-var hs-var">mkTy</span></a></span></span><span> </span><span id="local-6989586621682113227"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113227"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-750"></span><span>        </span><span class="hs-comment">-- New polymorphic type variable for the bracket</span><span>
</span><span id="line-751"></span><span>        </span><span id="local-6989586621682113228"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113228"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-var">mkMetaTyVar</span></a></span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-comment">-- Emit a Quote constraint for the bracket</span><span>
</span><span id="line-753"></span><span>        </span><span id="local-6989586621682113229"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113229"><span class="hs-identifier hs-var">ev_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-var">emitQuoteWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113228"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-754"></span><span>        </span><span class="hs-comment">-- Construct the final expected type of the quote, for example</span><span>
</span><span id="line-755"></span><span>        </span><span class="hs-comment">-- m Exp or m Type</span><span>
</span><span id="line-756"></span><span>        </span><span id="local-6989586621682113230"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113230"><span class="hs-identifier hs-var">final_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113228"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113227"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-comment">-- Return the evidence variable and metavariable to be used during</span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-comment">-- desugaring.</span><span>
</span><span id="line-759"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113231"><span class="annot"><span class="annottext">wrapper :: QuoteWrapper
</span><a href="#local-6989586621682113231"><span class="hs-identifier hs-var hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type -&gt; QuoteWrapper
</span><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-var">QuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113229"><span class="hs-identifier hs-var">ev_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113228"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-760"></span><span>        </span><span class="annot"><span class="annottext">(Maybe QuoteWrapper, Type) -&gt; TcM (Maybe QuoteWrapper, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; Maybe QuoteWrapper
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621682113231"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113230"><span class="hs-identifier hs-var">final_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-762"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682113219"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#VarBr"><span class="hs-identifier hs-type">VarBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe QuoteWrapper
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; (Maybe QuoteWrapper, Type))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; TcM (Maybe QuoteWrapper, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#nameTyConName"><span class="hs-identifier hs-var">nameTyConName</span></a></span><span>
</span><span id="line-764"></span><span>                                           </span><span class="hs-comment">-- Result type is Var (not Quote-monadic)</span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExpBr"><span class="hs-identifier hs-type">ExpBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621682113226"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#expTyConName"><span class="hs-identifier hs-var">expTyConName</span></a></span><span>  </span><span class="hs-comment">-- Result type is m Exp</span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TypBr"><span class="hs-identifier hs-type">TypBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621682113226"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#typeTyConName"><span class="hs-identifier hs-var">typeTyConName</span></a></span><span> </span><span class="hs-comment">-- Result type is m Type</span><span>
</span><span id="line-767"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DecBrG"><span class="hs-identifier hs-type">DecBrG</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621682113226"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#decsTyConName"><span class="hs-identifier hs-var">decsTyConName</span></a></span><span> </span><span class="hs-comment">-- Result type is m [Dec]</span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#PatBr"><span class="hs-identifier hs-type">PatBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621682113226"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#patTyConName"><span class="hs-identifier hs-var">patTyConName</span></a></span><span>  </span><span class="hs-comment">-- Result type is m Pat</span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DecBrL"><span class="hs-identifier hs-type">DecBrL</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (Maybe QuoteWrapper, Type)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcBrackTy: Unexpected DecBrL&quot;</span></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-772"></span><span class="annot"><span class="hs-comment">-- | Typechecking a pending splice from a untyped bracket</span></span><span>
</span><span id="line-773"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcPendingSplice"><span class="hs-identifier hs-type">tcPendingSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-comment">-- Metavariable for the expected overall type of the</span><span>
</span><span id="line-774"></span><span>                          </span><span class="hs-comment">-- quotation.</span><span>
</span><span id="line-775"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span>
</span><span id="line-776"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-type">PendingTcSplice</span></a></span><span>
</span><span id="line-777"></span><span id="tcPendingSplice"><span class="annot"><span class="annottext">tcPendingSplice :: Type
-&gt; PendingRnSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice
</span><a href="GHC.Tc.Gen.Splice.html#tcPendingSplice"><span class="hs-identifier hs-var hs-var">tcPendingSplice</span></a></span></span><span> </span><span id="local-6989586621682113243"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113243"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span> </span><span id="local-6989586621682113245"><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621682113245"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span id="local-6989586621682113246"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113246"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621682113247"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113247"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-comment">-- See Note [Typechecking Overloaded Quotes]</span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113248"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113248"><span class="hs-identifier hs-var">meta_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113249"><span class="hs-identifier hs-var">meta_ty_name</span></a></span><span>
</span><span id="line-780"></span><span>         </span><span class="hs-comment">-- Expected type of splice, e.g. m Exp</span><span>
</span><span id="line-781"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113250"><span class="annot"><span class="annottext">expected_type :: Type
</span><a href="#local-6989586621682113250"><span class="hs-identifier hs-var hs-var">expected_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113243"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113248"><span class="hs-identifier hs-var">meta_ty</span></a></span><span>
</span><span id="line-782"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113251"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113251"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113247"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113250"><span class="hs-identifier hs-var">expected_type</span></a></span><span>
</span><span id="line-783"></span><span>                  </span><span class="hs-comment">-- Scale by Many, TH lifting is currently nonlinear (#18465)</span><span>
</span><span id="line-784"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PendingTcSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcTc -&gt; PendingTcSplice
</span><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-var">PendingTcSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113246"><span class="hs-identifier hs-var">splice_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113251"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-786"></span><span>     </span><span id="local-6989586621682113249"><span class="annot"><span class="annottext">meta_ty_name :: Name
</span><a href="#local-6989586621682113249"><span class="hs-identifier hs-var hs-var">meta_ty_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621682113245"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-787"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#expTyConName"><span class="hs-identifier hs-var">expTyConName</span></a></span><span>
</span><span id="line-788"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedPatSplice"><span class="hs-identifier hs-var">UntypedPatSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#patTyConName"><span class="hs-identifier hs-var">patTyConName</span></a></span><span>
</span><span id="line-789"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedTypeSplice"><span class="hs-identifier hs-var">UntypedTypeSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#typeTyConName"><span class="hs-identifier hs-var">typeTyConName</span></a></span><span>
</span><span id="line-790"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#decsTyConName"><span class="hs-identifier hs-var">decsTyConName</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-793"></span><span class="hs-comment">-- Takes a m and tau and returns the type m (TExp tau)</span><span>
</span><span id="line-794"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-type">tcTExpTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-795"></span><span id="tcTExpTy"><span class="annot"><span class="annottext">tcTExpTy :: Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var hs-var">tcTExpTy</span></a></span></span><span> </span><span id="local-6989586621682113258"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113258"><span class="hs-identifier hs-var">m_ty</span></a></span></span><span> </span><span id="local-6989586621682113259"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113259"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#unless/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113259"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTypedTHWithPolyType"><span class="hs-identifier hs-var">TcRnTypedTHWithPolyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113259"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113264"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682113264"><span class="hs-identifier hs-var">codeCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#codeTyConName"><span class="hs-identifier hs-var">codeTyConName</span></a></span><span>
</span><span id="line-798"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113266"><span class="annot"><span class="annottext">rep :: Type
</span><a href="#local-6989586621682113266"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113259"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-799"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682113264"><span class="hs-identifier hs-var">codeCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113266"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113258"><span class="hs-identifier hs-var">m_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113259"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-type">quotationCtxtDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-802"></span><span id="quotationCtxtDoc"><span class="annot"><span class="annottext">quotationCtxtDoc :: LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-var hs-var">quotationCtxtDoc</span></a></span></span><span> </span><span id="local-6989586621682113267"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113267"><span class="hs-identifier hs-var">br_body</span></a></span></span><span>
</span><span id="line-803"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SumArity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the Template Haskell quotation&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span>         </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#thTyBrackets"><span class="hs-identifier hs-var">thTyBrackets</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; (LHsExpr GhcRn -&gt; SDoc) -&gt; LHsExpr GhcRn -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcRn -&gt; SDoc) -&gt; LHsExpr GhcRn -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113267"><span class="hs-identifier hs-var">br_body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span>  </span><span class="hs-comment">-- The whole of the rest of the file is the else-branch (ie stage2 only)</span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Splicing an expression}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span id="tcTypedSplice"><span class="annot"><span class="annottext">tcTypedSplice :: Name -&gt; LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTypedSplice"><span class="hs-identifier hs-var hs-var">tcTypedSplice</span></a></span></span><span> </span><span id="local-6989586621682113272"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113272"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621682113273"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113273"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682113274"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113274"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#typedSpliceCtxtDoc"><span class="hs-identifier hs-var">typedSpliceCtxtDoc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113272"><span class="hs-identifier hs-var">splice_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113273"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-820"></span><span>    </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; SrcSpan
forall a e. GenLocated (SrcSpanAnn' a) e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682113273"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-821"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113278"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113278"><span class="hs-identifier hs-var">stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-822"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113278"><span class="hs-identifier hs-var">stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-823"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-type">Splice</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-var">tcTopSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113273"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113274"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-824"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span id="local-6989586621682113281"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113281"><span class="hs-identifier hs-var">pop_stage</span></a></span></span><span> </span><span id="local-6989586621682113282"><span class="annot"><span class="annottext">PendingStuff
</span><a href="#local-6989586621682113282"><span class="hs-identifier hs-var">pend</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThStage
-&gt; PendingStuff
-&gt; Name
-&gt; LHsExpr GhcRn
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-var">tcNestedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113281"><span class="hs-identifier hs-var">pop_stage</span></a></span><span> </span><span class="annot"><span class="annottext">PendingStuff
</span><a href="#local-6989586621682113282"><span class="hs-identifier hs-var">pend</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113272"><span class="hs-identifier hs-var">splice_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113273"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113274"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-825"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-type">RunSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-826"></span><span>            </span><span class="hs-comment">-- See Note [RunSplice ThLevel] in &quot;GHC.Tc.Types&quot;.</span><span>
</span><span id="line-827"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSpliceExpr: attempted to typecheck a splice when &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-828"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;running another splice&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Name -&gt; LHsExpr GhcRn -&gt; SDoc
forall (p :: Pass).
OutputableBndrId p =&gt;
Maybe Name -&gt; LHsExpr (GhcPass p) -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprTypedSplice"><span class="hs-identifier hs-var">pprTypedSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113272"><span class="hs-identifier hs-var">splice_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113273"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>          </span><span class="annot"><span class="annottext">ThStage
</span><a href="GHC.Tc.Types.html#Comp"><span class="hs-identifier hs-var">Comp</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-var">tcTopSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113273"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113274"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-830"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span class="hs-comment">{- Note [Collecting modFinalizers in typed splices]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
'qAddModFinalizer' of the @Quasi TcM@ instance adds finalizers in the local
environment (see Note [Delaying modFinalizers in untyped splices] in
GHC.Rename.Splice). Thus after executing the splice, we move the finalizers to the
finalizer list in the global environment and set them to use the current local
environment (with 'addModFinalizersWithLclEnv').

-}</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-843"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-type">tcTopSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span id="tcTopSplice"><span class="annot"><span class="annottext">tcTopSplice :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-var hs-var">tcTopSplice</span></a></span></span><span> </span><span id="local-6989586621682113288"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113288"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682113289"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113289"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Typecheck the expression,</span><span>
</span><span id="line-846"></span><span>         </span><span class="hs-comment">-- making sure it has type Q (T res_ty)</span><span>
</span><span id="line-847"></span><span>         </span><span id="local-6989586621682113290"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113290"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113289"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-848"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113292"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113292"><span class="hs-identifier hs-var">q_type</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#qTyConName"><span class="hs-identifier hs-var">qTyConName</span></a></span><span>
</span><span id="line-849"></span><span>       </span><span class="hs-comment">-- Top level splices must still be of type Q (TExp a)</span><span>
</span><span id="line-850"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113294"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113294"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var">tcTExpTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113292"><span class="hs-identifier hs-var">q_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113290"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-851"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113295"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113295"><span class="hs-identifier hs-var">q_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SpliceType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-var">tcTopSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Typed"><span class="hs-identifier hs-var">Typed</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-852"></span><span>                   </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113288"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113294"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span><span>
</span><span id="line-853"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113298"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682113298"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-854"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113300"><span class="annot"><span class="annottext">delayed_splice :: DelayedSplice
</span><a href="#local-6989586621682113300"><span class="hs-identifier hs-var hs-var">delayed_splice</span></a></span></span><span>
</span><span id="line-855"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; LHsExpr GhcRn -&gt; Type -&gt; LHsExpr GhcTc -&gt; DelayedSplice
</span><a href="GHC.Hs.Expr.html#DelayedSplice"><span class="hs-identifier hs-var">DelayedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682113298"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113288"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113290"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113295"><span class="hs-identifier hs-var">q_expr</span></a></span><span>
</span><span id="line-856"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTypedSplice GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XTypedSplice p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-var">HsTypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XTypedSplice GhcTc
DelayedSplice
</span><a href="#local-6989586621682113300"><span class="hs-identifier hs-var">delayed_splice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113295"><span class="hs-identifier hs-var">q_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-861"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-type">tcTopSpliceExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#SpliceType"><span class="hs-identifier hs-type">SpliceType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-862"></span><span class="hs-comment">-- Note [How top-level splices are handled]</span><span>
</span><span id="line-863"></span><span class="hs-comment">-- Type check an expression that is the body of a top-level splice</span><span>
</span><span id="line-864"></span><span class="hs-comment">--   (the caller will compile and run it)</span><span>
</span><span id="line-865"></span><span class="hs-comment">-- Note that set the level to Splice, regardless of the original level,</span><span>
</span><span id="line-866"></span><span class="hs-comment">-- before typechecking the expression.  For example:</span><span>
</span><span id="line-867"></span><span class="hs-comment">--      f x = $( ...$(g 3) ... )</span><span>
</span><span id="line-868"></span><span class="hs-comment">-- The recursive call to tcCheckPolyExpr will simply expand the</span><span>
</span><span id="line-869"></span><span class="hs-comment">-- inner escape before dealing with the outer one</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span id="tcTopSpliceExpr"><span class="annot"><span class="annottext">tcTopSpliceExpr :: SpliceType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-var hs-var">tcTopSpliceExpr</span></a></span></span><span> </span><span id="local-6989586621682113303"><span class="annot"><span class="annottext">SpliceType
</span><a href="#local-6989586621682113303"><span class="hs-identifier hs-var">isTypedSplice</span></a></span></span><span> </span><span id="local-6989586621682113304"><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621682113304"><span class="hs-identifier hs-var">tc_action</span></a></span></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- checkNoErrs: must not try to run the thing</span><span>
</span><span id="line-873"></span><span>                   </span><span class="hs-comment">-- if the type checker fails!</span><span>
</span><span id="line-874"></span><span>    </span><span class="annot"><span class="annottext">ThStage -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SpliceType -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-var">Splice</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="#local-6989586621682113303"><span class="hs-identifier hs-var">isTypedSplice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-875"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>    </span><span class="hs-comment">-- Typecheck the expression</span><span>
</span><span id="line-876"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682113306"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682113306"><span class="hs-identifier hs-var">mb_expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113307"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682113307"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM
     (Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc)), WantedConstraints)
forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var">tryCaptureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc)
IOEnv
  (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682113304"><span class="hs-identifier hs-var">tc_action</span></a></span><span>
</span><span id="line-877"></span><span>             </span><span class="hs-comment">-- If tc_action fails (perhaps because of insoluble constraints)</span><span>
</span><span id="line-878"></span><span>             </span><span class="hs-comment">-- we want to capture and report those constraints, else we may</span><span>
</span><span id="line-879"></span><span>             </span><span class="hs-comment">-- just get a silent failure (#20179). Hence the 'try' part.</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113309"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621682113309"><span class="hs-identifier hs-var">const_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM (Bag EvBind)
</span><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-var">simplifyTop</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682113307"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682113306"><span class="hs-identifier hs-var">mb_expr'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-884"></span><span>            </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>   </span><span class="hs-comment">-- In this case simplifyTop should have</span><span>
</span><span id="line-885"></span><span>                                  </span><span class="hs-comment">-- reported some errors</span><span>
</span><span id="line-886"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682113312"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113312"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc))
-&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsDictLet"><span class="hs-identifier hs-var">mkHsDictLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag EvBind -&gt; TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#EvBinds"><span class="hs-identifier hs-var">EvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621682113309"><span class="hs-identifier hs-var">const_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113312"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-889"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-type">tcNestedSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#PendingStuff"><span class="hs-identifier hs-type">PendingStuff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-890"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>    </span><span class="hs-comment">-- See Note [How brackets and nested splices are handled]</span><span>
</span><span id="line-892"></span><span>    </span><span class="hs-comment">-- A splice inside brackets</span><span>
</span><span id="line-893"></span><span id="tcNestedSplice"><span class="annot"><span class="annottext">tcNestedSplice :: ThStage
-&gt; PendingStuff
-&gt; Name
-&gt; LHsExpr GhcRn
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-var hs-var">tcNestedSplice</span></a></span></span><span> </span><span id="local-6989586621682113315"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113315"><span class="hs-identifier hs-var">pop_stage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span id="local-6989586621682113316"><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621682113316"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span> </span><span id="local-6989586621682113317"><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621682113317"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span id="local-6989586621682113318"><span class="annot"><span class="annottext">q :: QuoteWrapper
</span><a href="#local-6989586621682113318"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-type">QuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682113319"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113319"><span class="hs-identifier hs-var">m_var</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682113320"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113320"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621682113321"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113321"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682113322"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113322"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-894"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113323"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113323"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682113322"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-895"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113324"><span class="annot"><span class="annottext">rep :: Type
</span><a href="#local-6989586621682113324"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113323"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-896"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113325"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113325"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var">tcTExpTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113319"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113323"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-897"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113326"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113326"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682113315"><span class="hs-identifier hs-var">pop_stage</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-898"></span><span>                  </span><span class="annot"><span class="annottext">TcRef WantedConstraints
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcRef WantedConstraints -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-var">setConstraintVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621682113317"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-899"></span><span>                  </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113321"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113325"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span><span>
</span><span id="line-900"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113328"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113328"><span class="hs-identifier hs-var">untype_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#unTypeCodeName"><span class="hs-identifier hs-var">unTypeCodeName</span></a></span><span>
</span><span id="line-901"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113330"><span class="annot"><span class="annottext">expr'' :: LHsExpr GhcTc
</span><a href="#local-6989586621682113330"><span class="hs-identifier hs-var hs-var">expr''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#mkHsApp"><span class="hs-identifier hs-var">mkHsApp</span></a></span><span>
</span><span id="line-902"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#applyQuoteWrapper"><span class="hs-identifier hs-var">applyQuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621682113318"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [Type] -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#nlHsTyApp"><span class="hs-identifier hs-var">nlHsTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113328"><span class="hs-identifier hs-var">untype_code</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113324"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113323"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113326"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-904"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113331"><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621682113331"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621682113316"><span class="hs-identifier hs-var">ps_var</span></a></span><span>
</span><span id="line-905"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice] -&gt; [PendingTcSplice] -&gt; TcRn ()
forall a env. IORef a -&gt; a -&gt; IOEnv env ()
</span><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621682113316"><span class="hs-identifier hs-var">ps_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcTc -&gt; PendingTcSplice
</span><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-var">PendingTcSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113320"><span class="hs-identifier hs-var">splice_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113330"><span class="hs-identifier hs-var">expr''</span></a></span><span> </span><span class="annot"><span class="annottext">PendingTcSplice -&gt; [PendingTcSplice] -&gt; [PendingTcSplice]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621682113331"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span>       </span><span class="hs-comment">-- The returned expression is ignored; it's in the pending splices</span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Splice.html#stubNestedSplice"><span class="hs-identifier hs-var">stubNestedSplice</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-var">tcNestedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PendingStuff
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682113334"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113334"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcNestedSplice: rename stage found&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113334"><span class="hs-identifier hs-var">splice_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-915"></span><span class="hs-comment">-- This is called in the zonker</span><span>
</span><span id="line-916"></span><span class="hs-comment">-- See Note [Running typed splices in the zonker]</span><span>
</span><span id="line-917"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTopSplice"><span class="hs-identifier hs-type">runTopSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#DelayedSplice"><span class="hs-identifier hs-type">DelayedSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span id="runTopSplice"><span class="annot"><span class="annottext">runTopSplice :: DelayedSplice -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#runTopSplice"><span class="hs-identifier hs-var hs-var">runTopSplice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#DelayedSplice"><span class="hs-identifier hs-type">DelayedSplice</span></a></span><span> </span><span id="local-6989586621682113335"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682113335"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span id="local-6989586621682113336"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113336"><span class="hs-identifier hs-var">orig_expr</span></a></span></span><span> </span><span id="local-6989586621682113337"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113337"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682113338"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113338"><span class="hs-identifier hs-var">q_expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall gbl a.
TcLclEnv -&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
</span><a href="GHC.Tc.Utils.Monad.html#restoreLclEnv"><span class="hs-identifier hs-var">restoreLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682113335"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-920"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113340"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113340"><span class="hs-identifier hs-var">zonked_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113337"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-921"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113342"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113342"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTopLExpr"><span class="hs-identifier hs-var">zonkTopLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113338"><span class="hs-identifier hs-var">q_expr</span></a></span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-comment">-- See Note [Collecting modFinalizers in typed splices].</span><span>
</span><span id="line-923"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113344"><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621682113344"><span class="hs-identifier hs-var">modfinalizers_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
-&gt; TcRnIf TcGblEnv TcLclEnv (TcRef [ForeignRef (Q ())])
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-924"></span><span>         </span><span class="hs-comment">-- Run the expression</span><span>
</span><span id="line-925"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113346"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621682113346"><span class="hs-identifier hs-var">expr2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; TcM (LHsExpr GhcPs) -&gt; TcM (LHsExpr GhcPs)
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())] -&gt; ThStage
</span><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-var">RunSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621682113344"><span class="hs-identifier hs-var">modfinalizers_ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcPs) -&gt; TcM (LHsExpr GhcPs))
-&gt; TcM (LHsExpr GhcPs) -&gt; TcM (LHsExpr GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-926"></span><span>                    </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier hs-var">runMetaE</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113342"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span><span>
</span><span id="line-927"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113347"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621682113347"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
-&gt; TcRnIf TcGblEnv TcLclEnv [ForeignRef (Q ())]
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621682113344"><span class="hs-identifier hs-var">modfinalizers_ref</span></a></span><span>
</span><span id="line-928"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(ThModFinalizers -&gt; TcRn ()) -&gt; ThModFinalizers -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ThModFinalizers
</span><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-var">ThModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621682113347"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-929"></span><span>       </span><span class="hs-comment">-- We use orig_expr here and not q_expr when tracing as a call to</span><span>
</span><span id="line-930"></span><span>       </span><span class="hs-comment">-- unsafeCodeCoerce is added to the original expression by the</span><span>
</span><span id="line-931"></span><span>       </span><span class="hs-comment">-- typechecker when typed quotes are type checked.</span><span>
</span><span id="line-932"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SpliceInfo -&gt; TcRn ()
</span><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier hs-var">traceSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-type">SpliceInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">spliceDescription :: String
</span><a href="GHC.Rename.Splice.html#spliceDescription"><span class="hs-identifier hs-var">spliceDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expression&quot;</span></span><span>
</span><span id="line-933"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceIsDecl :: Bool
</span><a href="GHC.Rename.Splice.html#spliceIsDecl"><span class="hs-identifier hs-var">spliceIsDecl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-934"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceSource :: Maybe (LHsExpr GhcRn)
</span><a href="GHC.Rename.Splice.html#spliceSource"><span class="hs-identifier hs-var">spliceSource</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682113336"><span class="hs-identifier hs-var">orig_expr</span></a></span><span>
</span><span id="line-935"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceGenerated :: SDoc
</span><a href="GHC.Rename.Splice.html#spliceGenerated"><span class="hs-identifier hs-var">spliceGenerated</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621682113346"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>        </span><span class="hs-comment">-- Rename and typecheck the spliced-in expression,</span><span>
</span><span id="line-937"></span><span>        </span><span class="hs-comment">-- making sure it has type res_ty</span><span>
</span><span id="line-938"></span><span>        </span><span class="hs-comment">-- These steps should never fail; this is a *typed* splice</span><span>
</span><span id="line-939"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113356"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113356"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113357"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682113357"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-940"></span><span>            </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), WantedConstraints))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-941"></span><span>              </span><span class="annot"><span class="annottext">SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#spliceResultDoc"><span class="hs-identifier hs-var">spliceResultDoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113342"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-942"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113360"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682113360"><span class="hs-identifier hs-var">exp3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113361"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621682113361"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621682113346"><span class="hs-identifier hs-var">expr2</span></a></span><span>
</span><span id="line-943"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682113360"><span class="hs-identifier hs-var">exp3</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113340"><span class="hs-identifier hs-var">zonked_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-944"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113363"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621682113363"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM (Bag EvBind)
</span><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-var">simplifyTop</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682113357"><span class="hs-identifier hs-var">wcs</span></a></span><span>
</span><span id="line-945"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcEvBinds -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsDictLet"><span class="hs-identifier hs-var">mkHsDictLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag EvBind -&gt; TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#EvBinds"><span class="hs-identifier hs-var">EvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621682113363"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113356"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *

*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#typedSpliceCtxtDoc"><span class="hs-identifier hs-type">typedSpliceCtxtDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SplicePointName"><span class="hs-identifier hs-type">SplicePointName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-958"></span><span id="typedSpliceCtxtDoc"><span class="annot"><span class="annottext">typedSpliceCtxtDoc :: Name -&gt; LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#typedSpliceCtxtDoc"><span class="hs-identifier hs-var hs-var">typedSpliceCtxtDoc</span></a></span></span><span> </span><span id="local-6989586621682113365"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113365"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682113366"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113366"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SumArity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the Template Haskell splice&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>         </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Name -&gt; LHsExpr GhcRn -&gt; SDoc
forall (p :: Pass).
OutputableBndrId p =&gt;
Maybe Name -&gt; LHsExpr (GhcPass p) -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprTypedSplice"><span class="hs-identifier hs-var">pprTypedSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113365"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113366"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#spliceResultDoc"><span class="hs-identifier hs-type">spliceResultDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-963"></span><span id="spliceResultDoc"><span class="annot"><span class="annottext">spliceResultDoc :: LHsExpr GhcTc -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#spliceResultDoc"><span class="hs-identifier hs-var hs-var">spliceResultDoc</span></a></span></span><span> </span><span id="local-6989586621682113367"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113367"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the result of the splice:&quot;</span></span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'$'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113367"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;To see what the splice expanded to, use -ddump-splices&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#stubNestedSplice"><span class="hs-identifier hs-type">stubNestedSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-969"></span><span class="hs-comment">-- Used when we need a (LHsExpr GhcTc) that we are never going</span><span>
</span><span id="line-970"></span><span class="hs-comment">-- to look at.  We could use &quot;panic&quot; but that's confusing if we ever</span><span>
</span><span id="line-971"></span><span class="hs-comment">-- do a debug-print.  The warning is because this should never happen</span><span>
</span><span id="line-972"></span><span class="hs-comment">-- /except/ when doing debug prints.</span><span>
</span><span id="line-973"></span><span id="stubNestedSplice"><span class="annot"><span class="annottext">stubNestedSplice :: HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Splice.html#stubNestedSplice"><span class="hs-identifier hs-var hs-var">stubNestedSplice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; SDoc -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a. HasCallStack =&gt; Bool -&gt; String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#warnPprTrace"><span class="hs-identifier hs-var">warnPprTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;stubNestedSplice&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-974"></span><span>                   </span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcTc
EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; HsLit GhcTc
forall (p :: Pass). String -&gt; HsLit (GhcPass p)
</span><a href="GHC.Hs.Utils.html#mkHsString"><span class="hs-identifier hs-var">mkHsString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;stubNestedSplice&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Annotations
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span id="runAnnotation"><span class="annot"><span class="annottext">runAnnotation :: CoreAnnTarget -&gt; LHsExpr GhcRn -&gt; TcM Annotation
</span><a href="GHC.Tc.Gen.Splice.html#runAnnotation"><span class="hs-identifier hs-var hs-var">runAnnotation</span></a></span></span><span> </span><span id="local-6989586621682113377"><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682113377"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682113378"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113378"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-986"></span><span>    </span><span class="hs-comment">-- Find the classes we want instances for in order to call toAnnotationWrapper</span><span>
</span><span id="line-987"></span><span>    </span><span id="local-6989586621682113379"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113379"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-988"></span><span>    </span><span id="local-6989586621682113381"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682113381"><span class="hs-identifier hs-var">data_class</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#dataClassName"><span class="hs-identifier hs-var">dataClassName</span></a></span><span>
</span><span id="line-989"></span><span>    </span><span id="local-6989586621682113384"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113384"><span class="hs-identifier hs-var">to_annotation_wrapper_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#toAnnotationWrapperName"><span class="hs-identifier hs-var">toAnnotationWrapperName</span></a></span><span>
</span><span id="line-990"></span><span>
</span><span id="line-991"></span><span>    </span><span class="hs-comment">-- Check the instances we require live in another module (we want to execute it..)</span><span>
</span><span id="line-992"></span><span>    </span><span class="hs-comment">-- and check identifiers live in other modules using TH stage checks. tcSimplifyStagedExpr</span><span>
</span><span id="line-993"></span><span>    </span><span class="hs-comment">-- also resolves the LIE constraints to detect e.g. instance ambiguity</span><span>
</span><span id="line-994"></span><span>    </span><span id="local-6989586621682113386"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113386"><span class="hs-identifier hs-var">zonked_wrapped_expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTopLExpr"><span class="hs-identifier hs-var">zonkTopLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcTc)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3D%3C%3C/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-var">tcTopSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-995"></span><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113389"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113389"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113390"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113390"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682113378"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-996"></span><span>                </span><span class="hs-comment">-- We manually wrap the typechecked expression in a call to toAnnotationWrapper</span><span>
</span><span id="line-997"></span><span>                </span><span class="hs-comment">-- By instantiating the call &gt;here&lt; it gets registered in the</span><span>
</span><span id="line-998"></span><span>                </span><span class="hs-comment">-- LIE consulted by tcTopSpliceExpr</span><span>
</span><span id="line-999"></span><span>                </span><span class="hs-comment">-- and hence ensures the appropriate dictionary is bound by const_binds</span><span>
</span><span id="line-1000"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113391"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682113391"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [Type] -&gt; [Type] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-var">instCall</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#AnnOrigin"><span class="hs-identifier hs-var">AnnOrigin</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113390"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682113381"><span class="hs-identifier hs-var">data_class</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113390"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1001"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113395"><span class="annot"><span class="annottext">loc' :: SrcSpanAnnA
</span><a href="#local-6989586621682113395"><span class="hs-identifier hs-var hs-var">loc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113379"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1002"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113397"><span class="annot"><span class="annottext">specialised_to_annotation_wrapper_expr :: GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113397"><span class="hs-identifier hs-var hs-var">specialised_to_annotation_wrapper_expr</span></a></span></span><span>
</span><span id="line-1003"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682113395"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682113391"><span class="hs-identifier hs-var">wrapper</span></a></span><span>
</span><span id="line-1004"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; LIdP GhcTc -&gt; HsExpr GhcTc
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Id -&gt; GenLocated SrcSpanAnnN Id
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnN
forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113379"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682113384"><span class="hs-identifier hs-var">to_annotation_wrapper_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1005"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682113395"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcTc
EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span>
</span><span id="line-1006"></span><span>                                </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113397"><span class="hs-identifier hs-var">specialised_to_annotation_wrapper_expr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113389"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1007"></span><span>                                </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span>    </span><span class="hs-comment">-- Run the appropriately wrapped expression to get the value of</span><span>
</span><span id="line-1010"></span><span>    </span><span class="hs-comment">-- the annotation and its dictionaries. The return value is of</span><span>
</span><span id="line-1011"></span><span>    </span><span class="hs-comment">-- type AnnotationWrapper by construction, so this conversion is</span><span>
</span><span id="line-1012"></span><span>    </span><span class="hs-comment">-- safe</span><span>
</span><span id="line-1013"></span><span>    </span><span id="local-6989586621682113402"><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621682113402"><span class="hs-identifier hs-var">serialized</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM Serialized
</span><a href="GHC.Tc.Gen.Splice.html#runMetaAW"><span class="hs-identifier hs-var">runMetaAW</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113386"><span class="hs-identifier hs-var">zonked_wrapped_expr'</span></a></span><span>
</span><span id="line-1014"></span><span>    </span><span class="annot"><span class="annottext">Annotation -&gt; TcM Annotation
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1015"></span><span>               </span><span class="annot"><span class="annottext">ann_target :: CoreAnnTarget
</span><a href="GHC.Types.Annotations.html#ann_target"><span class="hs-identifier hs-var">ann_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682113377"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1016"></span><span>               </span><span class="annot"><span class="annottext">ann_value :: Serialized
</span><a href="GHC.Types.Annotations.html#ann_value"><span class="hs-identifier hs-var">ann_value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621682113402"><span class="hs-identifier hs-var">serialized</span></a></span><span>
</span><span id="line-1017"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#convertAnnotationWrapper"><span class="hs-identifier hs-type">convertAnnotationWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#Serialized/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span>
</span><span id="line-1020"></span><span id="convertAnnotationWrapper"><span class="annot"><span class="annottext">convertAnnotationWrapper :: ForeignHValue -&gt; TcM Serialized
</span><a href="GHC.Tc.Gen.Splice.html#convertAnnotationWrapper"><span class="hs-identifier hs-var hs-var">convertAnnotationWrapper</span></a></span></span><span> </span><span id="local-6989586621682113408"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682113408"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1021"></span><span>  </span><span id="local-6989586621682113409"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682113409"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var">tcGetInterp</span></a></span><span>
</span><span id="line-1022"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682113409"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1023"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Serialized
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#THAnnWrapper/GHCi.Message.html#THAnnWrapper"><span class="hs-identifier hs-var">THAnnWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682113408"><span class="hs-identifier hs-var">fhv</span></a></span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1026"></span><span>      </span><span id="local-6989586621682113416"><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621682113416"><span class="hs-identifier hs-var">annotation_wrapper</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue)
-&gt; IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO HValue
forall a. Interp -&gt; ForeignRef a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier hs-var">wormhole</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682113409"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682113408"><span class="hs-identifier hs-var">fhv</span></a></span><span>
</span><span id="line-1027"></span><span>      </span><span class="annot"><span class="annottext">Serialized -&gt; TcM Serialized
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Serialized -&gt; TcM Serialized) -&gt; Serialized -&gt; TcM Serialized
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1028"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HValue -&gt; AnnotationWrapper
forall a b. a -&gt; b
</span><a href="../../base-4.18.3.0/src/Unsafe.Coerce.html#unsafeCoerce/Unsafe.Coerce.html#unsafeCoerce"><span class="hs-identifier hs-var">unsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621682113416"><span class="hs-identifier hs-var">annotation_wrapper</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1029"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Desugar.html#AnnotationWrapper/GHC.Desugar.html#AnnotationWrapper"><span class="hs-identifier hs-type">AnnotationWrapper</span></a></span><span> </span><span id="local-6989586621682113425"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113425"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113426"><span class="annot"><span class="annottext">serialized :: Serialized
</span><a href="#local-6989586621682113426"><span class="hs-identifier hs-var hs-var">serialized</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [Word8]) -&gt; a -&gt; Serialized
forall a. Typeable a =&gt; (a -&gt; [Word8]) -&gt; a -&gt; Serialized
</span><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#toSerialized/GHC.Serialized.html#toSerialized"><span class="hs-identifier hs-var">toSerialized</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [Word8]
forall a. Data a =&gt; a -&gt; [Word8]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#serializeWithData/GHC.Serialized.html#serializeWithData"><span class="hs-identifier hs-var">serializeWithData</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113425"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1030"></span><span>               </span><span class="hs-comment">-- Got the value and dictionaries: build the serialized value and</span><span>
</span><span id="line-1031"></span><span>               </span><span class="hs-comment">-- call it a day. We ensure that we seq the entire serialized value</span><span>
</span><span id="line-1032"></span><span>               </span><span class="hs-comment">-- in order that any errors in the user-written code for the</span><span>
</span><span id="line-1033"></span><span>               </span><span class="hs-comment">-- annotation are exposed at this point.  This is also why we are</span><span>
</span><span id="line-1034"></span><span>               </span><span class="hs-comment">-- doing all this stuff inside the context of runMeta: it has the</span><span>
</span><span id="line-1035"></span><span>               </span><span class="hs-comment">-- facilities to deal with user error in a meta-level expression</span><span>
</span><span id="line-1036"></span><span>               </span><span class="annot"><span class="annottext">Serialized -&gt; ()
</span><a href="GHC.Tc.Gen.Splice.html#seqSerialized"><span class="hs-identifier hs-var">seqSerialized</span></a></span><span> </span><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621682113426"><span class="hs-identifier hs-var">serialized</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Serialized -&gt; Serialized
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621682113426"><span class="hs-identifier hs-var">serialized</span></a></span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span class="annot"><span class="hs-comment">-- | Force the contents of the Serialized value so weknow it doesn't contain any bottoms</span></span><span>
</span><span id="line-1039"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#seqSerialized"><span class="hs-identifier hs-type">seqSerialized</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#Serialized/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span id="seqSerialized"><span class="annot"><span class="annottext">seqSerialized :: Serialized -&gt; ()
</span><a href="GHC.Tc.Gen.Splice.html#seqSerialized"><span class="hs-identifier hs-var hs-var">seqSerialized</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#Serialized/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span> </span><span id="local-6989586621682113431"><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621682113431"><span class="hs-identifier hs-var">the_type</span></a></span></span><span> </span><span id="local-6989586621682113432"><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621682113432"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621682113431"><span class="hs-identifier hs-var">the_type</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621682113432"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; () -&gt; ()
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-1044"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Running an expression}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span id="local-6989586621682111972"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-type">runQuasi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Q/Language.Haskell.TH.Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682111972"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682111972"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1053"></span><span id="runQuasi"><span class="annot"><span class="annottext">runQuasi :: forall a. Q a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-var hs-var">runQuasi</span></a></span></span><span> </span><span id="local-6989586621682113436"><span class="annot"><span class="annottext">Q a
</span><a href="#local-6989586621682113436"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Quasi m =&gt; Q a -&gt; m a
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#runQ/Language.Haskell.TH.Syntax.html#runQ"><span class="hs-identifier hs-var">TH.runQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q a
</span><a href="#local-6989586621682113436"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-1054"></span><span>
</span><span id="line-1055"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier hs-type">runRemoteModFinalizers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-type">ThModFinalizers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span id="runRemoteModFinalizers"><span class="annot"><span class="annottext">runRemoteModFinalizers :: ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier hs-var hs-var">runRemoteModFinalizers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-type">ThModFinalizers</span></a></span><span> </span><span id="local-6989586621682113438"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621682113438"><span class="hs-identifier hs-var">finRefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1057"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113439"><span class="annot"><span class="annottext">withForeignRefs :: [ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621682113439"><span class="hs-identifier hs-var hs-var">withForeignRefs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682113440"><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621682113440"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621682113440"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1058"></span><span>      </span><span class="annot"><a href="#local-6989586621682113439"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113441"><span class="annot"><span class="annottext">ForeignRef a
</span><a href="#local-6989586621682113441"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682113442"><span class="annot"><span class="annottext">[ForeignRef a]
</span><a href="#local-6989586621682113442"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682113443"><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621682113443"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#withForeignRef/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef a
</span><a href="#local-6989586621682113441"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef a -&gt; IO b) -&gt; IO b) -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682113445"><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682113445"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1059"></span><span>        </span><span class="annot"><span class="annottext">[ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621682113439"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef a]
</span><a href="#local-6989586621682113442"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">(([RemoteRef a] -&gt; IO b) -&gt; IO b)
-&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682113446"><span class="annot"><span class="annottext">[RemoteRef a]
</span><a href="#local-6989586621682113446"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621682113443"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682113445"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a -&gt; [RemoteRef a] -&gt; [RemoteRef a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[RemoteRef a]
</span><a href="#local-6989586621682113446"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>  </span><span id="local-6989586621682113447"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682113447"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var">tcGetInterp</span></a></span><span>
</span><span id="line-1061"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682113447"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1064"></span><span>      </span><span id="local-6989586621682113448"><span class="annot"><span class="annottext">[Q ()]
</span><a href="#local-6989586621682113448"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Q ()] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Q ()]
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
-&gt; ([RemoteRef (Q ())] -&gt; IO [Q ()]) -&gt; IO [Q ()]
forall {a} {b}. [ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621682113439"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621682113438"><span class="hs-identifier hs-var">finRefs</span></a></span><span> </span><span class="annot"><span class="annottext">(([RemoteRef (Q ())] -&gt; IO [Q ()]) -&gt; IO [Q ()])
-&gt; ([RemoteRef (Q ())] -&gt; IO [Q ()]) -&gt; IO [Q ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteRef (Q ()) -&gt; IO (Q ())) -&gt; [RemoteRef (Q ())] -&gt; IO [Q ()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ()) -&gt; IO (Q ())
forall a. RemoteRef a -&gt; IO a
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#localRef/GHCi.RemoteTypes.html#localRef"><span class="hs-identifier hs-var">localRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1065"></span><span>      </span><span class="annot"><span class="annottext">Q () -&gt; TcRn ()
forall a. Q a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-var">runQuasi</span></a></span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; TcRn ()) -&gt; Q () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Q ()] -&gt; Q ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#sequence_/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="annot"><span class="annottext">[Q ()]
</span><a href="#local-6989586621682113448"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1068"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682113451"><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682113451"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621682113452"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682113452"><span class="hs-identifier hs-var">iserv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IServConfig -&gt; IServ -&gt; (IServInstance -&gt; TcRn ()) -&gt; TcRn ()
forall (m :: * -&gt; *) a.
(MonadIO m, ExceptionMonad m) =&gt;
IServConfig -&gt; IServ -&gt; (IServInstance -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ_"><span class="hs-identifier hs-var">withIServ_</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682113451"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682113452"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">((IServInstance -&gt; TcRn ()) -&gt; TcRn ())
-&gt; (IServInstance -&gt; TcRn ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682113454"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682113454"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1069"></span><span>      </span><span id="local-6989586621682113455"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682113455"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1070"></span><span>      </span><span id="local-6989586621682113457"><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621682113457"><span class="hs-identifier hs-var">th_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; TcRnIf TcGblEnv TcLclEnv (Maybe (ForeignRef (IORef QState)))
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682113455"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1071"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621682113457"><span class="hs-identifier hs-var">th_state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1072"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TH was not started, nothing to do</span><span>
</span><span id="line-1073"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682113459"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682113459"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1074"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; TcRn ()
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcRn ()) -&gt; IO () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#withForeignRef/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682113459"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682113460"><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621682113460"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1075"></span><span>            </span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ([RemoteRef (Q ())] -&gt; IO ()) -&gt; IO ()
forall {a} {b}. [ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621682113439"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621682113438"><span class="hs-identifier hs-var">finRefs</span></a></span><span> </span><span class="annot"><span class="annottext">(([RemoteRef (Q ())] -&gt; IO ()) -&gt; IO ())
-&gt; ([RemoteRef (Q ())] -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682113461"><span class="annot"><span class="annottext">[RemoteRef (Q ())]
</span><a href="#local-6989586621682113461"><span class="hs-identifier hs-var">qrefs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1076"></span><span>              </span><span class="annot"><span class="annottext">IServInstance -&gt; Put -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#writeIServ"><span class="hs-identifier hs-var">writeIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682113454"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message (QResult ()) -&gt; Put
forall a. Message a -&gt; Put
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#putMessage/GHCi.Message.html#putMessage"><span class="hs-identifier hs-var">putMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
-&gt; [RemoteRef (Q ())] -&gt; Message (QResult ())
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#RunModFinalizers/GHCi.Message.html#RunModFinalizers"><span class="hs-identifier hs-var">RunModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621682113460"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">[RemoteRef (Q ())]
</span><a href="#local-6989586621682113461"><span class="hs-identifier hs-var">qrefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages TcRnMessage] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682113454"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1078"></span><span>          </span><span class="annot"><span class="annottext">IServInstance -&gt; TcRn ()
forall a. Binary a =&gt; IServInstance -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-var">readQResult</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682113454"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span id="local-6989586621682111999"><span id="local-6989586621682112001"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-type">runQResult</span></a></span><span>
</span><span id="line-1081"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682111999"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682111999"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682112001"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1083"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682111999"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1085"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-comment">{- TH.Q a -}</span><span>
</span><span id="line-1086"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112001"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-1087"></span><span id="runQResult"><span class="annot"><span class="annottext">runQResult :: forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var hs-var">runQResult</span></a></span></span><span> </span><span id="local-6989586621682113473"><span class="annot"><span class="annottext">a -&gt; String
</span><a href="#local-6989586621682113473"><span class="hs-identifier hs-var">show_th</span></a></span></span><span> </span><span id="local-6989586621682113474"><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; a -&gt; b
</span><a href="#local-6989586621682113474"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682113475"><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM a
</span><a href="#local-6989586621682113475"><span class="hs-identifier hs-var">runQ</span></a></span></span><span> </span><span id="local-6989586621682113476"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113476"><span class="hs-identifier hs-var">expr_span</span></a></span></span><span> </span><span id="local-6989586621682113477"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682113477"><span class="hs-identifier hs-var">hval</span></a></span></span><span>
</span><span id="line-1088"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113478"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113478"><span class="hs-identifier hs-var">th_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM a
</span><a href="#local-6989586621682113475"><span class="hs-identifier hs-var">runQ</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682113477"><span class="hs-identifier hs-var">hval</span></a></span><span>
</span><span id="line-1089"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113479"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682113479"><span class="hs-identifier hs-var">th_origin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var">getThSpliceOrigin</span></a></span><span>
</span><span id="line-1090"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got TH result:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
</span><a href="#local-6989586621682113473"><span class="hs-identifier hs-var">show_th</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113478"><span class="hs-identifier hs-var">th_result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">b -&gt; TcM b
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; a -&gt; b
</span><a href="#local-6989586621682113474"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682113479"><span class="hs-identifier hs-var">th_origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113476"><span class="hs-identifier hs-var">expr_span</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113478"><span class="hs-identifier hs-var">th_result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-1095"></span><span id="local-6989586621682112005"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-type">runMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Meta.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112005"><span class="hs-identifier hs-type">hs_syn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-1097"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112005"><span class="hs-identifier hs-type">hs_syn</span></a></span></span><span>
</span><span id="line-1098"></span><span id="runMeta"><span class="annot"><span class="annottext">runMeta :: forall hs_syn.
(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var hs-var">runMeta</span></a></span></span><span> </span><span id="local-6989586621682113487"><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="#local-6989586621682113487"><span class="hs-identifier hs-var">unwrap</span></a></span></span><span> </span><span id="local-6989586621682113488"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113488"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1099"></span><span>    </span><span id="local-6989586621682113489"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621682113489"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Hooks
forall (m :: * -&gt; *). HasHooks m =&gt; m Hooks
</span><a href="GHC.Driver.Hooks.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span>
</span><span id="line-1100"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Hooks -&gt; Maybe (MetaHook (IOEnv (Env TcGblEnv TcLclEnv)))
</span><a href="GHC.Driver.Hooks.html#runMetaHook"><span class="hs-identifier hs-var">runMetaHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621682113489"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1101"></span><span>        </span><span class="annot"><span class="annottext">Maybe (MetaHook (IOEnv (Env TcGblEnv TcLclEnv)))
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="#local-6989586621682113487"><span class="hs-identifier hs-var">unwrap</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
</span><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113488"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1102"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682113492"><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
</span><a href="#local-6989586621682113492"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="#local-6989586621682113487"><span class="hs-identifier hs-var">unwrap</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
</span><a href="#local-6989586621682113492"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113488"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-type">defaultRunMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Meta.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span>
</span><span id="line-1105"></span><span id="defaultRunMeta"><span class="annot"><span class="annottext">defaultRunMeta :: MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
</span><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var hs-var">defaultRunMeta</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Meta.html#MetaE"><span class="hs-identifier hs-type">MetaE</span></a></span><span> </span><span id="local-6989586621682113494"><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; MetaResult
</span><a href="#local-6989586621682113494"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcPs) -&gt; MetaResult)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcPs))
-&gt; TcM MetaResult
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; MetaResult
GenLocated SrcSpanAnnA (HsExpr GhcPs) -&gt; MetaResult
</span><a href="#local-6989586621682113494"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcPs))
 -&gt; TcM MetaResult)
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcTc)
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; TcM MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcPs) -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue
    -&gt; TcM
         (Either
            RunSpliceFailReason (GenLocated SrcSpanAnnA (HsExpr GhcPs))))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcPs))
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp -&gt; String)
-&gt; (Origin
    -&gt; SrcSpan
    -&gt; Exp
    -&gt; Either
         RunSpliceFailReason (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
-&gt; (ForeignHValue -&gt; TcM Exp)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM
     (Either
        RunSpliceFailReason (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Ppr.html#pprint/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; SrcSpan -&gt; Exp -&gt; Either RunSpliceFailReason (LHsExpr GhcPs)
Origin
-&gt; SrcSpan
-&gt; Exp
-&gt; Either
     RunSpliceFailReason (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="GHC.ThToHs.html#convertToHsExpr"><span class="hs-identifier hs-var">convertToHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM Exp
</span><a href="GHC.Tc.Gen.Splice.html#runTHExp"><span class="hs-identifier hs-var">runTHExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Meta.html#MetaP"><span class="hs-identifier hs-type">MetaP</span></a></span><span> </span><span id="local-6989586621682113499"><span class="annot"><span class="annottext">LPat GhcPs -&gt; MetaResult
</span><a href="#local-6989586621682113499"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1108"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcPs) -&gt; MetaResult)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcPs))
-&gt; TcM MetaResult
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcPs -&gt; MetaResult
GenLocated SrcSpanAnnA (Pat GhcPs) -&gt; MetaResult
</span><a href="#local-6989586621682113499"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcPs))
 -&gt; TcM MetaResult)
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcTc)
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcPs)))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; TcM MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (GenLocated SrcSpanAnnA (Pat GhcPs) -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue
    -&gt; TcM
         (Either RunSpliceFailReason (GenLocated SrcSpanAnnA (Pat GhcPs))))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcPs))
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcPs) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Pat -&gt; String)
-&gt; (Origin
    -&gt; SrcSpan
    -&gt; Pat
    -&gt; Either RunSpliceFailReason (GenLocated SrcSpanAnnA (Pat GhcPs)))
-&gt; (ForeignHValue -&gt; TcM Pat)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM
     (Either RunSpliceFailReason (GenLocated SrcSpanAnnA (Pat GhcPs)))
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Ppr.html#pprint/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; Pat -&gt; Either RunSpliceFailReason (LPat GhcPs)
Origin
-&gt; SrcSpan
-&gt; Pat
-&gt; Either RunSpliceFailReason (GenLocated SrcSpanAnnA (Pat GhcPs))
</span><a href="GHC.ThToHs.html#convertToPat"><span class="hs-identifier hs-var">convertToPat</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM Pat
</span><a href="GHC.Tc.Gen.Splice.html#runTHPat"><span class="hs-identifier hs-var">runTHPat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1109"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Meta.html#MetaT"><span class="hs-identifier hs-type">MetaT</span></a></span><span> </span><span id="local-6989586621682113503"><span class="annot"><span class="annottext">LHsType GhcPs -&gt; MetaResult
</span><a href="#local-6989586621682113503"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcPs) -&gt; MetaResult)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs))
-&gt; TcM MetaResult
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; MetaResult
GenLocated SrcSpanAnnA (HsType GhcPs) -&gt; MetaResult
</span><a href="#local-6989586621682113503"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs))
 -&gt; TcM MetaResult)
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcTc)
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs)))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; TcM MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (GenLocated SrcSpanAnnA (HsType GhcPs) -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue
    -&gt; TcM
         (Either
            RunSpliceFailReason (GenLocated SrcSpanAnnA (HsType GhcPs))))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs))
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcPs) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; String)
-&gt; (Origin
    -&gt; SrcSpan
    -&gt; Type
    -&gt; Either
         RunSpliceFailReason (GenLocated SrcSpanAnnA (HsType GhcPs)))
-&gt; (ForeignHValue -&gt; TcM Type)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM
     (Either
        RunSpliceFailReason (GenLocated SrcSpanAnnA (HsType GhcPs)))
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Ppr.html#pprint/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; SrcSpan -&gt; Type -&gt; Either RunSpliceFailReason (LHsType GhcPs)
Origin
-&gt; SrcSpan
-&gt; Type
-&gt; Either
     RunSpliceFailReason (GenLocated SrcSpanAnnA (HsType GhcPs))
</span><a href="GHC.ThToHs.html#convertToHsType"><span class="hs-identifier hs-var">convertToHsType</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#runTHType"><span class="hs-identifier hs-var">runTHType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1111"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Meta.html#MetaD"><span class="hs-identifier hs-type">MetaD</span></a></span><span> </span><span id="local-6989586621682113507"><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; MetaResult
</span><a href="#local-6989586621682113507"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (HsDecl GhcPs)] -&gt; MetaResult)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
-&gt; TcM MetaResult
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; MetaResult
[GenLocated SrcSpanAnnA (HsDecl GhcPs)] -&gt; MetaResult
</span><a href="#local-6989586621682113507"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
 -&gt; TcM MetaResult)
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcTc)
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; TcM MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ([GenLocated SrcSpanAnnA (HsDecl GhcPs)] -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue
    -&gt; TcM
         (Either
            RunSpliceFailReason [GenLocated SrcSpanAnnA (HsDecl GhcPs)]))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Dec] -&gt; String)
-&gt; (Origin
    -&gt; SrcSpan
    -&gt; [Dec]
    -&gt; Either
         RunSpliceFailReason [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
-&gt; (ForeignHValue -&gt; TcM [Dec])
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM
     (Either
        RunSpliceFailReason [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Ppr.html#pprint/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; SrcSpan -&gt; [Dec] -&gt; Either RunSpliceFailReason [LHsDecl GhcPs]
Origin
-&gt; SrcSpan
-&gt; [Dec]
-&gt; Either
     RunSpliceFailReason [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="GHC.ThToHs.html#convertToHsDecls"><span class="hs-identifier hs-var">convertToHsDecls</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#runTHDec"><span class="hs-identifier hs-var">runTHDec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1113"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Meta.html#MetaAW"><span class="hs-identifier hs-type">MetaAW</span></a></span><span> </span><span id="local-6989586621682113511"><span class="annot"><span class="annottext">Serialized -&gt; MetaResult
</span><a href="#local-6989586621682113511"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Serialized -&gt; MetaResult) -&gt; TcM Serialized -&gt; TcM MetaResult
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Serialized -&gt; MetaResult
</span><a href="#local-6989586621682113511"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Serialized -&gt; TcM MetaResult)
-&gt; (GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; TcM Serialized)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; TcM MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (Serialized -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason Serialized))
-&gt; LHsExpr GhcTc
-&gt; TcM Serialized
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Serialized -&gt; SDoc
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForeignHValue -&gt; TcM (Either RunSpliceFailReason Serialized))
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM (Either RunSpliceFailReason Serialized)
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">((ForeignHValue -&gt; TcM (Either RunSpliceFailReason Serialized))
 -&gt; SrcSpan
 -&gt; ForeignHValue
 -&gt; TcM (Either RunSpliceFailReason Serialized))
-&gt; (ForeignHValue -&gt; TcM (Either RunSpliceFailReason Serialized))
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM (Either RunSpliceFailReason Serialized)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Serialized -&gt; Either RunSpliceFailReason Serialized)
-&gt; TcM Serialized -&gt; TcM (Either RunSpliceFailReason Serialized)
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Serialized -&gt; Either RunSpliceFailReason Serialized
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Serialized -&gt; TcM (Either RunSpliceFailReason Serialized))
-&gt; (ForeignHValue -&gt; TcM Serialized)
-&gt; ForeignHValue
-&gt; TcM (Either RunSpliceFailReason Serialized)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM Serialized
</span><a href="GHC.Tc.Gen.Splice.html#convertAnnotationWrapper"><span class="hs-identifier hs-var">convertAnnotationWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span>    </span><span class="hs-comment">-- We turn off showing the code in meta-level exceptions because doing so exposes</span><span>
</span><span id="line-1116"></span><span>    </span><span class="hs-comment">-- the toAnnotationWrapper function that we slap around the user's code</span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-1119"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaAW"><span class="hs-identifier hs-type">runMetaAW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>         </span><span class="hs-comment">-- Of type AnnotationWrapper</span><span>
</span><span id="line-1120"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#Serialized/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span>
</span><span id="line-1121"></span><span id="runMetaAW"><span class="annot"><span class="annottext">runMetaAW :: LHsExpr GhcTc -&gt; TcM Serialized
</span><a href="GHC.Tc.Gen.Splice.html#runMetaAW"><span class="hs-identifier hs-var hs-var">runMetaAW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc -&gt; TcM Serialized)
-&gt; LHsExpr GhcTc -&gt; TcM Serialized
forall hs_syn.
(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM Serialized
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f Serialized
</span><a href="GHC.Types.Meta.html#metaRequestAW"><span class="hs-identifier hs-var">metaRequestAW</span></a></span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier hs-type">runMetaE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type (Q Exp)</span><span>
</span><span id="line-1124"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span id="runMetaE"><span class="annot"><span class="annottext">runMetaE :: LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier hs-var hs-var">runMetaE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcPs)))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcPs))
forall hs_syn.
(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcPs))
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f (LHsExpr GhcPs)
</span><a href="GHC.Types.Meta.html#metaRequestE"><span class="hs-identifier hs-var">metaRequestE</span></a></span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier hs-type">runMetaP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type (Q Pat)</span><span>
</span><span id="line-1128"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span id="runMetaP"><span class="annot"><span class="annottext">runMetaP :: LHsExpr GhcTc -&gt; TcM (LPat GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier hs-var hs-var">runMetaP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcPs)))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcPs))
forall hs_syn.
(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM (LPat GhcPs)
MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcPs))
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f (LPat GhcPs)
</span><a href="GHC.Types.Meta.html#metaRequestP"><span class="hs-identifier hs-var">metaRequestP</span></a></span><span>
</span><span id="line-1130"></span><span>
</span><span id="line-1131"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier hs-type">runMetaT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type (Q Type)</span><span>
</span><span id="line-1132"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span id="runMetaT"><span class="annot"><span class="annottext">runMetaT :: LHsExpr GhcTc -&gt; TcM (LHsType GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier hs-var hs-var">runMetaT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs)))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs))
forall hs_syn.
(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM (LHsType GhcPs)
MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs))
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f (LHsType GhcPs)
</span><a href="GHC.Types.Meta.html#metaRequestT"><span class="hs-identifier hs-var">metaRequestT</span></a></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier hs-type">runMetaD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type Q [Dec]</span><span>
</span><span id="line-1136"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1137"></span><span id="runMetaD"><span class="annot"><span class="annottext">runMetaD :: LHsExpr GhcTc -&gt; TcM [LHsDecl GhcPs]
</span><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier hs-var hs-var">runMetaD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
forall hs_syn.
(MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
 -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc -&gt; TcM [LHsDecl GhcPs]
MetaHook (IOEnv (Env TcGblEnv TcLclEnv))
-&gt; LHsExpr GhcTc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f [LHsDecl GhcPs]
</span><a href="GHC.Types.Meta.html#metaRequestD"><span class="hs-identifier hs-var">metaRequestD</span></a></span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span class="hs-comment">{- Note [Errors in desugaring a splice]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
What should we do if there are errors when desugaring a splice? We should
abort. There are several cases to consider:

(a) The desugarer hits an unrecoverable error and fails in the monad.
(b) The desugarer hits a recoverable error, reports it, and continues.
(c) The desugarer reports a fatal warning (with -Werror), reports it, and continues.
(d) The desugarer reports a non-fatal warning, and continues.

Each case is tested in th/T19709[abcd].

General principle: we wish to report all messages from dealing with a splice
eagerly, as these messages arise during an earlier stage than type-checking
generally. It's also likely that a compile-time warning from spliced code
will be easier to understand then an error that arises from processing the
code the splice produces. (Rationale: the warning will be about the code the
user actually wrote, not what is generated.)

Case (a): We have no choice but to abort here, but we must make sure that
the messages are printed or logged before aborting. Logging them is annoying,
because we're in the type-checker, and the messages are DsMessages, from the
desugarer. So we report and then fail in the monad. This case is detected
by the fact that initDsTc returns Nothing.

Case (b): We detect this case by looking for errors in the messages returned
from initDsTc and aborting if we spot any (after printing, of course). Note
that initDsTc will return a Just ds_expr in this case, but we don't wish to
use the (likely very bogus) expression.

Case (c): This is functionally the same as (b), except that the expression
isn't bogus. We still don't wish to use it, as the user's request for -Werror
tells us not to.

Case (d): We report the warnings and then carry on with the expression.
This might result in warnings printed out of source order, but this is
appropriate, as the warnings from the splice arise from an earlier stage
of compilation.

Previously, we failed to abort in cases (b) and (c), leading to #19709.
-}</span><span>
</span><span id="line-1180"></span><span>
</span><span id="line-1181"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-1182"></span><span id="local-6989586621682112020"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-type">runMeta'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                 </span><span class="hs-comment">-- Whether code should be printed in the exception message</span><span>
</span><span id="line-1183"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682112020"><span class="hs-identifier hs-type">hs_syn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>                                    </span><span class="hs-comment">-- how to print the code</span><span>
</span><span id="line-1184"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#RunSpliceFailReason"><span class="hs-identifier hs-type">RunSpliceFailReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112020"><span class="hs-identifier hs-type">hs_syn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- How to run x</span><span>
</span><span id="line-1185"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>        </span><span class="hs-comment">-- Of type x; typically x = Q TH.Exp, or</span><span>
</span><span id="line-1186"></span><span>                                 </span><span class="hs-comment">--    something like that</span><span>
</span><span id="line-1187"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112020"><span class="hs-identifier hs-type">hs_syn</span></a></span></span><span>           </span><span class="hs-comment">-- Of type t</span><span>
</span><span id="line-1188"></span><span id="runMeta%27"><span class="annot"><span class="annottext">runMeta' :: forall hs_syn.
Bool
-&gt; (hs_syn -&gt; SDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var hs-var">runMeta'</span></a></span></span><span> </span><span id="local-6989586621682113562"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682113562"><span class="hs-identifier hs-var">show_code</span></a></span></span><span> </span><span id="local-6989586621682113563"><span class="annot"><span class="annottext">hs_syn -&gt; SDoc
</span><a href="#local-6989586621682113563"><span class="hs-identifier hs-var">ppr_hs</span></a></span></span><span> </span><span id="local-6989586621682113564"><span class="annot"><span class="annottext">SrcSpan -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn)
</span><a href="#local-6989586621682113564"><span class="hs-identifier hs-var">run_and_convert</span></a></span></span><span> </span><span id="local-6989586621682113565"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113565"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-1189"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;About to run&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113565"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier hs-var">recordThSpliceUse</span></a></span><span> </span><span class="hs-comment">-- seems to be the best place to do this,</span><span>
</span><span id="line-1191"></span><span>                            </span><span class="hs-comment">-- we catch all kinds of splices and annotations.</span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span>        </span><span class="hs-comment">-- Check that we've had no errors of any sort so far.</span><span>
</span><span id="line-1194"></span><span>        </span><span class="hs-comment">-- For example, if we found an error in an earlier defn f, but</span><span>
</span><span id="line-1195"></span><span>        </span><span class="hs-comment">-- recovered giving it type f :: forall a.a, it'd be very dodgy</span><span>
</span><span id="line-1196"></span><span>        </span><span class="hs-comment">-- to carry on.  Mind you, the staging restrictions mean we won't</span><span>
</span><span id="line-1197"></span><span>        </span><span class="hs-comment">-- actually run f, but it still seems wrong. And, more concretely,</span><span>
</span><span id="line-1198"></span><span>        </span><span class="hs-comment">-- see #5358 for an example that fell over when trying to</span><span>
</span><span id="line-1199"></span><span>        </span><span class="hs-comment">-- reify a function with an unlifted kind in it.  (These don't occur</span><span>
</span><span id="line-1200"></span><span>        </span><span class="hs-comment">-- in type-correct programs.)</span><span>
</span><span id="line-1201"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>        </span><span class="hs-comment">-- run plugins</span><span>
</span><span id="line-1204"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113568"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682113568"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1205"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113570"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113570"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Plugins
-&gt; PluginOperation
     (IOEnv (Env TcGblEnv TcLclEnv))
     (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall (m :: * -&gt; *) a.
Monad m =&gt;
Plugins -&gt; PluginOperation m a -&gt; a -&gt; m a
</span><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-var">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682113568"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Plugin -&gt; [String] -&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
PluginOperation
  (IOEnv (Env TcGblEnv TcLclEnv))
  (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Driver.Plugins.html#spliceRunAction"><span class="hs-identifier hs-var">spliceRunAction</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113565"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span>        </span><span class="hs-comment">-- Desugar</span><span>
</span><span id="line-1208"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113574"><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682113574"><span class="hs-identifier hs-var">ds_msgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113575"><span class="annot"><span class="annottext">Maybe CoreExpr
</span><a href="#local-6989586621682113575"><span class="hs-identifier hs-var">mb_ds_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM CoreExpr -&gt; TcM (Messages DsMessage, Maybe CoreExpr)
forall a. DsM a -&gt; TcM (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier hs-var">initDsTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113570"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>        </span><span class="hs-comment">-- Print any messages (even warnings) eagerly: they might be helpful if anything</span><span>
</span><span id="line-1211"></span><span>        </span><span class="hs-comment">-- goes wrong. See Note [Errors in desugaring a splice]. This happens in all</span><span>
</span><span id="line-1212"></span><span>        </span><span class="hs-comment">-- cases.</span><span>
</span><span id="line-1213"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113578"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682113578"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-1214"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113580"><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682113580"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DiagOpts)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DynFlags
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DiagOpts
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1215"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113583"><span class="annot"><span class="annottext">NoDiagnosticOpts
</span><a href="#local-6989586621682113583"><span class="hs-identifier hs-var">print_config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; NoDiagnosticOpts
DynFlags -&gt; DiagnosticOpts DsMessage
</span><a href="GHC.Driver.Config.Diagnostic.html#initDsMessageOpts"><span class="hs-identifier hs-var">initDsMessageOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; NoDiagnosticOpts)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DynFlags
-&gt; IOEnv (Env TcGblEnv TcLclEnv) NoDiagnosticOpts
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1216"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; TcRn ()
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcRn ()) -&gt; IO () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; DiagnosticOpts DsMessage
-&gt; DiagOpts
-&gt; Messages DsMessage
-&gt; IO ()
forall a.
Diagnostic a =&gt;
Logger -&gt; DiagnosticOpts a -&gt; DiagOpts -&gt; Messages a -&gt; IO ()
</span><a href="GHC.Driver.Errors.html#printMessages"><span class="hs-identifier hs-var">printMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682113578"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">NoDiagnosticOpts
DiagnosticOpts DsMessage
</span><a href="#local-6989586621682113583"><span class="hs-identifier hs-var">print_config</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682113580"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682113574"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113586"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682113586"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CoreExpr
</span><a href="#local-6989586621682113575"><span class="hs-identifier hs-var">mb_ds_expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1219"></span><span>            </span><span class="annot"><span class="annottext">Maybe CoreExpr
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) CoreExpr
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>   </span><span class="hs-comment">-- Case (a) from Note [Errors in desugaring a splice]</span><span>
</span><span id="line-1220"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682113587"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682113587"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-comment">-- There still might be a fatal warning or recoverable</span><span>
</span><span id="line-1221"></span><span>                             </span><span class="hs-comment">-- Cases (b) and (c) from Note [Errors in desugaring a splice]</span><span>
</span><span id="line-1222"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages DsMessage -&gt; Bool
forall e. Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#errorsOrFatalWarningsFound"><span class="hs-identifier hs-var">errorsOrFatalWarningsFound</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682113574"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>                     </span><span class="annot"><span class="annottext">TcRn ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1224"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoreExpr
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682113587"><span class="hs-identifier hs-var">ds_expr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span>        </span><span class="hs-comment">-- Compile and link it; might fail if linking fails</span><span>
</span><span id="line-1227"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113590"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113590"><span class="hs-identifier hs-var">src_span</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1228"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;About to run (desugared)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682113586"><span class="hs-identifier hs-var">ds_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113591"><span class="annot"><span class="annottext">Either IOEnvFailure (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="#local-6989586621682113591"><span class="hs-identifier hs-var">either_hval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv) (ForeignHValue, [Linkable], PkgsLoaded)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Either IOEnvFailure (ForeignHValue, [Linkable], PkgsLoaded))
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (ForeignHValue, [Linkable], PkgsLoaded)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Either IOEnvFailure (ForeignHValue, [Linkable], PkgsLoaded)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (ForeignHValue, [Linkable], PkgsLoaded)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Either IOEnvFailure (ForeignHValue, [Linkable], PkgsLoaded))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (ForeignHValue, [Linkable], PkgsLoaded)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (ForeignHValue, [Linkable], PkgsLoaded)
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ForeignHValue, [Linkable], PkgsLoaded)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (ForeignHValue, [Linkable], PkgsLoaded))
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (ForeignHValue, [Linkable], PkgsLoaded)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1230"></span><span>                         </span><span class="annot"><span class="annottext">HscEnv
-&gt; SrcSpan
-&gt; CoreExpr
-&gt; IO (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-var">GHC.Driver.Main.hscCompileCoreExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682113568"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113590"><span class="hs-identifier hs-var">src_span</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682113586"><span class="hs-identifier hs-var">ds_expr</span></a></span><span>
</span><span id="line-1231"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure (ForeignHValue, [Linkable], PkgsLoaded)
</span><a href="#local-6989586621682113591"><span class="hs-identifier hs-var">either_hval</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1232"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682113594"><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621682113594"><span class="hs-identifier hs-var">exn</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SplicePhase -&gt; IOEnvFailure -&gt; TcM hs_syn
forall e a. Exception e =&gt; SplicePhase -&gt; e -&gt; TcM a
</span><a href="#local-6989586621682113595"><span class="hs-identifier hs-var">fail_with_exn</span></a></span><span> </span><span class="annot"><span class="annottext">SplicePhase
</span><a href="GHC.Tc.Errors.Types.html#SplicePhase_CompileAndLink"><span class="hs-identifier hs-var">SplicePhase_CompileAndLink</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621682113594"><span class="hs-identifier hs-var">exn</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1233"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682113597"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682113597"><span class="hs-identifier hs-var">hval</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113598"><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621682113598"><span class="hs-identifier hs-var">needed_mods</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682113599"><span class="annot"><span class="annottext">PkgsLoaded
</span><a href="#local-6989586621682113599"><span class="hs-identifier hs-var">needed_pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span>        </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Coerce it to Q t, and run it</span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span>                </span><span class="hs-comment">-- Running might fail if it throws an exception of any kind (hence tryAllM)</span><span>
</span><span id="line-1238"></span><span>                </span><span class="hs-comment">-- including, say, a pattern-match exception in the code we are running</span><span>
</span><span id="line-1239"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-1240"></span><span>                </span><span class="hs-comment">-- We also do the TH -&gt; HS syntax conversion inside the same</span><span>
</span><span id="line-1241"></span><span>                </span><span class="hs-comment">-- exception-catching thing so that if there are any lurking</span><span>
</span><span id="line-1242"></span><span>                </span><span class="hs-comment">-- exceptions in the data structure returned by hval, we'll</span><span>
</span><span id="line-1243"></span><span>                </span><span class="hs-comment">-- encounter them inside the try</span><span>
</span><span id="line-1244"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-1245"></span><span>                </span><span class="hs-comment">-- See Note [Exceptions in TH]</span><span>
</span><span id="line-1246"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113600"><span class="annot"><span class="annottext">expr_span :: SrcSpan
</span><a href="#local-6989586621682113600"><span class="hs-identifier hs-var hs-var">expr_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; SrcSpan
forall a e. GenLocated (SrcSpanAnn' a) e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682113565"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1247"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Linkable] -&gt; PkgsLoaded -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThNeededRuntimeDeps"><span class="hs-identifier hs-var">recordThNeededRuntimeDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621682113598"><span class="hs-identifier hs-var">needed_mods</span></a></span><span> </span><span class="annot"><span class="annottext">PkgsLoaded
</span><a href="#local-6989586621682113599"><span class="hs-identifier hs-var">needed_pkgs</span></a></span><span>
</span><span id="line-1248"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113602"><span class="annot"><span class="annottext">Either SomeException hs_syn
</span><a href="#local-6989586621682113602"><span class="hs-identifier hs-var">either_tval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM hs_syn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either SomeException hs_syn)
forall env r. IOEnv env r -&gt; IOEnv env (Either SomeException r)
</span><a href="GHC.Data.IOEnv.html#tryAllM"><span class="hs-identifier hs-var">tryAllM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM hs_syn
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either SomeException hs_syn))
-&gt; TcM hs_syn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either SomeException hs_syn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1249"></span><span>                         </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM hs_syn -&gt; TcM hs_syn
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113600"><span class="hs-identifier hs-var">expr_span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM hs_syn -&gt; TcM hs_syn) -&gt; TcM hs_syn -&gt; TcM hs_syn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- Set the span so that qLocation can</span><span>
</span><span id="line-1250"></span><span>                                                </span><span class="hs-comment">-- see where this splice is</span><span>
</span><span id="line-1251"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113604"><span class="annot"><span class="annottext">Either RunSpliceFailReason hs_syn
</span><a href="#local-6989586621682113604"><span class="hs-identifier hs-var">mb_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; ForeignHValue -&gt; TcM (Either RunSpliceFailReason hs_syn)
</span><a href="#local-6989586621682113564"><span class="hs-identifier hs-var">run_and_convert</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113600"><span class="hs-identifier hs-var">expr_span</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682113597"><span class="hs-identifier hs-var">hval</span></a></span><span>
</span><span id="line-1252"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either RunSpliceFailReason hs_syn
</span><a href="#local-6989586621682113604"><span class="hs-identifier hs-var">mb_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1253"></span><span>                    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682113605"><span class="annot"><span class="annottext">RunSpliceFailReason
</span><a href="#local-6989586621682113605"><span class="hs-identifier hs-var">err</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM hs_syn
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; RunSpliceFailReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnRunSpliceFailure"><span class="hs-identifier hs-var">TcRnRunSpliceFailure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">RunSpliceFailReason
</span><a href="#local-6989586621682113605"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>                    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682113608"><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621682113608"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got HsSyn result:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">hs_syn -&gt; SDoc
</span><a href="#local-6989586621682113563"><span class="hs-identifier hs-var">ppr_hs</span></a></span><span> </span><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621682113608"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>                                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">hs_syn -&gt; TcM hs_syn
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(hs_syn -&gt; TcM hs_syn) -&gt; hs_syn -&gt; TcM hs_syn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621682113608"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1256"></span><span>
</span><span id="line-1257"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException hs_syn
</span><a href="#local-6989586621682113602"><span class="hs-identifier hs-var">either_tval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1258"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682113610"><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621682113610"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">hs_syn -&gt; TcM hs_syn
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621682113610"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1259"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682113611"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682113611"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe IOEnvFailure
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="../../base-4.18.3.0/src/GHC.Exception.Type.html#fromException/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682113611"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1260"></span><span>                         </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="GHC.Data.IOEnv.html#IOEnvFailure"><span class="hs-identifier hs-var">IOEnvFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM hs_syn
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-comment">-- Error already in Tc monad</span><span>
</span><span id="line-1261"></span><span>                         </span><span class="annot"><span class="annottext">Maybe IOEnvFailure
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SplicePhase -&gt; SomeException -&gt; TcM hs_syn
forall e a. Exception e =&gt; SplicePhase -&gt; e -&gt; TcM a
</span><a href="#local-6989586621682113595"><span class="hs-identifier hs-var">fail_with_exn</span></a></span><span> </span><span class="annot"><span class="annottext">SplicePhase
</span><a href="GHC.Tc.Errors.Types.html#SplicePhase_Run"><span class="hs-identifier hs-var">SplicePhase_Run</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682113611"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="hs-comment">-- Exception</span><span>
</span><span id="line-1262"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1264"></span><span>    </span><span class="hs-comment">-- see Note [Concealed TH exceptions]</span><span>
</span><span id="line-1265"></span><span>    </span><span id="local-6989586621682112070"><span id="local-6989586621682112071"><span class="annot"><a href="#local-6989586621682113595"><span class="hs-identifier hs-type">fail_with_exn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Exception.Type.html#Exception/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112070"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#SplicePhase"><span class="hs-identifier hs-type">SplicePhase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682112070"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112071"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1266"></span><span>    </span><span id="local-6989586621682113595"><span class="annot"><span class="annottext">fail_with_exn :: forall e a. Exception e =&gt; SplicePhase -&gt; e -&gt; TcM a
</span><a href="#local-6989586621682113595"><span class="hs-identifier hs-var hs-var">fail_with_exn</span></a></span></span><span> </span><span id="local-6989586621682113620"><span class="annot"><span class="annottext">SplicePhase
</span><a href="#local-6989586621682113620"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span id="local-6989586621682113621"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682113621"><span class="hs-identifier hs-var">exn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1267"></span><span>        </span><span id="local-6989586621682113622"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113622"><span class="hs-identifier hs-var">exn_msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String)
-&gt; IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; IO String
forall e. Exception e =&gt; e -&gt; IO String
</span><a href="GHC.Utils.Panic.html#safeShowException"><span class="hs-identifier hs-var">Panic.safeShowException</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682113621"><span class="hs-identifier hs-var">exn</span></a></span><span>
</span><span id="line-1268"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM a
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span>
</span><span id="line-1269"></span><span>          </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM a) -&gt; TcRnMessage -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SplicePhase
-&gt; SomeException -&gt; String -&gt; LHsExpr GhcTc -&gt; Bool -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnSpliceThrewException"><span class="hs-identifier hs-var">TcRnSpliceThrewException</span></a></span><span> </span><span class="annot"><span class="annottext">SplicePhase
</span><a href="#local-6989586621682113620"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><a href="../../base-4.18.3.0/src/GHC.Exception.Type.html#SomeException/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-var">SomeException</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682113621"><span class="hs-identifier hs-var">exn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113622"><span class="hs-identifier hs-var">exn_msg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621682113565"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682113562"><span class="hs-identifier hs-var">show_code</span></a></span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span class="hs-comment">{-
Note [Running typed splices in the zonker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

See #15471 for the full discussion.

For many years typed splices were run immediately after they were type checked
however, this is too early as it means to zonk some type variables before
they can be unified with type variables in the surrounding context.

For example,

```
module A where

test_foo :: forall a . Q (TExp (a -&gt; a))
test_foo = [|| id ||]

module B where

import A

qux = $$(test_foo)
```

We would expect `qux` to have inferred type `forall a . a -&gt; a` but if
we run the splices too early the unified variables are zonked to `Any`. The
inferred type is the unusable `Any -&gt; Any`.

To run the splice, we must compile `test_foo` all the way to byte code.
But at the moment when the type checker is looking at the splice, test_foo
has type `Q (TExp (alpha -&gt; alpha))` and we
certainly can't compile code involving unification variables!

We could default `alpha` to `Any` but then we infer `qux :: Any -&gt; Any`
which definitely is not what we want.  Moreover, if we had
  qux = [$$(test_foo), (\x -&gt; x +1::Int)]
then `alpha` would have to be `Int`.

Conclusion: we must defer taking decisions about `alpha` until the
typechecker is done; and *then* we can run the splice.  It's fine to do it
later, because we know it'll produce type-correct code.

Deferring running the splice until later, in the zonker, means that the
unification variables propagate upwards from the splice into the surrounding
context and are unified correctly.

This is implemented by storing the arguments we need for running the splice
in a `DelayedSplice`. In the zonker, the arguments are passed to
`GHC.Tc.Gen.Splice.runTopSplice` and the expression inserted into the AST as normal.



Note [Exceptions in TH]
~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have something like this
        $( f 4 )
where
        f :: Int -&gt; Q [Dec]
        f n | n&gt;3       = fail &quot;Too many declarations&quot;
            | otherwise = ...

The 'fail' is a user-generated failure, and should be displayed as a
perfectly ordinary compiler error message, not a panic or anything
like that.  Here's how it's processed:

  * 'fail' is the monad fail.  The monad instance for Q in TH.Syntax
    effectively transforms (fail s) to
        qReport True s &gt;&gt; fail
    where 'qReport' comes from the Quasi class and fail from its monad
    superclass.

  * The TcM monad is an instance of Quasi (see GHC.Tc.Gen.Splice), and it implements
    (qReport True s) by using addErr to add an error message to the bag of errors.
    The 'fail' in TcM raises an IOEnvFailure exception

 * 'qReport' forces the message to ensure any exception hidden in unevaluated
   thunk doesn't get into the bag of errors. Otherwise the following splice
   will trigger panic (#8987):
        $(fail undefined)
   See also Note [Concealed TH exceptions]

  * So, when running a splice, we catch all exceptions; then for
        - an IOEnvFailure exception, we assume the error is already
                in the error-bag (above)
        - other errors, we add an error to the bag
    and then fail

Note [Concealed TH exceptions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When displaying the error message contained in an exception originated from TH
code, we need to make sure that the error message itself does not contain an
exception.  For example, when executing the following splice:

    $( error (&quot;foo &quot; ++ error &quot;bar&quot;) )

the message for the outer exception is a thunk which will throw the inner
exception when evaluated.

For this reason, we display the message of a TH exception using the
'safeShowException' function, which recursively catches any exception thrown
when showing an error message.


To call runQ in the Tc monad, we need to make TcM an instance of Quasi:
-}</span><span>
</span><span id="line-1377"></span><span>
</span><span id="line-1378"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682113644"><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Quasi/Language.Haskell.TH.Syntax.html#Quasi"><span class="hs-identifier hs-type">TH.Quasi</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1379"></span><span>  </span><span id="local-6989586621682113664"><span class="annot"><span class="annottext">qNewName :: String -&gt; TcM Name
</span><a href="#local-6989586621682113664"><span class="hs-identifier hs-var hs-var hs-var hs-var">qNewName</span></a></span></span><span> </span><span id="local-6989586621682113666"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113666"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113667"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682113667"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-1380"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113669"><span class="annot"><span class="annottext">i :: Integer
</span><a href="#local-6989586621682113669"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="../../base-4.18.3.0/src/GHC.Real.html#toInteger/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; Word64
</span><a href="GHC.Types.Unique.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682113667"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1381"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Integer -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkNameU/Language.Haskell.TH.Syntax.html#mkNameU"><span class="hs-identifier hs-var">TH.mkNameU</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113666"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682113669"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1382"></span><span>
</span><span id="line-1383"></span><span>  </span><span class="hs-comment">-- 'msg' is forced to ensure exceptions don't escape,</span><span>
</span><span id="line-1384"></span><span>  </span><span class="hs-comment">-- see Note [Exceptions in TH]</span><span>
</span><span id="line-1385"></span><span>  </span><span id="local-6989586621682113672"><span class="annot"><span class="annottext">qReport :: Bool -&gt; String -&gt; TcRn ()
</span><a href="#local-6989586621682113672"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReport</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621682113674"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113674"><span class="hs-identifier hs-var">msg</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn () -&gt; TcRn ()
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-identifier hs-var">seqList</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113674"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnReportCustomQuasiError"><span class="hs-identifier hs-var">TcRnReportCustomQuasiError</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113674"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1386"></span><span>  </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReport/Language.Haskell.TH.Syntax.html#qReport"><span class="hs-identifier hs-var">qReport</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621682113676"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113676"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn () -&gt; TcRn ()
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-identifier hs-var">seqList</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113676"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">addDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnReportCustomQuasiError"><span class="hs-identifier hs-var">TcRnReportCustomQuasiError</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113676"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1387"></span><span>
</span><span id="line-1388"></span><span>  </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qLocation/Language.Haskell.TH.Syntax.html#qLocation"><span class="hs-identifier hs-type">qLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Loc/Language.Haskell.TH.Syntax.html#Loc"><span class="hs-identifier hs-type">TH.Loc</span></a></span><span>
</span><span id="line-1389"></span><span>  </span><span id="local-6989586621682113690"><span class="annot"><span class="annottext">qLocation :: TcM Loc
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qLocation/Language.Haskell.TH.Syntax.html#qLocation"><span class="hs-identifier hs-var hs-var hs-var hs-var">qLocation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113691"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682113691"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-1390"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113693"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113693"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1391"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113694"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113694"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113693"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1392"></span><span>                        </span><span class="annot"><a href="GHC.Types.SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-type">UnhelpfulSpan</span></a></span><span> </span><span class="annot"><span class="annottext">UnhelpfulSpanReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) RealSrcSpan
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qLocation: Unhelpful location&quot;</span></span><span>
</span><span id="line-1393"></span><span>                                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113693"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>                        </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span id="local-6989586621682113697"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113697"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; IOEnv (Env TcGblEnv TcLclEnv) RealSrcSpan
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113697"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1395"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Loc -&gt; TcM Loc
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Loc/Language.Haskell.TH.Syntax.html#Loc"><span class="hs-identifier hs-type">TH.Loc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">loc_filename :: String
</span><a href="#local-6989586621682113699"><span class="hs-identifier hs-var">TH.loc_filename</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; FastString
</span><a href="GHC.Types.SrcLoc.html#srcSpanFile"><span class="hs-identifier hs-var">srcSpanFile</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113694"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1396"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_module :: String
</span><a href="#local-6989586621682113702"><span class="hs-identifier hs-var">TH.loc_module</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682113691"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1397"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_package :: String
</span><a href="#local-6989586621682113705"><span class="hs-identifier hs-var">TH.loc_package</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
forall u. IsUnitId u =&gt; u -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682113691"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_start :: CharPos
</span><a href="#local-6989586621682113708"><span class="hs-identifier hs-var">TH.loc_start</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; SumArity
</span><a href="GHC.Types.SrcLoc.html#srcSpanStartLine"><span class="hs-identifier hs-var">srcSpanStartLine</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113694"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; SumArity
</span><a href="GHC.Types.SrcLoc.html#srcSpanStartCol"><span class="hs-identifier hs-var">srcSpanStartCol</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113694"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_end :: CharPos
</span><a href="#local-6989586621682113711"><span class="hs-identifier hs-var">TH.loc_end</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; SumArity
</span><a href="GHC.Types.SrcLoc.html#srcSpanEndLine"><span class="hs-identifier hs-var">srcSpanEndLine</span></a></span><span>   </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113694"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; SumArity
</span><a href="GHC.Types.SrcLoc.html#srcSpanEndCol"><span class="hs-identifier hs-var">srcSpanEndCol</span></a></span><span>   </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682113694"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1400"></span><span>
</span><span id="line-1401"></span><span>  </span><span id="local-6989586621682113714"><span class="annot"><span class="annottext">qLookupName :: Bool -&gt; String -&gt; TcM (Maybe Name)
</span><a href="#local-6989586621682113714"><span class="hs-identifier hs-var hs-var hs-var hs-var">qLookupName</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span>
</span><span id="line-1402"></span><span>  </span><span id="local-6989586621682113717"><span class="annot"><span class="annottext">qReify :: Name -&gt; TcM Info
</span><a href="#local-6989586621682113717"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReify</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reify"><span class="hs-identifier hs-var">reify</span></a></span><span>
</span><span id="line-1403"></span><span>  </span><span id="local-6989586621682113721"><span class="annot"><span class="annottext">qReifyFixity :: Name -&gt; TcM (Maybe Fixity)
</span><a href="#local-6989586621682113721"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyFixity</span></a></span></span><span> </span><span id="local-6989586621682113723"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113723"><span class="hs-identifier hs-var">nm</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113723"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Name -&gt; (Name -&gt; TcM (Maybe Fixity)) -&gt; TcM (Maybe Fixity)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe Fixity)
</span><a href="GHC.Tc.Gen.Splice.html#reifyFixity"><span class="hs-identifier hs-var">reifyFixity</span></a></span><span>
</span><span id="line-1404"></span><span>  </span><span id="local-6989586621682113726"><span class="annot"><span class="annottext">qReifyType :: Name -&gt; TcM Type
</span><a href="#local-6989586621682113726"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyType</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypeOfThing"><span class="hs-identifier hs-var">reifyTypeOfThing</span></a></span><span>
</span><span id="line-1405"></span><span>  </span><span id="local-6989586621682113729"><span class="annot"><span class="annottext">qReifyInstances :: Name -&gt; [Type] -&gt; TcM [Dec]
</span><a href="#local-6989586621682113729"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyInstances</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyInstances"><span class="hs-identifier hs-var">reifyInstances</span></a></span><span>
</span><span id="line-1406"></span><span>  </span><span id="local-6989586621682113732"><span class="annot"><span class="annottext">qReifyRoles :: Name -&gt; TcM [Role]
</span><a href="#local-6989586621682113732"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyRoles</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM [Role]
</span><a href="GHC.Tc.Gen.Splice.html#reifyRoles"><span class="hs-identifier hs-var">reifyRoles</span></a></span><span>
</span><span id="line-1407"></span><span>  </span><span id="local-6989586621682113737"><span class="annot"><span class="annottext">qReifyAnnotations :: forall a. Data a =&gt; AnnLookup -&gt; TcM [a]
</span><a href="#local-6989586621682113737"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyAnnotations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TcM [a]
forall a. Data a =&gt; AnnLookup -&gt; TcM [a]
</span><a href="GHC.Tc.Gen.Splice.html#reifyAnnotations"><span class="hs-identifier hs-var">reifyAnnotations</span></a></span><span>
</span><span id="line-1408"></span><span>  </span><span id="local-6989586621682113740"><span class="annot"><span class="annottext">qReifyModule :: Module -&gt; TcM ModuleInfo
</span><a href="#local-6989586621682113740"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyModule</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; TcM ModuleInfo
</span><a href="GHC.Tc.Gen.Splice.html#reifyModule"><span class="hs-identifier hs-var">reifyModule</span></a></span><span>
</span><span id="line-1409"></span><span>  </span><span id="local-6989586621682113746"><span class="annot"><span class="annottext">qReifyConStrictness :: Name -&gt; TcM [DecidedStrictness]
</span><a href="#local-6989586621682113746"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyConStrictness</span></a></span></span><span> </span><span id="local-6989586621682113748"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113748"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113749"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113749"><span class="hs-identifier hs-var">nm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113748"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1410"></span><span>                              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682113750"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682113750"><span class="hs-identifier hs-var">dc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM DataCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupDataCon"><span class="hs-identifier hs-var">tcLookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113749"><span class="hs-identifier hs-var">nm'</span></a></span><span>
</span><span id="line-1411"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113752"><span class="annot"><span class="annottext">bangs :: [HsImplBang]
</span><a href="#local-6989586621682113752"><span class="hs-identifier hs-var hs-var">bangs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [HsImplBang]
</span><a href="GHC.Core.DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682113750"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1412"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[DecidedStrictness] -&gt; TcM [DecidedStrictness]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsImplBang -&gt; DecidedStrictness)
-&gt; [HsImplBang] -&gt; [DecidedStrictness]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang -&gt; DecidedStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var">reifyDecidedStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621682113752"><span class="hs-identifier hs-var">bangs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span>        </span><span class="hs-comment">-- For qRecover, discard error messages if</span><span>
</span><span id="line-1415"></span><span>        </span><span class="hs-comment">-- the recovery action is chosen.  Otherwise</span><span>
</span><span id="line-1416"></span><span>        </span><span class="hs-comment">-- we'll only fail higher up.</span><span>
</span><span id="line-1417"></span><span>  </span><span id="local-6989586621682113755"><span class="annot"><span class="annottext">qRecover :: forall a. TcM a -&gt; TcM a -&gt; TcM a
</span><a href="#local-6989586621682113755"><span class="hs-identifier hs-var hs-var hs-var hs-var">qRecover</span></a></span></span><span> </span><span id="local-6989586621682113757"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682113757"><span class="hs-identifier hs-var">recover</span></a></span></span><span> </span><span id="local-6989586621682113758"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682113758"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM a -&gt; TcM a
forall a. TcM a -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-var">tryTcDiscardingErrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682113757"><span class="hs-identifier hs-var">recover</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682113758"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-1418"></span><span>
</span><span id="line-1419"></span><span>  </span><span id="local-6989586621682113763"><span class="annot"><span class="annottext">qGetPackageRoot :: IOEnv (Env TcGblEnv TcLclEnv) String
</span><a href="#local-6989586621682113763"><span class="hs-identifier hs-var hs-var hs-var hs-var">qGetPackageRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1420"></span><span>    </span><span id="local-6989586621682113765"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682113765"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1421"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String)
-&gt; String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#workingDirectory"><span class="hs-identifier hs-var">workingDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682113765"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span>  </span><span id="local-6989586621682113771"><span class="annot"><span class="annottext">qAddDependentFile :: String -&gt; TcRn ()
</span><a href="#local-6989586621682113771"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddDependentFile</span></a></span></span><span> </span><span id="local-6989586621682113773"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113773"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1424"></span><span>    </span><span id="local-6989586621682113774"><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621682113774"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [String])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef [String])
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [String]
</span><a href="GHC.Tc.Types.html#tcg_dependent_files"><span class="hs-identifier hs-var">tcg_dependent_files</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1425"></span><span>    </span><span id="local-6989586621682113776"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682113776"><span class="hs-identifier hs-var">dep_files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef [String] -&gt; TcRnIf TcGblEnv TcLclEnv [String]
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621682113774"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1426"></span><span>    </span><span class="annot"><span class="annottext">TcRef [String] -&gt; [String] -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621682113774"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113773"><span class="hs-identifier hs-var">fp</span></a></span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682113776"><span class="hs-identifier hs-var">dep_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1427"></span><span>
</span><span id="line-1428"></span><span>  </span><span id="local-6989586621682113786"><span class="annot"><span class="annottext">qAddTempFile :: String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
</span><a href="#local-6989586621682113786"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddTempFile</span></a></span></span><span> </span><span id="local-6989586621682113788"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113788"><span class="hs-identifier hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1429"></span><span>    </span><span id="local-6989586621682113789"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682113789"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1430"></span><span>    </span><span id="local-6989586621682113790"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682113790"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-1431"></span><span>    </span><span id="local-6989586621682113791"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682113791"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; TmpFs)
-&gt; TcRnIf TcGblEnv TcLclEnv HscEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TmpFs
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1432"></span><span>    </span><span class="annot"><span class="annottext">IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String)
-&gt; IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682113790"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682113791"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682113789"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113788"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span>  </span><span id="local-6989586621682113812"><span class="annot"><span class="annottext">qAddTopDecls :: [Dec] -&gt; TcRn ()
</span><a href="#local-6989586621682113812"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddTopDecls</span></a></span></span><span> </span><span id="local-6989586621682113814"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682113814"><span class="hs-identifier hs-var">thds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1435"></span><span>      </span><span id="local-6989586621682113815"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113815"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1436"></span><span>      </span><span id="local-6989586621682113816"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682113816"><span class="hs-identifier hs-var">th_origin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var">getThSpliceOrigin</span></a></span><span>
</span><span id="line-1437"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113817"><span class="annot"><span class="annottext">either_hval :: Either RunSpliceFailReason [LHsDecl GhcPs]
</span><a href="#local-6989586621682113817"><span class="hs-identifier hs-var hs-var">either_hval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; SrcSpan -&gt; [Dec] -&gt; Either RunSpliceFailReason [LHsDecl GhcPs]
</span><a href="GHC.ThToHs.html#convertToHsDecls"><span class="hs-identifier hs-var">convertToHsDecls</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682113816"><span class="hs-identifier hs-var">th_origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682113815"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682113814"><span class="hs-identifier hs-var">thds</span></a></span><span>
</span><span id="line-1438"></span><span>      </span><span id="local-6989586621682113818"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113818"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either RunSpliceFailReason [LHsDecl GhcPs]
</span><a href="#local-6989586621682113817"><span class="hs-identifier hs-var">either_hval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1439"></span><span>              </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682113819"><span class="annot"><span class="annottext">RunSpliceFailReason
</span><a href="#local-6989586621682113819"><span class="hs-identifier hs-var">exn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span>
</span><span id="line-1440"></span><span>                            </span><span class="annot"><span class="annottext">(TcRnMessage
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
-&gt; TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; RunSpliceFailReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnRunSpliceFailure"><span class="hs-identifier hs-var">TcRnRunSpliceFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addTopDecls&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunSpliceFailReason
</span><a href="#local-6989586621682113819"><span class="hs-identifier hs-var">exn</span></a></span><span>
</span><span id="line-1441"></span><span>              </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682113820"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621682113820"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113820"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1442"></span><span>      </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsDecl GhcPs) -&gt; TcRn ())
-&gt; [GenLocated SrcSpanAnnA (HsDecl GhcPs)] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDecl GhcPs -&gt; TcRn ()
</span><a href="#local-6989586621682113822"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(HsDecl GhcPs -&gt; TcRn ())
-&gt; (GenLocated SrcSpanAnnA (HsDecl GhcPs) -&gt; HsDecl GhcPs)
-&gt; GenLocated SrcSpanAnnA (HsDecl GhcPs)
-&gt; TcRn ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsDecl GhcPs) -&gt; HsDecl GhcPs
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113818"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1443"></span><span>      </span><span id="local-6989586621682113823"><span class="annot"><span class="annottext">TcRef [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113823"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (TcRef [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [LHsDecl GhcPs]
TcGblEnv -&gt; TcRef [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="GHC.Tc.Types.html#tcg_th_topdecls"><span class="hs-identifier hs-var">tcg_th_topdecls</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1444"></span><span>      </span><span class="annot"><span class="annottext">TcRef [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
-&gt; ([GenLocated SrcSpanAnnA (HsDecl GhcPs)]
    -&gt; [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
-&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113823"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682113826"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113826"><span class="hs-identifier hs-var">topds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113818"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
-&gt; [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
-&gt; [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682113826"><span class="hs-identifier hs-var">topds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1445"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1446"></span><span>      </span><span class="annot"><a href="#local-6989586621682113822"><span class="hs-identifier hs-type">checkTopDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsDecl"><span class="hs-identifier hs-type">HsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>      </span><span id="local-6989586621682113822"><span class="annot"><span class="annottext">checkTopDecl :: HsDecl GhcPs -&gt; TcRn ()
</span><a href="#local-6989586621682113822"><span class="hs-identifier hs-var hs-var">checkTopDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#ValD"><span class="hs-identifier hs-type">ValD</span></a></span><span> </span><span class="annot"><span class="annottext">XValD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682113828"><span class="annot"><span class="annottext">HsBind GhcPs
</span><a href="#local-6989586621682113828"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1448"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; TcRn ()) -&gt; [RdrName] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRn ()
</span><a href="#local-6989586621682113829"><span class="hs-identifier hs-var">bindName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag GhcPs -&gt; HsBind GhcPs -&gt; [IdP GhcPs]
forall p idR.
CollectPass p =&gt;
CollectFlag p -&gt; HsBindLR p idR -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectHsBindBinders"><span class="hs-identifier hs-var">collectHsBindBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcPs
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsBind GhcPs
</span><a href="#local-6989586621682113828"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>      </span><span class="annot"><a href="#local-6989586621682113822"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#SigD"><span class="hs-identifier hs-type">SigD</span></a></span><span> </span><span class="annot"><span class="annottext">XSigD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Sig GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1451"></span><span>      </span><span class="annot"><a href="#local-6989586621682113822"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#AnnD"><span class="hs-identifier hs-type">AnnD</span></a></span><span> </span><span class="annot"><span class="annottext">XAnnD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AnnDecl GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1453"></span><span>      </span><span class="annot"><a href="#local-6989586621682113822"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#ForD"><span class="hs-identifier hs-type">ForD</span></a></span><span> </span><span class="annot"><span class="annottext">XForD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#ForeignImport"><span class="hs-identifier hs-type">ForeignImport</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fd_name :: forall pass. ForeignDecl pass -&gt; LIdP pass
</span><a href="Language.Haskell.Syntax.Decls.html#fd_name"><span class="hs-identifier hs-var">fd_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682113837"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682113837"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1454"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRn ()
</span><a href="#local-6989586621682113829"><span class="hs-identifier hs-var">bindName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682113837"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1455"></span><span>      </span><span class="annot"><a href="#local-6989586621682113822"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span id="local-6989586621682113838"><span class="annot"><span class="annottext">HsDecl GhcPs
</span><a href="#local-6989586621682113838"><span class="hs-identifier hs-var">d</span></a></span></span><span>
</span><span id="line-1456"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsDecl GhcPs -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnInvalidTopDecl"><span class="hs-identifier hs-var">TcRnInvalidTopDecl</span></a></span><span> </span><span class="annot"><span class="annottext">HsDecl GhcPs
</span><a href="#local-6989586621682113838"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1457"></span><span>
</span><span id="line-1458"></span><span>      </span><span class="annot"><a href="#local-6989586621682113829"><span class="hs-identifier hs-type">bindName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span>      </span><span id="local-6989586621682113829"><span class="annot"><span class="annottext">bindName :: RdrName -&gt; TcRn ()
</span><a href="#local-6989586621682113829"><span class="hs-identifier hs-var hs-var">bindName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#Exact"><span class="hs-identifier hs-type">Exact</span></a></span><span> </span><span id="local-6989586621682113841"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113841"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1460"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682113842"><span class="annot"><span class="annottext">TcRef FreeVars
</span><a href="#local-6989586621682113842"><span class="hs-identifier hs-var">th_topnames_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef FreeVars)
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef FreeVars)
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef FreeVars
</span><a href="GHC.Tc.Types.html#tcg_th_topnames"><span class="hs-identifier hs-var">tcg_th_topnames</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1461"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef FreeVars -&gt; (FreeVars -&gt; FreeVars) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef FreeVars
</span><a href="#local-6989586621682113842"><span class="hs-identifier hs-var">th_topnames_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682113844"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621682113844"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621682113844"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113841"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-1463"></span><span>
</span><span id="line-1464"></span><span>      </span><span class="annot"><a href="#local-6989586621682113829"><span class="hs-identifier hs-var">bindName</span></a></span><span> </span><span id="local-6989586621682113846"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682113846"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnNonExactName"><span class="hs-identifier hs-var">TcRnNonExactName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682113846"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1465"></span><span>
</span><span id="line-1466"></span><span>  </span><span id="local-6989586621682113850"><span class="annot"><span class="annottext">qAddForeignFilePath :: ForeignSrcLang -&gt; String -&gt; TcRn ()
</span><a href="#local-6989586621682113850"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddForeignFilePath</span></a></span></span><span> </span><span id="local-6989586621682113852"><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621682113852"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span id="local-6989586621682113853"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113853"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1467"></span><span>    </span><span id="local-6989586621682113854"><span class="annot"><span class="annottext">TcRef [(ForeignSrcLang, String)]
</span><a href="#local-6989586621682113854"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [(ForeignSrcLang, String)])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef [(ForeignSrcLang, String)])
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [(ForeignSrcLang, String)]
</span><a href="GHC.Tc.Types.html#tcg_th_foreign_files"><span class="hs-identifier hs-var">tcg_th_foreign_files</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1468"></span><span>    </span><span class="annot"><span class="annottext">TcRef [(ForeignSrcLang, String)]
-&gt; ([(ForeignSrcLang, String)] -&gt; [(ForeignSrcLang, String)])
-&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [(ForeignSrcLang, String)]
</span><a href="#local-6989586621682113854"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621682113852"><span class="hs-identifier hs-var">lang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113853"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ForeignSrcLang, String)
-&gt; [(ForeignSrcLang, String)] -&gt; [(ForeignSrcLang, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span>  </span><span id="local-6989586621682113860"><span class="annot"><span class="annottext">qAddModFinalizer :: Q () -&gt; TcRn ()
</span><a href="#local-6989586621682113860"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddModFinalizer</span></a></span></span><span> </span><span id="local-6989586621682113862"><span class="annot"><span class="annottext">Q ()
</span><a href="#local-6989586621682113862"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1471"></span><span>      </span><span id="local-6989586621682113863"><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621682113863"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (RemoteRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (RemoteRef (Q ()))
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (RemoteRef (Q ()))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (RemoteRef (Q ())))
-&gt; IO (RemoteRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (RemoteRef (Q ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Q () -&gt; IO (RemoteRef (Q ()))
forall a. a -&gt; IO (RemoteRef a)
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#mkRemoteRef/GHCi.RemoteTypes.html#mkRemoteRef"><span class="hs-identifier hs-var">mkRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">Q ()
</span><a href="#local-6989586621682113862"><span class="hs-identifier hs-var">fin</span></a></span><span>
</span><span id="line-1472"></span><span>      </span><span id="local-6989586621682113865"><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621682113865"><span class="hs-identifier hs-var">fref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ForeignRef (Q ()))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ())))
-&gt; IO (ForeignRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ()) -&gt; IO () -&gt; IO (ForeignRef (Q ()))
forall a. RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#mkForeignRef/GHCi.RemoteTypes.html#mkForeignRef"><span class="hs-identifier hs-var">mkForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621682113863"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (Q ()) -&gt; IO ()
forall a. RemoteRef a -&gt; IO ()
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#freeRemoteRef/GHCi.RemoteTypes.html#freeRemoteRef"><span class="hs-identifier hs-var">freeRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621682113863"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>      </span><span class="annot"><span class="annottext">ForeignRef (Q ()) -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-var">addModFinalizerRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621682113865"><span class="hs-identifier hs-var">fref</span></a></span><span>
</span><span id="line-1474"></span><span>
</span><span id="line-1475"></span><span>  </span><span id="local-6989586621682113876"><span class="annot"><span class="annottext">qAddCorePlugin :: String -&gt; TcRn ()
</span><a href="#local-6989586621682113876"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddCorePlugin</span></a></span></span><span> </span><span id="local-6989586621682113878"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113878"><span class="hs-identifier hs-var">plugin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1476"></span><span>      </span><span id="local-6989586621682113879"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682113879"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1477"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113880"><span class="annot"><span class="annottext">fc :: FinderCache
</span><a href="#local-6989586621682113880"><span class="hs-identifier hs-var hs-var">fc</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682113879"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1478"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113882"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621682113882"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682113879"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1479"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113884"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682113884"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682113879"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1480"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113886"><span class="annot"><span class="annottext">fopts :: FinderOpts
</span><a href="#local-6989586621682113886"><span class="hs-identifier hs-var hs-var">fopts</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FinderOpts
</span><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier hs-var">initFinderOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682113884"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1481"></span><span>      </span><span id="local-6989586621682113888"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682113888"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FindResult -&gt; IOEnv (Env TcGblEnv TcLclEnv) FindResult
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO FindResult -&gt; IOEnv (Env TcGblEnv TcLclEnv) FindResult)
-&gt; IO FindResult -&gt; IOEnv (Env TcGblEnv TcLclEnv) FindResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
-&gt; FinderOpts -&gt; HomeUnit -&gt; ModuleName -&gt; IO FindResult
</span><a href="GHC.Unit.Finder.html#findHomeModule"><span class="hs-identifier hs-var">findHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682113880"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621682113886"><span class="hs-identifier hs-var">fopts</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682113882"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113878"><span class="hs-identifier hs-var">plugin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1482"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113891"><span class="annot"><span class="annottext">err :: TcRnMessage
</span><a href="#local-6989586621682113891"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnAddInvalidCorePlugin"><span class="hs-identifier hs-var">TcRnAddInvalidCorePlugin</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113878"><span class="hs-identifier hs-var">plugin</span></a></span><span>
</span><span id="line-1483"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682113888"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1484"></span><span>        </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682113891"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1485"></span><span>        </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FoundMultiple"><span class="hs-identifier hs-type">FoundMultiple</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682113891"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1486"></span><span>        </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1487"></span><span>      </span><span id="local-6989586621682113895"><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621682113895"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [String]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [String])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef [String])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1488"></span><span>      </span><span class="annot"><span class="annottext">TcRef [String] -&gt; ([String] -&gt; [String]) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621682113895"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113878"><span class="hs-identifier hs-var">plugin</span></a></span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span>  </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qGetQ/Language.Haskell.TH.Syntax.html#qGetQ"><span class="hs-identifier hs-type">qGetQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682113898"><span class="annot"><a href="#local-6989586621682113898"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Typeable.Internal.html#Typeable/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682113898"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682113898"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1491"></span><span>  </span><span id="local-6989586621682113911"><span class="annot"><span class="annottext">qGetQ :: forall a. Typeable a =&gt; TcM (Maybe a)
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qGetQ/Language.Haskell.TH.Syntax.html#qGetQ"><span class="hs-identifier hs-var hs-var hs-var hs-var">qGetQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1492"></span><span>      </span><span id="local-6989586621682113912"><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621682113912"><span class="hs-identifier hs-var">th_state_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef (Map TypeRep Dynamic))
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef (Map TypeRep Dynamic))
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Map TypeRep Dynamic)
</span><a href="GHC.Tc.Types.html#tcg_th_state"><span class="hs-identifier hs-var">tcg_th_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1493"></span><span>      </span><span id="local-6989586621682113914"><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621682113914"><span class="hs-identifier hs-var">th_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
-&gt; TcRnIf TcGblEnv TcLclEnv (Map TypeRep Dynamic)
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621682113912"><span class="hs-identifier hs-var">th_state_var</span></a></span><span>
</span><span id="line-1494"></span><span>      </span><span class="hs-comment">-- See #10596 for why we use a scoped type variable here.</span><span>
</span><span id="line-1495"></span><span>      </span><span class="annot"><span class="annottext">Maybe a -&gt; TcM (Maybe a)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeRep -&gt; Map TypeRep Dynamic -&gt; Maybe Dynamic
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a -&gt; TypeRep
forall {k} (proxy :: k -&gt; *) (a :: k).
Typeable a =&gt;
proxy a -&gt; TypeRep
</span><a href="../../base-4.18.3.0/src/Data.Typeable.html#typeRep/Data.Typeable.html#typeRep"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a
forall {k} (t :: k). Proxy t
</span><a href="../../base-4.18.3.0/src/Data.Proxy.html#Proxy/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Proxy.html#Proxy/Data.Proxy.html#Proxy"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682113898"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621682113914"><span class="hs-identifier hs-var">th_state</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dynamic -&gt; (Dynamic -&gt; Maybe a) -&gt; Maybe a
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Dynamic -&gt; Maybe a
forall a. Typeable a =&gt; Dynamic -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/Data.Dynamic.html#fromDynamic/Data.Dynamic.html#fromDynamic"><span class="hs-identifier hs-var">fromDynamic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1496"></span><span>
</span><span id="line-1497"></span><span>  </span><span id="local-6989586621682113923"><span class="annot"><span class="annottext">qPutQ :: forall a. Typeable a =&gt; a -&gt; TcRn ()
</span><a href="#local-6989586621682113923"><span class="hs-identifier hs-var hs-var hs-var hs-var">qPutQ</span></a></span></span><span> </span><span id="local-6989586621682113925"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113925"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1498"></span><span>      </span><span id="local-6989586621682113926"><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621682113926"><span class="hs-identifier hs-var">th_state_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef (Map TypeRep Dynamic))
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef (Map TypeRep Dynamic))
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Map TypeRep Dynamic)
</span><a href="GHC.Tc.Types.html#tcg_th_state"><span class="hs-identifier hs-var">tcg_th_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1499"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
-&gt; (Map TypeRep Dynamic -&gt; Map TypeRep Dynamic) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621682113926"><span class="hs-identifier hs-var">th_state_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682113927"><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621682113927"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeRep -&gt; Dynamic -&gt; Map TypeRep Dynamic -&gt; Map TypeRep Dynamic
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TypeRep
forall a. Typeable a =&gt; a -&gt; TypeRep
</span><a href="../../base-4.18.3.0/src/Data.Typeable.html#typeOf/Data.Typeable.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113925"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Dynamic
forall a. Typeable a =&gt; a -&gt; Dynamic
</span><a href="../../base-4.18.3.0/src/Data.Dynamic.html#toDyn/Data.Dynamic.html#toDyn"><span class="hs-identifier hs-var">toDyn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682113925"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621682113927"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span>  </span><span id="local-6989586621682113929"><span class="annot"><span class="annottext">qIsExtEnabled :: Extension -&gt; TcM Bool
</span><a href="#local-6989586621682113929"><span class="hs-identifier hs-var hs-var hs-var hs-var">qIsExtEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcM Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span>
</span><span id="line-1502"></span><span>
</span><span id="line-1503"></span><span>  </span><span id="local-6989586621682113935"><span class="annot"><span class="annottext">qExtsEnabled :: TcM [Extension]
</span><a href="#local-6989586621682113935"><span class="hs-identifier hs-var hs-var hs-var hs-var">qExtsEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1504"></span><span>    </span><span class="annot"><span class="annottext">EnumSet Extension -&gt; [Extension]
forall a. Enum a =&gt; EnumSet a -&gt; [a]
</span><a href="GHC.Data.EnumSet.html#toList"><span class="hs-identifier hs-var">EnumSet.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(EnumSet Extension -&gt; [Extension])
-&gt; (HscEnv -&gt; EnumSet Extension) -&gt; HscEnv -&gt; [Extension]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; EnumSet Extension
</span><a href="GHC.Driver.Session.html#extensionFlags"><span class="hs-identifier hs-var">extensionFlags</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; EnumSet Extension)
-&gt; (HscEnv -&gt; DynFlags) -&gt; HscEnv -&gt; EnumSet Extension
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; [Extension])
-&gt; TcRnIf TcGblEnv TcLclEnv HscEnv -&gt; TcM [Extension]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1505"></span><span>
</span><span id="line-1506"></span><span>  </span><span id="local-6989586621682113950"><span class="annot"><span class="annottext">qPutDoc :: DocLoc -&gt; String -&gt; TcRn ()
</span><a href="#local-6989586621682113950"><span class="hs-identifier hs-var hs-var hs-var hs-var">qPutDoc</span></a></span></span><span> </span><span id="local-6989586621682113952"><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682113952"><span class="hs-identifier hs-var">doc_loc</span></a></span></span><span> </span><span id="local-6989586621682113953"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113953"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1507"></span><span>    </span><span id="local-6989586621682113954"><span class="annot"><span class="annottext">TcRef THDocs
</span><a href="#local-6989586621682113954"><span class="hs-identifier hs-var">th_doc_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef THDocs
</span><a href="GHC.Tc.Types.html#tcg_th_docs"><span class="hs-identifier hs-var">tcg_th_docs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef THDocs)
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef THDocs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1508"></span><span>    </span><span id="local-6989586621682113956"><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682113956"><span class="hs-identifier hs-var">resolved_doc_loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DocLoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) DocLoc
</span><a href="#local-6989586621682113957"><span class="hs-identifier hs-var">resolve_loc</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682113952"><span class="hs-identifier hs-var">doc_loc</span></a></span><span>
</span><span id="line-1509"></span><span>    </span><span id="local-6989586621682113958"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682113958"><span class="hs-identifier hs-var">is_local</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DocLoc -&gt; TcM Bool
forall {f :: * -&gt; *}.
(Applicative f, HasModule f) =&gt;
DocLoc -&gt; f Bool
</span><a href="#local-6989586621682113959"><span class="hs-identifier hs-var">checkLocalName</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682113956"><span class="hs-identifier hs-var">resolved_doc_loc</span></a></span><span>
</span><span id="line-1510"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#unless/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682113958"><span class="hs-identifier hs-var">is_local</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnAddDocToNonLocalDefn"><span class="hs-identifier hs-var">TcRnAddDocToNonLocalDefn</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682113952"><span class="hs-identifier hs-var">doc_loc</span></a></span><span>
</span><span id="line-1511"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682113961"><span class="annot"><span class="annottext">ds :: HsDocString
</span><a href="#local-6989586621682113961"><span class="hs-identifier hs-var hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; HsDocString
</span><a href="GHC.Hs.DocString.html#mkGeneratedHsDocString"><span class="hs-identifier hs-var">mkGeneratedHsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682113953"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1512"></span><span>        </span><span id="local-6989586621682113963"><span class="annot"><span class="annottext">hd :: HsDoc GhcPs
</span><a href="#local-6989586621682113963"><span class="hs-identifier hs-var hs-var">hd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (GenLocated SrcSpanAnnN RdrName) -&gt; HsDocString -&gt; HsDoc GhcPs
</span><a href="GHC.Parser.HaddockLex.html#lexHsDoc"><span class="hs-identifier hs-var">lexHsDoc</span></a></span><span> </span><span class="annot"><span class="annottext">P (GenLocated SrcSpanAnnN RdrName)
</span><a href="GHC.Parser.html#parseIdentifier"><span class="hs-identifier hs-var">parseIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocString
</span><a href="#local-6989586621682113961"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1513"></span><span>    </span><span id="local-6989586621682113964"><span class="annot"><span class="annottext">WithHsDocIdentifiers HsDocString GhcRn
</span><a href="#local-6989586621682113964"><span class="hs-identifier hs-var">hd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDoc GhcPs -&gt; RnM (WithHsDocIdentifiers HsDocString GhcRn)
forall a.
WithHsDocIdentifiers a GhcPs -&gt; RnM (WithHsDocIdentifiers a GhcRn)
</span><a href="GHC.Rename.Doc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoc GhcPs
</span><a href="#local-6989586621682113963"><span class="hs-identifier hs-var">hd</span></a></span><span>
</span><span id="line-1514"></span><span>    </span><span class="annot"><span class="annottext">TcRef THDocs -&gt; (THDocs -&gt; THDocs) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef THDocs
</span><a href="#local-6989586621682113954"><span class="hs-identifier hs-var">th_doc_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DocLoc
-&gt; WithHsDocIdentifiers HsDocString GhcRn -&gt; THDocs -&gt; THDocs
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682113956"><span class="hs-identifier hs-var">resolved_doc_loc</span></a></span><span> </span><span class="annot"><span class="annottext">WithHsDocIdentifiers HsDocString GhcRn
</span><a href="#local-6989586621682113964"><span class="hs-identifier hs-var">hd'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1515"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1516"></span><span>      </span><span id="local-6989586621682113957"><span class="annot"><span class="annottext">resolve_loc :: DocLoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) DocLoc
</span><a href="#local-6989586621682113957"><span class="hs-identifier hs-var hs-var">resolve_loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DeclDoc/Language.Haskell.TH.Syntax.html#DeclDoc"><span class="hs-identifier hs-type">TH.DeclDoc</span></a></span><span> </span><span id="local-6989586621682113974"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113974"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DocLoc
</span><a href="GHC.Tc.Types.html#DeclDoc"><span class="hs-identifier hs-var">DeclDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; DocLoc)
-&gt; TcM Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DocLoc
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113974"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1517"></span><span>      </span><span class="annot"><a href="#local-6989586621682113957"><span class="hs-identifier hs-var">resolve_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ArgDoc/Language.Haskell.TH.Syntax.html#ArgDoc"><span class="hs-identifier hs-type">TH.ArgDoc</span></a></span><span> </span><span id="local-6989586621682113977"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113977"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682113978"><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682113978"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SumArity -&gt; DocLoc
</span><a href="GHC.Tc.Types.html#ArgDoc"><span class="hs-identifier hs-var">ArgDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; SumArity -&gt; DocLoc)
-&gt; TcM Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (SumArity -&gt; DocLoc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682113977"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (SumArity -&gt; DocLoc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) SumArity
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DocLoc
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) (a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; IOEnv (Env TcGblEnv TcLclEnv) SumArity
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682113978"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1518"></span><span>      </span><span class="annot"><a href="#local-6989586621682113957"><span class="hs-identifier hs-var">resolve_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InstDoc/Language.Haskell.TH.Syntax.html#InstDoc"><span class="hs-identifier hs-type">TH.InstDoc</span></a></span><span> </span><span id="local-6989586621682113981"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113981"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DocLoc
</span><a href="GHC.Tc.Types.html#InstDoc"><span class="hs-identifier hs-var">InstDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; DocLoc)
-&gt; TcM Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DocLoc
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; TcM Name -&gt; TcM Name
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThInstName"><span class="hs-identifier hs-var">lookupThInstName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682113981"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1519"></span><span>      </span><span class="annot"><a href="#local-6989586621682113957"><span class="hs-identifier hs-var">resolve_loc</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ModuleDoc/Language.Haskell.TH.Syntax.html#ModuleDoc"><span class="hs-identifier hs-var">TH.ModuleDoc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DocLoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) DocLoc
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="GHC.Tc.Types.html#ModuleDoc"><span class="hs-identifier hs-var">ModuleDoc</span></a></span><span>
</span><span id="line-1520"></span><span>
</span><span id="line-1521"></span><span>      </span><span class="hs-comment">-- It doesn't make sense to add documentation to something not inside</span><span>
</span><span id="line-1522"></span><span>      </span><span class="hs-comment">-- the current module. So check for it!</span><span>
</span><span id="line-1523"></span><span>      </span><span id="local-6989586621682113959"><span class="annot"><span class="annottext">checkLocalName :: DocLoc -&gt; f Bool
</span><a href="#local-6989586621682113959"><span class="hs-identifier hs-var hs-var">checkLocalName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#DeclDoc"><span class="hs-identifier hs-type">DeclDoc</span></a></span><span> </span><span id="local-6989586621682114005"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114005"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Name -&gt; Bool)
-&gt; f (GenModule Unit) -&gt; f (Name -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">f (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span> </span><span class="annot"><span class="annottext">f (Name -&gt; Bool) -&gt; f Name -&gt; f Bool
forall a b. f (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; f Name
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114005"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1524"></span><span>      </span><span class="annot"><a href="#local-6989586621682113959"><span class="hs-identifier hs-var">checkLocalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ArgDoc"><span class="hs-identifier hs-type">ArgDoc</span></a></span><span> </span><span id="local-6989586621682114007"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114007"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Name -&gt; Bool)
-&gt; f (GenModule Unit) -&gt; f (Name -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">f (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span> </span><span class="annot"><span class="annottext">f (Name -&gt; Bool) -&gt; f Name -&gt; f Bool
forall a b. f (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; f Name
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114007"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1525"></span><span>      </span><span class="annot"><a href="#local-6989586621682113959"><span class="hs-identifier hs-var">checkLocalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#InstDoc"><span class="hs-identifier hs-type">InstDoc</span></a></span><span> </span><span id="local-6989586621682114008"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114008"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Name -&gt; Bool)
-&gt; f (GenModule Unit) -&gt; f (Name -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">f (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span> </span><span class="annot"><span class="annottext">f (Name -&gt; Bool) -&gt; f Name -&gt; f Bool
forall a b. f (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; f Name
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114008"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1526"></span><span>      </span><span class="annot"><a href="#local-6989586621682113959"><span class="hs-identifier hs-var">checkLocalName</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="GHC.Tc.Types.html#ModuleDoc"><span class="hs-identifier hs-var">ModuleDoc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; f Bool
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1527"></span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span>  </span><span id="local-6989586621682114020"><span class="annot"><span class="annottext">qGetDoc :: DocLoc -&gt; TcM (Maybe String)
</span><a href="#local-6989586621682114020"><span class="hs-identifier hs-var hs-var hs-var hs-var">qGetDoc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DeclDoc/Language.Haskell.TH.Syntax.html#DeclDoc"><span class="hs-identifier hs-type">TH.DeclDoc</span></a></span><span> </span><span id="local-6989586621682114022"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114022"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114022"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Name -&gt; (Name -&gt; TcM (Maybe String)) -&gt; TcM (Maybe String)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe String)
</span><a href="GHC.Tc.Gen.Splice.html#lookupDeclDoc"><span class="hs-identifier hs-var">lookupDeclDoc</span></a></span><span>
</span><span id="line-1530"></span><span>  </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qGetDoc/Language.Haskell.TH.Syntax.html#qGetDoc"><span class="hs-identifier hs-var">qGetDoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InstDoc/Language.Haskell.TH.Syntax.html#InstDoc"><span class="hs-identifier hs-type">TH.InstDoc</span></a></span><span> </span><span id="local-6989586621682114024"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114024"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThInstName"><span class="hs-identifier hs-var">lookupThInstName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114024"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Name -&gt; (Name -&gt; TcM (Maybe String)) -&gt; TcM (Maybe String)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe String)
</span><a href="GHC.Tc.Gen.Splice.html#lookupDeclDoc"><span class="hs-identifier hs-var">lookupDeclDoc</span></a></span><span>
</span><span id="line-1531"></span><span>  </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qGetDoc/Language.Haskell.TH.Syntax.html#qGetDoc"><span class="hs-identifier hs-var">qGetDoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ArgDoc/Language.Haskell.TH.Syntax.html#ArgDoc"><span class="hs-identifier hs-type">TH.ArgDoc</span></a></span><span> </span><span id="local-6989586621682114025"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114025"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682114026"><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682114026"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114025"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Name -&gt; (Name -&gt; TcM (Maybe String)) -&gt; TcM (Maybe String)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; Name -&gt; TcM (Maybe String)
</span><a href="GHC.Tc.Gen.Splice.html#lookupArgDoc"><span class="hs-identifier hs-var">lookupArgDoc</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682114026"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1532"></span><span>  </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qGetDoc/Language.Haskell.TH.Syntax.html#qGetDoc"><span class="hs-identifier hs-var">qGetDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ModuleDoc/Language.Haskell.TH.Syntax.html#ModuleDoc"><span class="hs-identifier hs-var">TH.ModuleDoc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1533"></span><span>    </span><span id="local-6989586621682114028"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682114028"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1534"></span><span>    </span><span id="local-6989586621682114029"><span class="annot"><span class="annottext">Maybe Docs
</span><a href="#local-6989586621682114029"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; (TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags -&gt; TcGblEnv -&gt; m (Maybe Docs)
</span><a href="GHC.HsToCore.Docs.html#extractDocs"><span class="hs-identifier hs-var">extractDocs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682114028"><span class="hs-identifier hs-var">df</span></a></span><span>
</span><span id="line-1535"></span><span>    </span><span class="annot"><span class="annottext">Maybe String -&gt; TcM (Maybe String)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDocString -&gt; String
</span><a href="GHC.Hs.DocString.html#renderHsDocString"><span class="hs-identifier hs-var">renderHsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">(HsDocString -&gt; String)
-&gt; (WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString)
-&gt; WithHsDocIdentifiers HsDocString GhcRn
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString
forall a pass. WithHsDocIdentifiers a pass -&gt; a
</span><a href="GHC.Hs.Doc.html#hsDocString"><span class="hs-identifier hs-var">hsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">(WithHsDocIdentifiers HsDocString GhcRn -&gt; String)
-&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn) -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Docs -&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn)
</span><a href="GHC.Hs.Doc.html#docs_mod_hdr"><span class="hs-identifier hs-var">docs_mod_hdr</span></a></span><span> </span><span class="annot"><span class="annottext">(Docs -&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn))
-&gt; Maybe Docs -&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3D%3C%3C/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Docs
</span><a href="#local-6989586621682114029"><span class="hs-identifier hs-var">docs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1536"></span><span>
</span><span id="line-1537"></span><span class="hs-comment">-- | Looks up documentation for a declaration in first the current module,</span><span>
</span><span id="line-1538"></span><span class="hs-comment">-- otherwise tries to find it in another module via 'hscGetModuleInterface'.</span><span>
</span><span id="line-1539"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupDeclDoc"><span class="hs-identifier hs-type">lookupDeclDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1540"></span><span id="lookupDeclDoc"><span class="annot"><span class="annottext">lookupDeclDoc :: Name -&gt; TcM (Maybe String)
</span><a href="GHC.Tc.Gen.Splice.html#lookupDeclDoc"><span class="hs-identifier hs-var hs-var">lookupDeclDoc</span></a></span></span><span> </span><span id="local-6989586621682114035"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114035"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1541"></span><span>  </span><span id="local-6989586621682114036"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682114036"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1542"></span><span>  </span><span class="annot"><a href="GHC.Hs.Doc.html#Docs"><span class="hs-identifier hs-type">Docs</span></a></span><span class="hs-special">{</span><span id="local-6989586621682114038"><span class="annot"><span class="annottext">UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
docs_decls :: UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
docs_decls :: Docs -&gt; UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="#local-6989586621682114038"><span class="hs-identifier hs-var hs-var">docs_decls</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe Docs -&gt; Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Docs
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Docs -&gt; Maybe Docs -&gt; Docs
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Docs
</span><a href="GHC.Hs.Doc.html#emptyDocs"><span class="hs-identifier hs-var">emptyDocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Docs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; (TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags -&gt; TcGblEnv -&gt; m (Maybe Docs)
</span><a href="GHC.HsToCore.Docs.html#extractDocs"><span class="hs-identifier hs-var">extractDocs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682114036"><span class="hs-identifier hs-var">df</span></a></span><span>
</span><span id="line-1543"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
-&gt; Name -&gt; Maybe [WithHsDocIdentifiers HsDocString GhcRn]
forall k a. Uniquable k =&gt; UniqMap k a -&gt; k -&gt; Maybe a
</span><a href="GHC.Types.Unique.Map.html#lookupUniqMap"><span class="hs-identifier hs-var">lookupUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="#local-6989586621682114038"><span class="hs-identifier hs-var">docs_decls</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114035"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1544"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114042"><span class="annot"><span class="annottext">[WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="#local-6989586621682114042"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; TcM (Maybe String)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; TcM (Maybe String))
-&gt; Maybe String -&gt; TcM (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsDocString] -&gt; String
</span><a href="GHC.Hs.DocString.html#renderHsDocStrings"><span class="hs-identifier hs-var">renderHsDocStrings</span></a></span><span> </span><span class="annot"><span class="annottext">([HsDocString] -&gt; String) -&gt; [HsDocString] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString)
-&gt; [WithHsDocIdentifiers HsDocString GhcRn] -&gt; [HsDocString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString
forall a pass. WithHsDocIdentifiers a pass -&gt; a
</span><a href="GHC.Hs.Doc.html#hsDocString"><span class="hs-identifier hs-var">hsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">[WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="#local-6989586621682114042"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1545"></span><span>    </span><span class="annot"><span class="annottext">Maybe [WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1546"></span><span>      </span><span class="hs-comment">-- Wasn't in the current module. Try searching other external ones!</span><span>
</span><span id="line-1547"></span><span>      </span><span id="local-6989586621682114044"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621682114044"><span class="hs-identifier hs-var">mIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe ModIface)
</span><a href="GHC.Tc.Gen.Splice.html#getExternalModIface"><span class="hs-identifier hs-var">getExternalModIface</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114035"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1548"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621682114044"><span class="hs-identifier hs-var">mIface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1549"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mi_docs :: forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Maybe Docs
</span><a href="GHC.Unit.Module.ModIface.html#mi_docs"><span class="hs-identifier hs-var">mi_docs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Doc.html#Docs"><span class="hs-identifier hs-type">Docs</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">docs_decls :: Docs -&gt; UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="GHC.Hs.Doc.html#docs_decls"><span class="hs-identifier hs-var">docs_decls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114048"><span class="annot"><span class="annottext">UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="#local-6989586621682114048"><span class="hs-identifier hs-var">dmap</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1550"></span><span>          </span><span class="annot"><span class="annottext">Maybe String -&gt; TcM (Maybe String)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; TcM (Maybe String))
-&gt; Maybe String -&gt; TcM (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[HsDocString] -&gt; String
</span><a href="GHC.Hs.DocString.html#renderHsDocStrings"><span class="hs-identifier hs-var">renderHsDocStrings</span></a></span><span> </span><span class="annot"><span class="annottext">([HsDocString] -&gt; String)
-&gt; ([WithHsDocIdentifiers HsDocString GhcRn] -&gt; [HsDocString])
-&gt; [WithHsDocIdentifiers HsDocString GhcRn]
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString)
-&gt; [WithHsDocIdentifiers HsDocString GhcRn] -&gt; [HsDocString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString
forall a pass. WithHsDocIdentifiers a pass -&gt; a
</span><a href="GHC.Hs.Doc.html#hsDocString"><span class="hs-identifier hs-var">hsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">([WithHsDocIdentifiers HsDocString GhcRn] -&gt; String)
-&gt; Maybe [WithHsDocIdentifiers HsDocString GhcRn] -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
-&gt; Name -&gt; Maybe [WithHsDocIdentifiers HsDocString GhcRn]
forall k a. Uniquable k =&gt; UniqMap k a -&gt; k -&gt; Maybe a
</span><a href="GHC.Types.Unique.Map.html#lookupUniqMap"><span class="hs-identifier hs-var">lookupUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap Name [WithHsDocIdentifiers HsDocString GhcRn]
</span><a href="#local-6989586621682114048"><span class="hs-identifier hs-var">dmap</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114035"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1551"></span><span>        </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; TcM (Maybe String)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span class="hs-comment">-- | Like 'lookupDeclDoc', looks up documentation for a function argument. If</span><span>
</span><span id="line-1554"></span><span class="hs-comment">-- it can't find any documentation for a function in this module, it tries to</span><span>
</span><span id="line-1555"></span><span class="hs-comment">-- find it in another module.</span><span>
</span><span id="line-1556"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupArgDoc"><span class="hs-identifier hs-type">lookupArgDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1557"></span><span id="lookupArgDoc"><span class="annot"><span class="annottext">lookupArgDoc :: SumArity -&gt; Name -&gt; TcM (Maybe String)
</span><a href="GHC.Tc.Gen.Splice.html#lookupArgDoc"><span class="hs-identifier hs-var hs-var">lookupArgDoc</span></a></span></span><span> </span><span id="local-6989586621682114049"><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682114049"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682114050"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114050"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1558"></span><span>  </span><span id="local-6989586621682114051"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682114051"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1559"></span><span>  </span><span class="annot"><a href="GHC.Hs.Doc.html#Docs"><span class="hs-identifier hs-type">Docs</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">docs_args :: Docs
-&gt; UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
</span><a href="GHC.Hs.Doc.html#docs_args"><span class="hs-identifier hs-var">docs_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114053"><span class="annot"><span class="annottext">UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
</span><a href="#local-6989586621682114053"><span class="hs-identifier hs-var">argDocs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe Docs -&gt; Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Docs
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Docs -&gt; Maybe Docs -&gt; Docs
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Docs
</span><a href="GHC.Hs.Doc.html#emptyDocs"><span class="hs-identifier hs-var">emptyDocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Docs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; (TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Docs)
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags -&gt; TcGblEnv -&gt; m (Maybe Docs)
</span><a href="GHC.HsToCore.Docs.html#extractDocs"><span class="hs-identifier hs-var">extractDocs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682114051"><span class="hs-identifier hs-var">df</span></a></span><span>
</span><span id="line-1560"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
-&gt; Name -&gt; Maybe (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
forall k a. Uniquable k =&gt; UniqMap k a -&gt; k -&gt; Maybe a
</span><a href="GHC.Types.Unique.Map.html#lookupUniqMap"><span class="hs-identifier hs-var">lookupUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
</span><a href="#local-6989586621682114053"><span class="hs-identifier hs-var">argDocs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114050"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1561"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114054"><span class="annot"><span class="annottext">IntMap (WithHsDocIdentifiers HsDocString GhcRn)
</span><a href="#local-6989586621682114054"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; TcM (Maybe String)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; TcM (Maybe String))
-&gt; Maybe String -&gt; TcM (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocString -&gt; String
</span><a href="GHC.Hs.DocString.html#renderHsDocString"><span class="hs-identifier hs-var">renderHsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">(HsDocString -&gt; String)
-&gt; (WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString)
-&gt; WithHsDocIdentifiers HsDocString GhcRn
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString
forall a pass. WithHsDocIdentifiers a pass -&gt; a
</span><a href="GHC.Hs.Doc.html#hsDocString"><span class="hs-identifier hs-var">hsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">(WithHsDocIdentifiers HsDocString GhcRn -&gt; String)
-&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn) -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
-&gt; IntMap (WithHsDocIdentifiers HsDocString GhcRn)
-&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn)
forall a. SumArity -&gt; IntMap a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.IntMap.Internal.html#lookup/Data.IntMap.Internal.html#lookup"><span class="hs-identifier hs-var">IntMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682114049"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (WithHsDocIdentifiers HsDocString GhcRn)
</span><a href="#local-6989586621682114054"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1562"></span><span>    </span><span class="annot"><span class="annottext">Maybe (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1563"></span><span>      </span><span id="local-6989586621682114056"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621682114056"><span class="hs-identifier hs-var">mIface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe ModIface)
</span><a href="GHC.Tc.Gen.Splice.html#getExternalModIface"><span class="hs-identifier hs-var">getExternalModIface</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114050"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1564"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621682114056"><span class="hs-identifier hs-var">mIface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1565"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mi_docs :: forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Maybe Docs
</span><a href="GHC.Unit.Module.ModIface.html#mi_docs"><span class="hs-identifier hs-var">mi_docs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Doc.html#Docs"><span class="hs-identifier hs-type">Docs</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">docs_args :: Docs
-&gt; UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
</span><a href="GHC.Hs.Doc.html#docs_args"><span class="hs-identifier hs-var">docs_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114057"><span class="annot"><span class="annottext">UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
</span><a href="#local-6989586621682114057"><span class="hs-identifier hs-var">amap</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1566"></span><span>          </span><span class="annot"><span class="annottext">Maybe String -&gt; TcM (Maybe String)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; TcM (Maybe String))
-&gt; Maybe String -&gt; TcM (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocString -&gt; String
</span><a href="GHC.Hs.DocString.html#renderHsDocString"><span class="hs-identifier hs-var">renderHsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">(HsDocString -&gt; String)
-&gt; (WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString)
-&gt; WithHsDocIdentifiers HsDocString GhcRn
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WithHsDocIdentifiers HsDocString GhcRn -&gt; HsDocString
forall a pass. WithHsDocIdentifiers a pass -&gt; a
</span><a href="GHC.Hs.Doc.html#hsDocString"><span class="hs-identifier hs-var">hsDocString</span></a></span><span> </span><span class="annot"><span class="annottext">(WithHsDocIdentifiers HsDocString GhcRn -&gt; String)
-&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn) -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
-&gt; Name -&gt; Maybe (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
forall k a. Uniquable k =&gt; UniqMap k a -&gt; k -&gt; Maybe a
</span><a href="GHC.Types.Unique.Map.html#lookupUniqMap"><span class="hs-identifier hs-var">lookupUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap Name (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
</span><a href="#local-6989586621682114057"><span class="hs-identifier hs-var">amap</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114050"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IntMap (WithHsDocIdentifiers HsDocString GhcRn))
-&gt; (IntMap (WithHsDocIdentifiers HsDocString GhcRn)
    -&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn))
-&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
-&gt; IntMap (WithHsDocIdentifiers HsDocString GhcRn)
-&gt; Maybe (WithHsDocIdentifiers HsDocString GhcRn)
forall a. SumArity -&gt; IntMap a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.IntMap.Internal.html#lookup/Data.IntMap.Internal.html#lookup"><span class="hs-identifier hs-var">IntMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682114049"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1567"></span><span>        </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; TcM (Maybe String)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1568"></span><span>
</span><span id="line-1569"></span><span class="annot"><span class="hs-comment">-- | Returns the module a Name belongs to, if it is isn't local.</span></span><span>
</span><span id="line-1570"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getExternalModIface"><span class="hs-identifier hs-type">getExternalModIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1571"></span><span id="getExternalModIface"><span class="annot"><span class="annottext">getExternalModIface :: Name -&gt; TcM (Maybe ModIface)
</span><a href="GHC.Tc.Gen.Splice.html#getExternalModIface"><span class="hs-identifier hs-var hs-var">getExternalModIface</span></a></span></span><span> </span><span id="local-6989586621682114058"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114058"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1572"></span><span>  </span><span id="local-6989586621682114059"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114059"><span class="hs-identifier hs-var">isLocal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Name -&gt; Bool)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (GenModule Unit)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (Name -&gt; Bool)
-&gt; TcM Name -&gt; TcM Bool
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) (a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114058"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1573"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114059"><span class="hs-identifier hs-var">isLocal</span></a></span><span>
</span><span id="line-1574"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface -&gt; TcM (Maybe ModIface)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1575"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe (GenModule Unit)
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114058"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1576"></span><span>          </span><span class="annot"><span class="annottext">Maybe (GenModule Unit)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface -&gt; TcM (Maybe ModIface)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1577"></span><span>          </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114061"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682114061"><span class="hs-identifier hs-var">modNm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1578"></span><span>            </span><span id="local-6989586621682114062"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682114062"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1579"></span><span>            </span><span id="local-6989586621682114063"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682114063"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModIface -&gt; IOEnv (Env TcGblEnv TcLclEnv) ModIface
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModIface -&gt; IOEnv (Env TcGblEnv TcLclEnv) ModIface)
-&gt; IO ModIface -&gt; IOEnv (Env TcGblEnv TcLclEnv) ModIface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; GenModule Unit -&gt; IO ModIface
</span><a href="GHC.Driver.Main.html#hscGetModuleInterface"><span class="hs-identifier hs-var">hscGetModuleInterface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682114062"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682114061"><span class="hs-identifier hs-var">modNm</span></a></span><span>
</span><span id="line-1580"></span><span>            </span><span class="annot"><span class="annottext">Maybe ModIface -&gt; TcM (Maybe ModIface)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Maybe ModIface
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682114063"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>
</span><span id="line-1582"></span><span class="annot"><span class="hs-comment">-- | Find the GHC name of the first instance that matches the TH type</span></span><span>
</span><span id="line-1583"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThInstName"><span class="hs-identifier hs-type">lookupThInstName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1584"></span><span id="lookupThInstName"><span class="annot"><span class="annottext">lookupThInstName :: Type -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThInstName"><span class="hs-identifier hs-var hs-var">lookupThInstName</span></a></span></span><span> </span><span id="local-6989586621682114064"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114064"><span class="hs-identifier hs-var">th_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1585"></span><span>  </span><span id="local-6989586621682114065"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114065"><span class="hs-identifier hs-var">cls_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Name
</span><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114064"><span class="hs-identifier hs-var">th_type</span></a></span><span>
</span><span id="line-1586"></span><span>  </span><span id="local-6989586621682114067"><span class="annot"><span class="annottext">Either (Class, [ClsInst]) (TyCon, [FamInst])
</span><a href="#local-6989586621682114067"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [Type] -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
</span><a href="GHC.Tc.Gen.Splice.html#reifyInstances%27"><span class="hs-identifier hs-var">reifyInstances'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114065"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="#local-6989586621682114069"><span class="hs-identifier hs-var">inst_arg_types</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114064"><span class="hs-identifier hs-var">th_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1587"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (Class, [ClsInst]) (TyCon, [FamInst])
</span><a href="#local-6989586621682114067"><span class="hs-identifier hs-var">insts</span></a></span><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- This expands any type synonyms</span><span>
</span><span id="line-1588"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114070"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682114070"><span class="hs-identifier hs-var">inst</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[ClsInst]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcM Name) -&gt; Name -&gt; TcM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682114070"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-1589"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114071"><span class="hs-identifier hs-var">noMatches</span></a></span><span>
</span><span id="line-1590"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114072"><span class="annot"><span class="annottext">FamInst
</span><a href="#local-6989586621682114072"><span class="hs-identifier hs-var">inst</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[FamInst]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcM Name) -&gt; Name -&gt; TcM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FamInst -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">FamInst
</span><a href="#local-6989586621682114072"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-1591"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114071"><span class="hs-identifier hs-var">noMatches</span></a></span><span>
</span><span id="line-1592"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1593"></span><span>    </span><span id="local-6989586621682114071"><span class="annot"><span class="annottext">noMatches :: TcM Name
</span><a href="#local-6989586621682114071"><span class="hs-identifier hs-var hs-var">noMatches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM Name
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM Name) -&gt; TcRnMessage -&gt; TcM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1594"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; LookupTHInstNameErrReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnFailedToLookupThInstName"><span class="hs-identifier hs-var">TcRnFailedToLookupThInstName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114064"><span class="hs-identifier hs-var">th_type</span></a></span><span> </span><span class="annot"><span class="annottext">LookupTHInstNameErrReason
</span><a href="GHC.Tc.Errors.Types.html#NoMatchesFound"><span class="hs-identifier hs-var">NoMatchesFound</span></a></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span>    </span><span class="hs-comment">-- Get the name of the class for the instance we are documenting</span><span>
</span><span id="line-1597"></span><span>    </span><span class="hs-comment">-- &gt; inst_cls_name (Monad Maybe) == Monad</span><span>
</span><span id="line-1598"></span><span>    </span><span class="hs-comment">-- &gt; inst_cls_name C = C</span><span>
</span><span id="line-1599"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-type">inst_cls_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-1600"></span><span>    </span><span id="local-6989586621682114066"><span class="annot"><span class="annottext">inst_cls_name :: Type -&gt; TcM Name
</span><a href="#local-6989586621682114066"><span class="hs-identifier hs-var hs-var">inst_cls_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-identifier hs-type">TH.AppT</span></a></span><span> </span><span id="local-6989586621682114076"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114076"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Name
</span><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114076"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1601"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SigT/Language.Haskell.TH.Syntax.html#SigT"><span class="hs-identifier hs-type">TH.SigT</span></a></span><span> </span><span id="local-6989586621682114078"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114078"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Name
</span><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114078"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1602"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#VarT/Language.Haskell.TH.Syntax.html#VarT"><span class="hs-identifier hs-type">TH.VarT</span></a></span><span> </span><span id="local-6989586621682114080"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114080"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114080"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1603"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-type">TH.ConT</span></a></span><span> </span><span id="local-6989586621682114082"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114082"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114082"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1604"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedT/Language.Haskell.TH.Syntax.html#PromotedT"><span class="hs-identifier hs-type">TH.PromotedT</span></a></span><span> </span><span id="local-6989586621682114084"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114084"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114084"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1605"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InfixT/Language.Haskell.TH.Syntax.html#InfixT"><span class="hs-identifier hs-type">TH.InfixT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682114086"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114086"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114086"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1606"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#UInfixT/Language.Haskell.TH.Syntax.html#UInfixT"><span class="hs-identifier hs-type">TH.UInfixT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682114088"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114088"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114088"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1607"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedInfixT/Language.Haskell.TH.Syntax.html#PromotedInfixT"><span class="hs-identifier hs-type">TH.PromotedInfixT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682114090"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114090"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114090"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1608"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedUInfixT/Language.Haskell.TH.Syntax.html#PromotedUInfixT"><span class="hs-identifier hs-type">TH.PromotedUInfixT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682114092"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114092"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114092"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1609"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ParensT/Language.Haskell.TH.Syntax.html#ParensT"><span class="hs-identifier hs-type">TH.ParensT</span></a></span><span> </span><span id="local-6989586621682114094"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114094"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Name
</span><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114094"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1610"></span><span>
</span><span id="line-1611"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ForallT/Language.Haskell.TH.Syntax.html#ForallT"><span class="hs-identifier hs-type">TH.ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1612"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ForallVisT/Language.Haskell.TH.Syntax.html#ForallVisT"><span class="hs-identifier hs-type">TH.ForallVisT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1613"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppKindT/Language.Haskell.TH.Syntax.html#AppKindT"><span class="hs-identifier hs-type">TH.AppKindT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1614"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TupleT/Language.Haskell.TH.Syntax.html#TupleT"><span class="hs-identifier hs-type">TH.TupleT</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1615"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#UnboxedTupleT/Language.Haskell.TH.Syntax.html#UnboxedTupleT"><span class="hs-identifier hs-type">TH.UnboxedTupleT</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1616"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#UnboxedSumT/Language.Haskell.TH.Syntax.html#UnboxedSumT"><span class="hs-identifier hs-type">TH.UnboxedSumT</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1617"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ArrowT/Language.Haskell.TH.Syntax.html#ArrowT"><span class="hs-identifier hs-var">TH.ArrowT</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1618"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#MulArrowT/Language.Haskell.TH.Syntax.html#MulArrowT"><span class="hs-identifier hs-var">TH.MulArrowT</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1619"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#EqualityT/Language.Haskell.TH.Syntax.html#EqualityT"><span class="hs-identifier hs-var">TH.EqualityT</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1620"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ListT/Language.Haskell.TH.Syntax.html#ListT"><span class="hs-identifier hs-var">TH.ListT</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1621"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedTupleT/Language.Haskell.TH.Syntax.html#PromotedTupleT"><span class="hs-identifier hs-type">TH.PromotedTupleT</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1622"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedNilT/Language.Haskell.TH.Syntax.html#PromotedNilT"><span class="hs-identifier hs-var">TH.PromotedNilT</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1623"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedConsT/Language.Haskell.TH.Syntax.html#PromotedConsT"><span class="hs-identifier hs-var">TH.PromotedConsT</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1624"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#StarT/Language.Haskell.TH.Syntax.html#StarT"><span class="hs-identifier hs-var">TH.StarT</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1625"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConstraintT/Language.Haskell.TH.Syntax.html#ConstraintT"><span class="hs-identifier hs-var">TH.ConstraintT</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1626"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#LitT/Language.Haskell.TH.Syntax.html#LitT"><span class="hs-identifier hs-type">TH.LitT</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1627"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#WildCardT/Language.Haskell.TH.Syntax.html#WildCardT"><span class="hs-identifier hs-var">TH.WildCardT</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1628"></span><span>    </span><span class="annot"><a href="#local-6989586621682114066"><span class="hs-identifier hs-var">inst_cls_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ImplicitParamT/Language.Haskell.TH.Syntax.html#ImplicitParamT"><span class="hs-identifier hs-type">TH.ImplicitParamT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var">inst_cls_name_err</span></a></span><span>
</span><span id="line-1629"></span><span>
</span><span id="line-1630"></span><span>    </span><span id="local-6989586621682114096"><span class="annot"><span class="annottext">inst_cls_name_err :: TcM Name
</span><a href="#local-6989586621682114096"><span class="hs-identifier hs-var hs-var">inst_cls_name_err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM Name
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM Name) -&gt; TcRnMessage -&gt; TcM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1631"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; LookupTHInstNameErrReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnFailedToLookupThInstName"><span class="hs-identifier hs-var">TcRnFailedToLookupThInstName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114064"><span class="hs-identifier hs-var">th_type</span></a></span><span> </span><span class="annot"><span class="annottext">LookupTHInstNameErrReason
</span><a href="GHC.Tc.Errors.Types.html#CouldNotDetermineInstance"><span class="hs-identifier hs-var">CouldNotDetermineInstance</span></a></span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span>    </span><span class="hs-comment">-- Basically does the opposite of 'mkThAppTs'</span><span>
</span><span id="line-1634"></span><span>    </span><span class="hs-comment">-- &gt; inst_arg_types (Monad Maybe) == [Maybe]</span><span>
</span><span id="line-1635"></span><span>    </span><span class="hs-comment">-- &gt; inst_arg_types C == []</span><span>
</span><span id="line-1636"></span><span>    </span><span class="annot"><a href="#local-6989586621682114069"><span class="hs-identifier hs-type">inst_arg_types</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1637"></span><span>    </span><span id="local-6989586621682114069"><span class="annot"><span class="annottext">inst_arg_types :: Type -&gt; [Type]
</span><a href="#local-6989586621682114069"><span class="hs-identifier hs-var hs-var">inst_arg_types</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-identifier hs-type">TH.AppT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682114115"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114115"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1638"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114116"><span class="annot"><span class="annottext">go :: Type -&gt; [Type]
</span><a href="#local-6989586621682114116"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-identifier hs-type">TH.AppT</span></a></span><span> </span><span id="local-6989586621682114117"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114117"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682114118"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114118"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114117"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="#local-6989586621682114116"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114118"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1639"></span><span>          </span><span class="annot"><a href="#local-6989586621682114116"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682114119"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114119"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114119"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="#local-6989586621682114116"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114115"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1641"></span><span>    </span><span class="annot"><a href="#local-6989586621682114069"><span class="hs-identifier hs-var">inst_arg_types</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span class="annot"><span class="hs-comment">-- | Adds a mod finalizer reference to the local environment.</span></span><span>
</span><span id="line-1644"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-type">addModFinalizerRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignRef/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Q/Language.Haskell.TH.Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span id="addModFinalizerRef"><span class="annot"><span class="annottext">addModFinalizerRef :: ForeignRef (Q ()) -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-var hs-var">addModFinalizerRef</span></a></span></span><span> </span><span id="local-6989586621682114120"><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621682114120"><span class="hs-identifier hs-var">finRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1646"></span><span>    </span><span id="local-6989586621682114121"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682114121"><span class="hs-identifier hs-var">th_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-1647"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682114121"><span class="hs-identifier hs-var">th_stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1648"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-type">RunSplice</span></a></span><span> </span><span id="local-6989586621682114122"><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621682114122"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
-&gt; ([ForeignRef (Q ())] -&gt; [ForeignRef (Q ())]) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621682114122"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621682114120"><span class="hs-identifier hs-var">finRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (Q ()) -&gt; [ForeignRef (Q ())] -&gt; [ForeignRef (Q ())]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-1649"></span><span>      </span><span class="hs-comment">-- This case happens only if a splice is executed and the caller does</span><span>
</span><span id="line-1650"></span><span>      </span><span class="hs-comment">-- not set the 'ThStage' to 'RunSplice' to collect finalizers.</span><span>
</span><span id="line-1651"></span><span>      </span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices] in GHC.Rename.Splice.</span><span>
</span><span id="line-1652"></span><span>      </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1653"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addModFinalizer was called when no finalizers were collected&quot;</span></span><span>
</span><span id="line-1654"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682114121"><span class="hs-identifier hs-var">th_stage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1655"></span><span>
</span><span id="line-1656"></span><span class="annot"><span class="hs-comment">-- | Releases the external interpreter state.</span></span><span>
</span><span id="line-1657"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier hs-type">finishTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span id="finishTH"><span class="annot"><span class="annottext">finishTH :: TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier hs-var hs-var">finishTH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1659"></span><span>  </span><span id="local-6989586621682114123"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682114123"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1660"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">(Interp -&gt; InterpInstance) -&gt; Maybe Interp -&gt; Maybe InterpInstance
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682114123"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1661"></span><span>    </span><span class="annot"><span class="annottext">Maybe InterpInstance
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1666"></span><span>      </span><span id="local-6989586621682114125"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114125"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1667"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; Maybe (ForeignRef (IORef QState)) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114125"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1668"></span><span>
</span><span id="line-1669"></span><span>
</span><span id="line-1670"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHExp"><span class="hs-identifier hs-type">runTHExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Exp/Language.Haskell.TH.Syntax.html#Exp"><span class="hs-identifier hs-type">TH.Exp</span></a></span><span>
</span><span id="line-1671"></span><span id="runTHExp"><span class="annot"><span class="annottext">runTHExp :: ForeignHValue -&gt; TcM Exp
</span><a href="GHC.Tc.Gen.Splice.html#runTHExp"><span class="hs-identifier hs-var hs-var">runTHExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Exp
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#THExp/GHCi.Message.html#THExp"><span class="hs-identifier hs-var">THExp</span></a></span><span>
</span><span id="line-1672"></span><span>
</span><span id="line-1673"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHPat"><span class="hs-identifier hs-type">runTHPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Pat/Language.Haskell.TH.Syntax.html#Pat"><span class="hs-identifier hs-type">TH.Pat</span></a></span><span>
</span><span id="line-1674"></span><span id="runTHPat"><span class="annot"><span class="annottext">runTHPat :: ForeignHValue -&gt; TcM Pat
</span><a href="GHC.Tc.Gen.Splice.html#runTHPat"><span class="hs-identifier hs-var hs-var">runTHPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Pat
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#THPat/GHCi.Message.html#THPat"><span class="hs-identifier hs-var">THPat</span></a></span><span>
</span><span id="line-1675"></span><span>
</span><span id="line-1676"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHType"><span class="hs-identifier hs-type">runTHType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-1677"></span><span id="runTHType"><span class="annot"><span class="annottext">runTHType :: ForeignHValue -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#runTHType"><span class="hs-identifier hs-var hs-var">runTHType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Type
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#THType/GHCi.Message.html#THType"><span class="hs-identifier hs-var">THType</span></a></span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHDec"><span class="hs-identifier hs-type">runTHDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1680"></span><span id="runTHDec"><span class="annot"><span class="annottext">runTHDec :: ForeignHValue -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#runTHDec"><span class="hs-identifier hs-var hs-var">runTHDec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM [Dec]
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#THDec/GHCi.Message.html#THDec"><span class="hs-identifier hs-var">THDec</span></a></span><span>
</span><span id="line-1681"></span><span>
</span><span id="line-1682"></span><span id="local-6989586621682111956"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-type">runTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../binary-0.8.9.1/src/Data.Binary.Class.html#Binary/Data.Binary.Class.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682111956"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#THResultType/GHCi.Message.html#THResultType"><span class="hs-identifier hs-type">THResultType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignHValue/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682111956"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1683"></span><span id="runTH"><span class="annot"><span class="annottext">runTH :: forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var hs-var">runTH</span></a></span></span><span> </span><span id="local-6989586621682114149"><span class="annot"><span class="annottext">THResultType
</span><a href="#local-6989586621682114149"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682114150"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682114150"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1684"></span><span>  </span><span id="local-6989586621682114151"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682114151"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var">tcGetInterp</span></a></span><span>
</span><span id="line-1685"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682114151"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1688"></span><span>       </span><span class="hs-comment">-- Run it in the local TcM</span><span>
</span><span id="line-1689"></span><span>      </span><span id="local-6989586621682114152"><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621682114152"><span class="hs-identifier hs-var">hv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue)
-&gt; IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO HValue
forall a. Interp -&gt; ForeignRef a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier hs-var">wormhole</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682114151"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682114150"><span class="hs-identifier hs-var">fhv</span></a></span><span>
</span><span id="line-1690"></span><span>      </span><span id="local-6989586621682114153"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114153"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q a -&gt; TcM a
forall a. Q a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-var">runQuasi</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114154"><span class="annot"><span class="annottext">HValue -&gt; Q a
forall a b. a -&gt; b
</span><a href="../../base-4.18.3.0/src/Unsafe.Coerce.html#unsafeCoerce/Unsafe.Coerce.html#unsafeCoerce"><span class="hs-identifier hs-var">unsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621682114152"><span class="hs-identifier hs-var">hv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Q/Language.Haskell.TH.Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682114154"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1691"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114153"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1694"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682114155"><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682114155"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621682114156"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682114156"><span class="hs-identifier hs-var">iserv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1695"></span><span>      </span><span class="hs-comment">-- Run it on the server.  For an overview of how TH works with</span><span>
</span><span id="line-1696"></span><span>      </span><span class="hs-comment">-- Remote GHCi, see Note [Remote Template Haskell] in</span><span>
</span><span id="line-1697"></span><span>      </span><span class="hs-comment">-- libraries/ghci/GHCi/TH.hs.</span><span>
</span><span id="line-1698"></span><span>      </span><span class="annot"><span class="annottext">IServConfig -&gt; IServ -&gt; (IServInstance -&gt; TcM a) -&gt; TcM a
forall (m :: * -&gt; *) a.
(MonadIO m, ExceptionMonad m) =&gt;
IServConfig -&gt; IServ -&gt; (IServInstance -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ_"><span class="hs-identifier hs-var">withIServ_</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682114155"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682114156"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">((IServInstance -&gt; TcM a) -&gt; TcM a)
-&gt; (IServInstance -&gt; TcM a) -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682114157"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114157"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1699"></span><span>        </span><span id="local-6989586621682114158"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682114158"><span class="hs-identifier hs-var">rstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; TcM (ForeignRef (IORef QState))
</span><a href="GHC.Tc.Gen.Splice.html#getTHState"><span class="hs-identifier hs-var">getTHState</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114157"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1700"></span><span>        </span><span id="local-6989586621682114160"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621682114160"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Loc
forall (m :: * -&gt; *). Quasi m =&gt; m Loc
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qLocation/Language.Haskell.TH.Syntax.html#qLocation"><span class="hs-identifier hs-var">TH.qLocation</span></a></span><span>
</span><span id="line-1701"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; TcRn ()
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcRn ()) -&gt; IO () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1702"></span><span>          </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#withForeignRef/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682114158"><span class="hs-identifier hs-var">rstate</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682114161"><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621682114161"><span class="hs-identifier hs-var">state_hv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1703"></span><span>          </span><span class="annot"><span class="annottext">ForeignHValue -&gt; (RemoteRef HValue -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#withForeignRef/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682114150"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef HValue -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef HValue -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682114162"><span class="annot"><span class="annottext">RemoteRef HValue
</span><a href="#local-6989586621682114162"><span class="hs-identifier hs-var">q_hv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1704"></span><span>            </span><span class="annot"><span class="annottext">IServInstance -&gt; Put -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#writeIServ"><span class="hs-identifier hs-var">writeIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114157"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message (QResult ByteString) -&gt; Put
forall a. Message a -&gt; Put
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#putMessage/GHCi.Message.html#putMessage"><span class="hs-identifier hs-var">putMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
-&gt; RemoteRef HValue
-&gt; THResultType
-&gt; Maybe Loc
-&gt; Message (QResult ByteString)
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#RunTH/GHCi.Message.html#RunTH"><span class="hs-identifier hs-var">RunTH</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621682114161"><span class="hs-identifier hs-var">state_hv</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef HValue
</span><a href="#local-6989586621682114162"><span class="hs-identifier hs-var">q_hv</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="#local-6989586621682114149"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621682114160"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1705"></span><span>        </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages TcRnMessage] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114157"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1706"></span><span>        </span><span id="local-6989586621682114164"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682114164"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; TcM ByteString
forall a. Binary a =&gt; IServInstance -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-var">readQResult</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114157"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1707"></span><span>        </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; TcM a) -&gt; a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Get a -&gt; ByteString -&gt; a
forall a. Get a -&gt; ByteString -&gt; a
</span><a href="../../binary-0.8.9.1/src/Data.Binary.Get.html#runGet/Data.Binary.Get.html#runGet"><span class="hs-identifier hs-var">runGet</span></a></span><span> </span><span class="annot"><span class="annottext">Get a
forall t. Binary t =&gt; Get t
</span><a href="../../binary-0.8.9.1/src/Data.Binary.Class.html#get/Data.Binary.Class.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.4/src/Data.ByteString.Lazy.Internal.html#fromStrict/Data.ByteString.Lazy.Internal.html#fromStrict"><span class="hs-identifier hs-var">LB.fromStrict</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682114164"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1708"></span><span>
</span><span id="line-1709"></span><span>
</span><span id="line-1710"></span><span class="hs-comment">-- | communicate with a remotely-running TH computation until it finishes.</span><span>
</span><span id="line-1711"></span><span class="hs-comment">-- See Note [Remote Template Haskell] in libraries/ghci/GHCi/TH.hs.</span><span>
</span><span id="line-1712"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-type">runRemoteTH</span></a></span><span>
</span><span id="line-1713"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServInstance"><span class="hs-identifier hs-type">IServInstance</span></a></span><span>
</span><span id="line-1714"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">--  saved from nested calls to qRecover</span><span>
</span><span id="line-1715"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1716"></span><span id="runRemoteTH"><span class="annot"><span class="annottext">runRemoteTH :: IServInstance -&gt; [Messages TcRnMessage] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var hs-var">runRemoteTH</span></a></span></span><span> </span><span id="local-6989586621682114168"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114168"><span class="hs-identifier hs-var">iserv</span></a></span></span><span> </span><span id="local-6989586621682114169"><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114169"><span class="hs-identifier hs-var">recovers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1717"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#THMsg/GHCi.Message.html#THMsg"><span class="hs-identifier hs-type">THMsg</span></a></span><span> </span><span id="local-6989586621682114177"><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621682114177"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO THMsg -&gt; IOEnv (Env TcGblEnv TcLclEnv) THMsg
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO THMsg -&gt; IOEnv (Env TcGblEnv TcLclEnv) THMsg)
-&gt; IO THMsg -&gt; IOEnv (Env TcGblEnv TcLclEnv) THMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; Get THMsg -&gt; IO THMsg
forall a. IServInstance -&gt; Get a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#readIServ"><span class="hs-identifier hs-var">readIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114168"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">Get THMsg
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#getTHMessage/GHCi.Message.html#getTHMessage"><span class="hs-identifier hs-var">getTHMessage</span></a></span><span>
</span><span id="line-1718"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621682114177"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1719"></span><span>    </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#RunTHDone/GHCi.Message.html#RunTHDone"><span class="hs-identifier hs-var">RunTHDone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1720"></span><span>    </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#StartRecover/GHCi.Message.html#StartRecover"><span class="hs-identifier hs-var">StartRecover</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Note [TH recover with -fexternal-interpreter]</span><span>
</span><span id="line-1721"></span><span>      </span><span id="local-6989586621682114188"><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
</span><a href="#local-6989586621682114188"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (TcRef (Messages TcRnMessage))
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-1722"></span><span>      </span><span id="local-6989586621682114190"><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682114190"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
-&gt; TcRnIf TcGblEnv TcLclEnv (Messages TcRnMessage)
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
</span><a href="#local-6989586621682114188"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1723"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage) -&gt; Messages TcRnMessage -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
</span><a href="#local-6989586621682114188"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1724"></span><span>      </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages TcRnMessage] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114168"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682114190"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
-&gt; [Messages TcRnMessage] -&gt; [Messages TcRnMessage]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114169"><span class="hs-identifier hs-var">recovers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1725"></span><span>    </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#EndRecover/GHCi.Message.html#EndRecover"><span class="hs-identifier hs-type">EndRecover</span></a></span><span> </span><span id="local-6989586621682114202"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114202"><span class="hs-identifier hs-var">caught_error</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1726"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114203"><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682114203"><span class="hs-identifier hs-var">prev_msgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114204"><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114204"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114169"><span class="hs-identifier hs-var">recovers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1727"></span><span>             </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Messages TcRnMessage, [Messages TcRnMessage])
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EndRecover&quot;</span></span><span>
</span><span id="line-1728"></span><span>             </span><span id="local-6989586621682114205"><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682114205"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682114206"><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114206"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682114205"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114206"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1729"></span><span>      </span><span id="local-6989586621682114207"><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
</span><a href="#local-6989586621682114207"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (TcRef (Messages TcRnMessage))
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-1730"></span><span>      </span><span id="local-6989586621682114208"><span class="annot"><span class="annottext">Bag (MsgEnvelope TcRnMessage)
</span><a href="#local-6989586621682114208"><span class="hs-identifier hs-var">warn_msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; Bag (MsgEnvelope TcRnMessage)
forall e. Diagnostic e =&gt; Messages e -&gt; Bag (MsgEnvelope e)
</span><a href="GHC.Types.Error.html#getWarningMessages"><span class="hs-identifier hs-var">getWarningMessages</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages TcRnMessage -&gt; Bag (MsgEnvelope TcRnMessage))
-&gt; TcRnIf TcGblEnv TcLclEnv (Messages TcRnMessage)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Bag (MsgEnvelope TcRnMessage))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
-&gt; TcRnIf TcGblEnv TcLclEnv (Messages TcRnMessage)
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
</span><a href="#local-6989586621682114207"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1731"></span><span>      </span><span class="hs-comment">-- keep the warnings only if there were no errors</span><span>
</span><span id="line-1732"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage) -&gt; Messages TcRnMessage -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Messages TcRnMessage)
</span><a href="#local-6989586621682114207"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages TcRnMessage -&gt; TcRn ())
-&gt; Messages TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114202"><span class="hs-identifier hs-var">caught_error</span></a></span><span>
</span><span id="line-1733"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682114203"><span class="hs-identifier hs-var">prev_msgs</span></a></span><span>
</span><span id="line-1734"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope TcRnMessage) -&gt; Messages TcRnMessage
forall e. Bag (MsgEnvelope e) -&gt; Messages e
</span><a href="GHC.Types.Error.html#mkMessages"><span class="hs-identifier hs-var">mkMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope TcRnMessage)
</span><a href="#local-6989586621682114208"><span class="hs-identifier hs-var">warn_msgs</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
-&gt; Messages TcRnMessage -&gt; Messages TcRnMessage
forall e. Messages e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-var">`unionMessages`</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682114203"><span class="hs-identifier hs-var">prev_msgs</span></a></span><span>
</span><span id="line-1735"></span><span>      </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages TcRnMessage] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114168"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114204"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1736"></span><span>    </span><span id="local-6989586621682114212"><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621682114212"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1737"></span><span>      </span><span id="local-6989586621682114213"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114213"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">THMessage a -&gt; TcM a
forall a. THMessage a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#handleTHMessage"><span class="hs-identifier hs-var">handleTHMessage</span></a></span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621682114177"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1738"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; TcRn ()
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcRn ()) -&gt; IO () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; Put -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#writeIServ"><span class="hs-identifier hs-var">writeIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114168"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Put
forall t. Binary t =&gt; t -&gt; Put
</span><a href="../../binary-0.8.9.1/src/Data.Binary.Class.html#put/Data.Binary.Class.html#put"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114213"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1739"></span><span>      </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages TcRnMessage] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114168"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">[Messages TcRnMessage]
</span><a href="#local-6989586621682114169"><span class="hs-identifier hs-var">recovers</span></a></span><span>
</span><span id="line-1740"></span><span>
</span><span id="line-1741"></span><span class="annot"><span class="hs-comment">-- | Read a value of type QResult from the iserv</span></span><span>
</span><span id="line-1742"></span><span id="local-6989586621682111998"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-type">readQResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../binary-0.8.9.1/src/Data.Binary.Class.html#Binary/Data.Binary.Class.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682111998"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServInstance"><span class="hs-identifier hs-type">IServInstance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682111998"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1743"></span><span id="readQResult"><span class="annot"><span class="annottext">readQResult :: forall a. Binary a =&gt; IServInstance -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-var hs-var">readQResult</span></a></span></span><span> </span><span id="local-6989586621682114226"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114226"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1744"></span><span>  </span><span id="local-6989586621682114227"><span class="annot"><span class="annottext">QResult a
</span><a href="#local-6989586621682114227"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (QResult a) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (QResult a)
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (QResult a) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (QResult a))
-&gt; IO (QResult a) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (QResult a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; Get (QResult a) -&gt; IO (QResult a)
forall a. IServInstance -&gt; Get a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#readIServ"><span class="hs-identifier hs-var">readIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114226"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Get (QResult a)
forall t. Binary t =&gt; Get t
</span><a href="../../binary-0.8.9.1/src/Data.Binary.Class.html#get/Data.Binary.Class.html#get"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-1745"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QResult a
</span><a href="#local-6989586621682114227"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1746"></span><span>    </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#QDone/GHCi.Message.html#QDone"><span class="hs-identifier hs-type">QDone</span></a></span><span> </span><span id="local-6989586621682114229"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114229"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114229"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1747"></span><span>    </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#QException/GHCi.Message.html#QException"><span class="hs-identifier hs-type">QException</span></a></span><span> </span><span id="local-6989586621682114231"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114231"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; TcM a
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; TcM a) -&gt; IO a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCall -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../base-4.18.3.0/src/GHC.IO.html#throwIO/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ErrorCall
</span><a href="../../base-4.18.3.0/src/GHC.Exception.html#ErrorCall/GHC.Exception.html#ErrorCall"><span class="hs-identifier hs-var">ErrorCall</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114231"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1748"></span><span>    </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#QFail/GHCi.Message.html#QFail"><span class="hs-identifier hs-type">QFail</span></a></span><span> </span><span id="local-6989586621682114234"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114234"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM a
forall a. String -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.Fail.html#fail/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114234"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1749"></span><span>
</span><span id="line-1750"></span><span class="hs-comment">{- Note [TH recover with -fexternal-interpreter]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Recover is slightly tricky to implement.

The meaning of &quot;recover a b&quot; is
 - Do a
   - If it finished with no errors, then keep the warnings it generated
   - If it failed, discard any messages it generated, and do b

Note that &quot;failed&quot; here can mean either
  (1) threw an exception (failTc)
  (2) generated an error message (addErrTcM)

The messages are managed by GHC in the TcM monad, whereas the
exception-handling is done in the ghc-iserv process, so we have to
coordinate between the two.

On the server:
  - emit a StartRecover message
  - run &quot;a; FailIfErrs&quot; inside a try
  - emit an (EndRecover x) message, where x = True if &quot;a; FailIfErrs&quot; failed
  - if &quot;a; FailIfErrs&quot; failed, run &quot;b&quot;

Back in GHC, when we receive:

  FailIfErrrs
    failTc if there are any error messages (= failIfErrsM)
  StartRecover
    save the current messages and start with an empty set.
  EndRecover caught_error
    Restore the previous messages,
    and merge in the new messages if caught_error is false.
-}</span><span>
</span><span id="line-1783"></span><span>
</span><span id="line-1784"></span><span class="hs-comment">-- | Retrieve (or create, if it hasn't been created already), the</span><span>
</span><span id="line-1785"></span><span class="hs-comment">-- remote TH state.  The TH state is a remote reference to an IORef</span><span>
</span><span id="line-1786"></span><span class="hs-comment">-- QState living on the server, and we have to pass this to each RunTH</span><span>
</span><span id="line-1787"></span><span class="hs-comment">-- call we make.</span><span>
</span><span id="line-1788"></span><span class="hs-comment">--</span><span>
</span><span id="line-1789"></span><span class="hs-comment">-- The TH state is stored in tcg_th_remote_state in the TcGblEnv.</span><span>
</span><span id="line-1790"></span><span class="hs-comment">--</span><span>
</span><span id="line-1791"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getTHState"><span class="hs-identifier hs-type">getTHState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServInstance"><span class="hs-identifier hs-type">IServInstance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.RemoteTypes.html#ForeignRef/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IORef.html#IORef/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#QState/GHCi.Message.html#QState"><span class="hs-identifier hs-type">QState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span id="getTHState"><span class="annot"><span class="annottext">getTHState :: IServInstance -&gt; TcM (ForeignRef (IORef QState))
</span><a href="GHC.Tc.Gen.Splice.html#getTHState"><span class="hs-identifier hs-var hs-var">getTHState</span></a></span></span><span> </span><span id="local-6989586621682114235"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114235"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1793"></span><span>  </span><span id="local-6989586621682114236"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114236"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1794"></span><span>  </span><span id="local-6989586621682114237"><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621682114237"><span class="hs-identifier hs-var">th_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; TcRnIf TcGblEnv TcLclEnv (Maybe (ForeignRef (IORef QState)))
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114236"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1795"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621682114237"><span class="hs-identifier hs-var">th_state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1796"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114238"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682114238"><span class="hs-identifier hs-var">rhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState) -&gt; TcM (ForeignRef (IORef QState))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682114238"><span class="hs-identifier hs-var">rhv</span></a></span><span>
</span><span id="line-1797"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1798"></span><span>      </span><span id="local-6989586621682114239"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682114239"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var">tcGetInterp</span></a></span><span>
</span><span id="line-1799"></span><span>      </span><span id="local-6989586621682114240"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682114240"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignRef (IORef QState)) -&gt; TcM (ForeignRef (IORef QState))
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ForeignRef (IORef QState)) -&gt; TcM (ForeignRef (IORef QState)))
-&gt; IO (ForeignRef (IORef QState))
-&gt; TcM (ForeignRef (IORef QState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; RemoteRef (IORef QState) -&gt; IO (ForeignRef (IORef QState))
forall a. Interp -&gt; RemoteRef a -&gt; IO (ForeignRef a)
</span><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-var">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682114239"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteRef (IORef QState) -&gt; IO (ForeignRef (IORef QState)))
-&gt; IO (RemoteRef (IORef QState)) -&gt; IO (ForeignRef (IORef QState))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3D%3C%3C/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
-&gt; Message (RemoteRef (IORef QState))
-&gt; IO (RemoteRef (IORef QState))
forall a. Binary a =&gt; IServInstance -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#iservCall"><span class="hs-identifier hs-var">iservCall</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621682114235"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Message (RemoteRef (IORef QState))
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#StartTH/GHCi.Message.html#StartTH"><span class="hs-identifier hs-var">StartTH</span></a></span><span>
</span><span id="line-1800"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; Maybe (ForeignRef (IORef QState)) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114236"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignRef (IORef QState) -&gt; Maybe (ForeignRef (IORef QState))
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682114240"><span class="hs-identifier hs-var">fhv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1801"></span><span>      </span><span class="annot"><span class="annottext">ForeignRef (IORef QState) -&gt; TcM (ForeignRef (IORef QState))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621682114240"><span class="hs-identifier hs-var">fhv</span></a></span><span>
</span><span id="line-1802"></span><span>
</span><span id="line-1803"></span><span id="local-6989586621682112232"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-type">wrapTHResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112232"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#THResult/GHCi.Message.html#THResult"><span class="hs-identifier hs-type">THResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112232"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1804"></span><span id="wrapTHResult"><span class="annot"><span class="annottext">wrapTHResult :: forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var hs-var">wrapTHResult</span></a></span></span><span> </span><span id="local-6989586621682114250"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682114250"><span class="hs-identifier hs-var">tcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1805"></span><span>  </span><span id="local-6989586621682114251"><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621682114251"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure a)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682114250"><span class="hs-identifier hs-var">tcm</span></a></span><span>   </span><span class="hs-comment">-- only catch 'fail', treat everything else as catastrophic</span><span>
</span><span id="line-1806"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621682114251"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1807"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682114252"><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621682114252"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">THResult a -&gt; TcM (THResult a)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; THResult a
forall a. String -&gt; THResult a
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#THException/GHCi.Message.html#THException"><span class="hs-identifier hs-var">THException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOEnvFailure -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.3.0/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621682114252"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1808"></span><span>    </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682114255"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114255"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">THResult a -&gt; TcM (THResult a)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; THResult a
forall a. a -&gt; THResult a
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#THComplete/GHCi.Message.html#THComplete"><span class="hs-identifier hs-var">THComplete</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682114255"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1809"></span><span>
</span><span id="line-1810"></span><span id="local-6989586621682112222"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#handleTHMessage"><span class="hs-identifier hs-type">handleTHMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#THMessage/GHCi.Message.html#THMessage"><span class="hs-identifier hs-type">THMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112222"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112222"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1811"></span><span id="handleTHMessage"><span class="annot"><span class="annottext">handleTHMessage :: forall a. THMessage a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#handleTHMessage"><span class="hs-identifier hs-var hs-var">handleTHMessage</span></a></span></span><span> </span><span id="local-6989586621682114261"><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621682114261"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621682114261"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1812"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#NewName/GHCi.Message.html#NewName"><span class="hs-identifier hs-type">NewName</span></a></span><span> </span><span id="local-6989586621682114265"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114265"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Name -&gt; TcM (THResult Name)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Name -&gt; TcM (THResult Name))
-&gt; TcM Name -&gt; TcM (THResult Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Name
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qNewName/Language.Haskell.TH.Syntax.html#qNewName"><span class="hs-identifier hs-var">TH.qNewName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114265"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1813"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#Report/GHCi.Message.html#Report"><span class="hs-identifier hs-type">Report</span></a></span><span> </span><span id="local-6989586621682114269"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114269"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682114270"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114270"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; Bool -&gt; String -&gt; m ()
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReport/Language.Haskell.TH.Syntax.html#qReport"><span class="hs-identifier hs-var">TH.qReport</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114269"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114270"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1814"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#LookupName/GHCi.Message.html#LookupName"><span class="hs-identifier hs-type">LookupName</span></a></span><span> </span><span id="local-6989586621682114274"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114274"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682114275"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114275"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe Name) -&gt; TcM (THResult (Maybe Name))
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe Name) -&gt; TcM (THResult (Maybe Name)))
-&gt; TcM (Maybe Name) -&gt; TcM (THResult (Maybe Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcM (Maybe Name)
forall (m :: * -&gt; *). Quasi m =&gt; Bool -&gt; String -&gt; m (Maybe Name)
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qLookupName/Language.Haskell.TH.Syntax.html#qLookupName"><span class="hs-identifier hs-var">TH.qLookupName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114274"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114275"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1815"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#Reify/GHCi.Message.html#Reify"><span class="hs-identifier hs-type">Reify</span></a></span><span> </span><span id="local-6989586621682114279"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114279"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Info -&gt; TcM (THResult Info)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Info -&gt; TcM (THResult Info))
-&gt; TcM Info -&gt; TcM (THResult Info)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Info
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReify/Language.Haskell.TH.Syntax.html#qReify"><span class="hs-identifier hs-var">TH.qReify</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114279"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1816"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#ReifyFixity/GHCi.Message.html#ReifyFixity"><span class="hs-identifier hs-type">ReifyFixity</span></a></span><span> </span><span id="local-6989586621682114283"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114283"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe Fixity) -&gt; TcM (THResult (Maybe Fixity))
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe Fixity) -&gt; TcM (THResult (Maybe Fixity)))
-&gt; TcM (Maybe Fixity) -&gt; TcM (THResult (Maybe Fixity))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe Fixity)
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m (Maybe Fixity)
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReifyFixity/Language.Haskell.TH.Syntax.html#qReifyFixity"><span class="hs-identifier hs-var">TH.qReifyFixity</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114283"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1817"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#ReifyType/GHCi.Message.html#ReifyType"><span class="hs-identifier hs-type">ReifyType</span></a></span><span> </span><span id="local-6989586621682114287"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114287"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Type -&gt; TcM (THResult Type)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM (THResult Type))
-&gt; TcM Type -&gt; TcM (THResult Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Type
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReifyType/Language.Haskell.TH.Syntax.html#qReifyType"><span class="hs-identifier hs-var">TH.qReifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114287"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1818"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#ReifyInstances/GHCi.Message.html#ReifyInstances"><span class="hs-identifier hs-type">ReifyInstances</span></a></span><span> </span><span id="local-6989586621682114291"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114291"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682114292"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114292"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [Dec] -&gt; TcM (THResult [Dec])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Dec] -&gt; TcM (THResult [Dec]))
-&gt; TcM [Dec] -&gt; TcM (THResult [Dec])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; TcM [Dec]
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; [Type] -&gt; m [Dec]
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReifyInstances/Language.Haskell.TH.Syntax.html#qReifyInstances"><span class="hs-identifier hs-var">TH.qReifyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114291"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114292"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1819"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#ReifyRoles/GHCi.Message.html#ReifyRoles"><span class="hs-identifier hs-type">ReifyRoles</span></a></span><span> </span><span id="local-6989586621682114296"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114296"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [Role] -&gt; TcM (THResult [Role])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Role] -&gt; TcM (THResult [Role]))
-&gt; TcM [Role] -&gt; TcM (THResult [Role])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM [Role]
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m [Role]
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReifyRoles/Language.Haskell.TH.Syntax.html#qReifyRoles"><span class="hs-identifier hs-var">TH.qReifyRoles</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114296"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1820"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#ReifyAnnotations/GHCi.Message.html#ReifyAnnotations"><span class="hs-identifier hs-type">ReifyAnnotations</span></a></span><span> </span><span id="local-6989586621682114300"><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621682114300"><span class="hs-identifier hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621682114301"><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621682114301"><span class="hs-identifier hs-var">tyrep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1821"></span><span>    </span><span class="annot"><span class="annottext">TcM [ByteString] -&gt; TcM (THResult [ByteString])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [ByteString] -&gt; TcM (THResult [ByteString]))
-&gt; TcM [ByteString] -&gt; TcM (THResult [ByteString])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Word8] -&gt; ByteString) -&gt; [[Word8]] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><a href="../../bytestring-0.11.5.4/src/Data.ByteString.html#pack/Data.ByteString.html#pack"><span class="hs-identifier hs-var">B.pack</span></a></span><span> </span><span class="annot"><span class="annottext">([[Word8]] -&gt; [ByteString])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]] -&gt; TcM [ByteString]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TypeRep -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]]
</span><a href="GHC.Tc.Gen.Splice.html#getAnnotationsByTypeRep"><span class="hs-identifier hs-var">getAnnotationsByTypeRep</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621682114300"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621682114301"><span class="hs-identifier hs-var">tyrep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1822"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#ReifyModule/GHCi.Message.html#ReifyModule"><span class="hs-identifier hs-type">ReifyModule</span></a></span><span> </span><span id="local-6989586621682114307"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682114307"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM ModuleInfo -&gt; TcM (THResult ModuleInfo)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ModuleInfo -&gt; TcM (THResult ModuleInfo))
-&gt; TcM ModuleInfo -&gt; TcM (THResult ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; TcM ModuleInfo
forall (m :: * -&gt; *). Quasi m =&gt; Module -&gt; m ModuleInfo
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReifyModule/Language.Haskell.TH.Syntax.html#qReifyModule"><span class="hs-identifier hs-var">TH.qReifyModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682114307"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1823"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#ReifyConStrictness/GHCi.Message.html#ReifyConStrictness"><span class="hs-identifier hs-type">ReifyConStrictness</span></a></span><span> </span><span id="local-6989586621682114311"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114311"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [DecidedStrictness] -&gt; TcM (THResult [DecidedStrictness])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [DecidedStrictness] -&gt; TcM (THResult [DecidedStrictness]))
-&gt; TcM [DecidedStrictness] -&gt; TcM (THResult [DecidedStrictness])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM [DecidedStrictness]
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m [DecidedStrictness]
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qReifyConStrictness/Language.Haskell.TH.Syntax.html#qReifyConStrictness"><span class="hs-identifier hs-var">TH.qReifyConStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114311"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1824"></span><span>  </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#GetPackageRoot/GHCi.Message.html#GetPackageRoot"><span class="hs-identifier hs-var">GetPackageRoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) String
forall (m :: * -&gt; *). Quasi m =&gt; m String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qGetPackageRoot/Language.Haskell.TH.Syntax.html#qGetPackageRoot"><span class="hs-identifier hs-var">TH.qGetPackageRoot</span></a></span><span>
</span><span id="line-1825"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#AddDependentFile/GHCi.Message.html#AddDependentFile"><span class="hs-identifier hs-type">AddDependentFile</span></a></span><span> </span><span id="local-6989586621682114318"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114318"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m ()
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qAddDependentFile/Language.Haskell.TH.Syntax.html#qAddDependentFile"><span class="hs-identifier hs-var">TH.qAddDependentFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114318"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1826"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#AddTempFile/GHCi.Message.html#AddTempFile"><span class="hs-identifier hs-type">AddTempFile</span></a></span><span> </span><span id="local-6989586621682114322"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114322"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qAddTempFile/Language.Haskell.TH.Syntax.html#qAddTempFile"><span class="hs-identifier hs-var">TH.qAddTempFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114322"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1827"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#AddModFinalizer/GHCi.Message.html#AddModFinalizer"><span class="hs-identifier hs-type">AddModFinalizer</span></a></span><span> </span><span id="local-6989586621682114329"><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621682114329"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1828"></span><span>    </span><span id="local-6989586621682114330"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682114330"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; Interp) -&gt; TcRnIf TcGblEnv TcLclEnv HscEnv -&gt; TcM Interp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1829"></span><span>    </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (ForeignRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interp -&gt; RemoteRef (Q ()) -&gt; IO (ForeignRef (Q ()))
forall a. Interp -&gt; RemoteRef a -&gt; IO (ForeignRef a)
</span><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-var">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682114330"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621682114329"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
-&gt; (ForeignRef (Q ()) -&gt; TcRn ()) -&gt; TcRn ()
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (Q ()) -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-var">addModFinalizerRef</span></a></span><span>
</span><span id="line-1830"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#AddCorePlugin/GHCi.Message.html#AddCorePlugin"><span class="hs-identifier hs-type">AddCorePlugin</span></a></span><span> </span><span id="local-6989586621682114335"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114335"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m ()
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qAddCorePlugin/Language.Haskell.TH.Syntax.html#qAddCorePlugin"><span class="hs-identifier hs-var">TH.qAddCorePlugin</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114335"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1831"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#AddTopDecls/GHCi.Message.html#AddTopDecls"><span class="hs-identifier hs-type">AddTopDecls</span></a></span><span> </span><span id="local-6989586621682114339"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114339"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; [Dec] -&gt; m ()
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qAddTopDecls/Language.Haskell.TH.Syntax.html#qAddTopDecls"><span class="hs-identifier hs-var">TH.qAddTopDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114339"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-1832"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#AddForeignFilePath/GHCi.Message.html#AddForeignFilePath"><span class="hs-identifier hs-type">AddForeignFilePath</span></a></span><span> </span><span id="local-6989586621682114343"><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621682114343"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span id="local-6989586621682114344"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114344"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang -&gt; String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; ForeignSrcLang -&gt; String -&gt; m ()
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qAddForeignFilePath/Language.Haskell.TH.Syntax.html#qAddForeignFilePath"><span class="hs-identifier hs-var">TH.qAddForeignFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621682114343"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114344"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1833"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#IsExtEnabled/GHCi.Message.html#IsExtEnabled"><span class="hs-identifier hs-type">IsExtEnabled</span></a></span><span> </span><span id="local-6989586621682114348"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682114348"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Bool -&gt; TcM (THResult Bool)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Bool -&gt; TcM (THResult Bool))
-&gt; TcM Bool -&gt; TcM (THResult Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcM Bool
forall (m :: * -&gt; *). Quasi m =&gt; Extension -&gt; m Bool
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qIsExtEnabled/Language.Haskell.TH.Syntax.html#qIsExtEnabled"><span class="hs-identifier hs-var">TH.qIsExtEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682114348"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-1834"></span><span>  </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#ExtsEnabled/GHCi.Message.html#ExtsEnabled"><span class="hs-identifier hs-var">ExtsEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [Extension] -&gt; TcM (THResult [Extension])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Extension] -&gt; TcM (THResult [Extension]))
-&gt; TcM [Extension] -&gt; TcM (THResult [Extension])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcM [Extension]
forall (m :: * -&gt; *). Quasi m =&gt; m [Extension]
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qExtsEnabled/Language.Haskell.TH.Syntax.html#qExtsEnabled"><span class="hs-identifier hs-var">TH.qExtsEnabled</span></a></span><span>
</span><span id="line-1835"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#PutDoc/GHCi.Message.html#PutDoc"><span class="hs-identifier hs-type">PutDoc</span></a></span><span> </span><span id="local-6989586621682114355"><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682114355"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682114356"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114356"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc -&gt; String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; DocLoc -&gt; String -&gt; m ()
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qPutDoc/Language.Haskell.TH.Syntax.html#qPutDoc"><span class="hs-identifier hs-var">TH.qPutDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682114355"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114356"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1836"></span><span>  </span><span class="annot"><a href="../../ghci-9.6.7/src/GHCi.Message.html#GetDoc/GHCi.Message.html#GetDoc"><span class="hs-identifier hs-type">GetDoc</span></a></span><span> </span><span id="local-6989586621682114360"><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682114360"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe String) -&gt; TcM (THResult (Maybe String))
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe String) -&gt; TcM (THResult (Maybe String)))
-&gt; TcM (Maybe String) -&gt; TcM (THResult (Maybe String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc -&gt; TcM (Maybe String)
forall (m :: * -&gt; *). Quasi m =&gt; DocLoc -&gt; m (Maybe String)
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#qGetDoc/Language.Haskell.TH.Syntax.html#qGetDoc"><span class="hs-identifier hs-var">TH.qGetDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DocLoc
</span><a href="#local-6989586621682114360"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1837"></span><span>  </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci-9.6.7/src/GHCi.Message.html#FailIfErrs/GHCi.Message.html#FailIfErrs"><span class="hs-identifier hs-var">FailIfErrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a></span><span>
</span><span id="line-1838"></span><span>  </span><span class="annot"><span class="annottext">THMessage a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;handleTHMessage: unexpected message &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">THMessage a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.3.0/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621682114261"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1839"></span><span>
</span><span id="line-1840"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getAnnotationsByTypeRep"><span class="hs-identifier hs-type">getAnnotationsByTypeRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AnnLookup/Language.Haskell.TH.Syntax.html#AnnLookup"><span class="hs-identifier hs-type">TH.AnnLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Typeable.html#TypeRep/Data.Typeable.html#TypeRep"><span class="hs-identifier hs-type">TypeRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1841"></span><span id="getAnnotationsByTypeRep"><span class="annot"><span class="annottext">getAnnotationsByTypeRep :: AnnLookup -&gt; TypeRep -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]]
</span><a href="GHC.Tc.Gen.Splice.html#getAnnotationsByTypeRep"><span class="hs-identifier hs-var hs-var">getAnnotationsByTypeRep</span></a></span></span><span> </span><span id="local-6989586621682114363"><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621682114363"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span id="local-6989586621682114364"><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621682114364"><span class="hs-identifier hs-var">tyrep</span></a></span></span><span>
</span><span id="line-1842"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114365"><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682114365"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TcM CoreAnnTarget
</span><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var">lookupThAnnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621682114363"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1843"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114367"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682114367"><span class="hs-identifier hs-var">topEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1844"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114368"><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621682114368"><span class="hs-identifier hs-var">epsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv)
-&gt; IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe ModGuts -&gt; IO AnnEnv
</span><a href="GHC.Driver.Env.html#prepareAnnotations"><span class="hs-identifier hs-var">prepareAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682114367"><span class="hs-identifier hs-var">topEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1845"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114370"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114370"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1846"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114371"><span class="annot"><span class="annottext">selectedEpsHptAnns :: [[Word8]]
</span><a href="#local-6989586621682114371"><span class="hs-identifier hs-var hs-var">selectedEpsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnEnv -&gt; CoreAnnTarget -&gt; TypeRep -&gt; [[Word8]]
</span><a href="GHC.Types.Annotations.html#findAnnsByTypeRep"><span class="hs-identifier hs-var">findAnnsByTypeRep</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621682114368"><span class="hs-identifier hs-var">epsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682114365"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621682114364"><span class="hs-identifier hs-var">tyrep</span></a></span><span>
</span><span id="line-1847"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114373"><span class="annot"><span class="annottext">selectedTcgAnns :: [[Word8]]
</span><a href="#local-6989586621682114373"><span class="hs-identifier hs-var hs-var">selectedTcgAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnEnv -&gt; CoreAnnTarget -&gt; TypeRep -&gt; [[Word8]]
</span><a href="GHC.Types.Annotations.html#findAnnsByTypeRep"><span class="hs-identifier hs-var">findAnnsByTypeRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; AnnEnv
</span><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var">tcg_ann_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114370"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682114365"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621682114364"><span class="hs-identifier hs-var">tyrep</span></a></span><span>
</span><span id="line-1848"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[[Word8]] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Word8]]
</span><a href="#local-6989586621682114371"><span class="hs-identifier hs-var">selectedEpsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[[Word8]] -&gt; [[Word8]] -&gt; [[Word8]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[[Word8]]
</span><a href="#local-6989586621682114373"><span class="hs-identifier hs-var">selectedTcgAnns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1849"></span><span>
</span><span id="line-1850"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
            Instance Testing
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1857"></span><span>
</span><span id="line-1858"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyInstances"><span class="hs-identifier hs-type">reifyInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1859"></span><span id="reifyInstances"><span class="annot"><span class="annottext">reifyInstances :: Name -&gt; [Type] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyInstances"><span class="hs-identifier hs-var hs-var">reifyInstances</span></a></span></span><span> </span><span id="local-6989586621682114375"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114375"><span class="hs-identifier hs-var">th_nm</span></a></span></span><span> </span><span id="local-6989586621682114376"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114376"><span class="hs-identifier hs-var">th_tys</span></a></span></span><span>
</span><span id="line-1860"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114377"><span class="annot"><span class="annottext">Either (Class, [ClsInst]) (TyCon, [FamInst])
</span><a href="#local-6989586621682114377"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [Type] -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
</span><a href="GHC.Tc.Gen.Splice.html#reifyInstances%27"><span class="hs-identifier hs-var">reifyInstances'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114375"><span class="hs-identifier hs-var">th_nm</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114376"><span class="hs-identifier hs-var">th_tys</span></a></span><span>
</span><span id="line-1861"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (Class, [ClsInst]) (TyCon, [FamInst])
</span><a href="#local-6989586621682114377"><span class="hs-identifier hs-var">insts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1862"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114378"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114378"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114379"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682114379"><span class="hs-identifier hs-var">cls_insts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1863"></span><span>             </span><span class="annot"><span class="annottext">Class -&gt; [ClsInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-var">reifyClassInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114378"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682114379"><span class="hs-identifier hs-var">cls_insts</span></a></span><span>
</span><span id="line-1864"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114381"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114381"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114382"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621682114382"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1865"></span><span>             </span><span class="annot"><span class="annottext">TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var">reifyFamilyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114381"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621682114382"><span class="hs-identifier hs-var">fam_insts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1866"></span><span>
</span><span id="line-1867"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyInstances%27"><span class="hs-identifier hs-type">reifyInstances'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-1868"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1869"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1870"></span><span>                </span><span class="hs-comment">-- ^ Returns 'Left' in the case that the instances were found to</span><span>
</span><span id="line-1871"></span><span>                </span><span class="hs-comment">-- be class instances, or 'Right' if they are family instances.</span><span>
</span><span id="line-1872"></span><span id="reifyInstances%27"><span class="annot"><span class="annottext">reifyInstances' :: Name
-&gt; [Type] -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
</span><a href="GHC.Tc.Gen.Splice.html#reifyInstances%27"><span class="hs-identifier hs-var hs-var">reifyInstances'</span></a></span></span><span> </span><span id="local-6989586621682114384"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114384"><span class="hs-identifier hs-var">th_nm</span></a></span></span><span> </span><span id="local-6989586621682114385"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114385"><span class="hs-identifier hs-var">th_tys</span></a></span></span><span>
</span><span id="line-1873"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the argument of reifyInstances:&quot;</span></span><span>
</span><span id="line-1874"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Ppr a =&gt; a -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-var">ppr_th</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114384"><span class="hs-identifier hs-var">th_nm</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; SDoc) -&gt; [Type] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Ppr a =&gt; a -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-var">ppr_th</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114385"><span class="hs-identifier hs-var">th_tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
 -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst])))
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1875"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114388"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682114388"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1876"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114389"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682114389"><span class="hs-identifier hs-var">th_origin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var">getThSpliceOrigin</span></a></span><span>
</span><span id="line-1877"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114390"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcPs)
</span><a href="#local-6989586621682114390"><span class="hs-identifier hs-var">rdr_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; Type -&gt; TcM (LHsType GhcPs)
</span><a href="#local-6989586621682114391"><span class="hs-identifier hs-var">cvt</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682114389"><span class="hs-identifier hs-var">th_origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682114388"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114384"><span class="hs-identifier hs-var">th_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114385"><span class="hs-identifier hs-var">th_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1878"></span><span>          </span><span class="hs-comment">-- #9262 says to bring vars into scope, like in HsForAllTy case</span><span>
</span><span id="line-1879"></span><span>          </span><span class="hs-comment">-- of rnHsTyKi</span><span>
</span><span id="line-1880"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114393"><span class="annot"><span class="annottext">tv_rdrs :: FreeKiTyVars
</span><a href="#local-6989586621682114393"><span class="hs-identifier hs-var hs-var">tv_rdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; FreeKiTyVars
</span><a href="GHC.Rename.HsType.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
GenLocated SrcSpanAnnA (HsType GhcPs)
</span><a href="#local-6989586621682114390"><span class="hs-identifier hs-var">rdr_ty</span></a></span><span>
</span><span id="line-1881"></span><span>          </span><span class="hs-comment">-- Rename  to HsType Name</span><span>
</span><span id="line-1882"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682114395"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114395"><span class="hs-identifier hs-var">tv_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114396"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621682114396"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114397"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621682114397"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1883"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
-&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
 -&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars))
-&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
-&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- If there are out-of-scope Names here, then we</span><span>
</span><span id="line-1884"></span><span>                             </span><span class="hs-comment">-- must error before proceeding to typecheck the</span><span>
</span><span id="line-1885"></span><span>                             </span><span class="hs-comment">-- renamed type, as that will result in GHC</span><span>
</span><span id="line-1886"></span><span>                             </span><span class="hs-comment">-- internal errors (#13837).</span><span>
</span><span id="line-1887"></span><span>               </span><span class="annot"><span class="annottext">Maybe Any
-&gt; FreeKiTyVars
-&gt; ([Name]
    -&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars))
-&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
forall assoc a.
Maybe assoc
-&gt; FreeKiTyVars
-&gt; ([Name] -&gt; RnM (a, FreeVars))
-&gt; RnM (a, FreeVars)
</span><a href="GHC.Rename.HsType.html#rnImplicitTvOccs"><span class="hs-identifier hs-var">rnImplicitTvOccs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Any
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">FreeKiTyVars
</span><a href="#local-6989586621682114393"><span class="hs-identifier hs-var">tv_rdrs</span></a></span><span> </span><span class="annot"><span class="annottext">(([Name]
  -&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars))
 -&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars))
-&gt; ([Name]
    -&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars))
-&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682114399"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114399"><span class="hs-identifier hs-var">tv_names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1888"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114400"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621682114400"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114401"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621682114401"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDocContext -&gt; LHsType GhcPs -&gt; RnM (LHsType GhcRn, FreeVars)
</span><a href="GHC.Rename.HsType.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="#local-6989586621682114403"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
GenLocated SrcSpanAnnA (HsType GhcPs)
</span><a href="#local-6989586621682114390"><span class="hs-identifier hs-var">rdr_ty</span></a></span><span>
</span><span id="line-1889"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
-&gt; TcM (([Name], GenLocated SrcSpanAnnA (HsType GhcRn)), FreeVars)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114399"><span class="hs-identifier hs-var">tv_names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621682114400"><span class="hs-identifier hs-var">rn_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621682114401"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1890"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114404"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682114404"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#ReifySkol"><span class="hs-identifier hs-var">ReifySkol</span></a></span><span>
</span><span id="line-1891"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114407"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682114407"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114408"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682114408"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114409"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114409"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114410"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114410"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; TcM ([Id], Type)
-&gt; TcM (TcLevel, WantedConstraints, ([Id], Type))
forall a. String -&gt; TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Solver.html#pushLevelAndSolveEqualitiesX"><span class="hs-identifier hs-var">pushLevelAndSolveEqualitiesX</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances&quot;</span></span><span>  </span><span class="annot"><span class="annottext">(TcM ([Id], Type)
 -&gt; TcM (TcLevel, WantedConstraints, ([Id], Type)))
-&gt; TcM ([Id], Type)
-&gt; TcM (TcLevel, WantedConstraints, ([Id], Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1893"></span><span>               </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; [Name] -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type -&gt; TcM ([Id], Type)
forall a. SkolemInfo -&gt; [Name] -&gt; TcM a -&gt; TcM ([Id], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Skol"><span class="hs-identifier hs-var">bindImplicitTKBndrs_Skol</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682114404"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114395"><span class="hs-identifier hs-var">tv_names</span></a></span><span>              </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) Type -&gt; TcM ([Id], Type))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type -&gt; TcM ([Id], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1894"></span><span>               </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsType"><span class="hs-identifier hs-var">tcInferLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621682114396"><span class="hs-identifier hs-var">rn_ty</span></a></span><span>
</span><span id="line-1895"></span><span>
</span><span id="line-1896"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114414"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114414"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [Id]
</span><a href="GHC.Tc.Gen.HsType.html#zonkAndScopedSort"><span class="hs-identifier hs-var">zonkAndScopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114409"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1897"></span><span>
</span><span id="line-1898"></span><span>        </span><span class="hs-comment">-- Avoid error cascade if there are unsolved</span><span>
</span><span id="line-1899"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; [Id] -&gt; TcLevel -&gt; WantedConstraints -&gt; TcRn ()
</span><a href="GHC.Tc.Solver.html#reportUnsolvedEqualities"><span class="hs-identifier hs-var">reportUnsolvedEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682114404"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114414"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682114407"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682114408"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114417"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114417"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToType"><span class="hs-identifier hs-var">zonkTcTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114410"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1902"></span><span>                </span><span class="hs-comment">-- Substitute out the meta type variables</span><span>
</span><span id="line-1903"></span><span>                </span><span class="hs-comment">-- In particular, the type might have kind</span><span>
</span><span id="line-1904"></span><span>                </span><span class="hs-comment">-- variables inside it (#7477)</span><span>
</span><span id="line-1905"></span><span>
</span><span id="line-1906"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances'&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114417"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114417"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1907"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114417"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- This expands any type synonyms</span><span>
</span><span id="line-1908"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114421"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114421"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114422"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114422"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- See #7910</span><span>
</span><span id="line-1909"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114423"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114423"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114421"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1910"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114425"><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621682114425"><span class="hs-identifier hs-var">inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a></span><span>
</span><span id="line-1911"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114427"><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621682114427"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114428"><span class="annot"><span class="annottext">PotentialUnifiers
</span><a href="#local-6989586621682114428"><span class="hs-identifier hs-var">unifies</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; InstEnvs
-&gt; Class
-&gt; [Type]
-&gt; ([InstMatch], PotentialUnifiers, [InstMatch])
</span><a href="GHC.Core.InstEnv.html#lookupInstEnv"><span class="hs-identifier hs-var">lookupInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621682114425"><span class="hs-identifier hs-var">inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114423"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114422"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1912"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances'1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InstMatch] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621682114427"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1913"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Either (Class, [ClsInst]) (TyCon, [FamInst])
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Class, [ClsInst]) (TyCon, [FamInst])
 -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst])))
-&gt; Either (Class, [ClsInst]) (TyCon, [FamInst])
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Class, [ClsInst]) -&gt; Either (Class, [ClsInst]) (TyCon, [FamInst])
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114423"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(InstMatch -&gt; ClsInst) -&gt; [InstMatch] -&gt; [ClsInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">InstMatch -&gt; ClsInst
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621682114427"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; [ClsInst] -&gt; [ClsInst]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">PotentialUnifiers -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#getPotentialUnifiers"><span class="hs-identifier hs-var">getPotentialUnifiers</span></a></span><span> </span><span class="annot"><span class="annottext">PotentialUnifiers
</span><a href="#local-6989586621682114428"><span class="hs-identifier hs-var">unifies</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1914"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isOpenFamilyTyCon"><span class="hs-identifier hs-var">isOpenFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114421"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1915"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114433"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682114433"><span class="hs-identifier hs-var">inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1916"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114435"><span class="annot"><span class="annottext">matches :: [FamInstMatch]
</span><a href="#local-6989586621682114435"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; [Type] -&gt; [FamInstMatch]
</span><a href="GHC.Core.FamInstEnv.html#lookupFamInstEnv"><span class="hs-identifier hs-var">lookupFamInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682114433"><span class="hs-identifier hs-var">inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114421"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114422"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1917"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances'2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FamInstMatch] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInstMatch]
</span><a href="#local-6989586621682114435"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1918"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Either (Class, [ClsInst]) (TyCon, [FamInst])
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Class, [ClsInst]) (TyCon, [FamInst])
 -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst])))
-&gt; Either (Class, [ClsInst]) (TyCon, [FamInst])
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, [FamInst]) -&gt; Either (Class, [ClsInst]) (TyCon, [FamInst])
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114421"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(FamInstMatch -&gt; FamInst) -&gt; [FamInstMatch] -&gt; [FamInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstMatch -&gt; FamInst
</span><a href="GHC.Core.FamInstEnv.html#fim_instance"><span class="hs-identifier hs-var">fim_instance</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInstMatch]
</span><a href="#local-6989586621682114435"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1919"></span><span>            </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a. TcRnMessage -&gt; TcM a
</span><a href="#local-6989586621682114438"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst])))
-&gt; TcRnMessage
-&gt; TcM (Either (Class, [ClsInst]) (TyCon, [FamInst]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnCannotReifyInstance"><span class="hs-identifier hs-var">TcRnCannotReifyInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114417"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1920"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1921"></span><span>    </span><span id="local-6989586621682114403"><span class="annot"><span class="annottext">doc :: HsDocContext
</span><a href="#local-6989586621682114403"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="GHC.Tc.Errors.Types.html#ClassInstanceCtx"><span class="hs-identifier hs-var">ClassInstanceCtx</span></a></span><span>
</span><span id="line-1922"></span><span>    </span><span id="local-6989586621682114438"><span class="annot"><span class="annottext">bale_out :: TcRnMessage -&gt; TcM a
</span><a href="#local-6989586621682114438"><span class="hs-identifier hs-var hs-var">bale_out</span></a></span></span><span> </span><span id="local-6989586621682114441"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682114441"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM a
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682114441"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1923"></span><span>
</span><span id="line-1924"></span><span>    </span><span class="annot"><a href="#local-6989586621682114391"><span class="hs-identifier hs-type">cvt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1925"></span><span>    </span><span id="local-6989586621682114391"><span class="annot"><span class="annottext">cvt :: Origin -&gt; SrcSpan -&gt; Type -&gt; TcM (LHsType GhcPs)
</span><a href="#local-6989586621682114391"><span class="hs-identifier hs-var hs-var">cvt</span></a></span></span><span> </span><span id="local-6989586621682114442"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682114442"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621682114443"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682114443"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682114444"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114444"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; SrcSpan -&gt; Type -&gt; Either RunSpliceFailReason (LHsType GhcPs)
</span><a href="GHC.ThToHs.html#convertToHsType"><span class="hs-identifier hs-var">convertToHsType</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682114442"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682114443"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114444"><span class="hs-identifier hs-var">th_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1926"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682114445"><span class="annot"><span class="annottext">RunSpliceFailReason
</span><a href="#local-6989586621682114445"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs))
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; RunSpliceFailReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnRunSpliceFailure"><span class="hs-identifier hs-var">TcRnRunSpliceFailure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">RunSpliceFailReason
</span><a href="#local-6989586621682114445"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1927"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682114446"><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621682114446"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcPs)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsType GhcPs))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
GenLocated SrcSpanAnnA (HsType GhcPs)
</span><a href="#local-6989586621682114446"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Reification
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1936"></span><span>
</span><span id="line-1937"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupName"><span class="hs-identifier hs-type">lookupName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True  &lt;=&gt; type namespace</span><span>
</span><span id="line-1938"></span><span>                        </span><span class="hs-comment">-- False &lt;=&gt; value namespace</span><span>
</span><span id="line-1939"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1940"></span><span id="lookupName"><span class="annot"><span class="annottext">lookupName :: Bool -&gt; String -&gt; TcM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupName"><span class="hs-identifier hs-var hs-var">lookupName</span></a></span></span><span> </span><span id="local-6989586621682114447"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114447"><span class="hs-identifier hs-var">is_type_name</span></a></span></span><span> </span><span id="local-6989586621682114448"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114448"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-1941"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114449"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682114449"><span class="hs-identifier hs-var">mb_nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-var">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682114451"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1942"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; TcM (Maybe Name)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Maybe Name -&gt; Maybe Name
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682114449"><span class="hs-identifier hs-var">mb_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1943"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1944"></span><span>    </span><span id="local-6989586621682114453"><span class="annot"><span class="annottext">th_name :: Name
</span><a href="#local-6989586621682114453"><span class="hs-identifier hs-var hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkName/Language.Haskell.TH.Syntax.html#mkName"><span class="hs-identifier hs-var">TH.mkName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114448"><span class="hs-identifier hs-var">s</span></a></span><span>       </span><span class="hs-comment">-- Parses M.x into a base of 'x' and a module of 'M'</span><span>
</span><span id="line-1945"></span><span>
</span><span id="line-1946"></span><span>    </span><span class="annot"><a href="#local-6989586621682114454"><span class="hs-identifier hs-type">occ_fs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-1947"></span><span>    </span><span id="local-6989586621682114454"><span class="annot"><span class="annottext">occ_fs :: FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var hs-var">occ_fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#nameBase/Language.Haskell.TH.Syntax.html#nameBase"><span class="hs-identifier hs-var">TH.nameBase</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114453"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1948"></span><span>
</span><span id="line-1949"></span><span>    </span><span class="annot"><a href="#local-6989586621682114457"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-1950"></span><span>    </span><span id="local-6989586621682114457"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621682114457"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114447"><span class="hs-identifier hs-var">is_type_name</span></a></span><span>
</span><span id="line-1951"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Bool
</span><a href="GHC.Utils.Lexeme.html#isLexVarSym"><span class="hs-identifier hs-var">isLexVarSym</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var">occ_fs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Bool
</span><a href="GHC.Utils.Lexeme.html#isLexCon"><span class="hs-identifier hs-var">isLexCon</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1952"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTcOccFS"><span class="hs-identifier hs-var">mkTcOccFS</span></a></span><span>    </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1953"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1954"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1955"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Bool
</span><a href="GHC.Utils.Lexeme.html#isLexCon"><span class="hs-identifier hs-var">isLexCon</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var">occ_fs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkDataOccFS"><span class="hs-identifier hs-var">mkDataOccFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1956"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span>  </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682114454"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1957"></span><span>
</span><span id="line-1958"></span><span>    </span><span id="local-6989586621682114451"><span class="annot"><span class="annottext">rdr_name :: RdrName
</span><a href="#local-6989586621682114451"><span class="hs-identifier hs-var hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#nameModule/Language.Haskell.TH.Syntax.html#nameModule"><span class="hs-identifier hs-var">TH.nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114453"><span class="hs-identifier hs-var">th_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1959"></span><span>                 </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrUnqual"><span class="hs-identifier hs-var">mkRdrUnqual</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682114457"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1960"></span><span>                 </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114467"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114467"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrQual"><span class="hs-identifier hs-var">mkRdrQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682114467"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682114457"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1961"></span><span>
</span><span id="line-1962"></span><span class="hs-comment">-- | We only want to produce warnings for TH-splices if the user requests so.</span><span>
</span><span id="line-1963"></span><span class="hs-comment">-- See Note [Warnings for TH splices].</span><span>
</span><span id="line-1964"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-type">getThSpliceOrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span>
</span><span id="line-1965"></span><span id="getThSpliceOrigin"><span class="annot"><span class="annottext">getThSpliceOrigin :: TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var hs-var">getThSpliceOrigin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1966"></span><span>  </span><span id="local-6989586621682114469"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114469"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcM Bool
forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_EnableThSpliceWarnings"><span class="hs-identifier hs-var">Opt_EnableThSpliceWarnings</span></a></span><span>
</span><span id="line-1967"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114469"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; TcM Origin
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#FromSource"><span class="hs-identifier hs-var">FromSource</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; TcM Origin
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#Generated"><span class="hs-identifier hs-var">Generated</span></a></span><span>
</span><span id="line-1968"></span><span>
</span><span id="line-1969"></span><span>
</span><span id="line-1970"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-type">getThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a></span><span>
</span><span id="line-1971"></span><span id="getThing"><span class="annot"><span class="annottext">getThing :: Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var hs-var">getThing</span></a></span></span><span> </span><span id="local-6989586621682114475"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114475"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-1972"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114476"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114476"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114475"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1973"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.3.0/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114475"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall {doc}. IsLine doc =&gt; Name -&gt; doc
</span><a href="#local-6989586621682114479"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114475"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114476"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1974"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#tcLookupTh"><span class="hs-identifier hs-var">tcLookupTh</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114476"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1975"></span><span>        </span><span class="hs-comment">-- ToDo: this tcLookup could fail, which would give a</span><span>
</span><span id="line-1976"></span><span>        </span><span class="hs-comment">--       rather unhelpful error message</span><span>
</span><span id="line-1977"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1978"></span><span>    </span><span id="local-6989586621682114479"><span class="annot"><span class="annottext">ppr_ns :: Name -&gt; doc
</span><a href="#local-6989586621682114479"><span class="hs-identifier hs-var hs-var">ppr_ns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NameG/Language.Haskell.TH.Syntax.html#NameG"><span class="hs-identifier hs-type">TH.NameG</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DataName/Language.Haskell.TH.Syntax.html#DataName"><span class="hs-identifier hs-var">TH.DataName</span></a></span><span>  </span><span id="local-6989586621682114493"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621682114493"><span class="hs-identifier hs-var">_pkg</span></a></span></span><span> </span><span id="local-6989586621682114494"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621682114494"><span class="hs-identifier hs-var">_mod</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;data&quot;</span></span><span>
</span><span id="line-1979"></span><span>    </span><span class="annot"><a href="#local-6989586621682114479"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NameG/Language.Haskell.TH.Syntax.html#NameG"><span class="hs-identifier hs-type">TH.NameG</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TcClsName/Language.Haskell.TH.Syntax.html#TcClsName"><span class="hs-identifier hs-var">TH.TcClsName</span></a></span><span> </span><span id="local-6989586621682114496"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621682114496"><span class="hs-identifier hs-var">_pkg</span></a></span></span><span> </span><span id="local-6989586621682114497"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621682114497"><span class="hs-identifier hs-var">_mod</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc&quot;</span></span><span>
</span><span id="line-1980"></span><span>    </span><span class="annot"><a href="#local-6989586621682114479"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NameG/Language.Haskell.TH.Syntax.html#NameG"><span class="hs-identifier hs-type">TH.NameG</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#VarName/Language.Haskell.TH.Syntax.html#VarName"><span class="hs-identifier hs-var">TH.VarName</span></a></span><span>   </span><span id="local-6989586621682114499"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621682114499"><span class="hs-identifier hs-var">_pkg</span></a></span></span><span> </span><span id="local-6989586621682114500"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621682114500"><span class="hs-identifier hs-var">_mod</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;var&quot;</span></span><span>
</span><span id="line-1981"></span><span>    </span><span class="annot"><a href="#local-6989586621682114479"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify/ppr_ns&quot;</span></span><span>
</span><span id="line-1982"></span><span>
</span><span id="line-1983"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reify"><span class="hs-identifier hs-type">reify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Info/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-1984"></span><span id="reify"><span class="annot"><span class="annottext">reify :: Name -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reify"><span class="hs-identifier hs-var hs-var">reify</span></a></span></span><span> </span><span id="local-6989586621682114501"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114501"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-1985"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#showName/Language.Haskell.TH.Syntax.html#showName"><span class="hs-identifier hs-var">TH.showName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114501"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1986"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114503"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114503"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var">getThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114501"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1987"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114503"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1988"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114503"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1989"></span><span>
</span><span id="line-1990"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-type">lookupThName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1991"></span><span id="lookupThName"><span class="annot"><span class="annottext">lookupThName :: Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var hs-var">lookupThName</span></a></span></span><span> </span><span id="local-6989586621682114505"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114505"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1992"></span><span>    </span><span id="local-6989586621682114506"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682114506"><span class="hs-identifier hs-var">mb_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier hs-var">lookupThName_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114505"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1993"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682114506"><span class="hs-identifier hs-var">mb_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1994"></span><span>        </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM Name
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Splice.html#notInScope"><span class="hs-identifier hs-var">notInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114505"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1995"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114508"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114508"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114508"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1996"></span><span>
</span><span id="line-1997"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier hs-type">lookupThName_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1998"></span><span id="lookupThName_maybe"><span class="annot"><span class="annottext">lookupThName_maybe :: Name -&gt; RnM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier hs-var hs-var">lookupThName_maybe</span></a></span></span><span> </span><span id="local-6989586621682114509"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114509"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-1999"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114510"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114510"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM (Maybe Name))
-&gt; [RdrName] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Name]
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-var">lookupOccRn_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [RdrName]
</span><a href="GHC.ThToHs.html#thRdrNameGuesses"><span class="hs-identifier hs-var">thRdrNameGuesses</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114509"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2000"></span><span>          </span><span class="hs-comment">-- Pick the first that works</span><span>
</span><span id="line-2001"></span><span>          </span><span class="hs-comment">-- E.g. reify (mkName &quot;A&quot;) will pick the class A in preference to the data constructor A</span><span>
</span><span id="line-2002"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; RnM (Maybe Name)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Maybe Name
forall a. [a] -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#listToMaybe/Data.Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114510"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2003"></span><span>
</span><span id="line-2004"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcLookupTh"><span class="hs-identifier hs-type">tcLookupTh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a></span><span>
</span><span id="line-2005"></span><span class="hs-comment">-- This is a specialised version of GHC.Tc.Utils.Env.tcLookup; specialised mainly in that</span><span>
</span><span id="line-2006"></span><span class="hs-comment">-- it gives a reify-related error message on failure, whereas in the normal</span><span>
</span><span id="line-2007"></span><span class="hs-comment">-- tcLookup, failure is a bug.</span><span>
</span><span id="line-2008"></span><span id="tcLookupTh"><span class="annot"><span class="annottext">tcLookupTh :: Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#tcLookupTh"><span class="hs-identifier hs-var hs-var">tcLookupTh</span></a></span></span><span> </span><span id="local-6989586621682114514"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114514"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2009"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114515"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114515"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114516"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682114516"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (TcGblEnv, TcLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span>
</span><span id="line-2010"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameEnv TcTyThing -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; NameEnv TcTyThing
</span><a href="GHC.Tc.Types.html#tcl_env"><span class="hs-identifier hs-var">tcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682114516"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114514"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2011"></span><span>                </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114520"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114520"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM TcTyThing
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114520"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-2012"></span><span>                </span><span class="annot"><span class="annottext">Maybe TcTyThing
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2013"></span><span>
</span><span id="line-2014"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing -&gt; Name -&gt; Maybe TyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; NameEnv TyThing
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114515"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114514"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2015"></span><span>                </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114522"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621682114522"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM TcTyThing
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621682114522"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><span id="line-2016"></span><span>                </span><span class="annot"><span class="annottext">Maybe TyThing
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2017"></span><span>
</span><span id="line-2018"></span><span>          </span><span class="hs-comment">-- EZY: I don't think this choice matters, no TH in signatures!</span><span>
</span><span id="line-2019"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; GenModule Unit
</span><a href="GHC.Tc.Types.html#tcg_semantic_mod"><span class="hs-identifier hs-var">tcg_semantic_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682114515"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114514"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2020"></span><span>          </span><span class="hs-keyword">then</span><span>  </span><span class="hs-comment">-- It's defined in this module</span><span>
</span><span id="line-2021"></span><span>                </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM TcTyThing
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Splice.html#notInEnv"><span class="hs-identifier hs-var">notInEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114514"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2022"></span><span>
</span><span id="line-2023"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-2024"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114526"><span class="annot"><span class="annottext">MaybeErr SDoc TyThing
</span><a href="#local-6989586621682114526"><span class="hs-identifier hs-var">mb_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (MaybeErr SDoc TyThing)
</span><a href="GHC.Iface.Load.html#tcLookupImported_maybe"><span class="hs-identifier hs-var">tcLookupImported_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114514"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2025"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaybeErr SDoc TyThing
</span><a href="#local-6989586621682114526"><span class="hs-identifier hs-var">mb_thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2026"></span><span>            </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621682114529"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621682114529"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM TcTyThing
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621682114529"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2027"></span><span>            </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621682114531"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682114531"><span class="hs-identifier hs-var">msg</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM TcTyThing
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnInterfaceLookupError"><span class="hs-identifier hs-var">TcRnInterfaceLookupError</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114514"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682114531"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2028"></span><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-2029"></span><span>
</span><span id="line-2030"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#notInScope"><span class="hs-identifier hs-type">notInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-2031"></span><span id="notInScope"><span class="annot"><span class="annottext">notInScope :: Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Splice.html#notInScope"><span class="hs-identifier hs-var hs-var">notInScope</span></a></span></span><span> </span><span id="local-6989586621682114533"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114533"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2032"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnCannotReifyOutOfScopeThing"><span class="hs-identifier hs-var">TcRnCannotReifyOutOfScopeThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114533"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#notInEnv"><span class="hs-identifier hs-type">notInEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-2035"></span><span id="notInEnv"><span class="annot"><span class="annottext">notInEnv :: Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Splice.html#notInEnv"><span class="hs-identifier hs-var hs-var">notInEnv</span></a></span></span><span> </span><span id="local-6989586621682114535"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114535"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnCannotReifyThingNotInTypeEnv"><span class="hs-identifier hs-var">TcRnCannotReifyThingNotInTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114535"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2038"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyRoles"><span class="hs-identifier hs-type">reifyRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Role/Language.Haskell.TH.Syntax.html#Role"><span class="hs-identifier hs-type">TH.Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2039"></span><span id="reifyRoles"><span class="annot"><span class="annottext">reifyRoles :: Name -&gt; TcM [Role]
</span><a href="GHC.Tc.Gen.Splice.html#reifyRoles"><span class="hs-identifier hs-var hs-var">reifyRoles</span></a></span></span><span> </span><span id="local-6989586621682114537"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114537"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-2040"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114538"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114538"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var">getThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114537"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-2041"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114538"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2042"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621682114540"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114540"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; TcM [Role]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Role -&gt; Role) -&gt; [Role] -&gt; [Role]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role
</span><a href="#local-6989586621682114541"><span class="hs-identifier hs-var">reify_role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114540"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2043"></span><span>           </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM [Role]
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnNoRolesAssociatedWithThing"><span class="hs-identifier hs-var">TcRnNoRolesAssociatedWithThing</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114538"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2044"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-2045"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2046"></span><span>    </span><span id="local-6989586621682114541"><span class="annot"><span class="annottext">reify_role :: Role -&gt; Role
</span><a href="#local-6989586621682114541"><span class="hs-identifier hs-var hs-var">reify_role</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NominalR/Language.Haskell.TH.Syntax.html#NominalR"><span class="hs-identifier hs-var">TH.NominalR</span></a></span><span>
</span><span id="line-2047"></span><span>    </span><span class="annot"><a href="#local-6989586621682114541"><span class="hs-identifier hs-var">reify_role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#RepresentationalR/Language.Haskell.TH.Syntax.html#RepresentationalR"><span class="hs-identifier hs-var">TH.RepresentationalR</span></a></span><span>
</span><span id="line-2048"></span><span>    </span><span class="annot"><a href="#local-6989586621682114541"><span class="hs-identifier hs-var">reify_role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PhantomR/Language.Haskell.TH.Syntax.html#PhantomR"><span class="hs-identifier hs-var">TH.PhantomR</span></a></span><span>
</span><span id="line-2049"></span><span>
</span><span id="line-2050"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2051"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-type">reifyThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Info/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-2052"></span><span class="hs-comment">-- The only reason this is monadic is for error reporting,</span><span>
</span><span id="line-2053"></span><span class="hs-comment">-- which in turn is mainly for the case when TH can't express</span><span>
</span><span id="line-2054"></span><span class="hs-comment">-- some random GHC extension</span><span>
</span><span id="line-2055"></span><span>
</span><span id="line-2056"></span><span id="reifyThing"><span class="annot"><span class="annottext">reifyThing :: TcTyThing -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var hs-var">reifyThing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621682114551"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114551"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2057"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114552"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114552"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114551"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2058"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114555"><span class="annot"><span class="annottext">v :: Name
</span><a href="#local-6989586621682114555"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114551"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2059"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114551"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2060"></span><span>            </span><span class="annot"><a href="GHC.Types.Id.Info.html#ClassOpId"><span class="hs-identifier hs-type">ClassOpId</span></a></span><span> </span><span id="local-6989586621682114558"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114558"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Name -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ClassOpI/Language.Haskell.TH.Syntax.html#ClassOpI"><span class="hs-identifier hs-var">TH.ClassOpI</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114555"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114552"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114558"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2061"></span><span>            </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sel_tycon :: IdDetails -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#sel_tycon"><span class="hs-identifier hs-var">sel_tycon</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621682114563"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114563"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-2062"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Maybe Dec -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#VarI/Language.Haskell.TH.Syntax.html#VarI"><span class="hs-identifier hs-var">TH.VarI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TyCon -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifySelector"><span class="hs-identifier hs-var">reifySelector</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114551"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114563"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114552"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dec
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2063"></span><span>            </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Maybe Dec -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#VarI/Language.Haskell.TH.Syntax.html#VarI"><span class="hs-identifier hs-var">TH.VarI</span></a></span><span>     </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114555"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114552"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dec
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2064"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2065"></span><span>
</span><span id="line-2066"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621682114566"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114566"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-var">reifyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114566"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2067"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621682114570"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114570"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2068"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#mkDataConI"><span class="hs-identifier hs-var">mkDataConI</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114570"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2069"></span><span>
</span><span id="line-2070"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621682114573"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682114573"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2071"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114574"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682114574"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682114573"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-2072"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114575"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114575"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([InvisTVBinder], [Type], [InvisTVBinder], [Type], [Scaled Type],
 Type)
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-var">reifyPatSynType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn
-&gt; ([InvisTVBinder], [Type], [InvisTVBinder], [Type],
    [Scaled Type], Type)
</span><a href="GHC.Core.PatSyn.html#patSynSigBndr"><span class="hs-identifier hs-var">patSynSigBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682114573"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2073"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PatSynI/Language.Haskell.TH.Syntax.html#PatSynI"><span class="hs-identifier hs-var">TH.PatSynI</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114574"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114575"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2074"></span><span>
</span><span id="line-2075"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Id
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114581"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114581"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2076"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114582"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114582"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114581"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Make use of all the info we have, even</span><span>
</span><span id="line-2077"></span><span>                                        </span><span class="hs-comment">-- though it may be incomplete</span><span>
</span><span id="line-2078"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114583"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114583"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114582"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2079"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Maybe Dec -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#VarI/Language.Haskell.TH.Syntax.html#VarI"><span class="hs-identifier hs-var">TH.VarI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114581"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114583"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dec
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2080"></span><span>
</span><span id="line-2081"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621682114585"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114585"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682114586"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114586"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2082"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114587"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114587"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114586"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2083"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114589"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114589"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114587"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2084"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyVarI/Language.Haskell.TH.Syntax.html#TyVarI"><span class="hs-identifier hs-var">TH.TyVarI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114585"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114589"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2085"></span><span>
</span><span id="line-2086"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span id="local-6989586621682114591"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114591"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM Info
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyThing&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; SDoc
</span><a href="GHC.Tc.Types.html#pprTcTyThingCategory"><span class="hs-identifier hs-var">pprTcTyThingCategory</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682114591"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2087"></span><span>
</span><span id="line-2088"></span><span class="hs-comment">-------------------------------------------</span><span>
</span><span id="line-2089"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyAxBranch"><span class="hs-identifier hs-type">reifyAxBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TySynEqn/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-type">TH.TySynEqn</span></a></span><span>
</span><span id="line-2090"></span><span id="reifyAxBranch"><span class="annot"><span class="annottext">reifyAxBranch :: TyCon -&gt; CoAxBranch -&gt; TcM TySynEqn
</span><a href="GHC.Tc.Gen.Splice.html#reifyAxBranch"><span class="hs-identifier hs-var hs-var">reifyAxBranch</span></a></span></span><span> </span><span id="local-6989586621682114594"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114594"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114597"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114597"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-2091"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114599"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114599"><span class="hs-identifier hs-var">lhs</span></a></span></span><span>
</span><span id="line-2092"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114601"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114601"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2093"></span><span>            </span><span class="hs-comment">-- remove kind patterns (#8884)</span><span>
</span><span id="line-2094"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114602"><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621682114602"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114597"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-2095"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114604"><span class="annot"><span class="annottext">lhs_types_only :: [Type]
</span><a href="#local-6989586621682114604"><span class="hs-identifier hs-var hs-var">lhs_types_only</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114594"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114599"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2096"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114606"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114606"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114604"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span>
</span><span id="line-2097"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114608"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114608"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var">tyConArgsPolyKinded</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114594"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2098"></span><span>                                   </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114604"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114606"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-2099"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114612"><span class="annot"><span class="annottext">lhs_type :: Type
</span><a href="#local-6989586621682114612"><span class="hs-identifier hs-var hs-var">lhs_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type) -&gt; Name -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114594"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114608"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span><span>
</span><span id="line-2100"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114613"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114613"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114601"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2101"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TySynEqn -&gt; TcM TySynEqn
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; Type -&gt; Type -&gt; TySynEqn
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TySynEqn/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-var">TH.TySynEqn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621682114602"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114612"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114613"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2102"></span><span>
</span><span id="line-2103"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-type">reifyTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Info/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-2104"></span><span id="reifyTyCon"><span class="annot"><span class="annottext">reifyTyCon :: TyCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-var hs-var">reifyTyCon</span></a></span></span><span> </span><span id="local-6989586621682114615"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-2105"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114616"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114616"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2106"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyClass"><span class="hs-identifier hs-var">reifyClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114616"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-2107"></span><span>
</span><span id="line-2108"></span><span class="hs-comment">{-  Seems to be just a short cut for the next equation -- omit
  | tc `hasKey` fUNTyConKey -- I'm not quite sure what is happening here
  = return (TH.PrimTyConI (reifyName tc) 2 False)
-}</span><span>
</span><span id="line-2112"></span><span>
</span><span id="line-2113"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2114"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SumArity -&gt; Bool -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PrimTyConI/Language.Haskell.TH.Syntax.html#PrimTyConI"><span class="hs-identifier hs-var">TH.PrimTyConI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; SumArity
forall a. [a] -&gt; SumArity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; SumArity
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2115"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedTypeKind"><span class="hs-identifier hs-var">isUnliftedTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2116"></span><span>
</span><span id="line-2117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2118"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114625"><span class="annot"><span class="annottext">tvs :: [Id]
</span><a href="#local-6989586621682114625"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2119"></span><span>             </span><span id="local-6989586621682114627"><span class="annot"><span class="annottext">res_kind :: Type
</span><a href="#local-6989586621682114627"><span class="hs-identifier hs-var hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2120"></span><span>             </span><span id="local-6989586621682114628"><span class="annot"><span class="annottext">resVar :: Maybe Name
</span><a href="#local-6989586621682114628"><span class="hs-identifier hs-var hs-var">resVar</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Name
</span><a href="GHC.Core.TyCon.html#tyConFamilyResVar_maybe"><span class="hs-identifier hs-var">tyConFamilyResVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2121"></span><span>
</span><span id="line-2122"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114630"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114630"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114627"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2123"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114632"><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621682114632"><span class="hs-identifier hs-var">resultSig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114633"><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><a href="#local-6989586621682114633"><span class="hs-identifier hs-var">injectivity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2124"></span><span>                 </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682114628"><span class="hs-identifier hs-var">resVar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2125"></span><span>                   </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; FamilyResultSig
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#KindSig/Language.Haskell.TH.Syntax.html#KindSig"><span class="hs-identifier hs-var">TH.KindSig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114630"><span class="hs-identifier hs-var">kind'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2126"></span><span>                   </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114635"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114635"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2127"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114636"><span class="annot"><span class="annottext">thName :: Name
</span><a href="#local-6989586621682114636"><span class="hs-identifier hs-var hs-var">thName</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114635"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2128"></span><span>                         </span><span id="local-6989586621682114637"><span class="annot"><span class="annottext">injAnnot :: Injectivity
</span><a href="#local-6989586621682114637"><span class="hs-identifier hs-var hs-var">injAnnot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Injectivity
</span><a href="GHC.Core.TyCon.html#tyConInjectivityInfo"><span class="hs-identifier hs-var">tyConInjectivityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2129"></span><span>                         </span><span id="local-6989586621682114639"><span class="annot"><span class="annottext">sig :: FamilyResultSig
</span><a href="#local-6989586621682114639"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBndr () -&gt; FamilyResultSig
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyVarSig/Language.Haskell.TH.Syntax.html#TyVarSig"><span class="hs-identifier hs-var">TH.TyVarSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; () -&gt; Type -&gt; TyVarBndr ()
forall flag. Name -&gt; flag -&gt; Type -&gt; TyVarBndr flag
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#KindedTV/Language.Haskell.TH.Syntax.html#KindedTV"><span class="hs-identifier hs-var">TH.KindedTV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114636"><span class="hs-identifier hs-var">thName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114630"><span class="hs-identifier hs-var">kind'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2130"></span><span>                         </span><span id="local-6989586621682114642"><span class="annot"><span class="annottext">inj :: Maybe InjectivityAnn
</span><a href="#local-6989586621682114642"><span class="hs-identifier hs-var hs-var">inj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621682114637"><span class="hs-identifier hs-var">injAnnot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2131"></span><span>                                 </span><span class="annot"><span class="annottext">Injectivity
</span><a href="GHC.Core.TyCon.html#NotInjective"><span class="hs-identifier hs-var">NotInjective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2132"></span><span>                                 </span><span class="annot"><a href="GHC.Core.TyCon.html#Injective"><span class="hs-identifier hs-type">Injective</span></a></span><span> </span><span id="local-6989586621682114645"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682114645"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2133"></span><span>                                     </span><span class="annot"><span class="annottext">InjectivityAnn -&gt; Maybe InjectivityAnn
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; InjectivityAnn
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InjectivityAnn/Language.Haskell.TH.Syntax.html#InjectivityAnn"><span class="hs-identifier hs-var">TH.InjectivityAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114636"><span class="hs-identifier hs-var">thName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114647"><span class="hs-identifier hs-var">injRHS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2134"></span><span>                                   </span><span class="hs-keyword">where</span><span>
</span><span id="line-2135"></span><span>                                     </span><span id="local-6989586621682114647"><span class="annot"><span class="annottext">injRHS :: [Name]
</span><a href="#local-6989586621682114647"><span class="hs-identifier hs-var hs-var">injRHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (Id -&gt; Name) -&gt; Id -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2136"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; [Id] -&gt; [Id]
forall a. [Bool] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682114645"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114625"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2137"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621682114639"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><a href="#local-6989586621682114642"><span class="hs-identifier hs-var">inj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2138"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114650"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114650"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2139"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114652"><span class="annot"><span class="annottext">tfHead :: TypeFamilyHead
</span><a href="#local-6989586621682114652"><span class="hs-identifier hs-var hs-var">tfHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2140"></span><span>               </span><span class="annot"><span class="annottext">Name
-&gt; [TyVarBndr ()]
-&gt; FamilyResultSig
-&gt; Maybe InjectivityAnn
-&gt; TypeFamilyHead
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TypeFamilyHead/Language.Haskell.TH.Syntax.html#TypeFamilyHead"><span class="hs-identifier hs-var">TH.TypeFamilyHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114650"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621682114632"><span class="hs-identifier hs-var">resultSig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><a href="#local-6989586621682114633"><span class="hs-identifier hs-var">injectivity</span></a></span><span>
</span><span id="line-2141"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isOpenTypeFamilyTyCon"><span class="hs-identifier hs-var">isOpenTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2142"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114655"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682114655"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2143"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114656"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114656"><span class="hs-identifier hs-var">instances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var">reifyFamilyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2144"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; [FamInst]
</span><a href="GHC.Core.FamInstEnv.html#familyInstances"><span class="hs-identifier hs-var">familyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682114655"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2145"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#FamilyI/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-var">TH.FamilyI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeFamilyHead -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#OpenTypeFamilyD/Language.Haskell.TH.Syntax.html#OpenTypeFamilyD"><span class="hs-identifier hs-var">TH.OpenTypeFamilyD</span></a></span><span> </span><span class="annot"><span class="annottext">TypeFamilyHead
</span><a href="#local-6989586621682114652"><span class="hs-identifier hs-var">tfHead</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114656"><span class="hs-identifier hs-var">instances</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2146"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114660"><span class="annot"><span class="annottext">[TySynEqn]
</span><a href="#local-6989586621682114660"><span class="hs-identifier hs-var">eqns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2147"></span><span>                     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (CoAxiom Branched)
</span><a href="GHC.Core.TyCon.html#isClosedSynFamilyTyConWithAxiom_maybe"><span class="hs-identifier hs-var">isClosedSynFamilyTyConWithAxiom_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2148"></span><span>                       </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114662"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621682114662"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoAxBranch -&gt; TcM TySynEqn)
-&gt; [CoAxBranch] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; TcM TySynEqn
</span><a href="GHC.Tc.Gen.Splice.html#reifyAxBranch"><span class="hs-identifier hs-var">reifyAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CoAxBranch] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn])
-&gt; [CoAxBranch] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2149"></span><span>                                  </span><span class="annot"><span class="annottext">Branches Branched -&gt; [CoAxBranch]
forall (br :: BranchFlag). Branches br -&gt; [CoAxBranch]
</span><a href="GHC.Core.Coercion.Axiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a></span><span> </span><span class="annot"><span class="annottext">(Branches Branched -&gt; [CoAxBranch])
-&gt; Branches Branched -&gt; [CoAxBranch]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; Branches Branched
forall (br :: BranchFlag). CoAxiom br -&gt; Branches br
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomBranches"><span class="hs-identifier hs-var">coAxiomBranches</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621682114662"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2150"></span><span>                       </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TySynEqn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2151"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#FamilyI/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-var">TH.FamilyI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeFamilyHead -&gt; [TySynEqn] -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ClosedTypeFamilyD/Language.Haskell.TH.Syntax.html#ClosedTypeFamilyD"><span class="hs-identifier hs-var">TH.ClosedTypeFamilyD</span></a></span><span> </span><span class="annot"><span class="annottext">TypeFamilyHead
</span><a href="#local-6989586621682114652"><span class="hs-identifier hs-var">tfHead</span></a></span><span> </span><span class="annot"><span class="annottext">[TySynEqn]
</span><a href="#local-6989586621682114660"><span class="hs-identifier hs-var">eqns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2152"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2153"></span><span>
</span><span id="line-2154"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2155"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114667"><span class="annot"><span class="annottext">res_kind :: Type
</span><a href="#local-6989586621682114667"><span class="hs-identifier hs-var hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2156"></span><span>
</span><span id="line-2157"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114668"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682114668"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Maybe Type)
-&gt; TcM Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114667"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2158"></span><span>
</span><span id="line-2159"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114669"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114669"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114670"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682114670"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2161"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114671"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114671"><span class="hs-identifier hs-var">instances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var">reifyFamilyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; [FamInst]
</span><a href="GHC.Core.FamInstEnv.html#familyInstances"><span class="hs-identifier hs-var">familyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682114670"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#FamilyI/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-var">TH.FamilyI</span></a></span><span>
</span><span id="line-2163"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Maybe Type -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DataFamilyD/Language.Haskell.TH.Syntax.html#DataFamilyD"><span class="hs-identifier hs-var">TH.DataFamilyD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114669"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682114668"><span class="hs-identifier hs-var">kind'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114671"><span class="hs-identifier hs-var">instances</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2164"></span><span>
</span><span id="line-2165"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114673"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114673"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe ([Id], Type)
</span><a href="GHC.Core.TyCon.html#synTyConDefn_maybe"><span class="hs-identifier hs-var">synTyConDefn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>  </span><span class="hs-comment">-- Vanilla type synonym</span><span>
</span><span id="line-2166"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114675"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114675"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114673"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2167"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114676"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114676"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2168"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyConI/Language.Haskell.TH.Syntax.html#TyConI"><span class="hs-identifier hs-var">TH.TyConI</span></a></span><span>
</span><span id="line-2169"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Type -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TySynD/Language.Haskell.TH.Syntax.html#TySynD"><span class="hs-identifier hs-var">TH.TySynD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114676"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114675"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2170"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-2171"></span><span>
</span><span id="line-2172"></span><span>  </span><span class="hs-comment">-- Special case for `type data` data constructors, which are reified as</span><span>
</span><span id="line-2173"></span><span>  </span><span class="hs-comment">-- `ATyCon`s rather than `ADataCon`s (#22818).</span><span>
</span><span id="line-2174"></span><span>  </span><span class="hs-comment">-- See Note [Type data declarations] in GHC.Rename.Module.</span><span>
</span><span id="line-2175"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682114679"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114679"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#isPromotedDataCon_maybe"><span class="hs-identifier hs-var">isPromotedDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2176"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isTypeDataCon"><span class="hs-identifier hs-var">isTypeDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114679"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2177"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#mkDataConI"><span class="hs-identifier hs-var">mkDataConI</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114679"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2178"></span><span>
</span><span id="line-2179"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2180"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114682"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114682"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type]
</span><a href="GHC.Core.TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2181"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114685"><span class="annot"><span class="annottext">tvs :: [Id]
</span><a href="#local-6989586621682114685"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2182"></span><span>              </span><span id="local-6989586621682114686"><span class="annot"><span class="annottext">dataCons :: [DataCon]
</span><a href="#local-6989586621682114686"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2183"></span><span>              </span><span id="local-6989586621682114688"><span class="annot"><span class="annottext">isGadt :: Bool
</span><a href="#local-6989586621682114688"><span class="hs-identifier hs-var hs-var">isGadt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGadtSyntaxTyCon"><span class="hs-identifier hs-var">isGadtSyntaxTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2184"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114690"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114690"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; [DataCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Con]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [Type] -&gt; DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-var">reifyDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114688"><span class="hs-identifier hs-var">isGadt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114685"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682114686"><span class="hs-identifier hs-var">dataCons</span></a></span><span>
</span><span id="line-2185"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114693"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114693"><span class="hs-identifier hs-var">r_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2186"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114694"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682114694"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2187"></span><span>              </span><span id="local-6989586621682114695"><span class="annot"><span class="annottext">deriv :: [a]
</span><a href="#local-6989586621682114695"><span class="hs-identifier hs-var hs-var">deriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Don't know about deriving</span><span>
</span><span id="line-2188"></span><span>              </span><span id="local-6989586621682114696"><span class="annot"><span class="annottext">decl :: Dec
</span><a href="#local-6989586621682114696"><span class="hs-identifier hs-var hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeDataTyCon"><span class="hs-identifier hs-var">isTypeDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2189"></span><span>                       </span><span class="hs-comment">-- `type data` declarations have a special `Dec`,</span><span>
</span><span id="line-2190"></span><span>                       </span><span class="hs-comment">-- separate from other `DataD`s. See</span><span>
</span><span id="line-2191"></span><span>                       </span><span class="hs-comment">-- [Type data declarations] in GHC.Rename.Module.</span><span>
</span><span id="line-2192"></span><span>                       </span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Maybe Type -&gt; [Con] -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TypeDataD/Language.Haskell.TH.Syntax.html#TypeDataD"><span class="hs-identifier hs-var">TH.TypeDataD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114694"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114693"><span class="hs-identifier hs-var">r_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114690"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-2193"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114615"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2194"></span><span>                       </span><span class="annot"><span class="annottext">[Type]
-&gt; Name
-&gt; [TyVarBndr ()]
-&gt; Maybe Type
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NewtypeD/Language.Haskell.TH.Syntax.html#NewtypeD"><span class="hs-identifier hs-var">TH.NewtypeD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114682"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114694"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114693"><span class="hs-identifier hs-var">r_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Con] -&gt; Con
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114690"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DerivClause]
forall a. [a]
</span><a href="#local-6989586621682114695"><span class="hs-identifier hs-var">deriv</span></a></span><span>
</span><span id="line-2195"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-2196"></span><span>                       </span><span class="annot"><span class="annottext">[Type]
-&gt; Name
-&gt; [TyVarBndr ()]
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DataD/Language.Haskell.TH.Syntax.html#DataD"><span class="hs-identifier hs-var">TH.DataD</span></a></span><span>    </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114682"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114694"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114693"><span class="hs-identifier hs-var">r_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114690"><span class="hs-identifier hs-var">cons</span></a></span><span>  </span><span class="annot"><span class="annottext">[DerivClause]
forall a. [a]
</span><a href="#local-6989586621682114695"><span class="hs-identifier hs-var">deriv</span></a></span><span>
</span><span id="line-2197"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyConI/Language.Haskell.TH.Syntax.html#TyConI"><span class="hs-identifier hs-var">TH.TyConI</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621682114696"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2198"></span><span>
</span><span id="line-2199"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-type">reifyDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Con/Language.Haskell.TH.Syntax.html#Con"><span class="hs-identifier hs-type">TH.Con</span></a></span><span>
</span><span id="line-2200"></span><span id="reifyDataCon"><span class="annot"><span class="annottext">reifyDataCon :: Bool -&gt; [Type] -&gt; DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-var hs-var">reifyDataCon</span></a></span></span><span> </span><span id="local-6989586621682114703"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114703"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span></span><span> </span><span id="local-6989586621682114704"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114704"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682114705"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span></span><span>
</span><span id="line-2201"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- used for H98 data constructors</span><span>
</span><span id="line-2202"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621682114706"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114706"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114707"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114707"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114708"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114708"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2203"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Type] -&gt; ([Id], [Type], [Type])
</span><a href="GHC.Core.DataCon.html#dataConInstSig"><span class="hs-identifier hs-var">dataConInstSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114704"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2204"></span><span>             </span><span class="hs-comment">-- used for GADTs data constructors</span><span>
</span><span id="line-2205"></span><span>             </span><span id="local-6989586621682114710"><span class="annot"><span class="annottext">g_user_tvs' :: [InvisTVBinder]
</span><a href="#local-6989586621682114710"><span class="hs-identifier hs-var hs-var">g_user_tvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [InvisTVBinder]
</span><a href="GHC.Core.DataCon.html#dataConUserTyVarBinders"><span class="hs-identifier hs-var">dataConUserTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2206"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621682114712"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114712"><span class="hs-identifier hs-var">g_univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114713"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682114713"><span class="hs-identifier hs-var">g_eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114714"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114714"><span class="hs-identifier hs-var">g_theta'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114715"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682114715"><span class="hs-identifier hs-var">g_arg_tys'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114716"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114716"><span class="hs-identifier hs-var">g_res_ty'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2207"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ([Id], [Id], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2208"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621682114718"><span class="annot"><span class="annottext">[SourceUnpackedness]
</span><a href="#local-6989586621682114718"><span class="hs-identifier hs-var">srcUnpks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114719"><span class="annot"><span class="annottext">[SourceStrictness]
</span><a href="#local-6989586621682114719"><span class="hs-identifier hs-var">srcStricts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2209"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsSrcBang -&gt; (SourceUnpackedness, SourceStrictness))
-&gt; [HsSrcBang] -&gt; ([SourceUnpackedness], [SourceStrictness])
forall a b c. (a -&gt; (b, c)) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#mapAndUnzip"><span class="hs-identifier hs-var">mapAndUnzip</span></a></span><span> </span><span class="annot"><span class="annottext">HsSrcBang -&gt; (SourceUnpackedness, SourceStrictness)
</span><a href="GHC.Tc.Gen.Splice.html#reifySourceBang"><span class="hs-identifier hs-var">reifySourceBang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsSrcBang]
</span><a href="GHC.Core.DataCon.html#dataConSrcBangs"><span class="hs-identifier hs-var">dataConSrcBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2210"></span><span>             </span><span id="local-6989586621682114723"><span class="annot"><span class="annottext">dcdBangs :: [Bang]
</span><a href="#local-6989586621682114723"><span class="hs-identifier hs-var hs-var">dcdBangs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SourceUnpackedness -&gt; SourceStrictness -&gt; Bang)
-&gt; [SourceUnpackedness] -&gt; [SourceStrictness] -&gt; [Bang]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness -&gt; SourceStrictness -&gt; Bang
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Bang/Language.Haskell.TH.Syntax.html#Bang"><span class="hs-identifier hs-var">TH.Bang</span></a></span><span> </span><span class="annot"><span class="annottext">[SourceUnpackedness]
</span><a href="#local-6989586621682114718"><span class="hs-identifier hs-var">srcUnpks</span></a></span><span> </span><span class="annot"><span class="annottext">[SourceStrictness]
</span><a href="#local-6989586621682114719"><span class="hs-identifier hs-var">srcStricts</span></a></span><span>
</span><span id="line-2211"></span><span>             </span><span id="local-6989586621682114726"><span class="annot"><span class="annottext">fields :: [FieldLabel]
</span><a href="#local-6989586621682114726"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [FieldLabel]
</span><a href="GHC.Core.DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2212"></span><span>             </span><span id="local-6989586621682114728"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682114728"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2213"></span><span>             </span><span class="hs-comment">-- Universal tvs present in eq_spec need to be filtered out, as</span><span>
</span><span id="line-2214"></span><span>             </span><span class="hs-comment">-- they will not appear anywhere in the type.</span><span>
</span><span id="line-2215"></span><span>             </span><span id="local-6989586621682114729"><span class="annot"><span class="annottext">eq_spec_tvs :: VarSet
</span><a href="#local-6989586621682114729"><span class="hs-identifier hs-var hs-var">eq_spec_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqSpec -&gt; Id) -&gt; [EqSpec] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">EqSpec -&gt; Id
</span><a href="GHC.Core.DataCon.html#eqSpecTyVar"><span class="hs-identifier hs-var">eqSpecTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682114713"><span class="hs-identifier hs-var">g_eq_spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2216"></span><span>
</span><span id="line-2217"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114732"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114732"><span class="hs-identifier hs-var">univ_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2218"></span><span>              </span><span class="hs-comment">-- See Note [Freshen reified GADT constructors' universal tyvars]</span><span>
</span><span id="line-2219"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (Subst, [Id])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyVarBndrs"><span class="hs-identifier hs-var">freshenTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; TcM (Subst, [Id])) -&gt; [Id] -&gt; TcM (Subst, [Id])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2220"></span><span>              </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682114729"><span class="hs-identifier hs-var">eq_spec_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114712"><span class="hs-identifier hs-var">g_univ_tvs</span></a></span><span>
</span><span id="line-2221"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114736"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114736"><span class="hs-identifier hs-var">tvb_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114737"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682114737"><span class="hs-identifier hs-var">g_user_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [InvisTVBinder] -&gt; (Subst, [InvisTVBinder])
forall {argf}.
Subst -&gt; [VarBndr Id argf] -&gt; (Subst, [VarBndr Id argf])
</span><a href="#local-6989586621682114738"><span class="hs-identifier hs-var">subst_tv_binders</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114732"><span class="hs-identifier hs-var">univ_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682114710"><span class="hs-identifier hs-var">g_user_tvs'</span></a></span><span>
</span><span id="line-2222"></span><span>             </span><span id="local-6989586621682114739"><span class="annot"><span class="annottext">g_theta :: [Type]
</span><a href="#local-6989586621682114739"><span class="hs-identifier hs-var hs-var">g_theta</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114736"><span class="hs-identifier hs-var">tvb_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114714"><span class="hs-identifier hs-var">g_theta'</span></a></span><span>
</span><span id="line-2223"></span><span>             </span><span id="local-6989586621682114741"><span class="annot"><span class="annottext">g_arg_tys :: [Type]
</span><a href="#local-6989586621682114741"><span class="hs-identifier hs-var hs-var">g_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114736"><span class="hs-identifier hs-var">tvb_subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682114715"><span class="hs-identifier hs-var">g_arg_tys'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2224"></span><span>             </span><span id="local-6989586621682114743"><span class="annot"><span class="annottext">g_res_ty :: Type
</span><a href="#local-6989586621682114743"><span class="hs-identifier hs-var hs-var">g_res_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span>  </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114736"><span class="hs-identifier hs-var">tvb_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114716"><span class="hs-identifier hs-var">g_res_ty'</span></a></span><span>
</span><span id="line-2225"></span><span>
</span><span id="line-2226"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114745"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114703"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114741"><span class="hs-identifier hs-var">g_arg_tys</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114708"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span>
</span><span id="line-2228"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114746"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621682114746"><span class="hs-identifier hs-var">main_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2229"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabel] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682114726"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114703"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2230"></span><span>                  </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [VarBangType] -&gt; Con
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#RecC/Language.Haskell.TH.Syntax.html#RecC"><span class="hs-identifier hs-var">TH.RecC</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114728"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; [Bang] -&gt; [Type] -&gt; [VarBangType]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip3/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-var">reifyFieldLabel</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682114726"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2231"></span><span>                                         </span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621682114723"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2232"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabel] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682114726"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2233"></span><span>                  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114752"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114752"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114743"><span class="hs-identifier hs-var">g_res_ty</span></a></span><span>
</span><span id="line-2234"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [VarBangType] -&gt; Type -&gt; Con
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#RecGadtC/Language.Haskell.TH.Syntax.html#RecGadtC"><span class="hs-identifier hs-var">TH.RecGadtC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114728"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2235"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; [Bang] -&gt; [Type] -&gt; [VarBangType]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip3/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (FieldLabel -&gt; Name) -&gt; FieldLabel -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682114726"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2236"></span><span>                                      </span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621682114723"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114752"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2237"></span><span>                </span><span class="hs-comment">-- We need to check not isGadtDataCon here because GADT</span><span>
</span><span id="line-2238"></span><span>                </span><span class="hs-comment">-- constructors can be declared infix.</span><span>
</span><span id="line-2239"></span><span>                </span><span class="hs-comment">-- See Note [Infix GADT constructors] in GHC.Tc.TyCl.</span><span>
</span><span id="line-2240"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114705"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114703"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2241"></span><span>                  </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SumArity -&gt; Bool
forall a. [a] -&gt; SumArity -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-var">`lengthIs`</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) Con
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2242"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682114757"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114757"><span class="hs-identifier hs-var">r_a1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114758"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114758"><span class="hs-identifier hs-var">r_a2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span>
</span><span id="line-2243"></span><span>                        </span><span class="hs-special">[</span><span id="local-6989586621682114759"><span class="annot"><span class="annottext">Bang
</span><a href="#local-6989586621682114759"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621682114760"><span class="annot"><span class="annottext">Bang
</span><a href="#local-6989586621682114760"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621682114723"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span>
</span><span id="line-2244"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BangType -&gt; Name -&gt; BangType -&gt; Con
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InfixC/Language.Haskell.TH.Syntax.html#InfixC"><span class="hs-identifier hs-var">TH.InfixC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bang
</span><a href="#local-6989586621682114759"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114757"><span class="hs-identifier hs-var">r_a1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114728"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bang
</span><a href="#local-6989586621682114760"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114758"><span class="hs-identifier hs-var">r_a2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2245"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114703"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2246"></span><span>                  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114762"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114762"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114743"><span class="hs-identifier hs-var">g_res_ty</span></a></span><span>
</span><span id="line-2247"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [BangType] -&gt; Type -&gt; Con
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#GadtC/Language.Haskell.TH.Syntax.html#GadtC"><span class="hs-identifier hs-var">TH.GadtC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114728"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621682114723"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Bang] -&gt; [Type] -&gt; [BangType]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114762"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2248"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2249"></span><span>                  </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NormalC/Language.Haskell.TH.Syntax.html#NormalC"><span class="hs-identifier hs-var">TH.NormalC</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114728"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621682114723"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Bang] -&gt; [Type] -&gt; [BangType]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2250"></span><span>
</span><span id="line-2251"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114765"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682114765"><span class="hs-identifier hs-var">ex_tvs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114766"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114766"><span class="hs-identifier hs-var">theta'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114703"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682114737"><span class="hs-identifier hs-var">g_user_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114739"><span class="hs-identifier hs-var">g_theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2252"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ([InvisTVBinder], [Type]) -&gt; ([InvisTVBinder], [Type])
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114706"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2253"></span><span>                                                 </span><span class="hs-comment">-- no covars for haskell syntax</span><span>
</span><span id="line-2254"></span><span>                                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; InvisTVBinder) -&gt; [Id] -&gt; [InvisTVBinder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; InvisTVBinder
forall {var}. var -&gt; VarBndr var Specificity
</span><a href="#local-6989586621682114769"><span class="hs-identifier hs-var">mk_specified</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114706"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114707"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2255"></span><span>             </span><span id="local-6989586621682114770"><span class="annot"><span class="annottext">ret_con :: IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="#local-6989586621682114770"><span class="hs-identifier hs-var hs-var">ret_con</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682114765"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114766"><span class="hs-identifier hs-var">theta'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621682114746"><span class="hs-identifier hs-var">main_con</span></a></span><span>
</span><span id="line-2256"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2257"></span><span>                         </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114771"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114771"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114766"><span class="hs-identifier hs-var">theta'</span></a></span><span>
</span><span id="line-2258"></span><span>                         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114772"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682114772"><span class="hs-identifier hs-var">ex_tvs''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682114765"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span>
</span><span id="line-2259"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Con -&gt; Con
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ForallC/Language.Haskell.TH.Syntax.html#ForallC"><span class="hs-identifier hs-var">TH.ForallC</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682114772"><span class="hs-identifier hs-var">ex_tvs''</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114771"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621682114746"><span class="hs-identifier hs-var">main_con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2260"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114745"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Bang] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621682114723"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>         </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="#local-6989586621682114770"><span class="hs-identifier hs-var">ret_con</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2262"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2263"></span><span>    </span><span id="local-6989586621682114769"><span class="annot"><span class="annottext">mk_specified :: var -&gt; VarBndr var Specificity
</span><a href="#local-6989586621682114769"><span class="hs-identifier hs-var hs-var">mk_specified</span></a></span></span><span> </span><span id="local-6989586621682114776"><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621682114776"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">var -&gt; Specificity -&gt; VarBndr var Specificity
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621682114776"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span>
</span><span id="line-2264"></span><span>
</span><span id="line-2265"></span><span>    </span><span id="local-6989586621682114738"><span class="annot"><span class="annottext">subst_tv_binders :: Subst -&gt; [VarBndr Id argf] -&gt; (Subst, [VarBndr Id argf])
</span><a href="#local-6989586621682114738"><span class="hs-identifier hs-var hs-var">subst_tv_binders</span></a></span></span><span> </span><span id="local-6989586621682114780"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114780"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682114781"><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621682114781"><span class="hs-identifier hs-var">tv_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2266"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114782"><span class="annot"><span class="annottext">tvs :: [Id]
</span><a href="#local-6989586621682114782"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf] -&gt; [Id]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621682114781"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span>
</span><span id="line-2267"></span><span>          </span><span id="local-6989586621682114784"><span class="annot"><span class="annottext">flags :: [argf]
</span><a href="#local-6989586621682114784"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf] -&gt; [argf]
forall tv argf. [VarBndr tv argf] -&gt; [argf]
</span><a href="GHC.Types.Var.html#binderFlags"><span class="hs-identifier hs-var">binderFlags</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621682114781"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span>
</span><span id="line-2268"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682114786"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114786"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114787"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114787"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; [Id] -&gt; (Subst, [Id])
Subst -&gt; [Id] -&gt; (Subst, [Id])
</span><a href="GHC.Core.TyCo.Subst.html#substTyVarBndrs"><span class="hs-identifier hs-var">substTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114780"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114782"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-2269"></span><span>          </span><span id="local-6989586621682114789"><span class="annot"><span class="annottext">tv_bndrs' :: [VarBndr Id argf]
</span><a href="#local-6989586621682114789"><span class="hs-identifier hs-var hs-var">tv_bndrs'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, argf) -&gt; VarBndr Id argf)
-&gt; [(Id, argf)] -&gt; [VarBndr Id argf]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682114790"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114790"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682114791"><span class="annot"><span class="annottext">argf
</span><a href="#local-6989586621682114791"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; argf -&gt; VarBndr Id argf
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114790"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">argf
</span><a href="#local-6989586621682114791"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [argf] -&gt; [(Id, argf)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114787"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[argf]
</span><a href="#local-6989586621682114784"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2270"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682114786"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621682114789"><span class="hs-identifier hs-var">tv_bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2271"></span><span>
</span><span id="line-2272"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#mkDataConI"><span class="hs-identifier hs-type">mkDataConI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Info/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-2273"></span><span id="mkDataConI"><span class="annot"><span class="annottext">mkDataConI :: DataCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#mkDataConI"><span class="hs-identifier hs-var hs-var">mkDataConI</span></a></span></span><span> </span><span id="local-6989586621682114792"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114792"><span class="hs-identifier hs-var">dc</span></a></span></span><span>
</span><span id="line-2274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114793"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682114793"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114792"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2275"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114795"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114795"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114792"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2276"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Name -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DataConI/Language.Haskell.TH.Syntax.html#DataConI"><span class="hs-identifier hs-var">TH.DataConI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114793"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114795"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2277"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConOrigTyCon"><span class="hs-identifier hs-var">dataConOrigTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682114792"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2278"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2279"></span><span>
</span><span id="line-2280"></span><span class="hs-comment">{-
Note [Freshen reified GADT constructors' universal tyvars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose one were to reify this GADT:

  data a :~: b where
    Refl :: forall a b. (a ~ b) =&gt; a :~: b

We ought to be careful here about the uniques we give to the occurrences of `a`
and `b` in this definition. That is because in the original DataCon, all uses
of `a` and `b` have the same unique, since `a` and `b` are both universally
quantified type variables--that is, they are used in both the (:~:) tycon as
well as in the constructor type signature. But when we turn the DataCon
definition into the reified one, the `a` and `b` in the constructor type
signature becomes differently scoped than the `a` and `b` in `data a :~: b`.

While it wouldn't technically be *wrong* per se to re-use the same uniques for
`a` and `b` across these two different scopes, it's somewhat annoying for end
users of Template Haskell, since they wouldn't be able to rely on the
assumption that all TH names have globally distinct uniques (#13885). For this
reason, we freshen the universally quantified tyvars that go into the reified
GADT constructor type signature to give them distinct uniques from their
counterparts in the tycon.
-}</span><span>
</span><span id="line-2304"></span><span>
</span><span id="line-2305"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2306"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyClass"><span class="hs-identifier hs-type">reifyClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Info/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-2307"></span><span id="reifyClass"><span class="annot"><span class="annottext">reifyClass :: Class -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyClass"><span class="hs-identifier hs-var hs-var">reifyClass</span></a></span></span><span> </span><span id="local-6989586621682114799"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114799"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-2308"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114800"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114800"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114801"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-2309"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114802"><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621682114802"><span class="hs-identifier hs-var">inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a></span><span>
</span><span id="line-2310"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114803"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114803"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [ClsInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-var">reifyClassInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114799"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnvs -&gt; Class -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#classInstances"><span class="hs-identifier hs-var">InstEnv.classInstances</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621682114802"><span class="hs-identifier hs-var">inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114799"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2311"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114805"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114805"><span class="hs-identifier hs-var">assocTys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ClassATItem -&gt; TcM [Dec]) -&gt; [ClassATItem] -&gt; TcM [Dec]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">ClassATItem -&gt; TcM [Dec]
</span><a href="#local-6989586621682114807"><span class="hs-identifier hs-var">reifyAT</span></a></span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621682114808"><span class="hs-identifier hs-var">ats</span></a></span><span>
</span><span id="line-2312"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114809"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114809"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Id, Maybe (Name, DefMethSpec Type)) -&gt; TcM [Dec])
-&gt; [(Id, Maybe (Name, DefMethSpec Type))] -&gt; TcM [Dec]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, Maybe (Name, DefMethSpec Type)) -&gt; TcM [Dec]
forall {a}. (Id, Maybe (a, DefMethSpec Type)) -&gt; TcM [Dec]
</span><a href="#local-6989586621682114810"><span class="hs-identifier hs-var">reify_op</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, Maybe (Name, DefMethSpec Type))]
</span><a href="#local-6989586621682114811"><span class="hs-identifier hs-var">op_stuff</span></a></span><span>
</span><span id="line-2313"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114812"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114812"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114799"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2314"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114814"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621682114814"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Name -&gt; [TyVarBndr ()] -&gt; [FunDep] -&gt; [Dec] -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ClassD/Language.Haskell.TH.Syntax.html#ClassD"><span class="hs-identifier hs-var">TH.ClassD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114800"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114799"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114812"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><a href="#local-6989586621682114816"><span class="hs-identifier hs-var">fds'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114805"><span class="hs-identifier hs-var">assocTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; [Dec] -&gt; [Dec]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114809"><span class="hs-identifier hs-var">ops</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2315"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ClassI/Language.Haskell.TH.Syntax.html#ClassI"><span class="hs-identifier hs-var">TH.ClassI</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621682114814"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621682114803"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2316"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2317"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114818"><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621682114818"><span class="hs-identifier hs-var">fds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114801"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114801"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114808"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621682114808"><span class="hs-identifier hs-var">ats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114811"><span class="annot"><span class="annottext">[(Id, Maybe (Name, DefMethSpec Type))]
</span><a href="#local-6989586621682114811"><span class="hs-identifier hs-var">op_stuff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
-&gt; ([Id], [FunDep Id], [Type], [Id], [ClassATItem],
    [(Id, Maybe (Name, DefMethSpec Type))])
</span><a href="GHC.Core.Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114799"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-2318"></span><span>    </span><span id="local-6989586621682114816"><span class="annot"><span class="annottext">fds' :: [FunDep]
</span><a href="#local-6989586621682114816"><span class="hs-identifier hs-var hs-var">fds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDep Id -&gt; FunDep) -&gt; [FunDep Id] -&gt; [FunDep]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FunDep Id -&gt; FunDep
</span><a href="GHC.Tc.Gen.Splice.html#reifyFunDep"><span class="hs-identifier hs-var">reifyFunDep</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621682114818"><span class="hs-identifier hs-var">fds</span></a></span><span>
</span><span id="line-2319"></span><span>    </span><span id="local-6989586621682114810"><span class="annot"><span class="annottext">reify_op :: (Id, Maybe (a, DefMethSpec Type)) -&gt; TcM [Dec]
</span><a href="#local-6989586621682114810"><span class="hs-identifier hs-var hs-var">reify_op</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114826"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114826"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114827"><span class="annot"><span class="annottext">Maybe (a, DefMethSpec Type)
</span><a href="#local-6989586621682114827"><span class="hs-identifier hs-var">def_meth</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2320"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114828"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114828"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Id], Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitMethodTy"><span class="hs-identifier hs-var">tcSplitMethodTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114826"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2321"></span><span>               </span><span class="hs-comment">-- Use tcSplitMethodTy to get rid of the extraneous class</span><span>
</span><span id="line-2322"></span><span>               </span><span class="hs-comment">-- variables and predicates at the beginning of op's type</span><span>
</span><span id="line-2323"></span><span>               </span><span class="hs-comment">-- (see #15551).</span><span>
</span><span id="line-2324"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114830"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114830"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114828"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2325"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114831"><span class="annot"><span class="annottext">nm' :: Name
</span><a href="#local-6989586621682114831"><span class="hs-identifier hs-var hs-var">nm'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114826"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-2326"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (a, DefMethSpec Type)
</span><a href="#local-6989586621682114827"><span class="hs-identifier hs-var">def_meth</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2327"></span><span>                </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621682114833"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114833"><span class="hs-identifier hs-var">gdm_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2328"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114834"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114834"><span class="hs-identifier hs-var">gdm_ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114833"><span class="hs-identifier hs-var">gdm_ty</span></a></span><span>
</span><span id="line-2329"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; TcM [Dec]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SigD/Language.Haskell.TH.Syntax.html#SigD"><span class="hs-identifier hs-var">TH.SigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114831"><span class="hs-identifier hs-var">nm'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114830"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DefaultSigD/Language.Haskell.TH.Syntax.html#DefaultSigD"><span class="hs-identifier hs-var">TH.DefaultSigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114831"><span class="hs-identifier hs-var">nm'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114834"><span class="hs-identifier hs-var">gdm_ty'</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2330"></span><span>                </span><span class="annot"><span class="annottext">Maybe (a, DefMethSpec Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; TcM [Dec]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SigD/Language.Haskell.TH.Syntax.html#SigD"><span class="hs-identifier hs-var">TH.SigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114831"><span class="hs-identifier hs-var">nm'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114830"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2331"></span><span>
</span><span id="line-2332"></span><span>    </span><span class="annot"><a href="#local-6989586621682114807"><span class="hs-identifier hs-type">reifyAT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2333"></span><span>    </span><span id="local-6989586621682114807"><span class="annot"><span class="annottext">reifyAT :: ClassATItem -&gt; TcM [Dec]
</span><a href="#local-6989586621682114807"><span class="hs-identifier hs-var hs-var">reifyAT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#ATI"><span class="hs-identifier hs-type">ATI</span></a></span><span> </span><span id="local-6989586621682114838"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114838"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621682114839"><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621682114839"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2334"></span><span>      </span><span id="local-6989586621682114840"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621682114840"><span class="hs-identifier hs-var">tycon'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-var">reifyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114838"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-2335"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621682114840"><span class="hs-identifier hs-var">tycon'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2336"></span><span>        </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#FamilyI/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-type">TH.FamilyI</span></a></span><span> </span><span id="local-6989586621682114841"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621682114841"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2337"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114842"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114842"><span class="hs-identifier hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114843"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114843"><span class="hs-identifier hs-var">tyArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; (Name, [Name])
</span><a href="#local-6989586621682114844"><span class="hs-identifier hs-var">tfNames</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621682114841"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-2338"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621682114841"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; [Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; [Dec]) -&gt; TcM [Dec] -&gt; TcM [Dec]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcM [Dec]
-&gt; ((Type, ATValidityInfo) -&gt; TcM [Dec])
-&gt; Maybe (Type, ATValidityInfo)
-&gt; TcM [Dec]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec] -&gt; TcM [Dec]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2339"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dec -&gt; [Dec]) -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec -&gt; TcM [Dec]
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; [Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) Dec -&gt; TcM [Dec])
-&gt; ((Type, ATValidityInfo) -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; (Type, ATValidityInfo)
-&gt; TcM [Dec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="#local-6989586621682114846"><span class="hs-identifier hs-var">reifyDefImpl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114842"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114843"><span class="hs-identifier hs-var">tyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; ((Type, ATValidityInfo) -&gt; Type)
-&gt; (Type, ATValidityInfo)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, ATValidityInfo) -&gt; Type
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2340"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621682114839"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2341"></span><span>        </span><span class="annot"><span class="annottext">Info
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM [Dec]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyAT&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.3.0/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621682114840"><span class="hs-identifier hs-var">tycon'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2342"></span><span>
</span><span id="line-2343"></span><span>    </span><span class="annot"><a href="#local-6989586621682114846"><span class="hs-identifier hs-type">reifyDefImpl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span>
</span><span id="line-2344"></span><span>    </span><span id="local-6989586621682114846"><span class="annot"><span class="annottext">reifyDefImpl :: Name -&gt; [Name] -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="#local-6989586621682114846"><span class="hs-identifier hs-var hs-var">reifyDefImpl</span></a></span></span><span> </span><span id="local-6989586621682114847"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114847"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682114848"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114848"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682114849"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114849"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2345"></span><span>      </span><span class="annot"><span class="annottext">TySynEqn -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TySynInstD/Language.Haskell.TH.Syntax.html#TySynInstD"><span class="hs-identifier hs-var">TH.TySynInstD</span></a></span><span> </span><span class="annot"><span class="annottext">(TySynEqn -&gt; Dec) -&gt; (Type -&gt; TySynEqn) -&gt; Type -&gt; Dec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; Type -&gt; Type -&gt; TySynEqn
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TySynEqn/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-var">TH.TySynEqn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114847"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Type) -&gt; [Name] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#VarT/Language.Haskell.TH.Syntax.html#VarT"><span class="hs-identifier hs-var">TH.VarT</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682114848"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2346"></span><span>                                  </span><span class="annot"><span class="annottext">(Type -&gt; Dec) -&gt; TcM Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114849"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2347"></span><span>
</span><span id="line-2348"></span><span>    </span><span class="annot"><a href="#local-6989586621682114844"><span class="hs-identifier hs-type">tfNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2349"></span><span>    </span><span id="local-6989586621682114844"><span class="annot"><span class="annottext">tfNames :: Dec -&gt; (Name, [Name])
</span><a href="#local-6989586621682114844"><span class="hs-identifier hs-var hs-var">tfNames</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#OpenTypeFamilyD/Language.Haskell.TH.Syntax.html#OpenTypeFamilyD"><span class="hs-identifier hs-type">TH.OpenTypeFamilyD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TypeFamilyHead/Language.Haskell.TH.Syntax.html#TypeFamilyHead"><span class="hs-identifier hs-type">TH.TypeFamilyHead</span></a></span><span> </span><span id="local-6989586621682114851"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114851"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682114852"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114852"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2350"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114851"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TyVarBndr () -&gt; Name) -&gt; [TyVarBndr ()] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndr () -&gt; Name
forall flag. TyVarBndr flag -&gt; Name
</span><a href="#local-6989586621682114853"><span class="hs-identifier hs-var">bndrName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682114852"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2351"></span><span>    </span><span class="annot"><a href="#local-6989586621682114844"><span class="hs-identifier hs-var">tfNames</span></a></span><span> </span><span id="local-6989586621682114854"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621682114854"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; (Name, [Name])
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tfNames&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.3.0/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621682114854"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2352"></span><span>
</span><span id="line-2353"></span><span>    </span><span id="local-6989586621682112355"><span class="annot"><a href="#local-6989586621682114853"><span class="hs-identifier hs-type">bndrName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyVarBndr/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112355"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span></span><span>
</span><span id="line-2354"></span><span>    </span><span id="local-6989586621682114853"><span class="annot"><span class="annottext">bndrName :: forall flag. TyVarBndr flag -&gt; Name
</span><a href="#local-6989586621682114853"><span class="hs-identifier hs-var hs-var">bndrName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PlainTV/Language.Haskell.TH.Syntax.html#PlainTV"><span class="hs-identifier hs-type">TH.PlainTV</span></a></span><span> </span><span id="local-6989586621682114856"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114856"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">flag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114856"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2355"></span><span>    </span><span class="annot"><a href="#local-6989586621682114853"><span class="hs-identifier hs-var">bndrName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#KindedTV/Language.Haskell.TH.Syntax.html#KindedTV"><span class="hs-identifier hs-type">TH.KindedTV</span></a></span><span> </span><span id="local-6989586621682114857"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114857"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">flag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114857"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2356"></span><span>
</span><span id="line-2357"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2358"></span><span class="hs-comment">-- | Annotate (with TH.SigT) a type if the first parameter is True</span><span>
</span><span id="line-2359"></span><span class="hs-comment">-- and if the type contains a free variable.</span><span>
</span><span id="line-2360"></span><span class="hs-comment">-- This is used to annotate type patterns for poly-kinded tyvars in</span><span>
</span><span id="line-2361"></span><span class="hs-comment">-- reifying class and type instances.</span><span>
</span><span id="line-2362"></span><span class="hs-comment">-- See @Note [Reified instances and explicit kind signatures]@.</span><span>
</span><span id="line-2363"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-type">annotThType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- True &lt;=&gt; annotate</span><span>
</span><span id="line-2364"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">TyCoRep.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2365"></span><span>  </span><span class="hs-comment">-- tiny optimization: if the type is annotated, don't annotate again.</span><span>
</span><span id="line-2366"></span><span id="annotThType"><span class="annot"><span class="annottext">annotThType :: Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var hs-var">annotThType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span id="local-6989586621682114858"><span class="annot"><span class="annottext">th_ty :: Type
</span><a href="#local-6989586621682114858"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SigT/Language.Haskell.TH.Syntax.html#SigT"><span class="hs-identifier hs-type">TH.SigT</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114858"><span class="hs-identifier hs-var">th_ty</span></a></span><span>
</span><span id="line-2367"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621682114859"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114859"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682114860"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114860"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span>
</span><span id="line-2368"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; Bool) -&gt; VarSet -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#filterVarSet"><span class="hs-identifier hs-var">filterVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; VarSet) -&gt; VarSet -&gt; VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114859"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2369"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114864"><span class="annot"><span class="annottext">ki :: Type
</span><a href="#local-6989586621682114864"><span class="hs-identifier hs-var hs-var">ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114859"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2370"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114865"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114865"><span class="hs-identifier hs-var">th_ki</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114864"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-2371"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SigT/Language.Haskell.TH.Syntax.html#SigT"><span class="hs-identifier hs-var">TH.SigT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114860"><span class="hs-identifier hs-var">th_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114865"><span class="hs-identifier hs-var">th_ki</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2372"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682114866"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114866"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114866"><span class="hs-identifier hs-var">th_ty</span></a></span><span>
</span><span id="line-2373"></span><span>
</span><span id="line-2374"></span><span class="hs-comment">-- | For every argument type that a type constructor accepts,</span><span>
</span><span id="line-2375"></span><span class="hs-comment">-- report whether or not the argument is poly-kinded. This is used to</span><span>
</span><span id="line-2376"></span><span class="hs-comment">-- eventually feed into 'annotThType'.</span><span>
</span><span id="line-2377"></span><span class="hs-comment">-- See @Note [Reified instances and explicit kind signatures]@.</span><span>
</span><span id="line-2378"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-type">tyConArgsPolyKinded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span>
</span><span id="line-2379"></span><span id="tyConArgsPolyKinded"><span class="annot"><span class="annottext">tyConArgsPolyKinded :: TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var hs-var">tyConArgsPolyKinded</span></a></span></span><span> </span><span id="local-6989586621682114867"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114867"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2380"></span><span>     </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682114868"><span class="hs-identifier hs-var">is_poly_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Id -&gt; Type) -&gt; Id -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114870"><span class="hs-identifier hs-var">tc_vis_tvs</span></a></span><span>
</span><span id="line-2381"></span><span>     </span><span class="hs-comment">-- See &quot;Wrinkle: Oversaturated data family instances&quot; in</span><span>
</span><span id="line-2382"></span><span>     </span><span class="hs-comment">-- @Note [Reified instances and explicit kind signatures]@</span><span>
</span><span id="line-2383"></span><span>  </span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; [Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(PiTyBinder -&gt; Bool) -&gt; [PiTyBinder] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682114868"><span class="hs-identifier hs-var">is_poly_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (PiTyBinder -&gt; Type) -&gt; PiTyBinder -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyBinder -&gt; Type
</span><a href="GHC.Types.Var.html#piTyBinderType"><span class="hs-identifier hs-var">piTyBinderType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621682114872"><span class="hs-identifier hs-var">tc_res_kind_vis_bndrs</span></a></span><span> </span><span class="hs-comment">-- (1) in Wrinkle</span><span>
</span><span id="line-2384"></span><span>  </span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; [Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Bool]
forall a. a -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#repeat/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>                                             </span><span class="hs-comment">-- (2) in Wrinkle</span><span>
</span><span id="line-2385"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2386"></span><span>    </span><span class="annot"><a href="#local-6989586621682114868"><span class="hs-identifier hs-type">is_poly_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2387"></span><span>    </span><span id="local-6989586621682114868"><span class="annot"><span class="annottext">is_poly_ty :: Type -&gt; Bool
</span><a href="#local-6989586621682114868"><span class="hs-identifier hs-var hs-var">is_poly_ty</span></a></span></span><span> </span><span id="local-6989586621682114874"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114874"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2388"></span><span>                    </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; Bool) -&gt; VarSet -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2389"></span><span>                    </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#filterVarSet"><span class="hs-identifier hs-var">filterVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; VarSet) -&gt; VarSet -&gt; VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2390"></span><span>                    </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114874"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2391"></span><span>
</span><span id="line-2392"></span><span>    </span><span class="annot"><a href="#local-6989586621682114870"><span class="hs-identifier hs-type">tc_vis_tvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2393"></span><span>    </span><span id="local-6989586621682114870"><span class="annot"><span class="annottext">tc_vis_tvs :: [Id]
</span><a href="#local-6989586621682114870"><span class="hs-identifier hs-var hs-var">tc_vis_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114867"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2394"></span><span>
</span><span id="line-2395"></span><span>    </span><span class="annot"><a href="#local-6989586621682114872"><span class="hs-identifier hs-type">tc_res_kind_vis_bndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#PiTyBinder"><span class="hs-identifier hs-type">PiTyBinder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2396"></span><span>    </span><span id="local-6989586621682114872"><span class="annot"><span class="annottext">tc_res_kind_vis_bndrs :: [PiTyBinder]
</span><a href="#local-6989586621682114872"><span class="hs-identifier hs-var hs-var">tc_res_kind_vis_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PiTyBinder -&gt; Bool) -&gt; [PiTyBinder] -&gt; [PiTyBinder]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyBinder -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisiblePiTyBinder"><span class="hs-identifier hs-var">isVisiblePiTyBinder</span></a></span><span> </span><span class="annot"><span class="annottext">([PiTyBinder] -&gt; [PiTyBinder]) -&gt; [PiTyBinder] -&gt; [PiTyBinder]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([PiTyBinder], Type) -&gt; [PiTyBinder]
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(([PiTyBinder], Type) -&gt; [PiTyBinder])
-&gt; ([PiTyBinder], Type) -&gt; [PiTyBinder]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([PiTyBinder], Type)
</span><a href="GHC.Core.Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ([PiTyBinder], Type)) -&gt; Type -&gt; ([PiTyBinder], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114867"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2397"></span><span>
</span><span id="line-2398"></span><span class="hs-comment">{-
Note [Reified instances and explicit kind signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Reified class instances and type family instances often include extra kind
information to disambiguate instances. Here is one such example that
illustrates this (#8953):

    type family Poly (a :: k) :: Type
    type instance Poly (x :: Bool)    = Int
    type instance Poly (x :: Maybe k) = Double

If you're not careful, reifying these instances might yield this:

    type instance Poly x = Int
    type instance Poly x = Double

To avoid this, we go through some care to annotate things with extra kind
information. Some functions which accomplish this feat include:

* annotThType: This annotates a type with a kind signature if the type contains
  a free variable.
* tyConArgsPolyKinded: This checks every argument that a type constructor can
  accept and reports if the type of the argument is poly-kinded. This
  information is ultimately fed into annotThType.

-----
-- Wrinkle: Oversaturated data family instances
-----

What constitutes an argument to a type constructor in the definition of
tyConArgsPolyKinded? For most type constructors, it's simply the visible
type variable binders (i.e., tyConVisibleTyVars). There is one corner case
we must keep in mind, however: data family instances can appear oversaturated
(#17296). For instance:

    data family   Foo :: Type -&gt; Type
    data instance Foo x

    data family Bar :: k
    data family Bar x

For these sorts of data family instances, tyConVisibleTyVars isn't enough,
as they won't give you the kinds of the oversaturated arguments. We must
also consult:

1. The kinds of the arguments in the result kind (i.e., the tyConResKind).
   This will tell us, e.g., the kind of `x` in `Foo x` above.
2. If we go beyond the number of arguments in the result kind (like the
   `x` in `Bar x`), then we conservatively assume that the argument's
   kind is poly-kinded.

-----
-- Wrinkle: data family instances with return kinds
-----

Another squirrelly corner case is this:

    data family Foo (a :: k)
    data instance Foo :: Bool -&gt; Type
    data instance Foo :: Char -&gt; Type

If you're not careful, reifying these instances might yield this:

    data instance Foo
    data instance Foo

We can fix this ambiguity by reifying the instances' explicit return kinds. We
should only do this if necessary (see
Note [When does a tycon application need an explicit kind signature?] in GHC.Core.Type),
but more importantly, we *only* do this if either of the following are true:

1. The data family instance has no constructors.
2. The data family instance is declared with GADT syntax.

If neither of these are true, then reifying the return kind would yield
something like this:

    data instance (Bar a :: Type) = MkBar a

Which is not valid syntax.
-}</span><span>
</span><span id="line-2479"></span><span>
</span><span id="line-2480"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2481"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-type">reifyClassInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2482"></span><span id="reifyClassInstances"><span class="annot"><span class="annottext">reifyClassInstances :: Class -&gt; [ClsInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-var hs-var">reifyClassInstances</span></a></span></span><span> </span><span id="local-6989586621682114877"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114877"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682114878"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682114878"><span class="hs-identifier hs-var">insts</span></a></span></span><span>
</span><span id="line-2483"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; [ClsInst] -&gt; TcM [Dec]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; ClsInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstance"><span class="hs-identifier hs-var">reifyClassInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var">tyConArgsPolyKinded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114877"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682114878"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-2484"></span><span>
</span><span id="line-2485"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyClassInstance"><span class="hs-identifier hs-type">reifyClassInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- True &lt;=&gt; the corresponding tv is poly-kinded</span><span>
</span><span id="line-2486"></span><span>                              </span><span class="hs-comment">-- includes only *visible* tvs</span><span>
</span><span id="line-2487"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span>
</span><span id="line-2488"></span><span id="reifyClassInstance"><span class="annot"><span class="annottext">reifyClassInstance :: [Bool] -&gt; ClsInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstance"><span class="hs-identifier hs-var hs-var">reifyClassInstance</span></a></span></span><span> </span><span id="local-6989586621682114880"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682114880"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span></span><span> </span><span id="local-6989586621682114881"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682114881"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-2489"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114882"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114882"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114883"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-2490"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114884"><span class="annot"><span class="annottext">vis_types :: [Type]
</span><a href="#local-6989586621682114884"><span class="hs-identifier hs-var hs-var">vis_types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114885"><span class="hs-identifier hs-var">cls_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114886"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-2491"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114887"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114887"><span class="hs-identifier hs-var">thtypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114884"><span class="hs-identifier hs-var">vis_types</span></a></span><span>
</span><span id="line-2492"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114888"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114888"><span class="hs-identifier hs-var">annot_thtypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682114880"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114884"><span class="hs-identifier hs-var">vis_types</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114887"><span class="hs-identifier hs-var">thtypes</span></a></span><span>
</span><span id="line-2493"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114889"><span class="annot"><span class="annottext">head_ty :: Type
</span><a href="#local-6989586621682114889"><span class="hs-identifier hs-var hs-var">head_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114890"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114888"><span class="hs-identifier hs-var">annot_thtypes</span></a></span><span>
</span><span id="line-2494"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Overlap -&gt; [Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InstanceD/Language.Haskell.TH.Syntax.html#InstanceD"><span class="hs-identifier hs-var">TH.InstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
</span><a href="#local-6989586621682114892"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114882"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114889"><span class="hs-identifier hs-var">head_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2495"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2496"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621682114893"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114893"><span class="hs-identifier hs-var">_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114883"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114883"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114890"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114890"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114886"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114886"><span class="hs-identifier hs-var">types</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Id], [Type], Class, [Type])
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitDFunTy"><span class="hs-identifier hs-var">tcSplitDFunTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114895"><span class="hs-identifier hs-var">dfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2497"></span><span>     </span><span id="local-6989586621682114885"><span class="annot"><span class="annottext">cls_tc :: TyCon
</span><a href="#local-6989586621682114885"><span class="hs-identifier hs-var hs-var">cls_tc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682114890"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-2498"></span><span>     </span><span id="local-6989586621682114895"><span class="annot"><span class="annottext">dfun :: Id
</span><a href="#local-6989586621682114895"><span class="hs-identifier hs-var hs-var">dfun</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682114881"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2499"></span><span>     </span><span id="local-6989586621682114892"><span class="annot"><span class="annottext">over :: Maybe Overlap
</span><a href="#local-6989586621682114892"><span class="hs-identifier hs-var hs-var">over</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OverlapFlag -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var">overlapMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682114881"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2500"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#NoOverlap"><span class="hs-identifier hs-type">NoOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2501"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Overlappable"><span class="hs-identifier hs-type">Overlappable</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Overlappable/Language.Haskell.TH.Syntax.html#Overlappable"><span class="hs-identifier hs-var">TH.Overlappable</span></a></span><span>
</span><span id="line-2502"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Overlapping"><span class="hs-identifier hs-type">Overlapping</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Overlapping/Language.Haskell.TH.Syntax.html#Overlapping"><span class="hs-identifier hs-var">TH.Overlapping</span></a></span><span>
</span><span id="line-2503"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Overlaps"><span class="hs-identifier hs-type">Overlaps</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Overlaps/Language.Haskell.TH.Syntax.html#Overlaps"><span class="hs-identifier hs-var">TH.Overlaps</span></a></span><span>
</span><span id="line-2504"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Incoherent"><span class="hs-identifier hs-type">Incoherent</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Incoherent/Language.Haskell.TH.Syntax.html#Incoherent"><span class="hs-identifier hs-var">TH.Incoherent</span></a></span><span>
</span><span id="line-2505"></span><span>
</span><span id="line-2506"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2507"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-type">reifyFamilyInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2508"></span><span id="reifyFamilyInstances"><span class="annot"><span class="annottext">reifyFamilyInstances :: TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var hs-var">reifyFamilyInstances</span></a></span></span><span> </span><span id="local-6989586621682114904"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114904"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621682114905"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621682114905"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span>
</span><span id="line-2509"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FamInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; [FamInst] -&gt; TcM [Dec]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; FamInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstance"><span class="hs-identifier hs-var">reifyFamilyInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var">tyConArgsPolyKinded</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114904"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621682114905"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-2510"></span><span>
</span><span id="line-2511"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstance"><span class="hs-identifier hs-type">reifyFamilyInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- True &lt;=&gt; the corresponding tv is poly-kinded</span><span>
</span><span id="line-2512"></span><span>                              </span><span class="hs-comment">-- includes only *visible* tvs</span><span>
</span><span id="line-2513"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Dec/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span>
</span><span id="line-2514"></span><span id="reifyFamilyInstance"><span class="annot"><span class="annottext">reifyFamilyInstance :: [Bool] -&gt; FamInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstance"><span class="hs-identifier hs-var hs-var">reifyFamilyInstance</span></a></span></span><span> </span><span id="local-6989586621682114907"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682114907"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fi_flavor :: FamInst -&gt; FamFlavor
</span><a href="GHC.Core.FamInstEnv.html#fi_flavor"><span class="hs-identifier hs-var">fi_flavor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114910"><span class="annot"><span class="annottext">FamFlavor
</span><a href="#local-6989586621682114910"><span class="hs-identifier hs-var">flavor</span></a></span></span><span>
</span><span id="line-2515"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fi_axiom :: FamInst -&gt; CoAxiom Unbranched
</span><a href="GHC.Core.FamInstEnv.html#fi_axiom"><span class="hs-identifier hs-var">fi_axiom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114912"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682114912"><span class="hs-identifier hs-var">ax</span></a></span></span><span>
</span><span id="line-2516"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fi_fam :: FamInst -&gt; Name
</span><a href="GHC.Core.FamInstEnv.html#fi_fam"><span class="hs-identifier hs-var">fi_fam</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114914"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114914"><span class="hs-identifier hs-var">fam</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2517"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114915"><span class="annot"><span class="annottext">fam_tc :: TyCon
</span><a href="#local-6989586621682114915"><span class="hs-identifier hs-var hs-var">fam_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; TyCon
forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682114912"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2518"></span><span>        </span><span id="local-6989586621682114917"><span class="annot"><span class="annottext">branch :: CoAxBranch
</span><a href="#local-6989586621682114917"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomSingleBranch"><span class="hs-identifier hs-var">coAxiomSingleBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682114912"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2519"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114919"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114919"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114920"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114920"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114921"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114921"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682114917"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-2520"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamFlavor
</span><a href="#local-6989586621682114910"><span class="hs-identifier hs-var">flavor</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2521"></span><span>      </span><span class="annot"><span class="annottext">FamFlavor
</span><a href="GHC.Core.FamInstEnv.html#SynFamilyInst"><span class="hs-identifier hs-var">SynFamilyInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2522"></span><span>               </span><span class="hs-comment">-- remove kind patterns (#8884)</span><span>
</span><span id="line-2523"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114923"><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621682114923"><span class="hs-identifier hs-var">th_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114919"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-2524"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114924"><span class="annot"><span class="annottext">lhs_types_only :: [Type]
</span><a href="#local-6989586621682114924"><span class="hs-identifier hs-var hs-var">lhs_types_only</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114915"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114920"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2525"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114925"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114925"><span class="hs-identifier hs-var">th_lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114924"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span>
</span><span id="line-2526"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114926"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114926"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682114907"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114924"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span>
</span><span id="line-2527"></span><span>                                                   </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114925"><span class="hs-identifier hs-var">th_lhs</span></a></span><span>
</span><span id="line-2528"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114927"><span class="annot"><span class="annottext">lhs_type :: Type
</span><a href="#local-6989586621682114927"><span class="hs-identifier hs-var hs-var">lhs_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type) -&gt; Name -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114914"><span class="hs-identifier hs-var">fam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114926"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span><span>
</span><span id="line-2529"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114928"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114928"><span class="hs-identifier hs-var">th_rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114921"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2530"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySynEqn -&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TySynInstD/Language.Haskell.TH.Syntax.html#TySynInstD"><span class="hs-identifier hs-var">TH.TySynInstD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; Type -&gt; Type -&gt; TySynEqn
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TySynEqn/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-var">TH.TySynEqn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621682114923"><span class="hs-identifier hs-var">th_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114927"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114928"><span class="hs-identifier hs-var">th_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2531"></span><span>
</span><span id="line-2532"></span><span>      </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#DataFamilyInst"><span class="hs-identifier hs-type">DataFamilyInst</span></a></span><span> </span><span id="local-6989586621682114930"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114930"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2533"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- eta-expand lhs types, because sometimes data/newtype</span><span>
</span><span id="line-2534"></span><span>                 </span><span class="hs-comment">-- instances are eta-reduced; See #9692</span><span>
</span><span id="line-2535"></span><span>                 </span><span class="hs-comment">-- See Note [Eta reduction for data families] in GHC.Core.Coercion.Axiom</span><span>
</span><span id="line-2536"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621682114931"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114931"><span class="hs-identifier hs-var">ee_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114932"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114932"><span class="hs-identifier hs-var">ee_lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; ([Id], [Type], Type)
</span><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-var">etaExpandCoAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682114917"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-2537"></span><span>                 </span><span id="local-6989586621682114933"><span class="annot"><span class="annottext">fam' :: Name
</span><a href="#local-6989586621682114933"><span class="hs-identifier hs-var hs-var">fam'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114914"><span class="hs-identifier hs-var">fam</span></a></span><span>
</span><span id="line-2538"></span><span>                 </span><span id="local-6989586621682114934"><span class="annot"><span class="annottext">dataCons :: [DataCon]
</span><a href="#local-6989586621682114934"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114930"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2539"></span><span>                 </span><span id="local-6989586621682114935"><span class="annot"><span class="annottext">isGadt :: Bool
</span><a href="#local-6989586621682114935"><span class="hs-identifier hs-var hs-var">isGadt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGadtSyntaxTyCon"><span class="hs-identifier hs-var">isGadtSyntaxTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114930"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2540"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114936"><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621682114936"><span class="hs-identifier hs-var">th_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114931"><span class="hs-identifier hs-var">ee_tvs</span></a></span><span>
</span><span id="line-2541"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114937"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114937"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; [DataCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Con]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [Type] -&gt; DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-var">reifyDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682114935"><span class="hs-identifier hs-var">isGadt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682114931"><span class="hs-identifier hs-var">ee_tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682114934"><span class="hs-identifier hs-var">dataCons</span></a></span><span>
</span><span id="line-2542"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114938"><span class="annot"><span class="annottext">types_only :: [Type]
</span><a href="#local-6989586621682114938"><span class="hs-identifier hs-var hs-var">types_only</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114915"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114932"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span>
</span><span id="line-2543"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114939"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114939"><span class="hs-identifier hs-var">th_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114938"><span class="hs-identifier hs-var">types_only</span></a></span><span>
</span><span id="line-2544"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114940"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114940"><span class="hs-identifier hs-var">annot_th_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682114907"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114938"><span class="hs-identifier hs-var">types_only</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114939"><span class="hs-identifier hs-var">th_tys</span></a></span><span>
</span><span id="line-2545"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114941"><span class="annot"><span class="annottext">lhs_type :: Type
</span><a href="#local-6989586621682114941"><span class="hs-identifier hs-var hs-var">lhs_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682114933"><span class="hs-identifier hs-var">fam'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114940"><span class="hs-identifier hs-var">annot_th_tys</span></a></span><span>
</span><span id="line-2546"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114942"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682114942"><span class="hs-identifier hs-var">mb_sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2547"></span><span>               </span><span class="hs-comment">-- See &quot;Wrinkle: data family instances with return kinds&quot; in</span><span>
</span><span id="line-2548"></span><span>               </span><span class="hs-comment">-- Note [Reified instances and explicit kind signatures]</span><span>
</span><span id="line-2549"></span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Con] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114937"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGadtSyntaxTyCon"><span class="hs-identifier hs-var">isGadtSyntaxTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114930"><span class="hs-identifier hs-var">rep_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2550"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TyCon -&gt; SumArity -&gt; Bool
</span><a href="GHC.Core.Type.html#tyConAppNeedsKindSig"><span class="hs-identifier hs-var">tyConAppNeedsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114915"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; SumArity
forall a. [a] -&gt; SumArity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; SumArity
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114932"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2551"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682114944"><span class="annot"><span class="annottext">full_kind :: Type
</span><a href="#local-6989586621682114944"><span class="hs-identifier hs-var hs-var">full_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114915"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114932"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2552"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682114945"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114945"><span class="hs-identifier hs-var">th_full_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114944"><span class="hs-identifier hs-var">full_kind</span></a></span><span>
</span><span id="line-2553"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type))
-&gt; Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114945"><span class="hs-identifier hs-var">th_full_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2554"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2555"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2556"></span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114930"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2557"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NewtypeInstD/Language.Haskell.TH.Syntax.html#NewtypeInstD"><span class="hs-identifier hs-var">TH.NewtypeInstD</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621682114936"><span class="hs-identifier hs-var">th_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114941"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682114942"><span class="hs-identifier hs-var">mb_sig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Con] -&gt; Con
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114937"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2558"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DataInstD/Language.Haskell.TH.Syntax.html#DataInstD"><span class="hs-identifier hs-var">TH.DataInstD</span></a></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621682114936"><span class="hs-identifier hs-var">th_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114941"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682114942"><span class="hs-identifier hs-var">mb_sig</span></a></span><span>       </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621682114937"><span class="hs-identifier hs-var">cons</span></a></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2559"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-2560"></span><span>
</span><span id="line-2561"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2562"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-type">reifyType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">TyCoRep.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2563"></span><span class="hs-comment">-- Monadic only because of failure</span><span>
</span><span id="line-2564"></span><span id="reifyType"><span class="annot"><span class="annottext">reifyType :: Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var hs-var">reifyType</span></a></span></span><span> </span><span id="local-6989586621682114948"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114948"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#tcIsLiftedTypeKind"><span class="hs-identifier hs-var">tcIsLiftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114948"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#StarT/Language.Haskell.TH.Syntax.html#StarT"><span class="hs-identifier hs-var">TH.StarT</span></a></span><span>
</span><span id="line-2565"></span><span>  </span><span class="hs-comment">-- Make sure to use tcIsLiftedTypeKind here, since we don't want to confuse it</span><span>
</span><span id="line-2566"></span><span>  </span><span class="hs-comment">-- with Constraint (#14869).</span><span>
</span><span id="line-2567"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621682114950"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682114950"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682114952"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682114952"><span class="hs-identifier hs-var">argf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2568"></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-var">reify_for_all</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682114952"><span class="hs-identifier hs-var">argf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114950"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2569"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621682114955"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682114955"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682114956"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682114956"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TcM TyLit
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-var">reifyTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682114955"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyLit -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#LitT/Language.Haskell.TH.Syntax.html#LitT"><span class="hs-identifier hs-var">TH.LitT</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682114956"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2570"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682114959"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114959"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#VarT/Language.Haskell.TH.Syntax.html#VarT"><span class="hs-identifier hs-var">TH.VarT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682114959"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2571"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682114961"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114961"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682114962"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114962"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_tc_app"><span class="hs-identifier hs-var">reify_tc_app</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682114961"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114962"><span class="hs-identifier hs-var">tys</span></a></span><span>   </span><span class="hs-comment">-- Do not expand type synonyms here</span><span>
</span><span id="line-2572"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621682114964"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682114964"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2573"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682114966"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114966"><span class="hs-identifier hs-var">ty_head</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682114967"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114967"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, [Type])
</span><a href="GHC.Core.Type.html#splitAppTys"><span class="hs-identifier hs-var">splitAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114964"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2574"></span><span>  </span><span id="local-6989586621682114969"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114969"><span class="hs-identifier hs-var">ty_head'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114966"><span class="hs-identifier hs-var">ty_head</span></a></span><span>
</span><span id="line-2575"></span><span>  </span><span id="local-6989586621682114970"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114970"><span class="hs-identifier hs-var">ty_args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
</span><a href="#local-6989586621682114971"><span class="hs-identifier hs-var">filter_out_invisible_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114966"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114967"><span class="hs-identifier hs-var">ty_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2576"></span><span>  </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114969"><span class="hs-identifier hs-var">ty_head'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114970"><span class="hs-identifier hs-var">ty_args'</span></a></span><span>
</span><span id="line-2577"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2578"></span><span>    </span><span class="hs-comment">-- Make sure to filter out any invisible arguments. For instance, if you</span><span>
</span><span id="line-2579"></span><span>    </span><span class="hs-comment">-- reify the following:</span><span>
</span><span id="line-2580"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2581"></span><span>    </span><span class="hs-comment">--   newtype T (f :: forall a. a -&gt; Type) = MkT (f Bool)</span><span>
</span><span id="line-2582"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2583"></span><span>    </span><span class="hs-comment">-- Then you should receive back `f Bool`, not `f Type Bool`, since the</span><span>
</span><span id="line-2584"></span><span>    </span><span class="hs-comment">-- `Type` argument is invisible (#15792).</span><span>
</span><span id="line-2585"></span><span>    </span><span class="annot"><a href="#local-6989586621682114971"><span class="hs-identifier hs-type">filter_out_invisible_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2586"></span><span>    </span><span id="local-6989586621682114971"><span class="annot"><span class="annottext">filter_out_invisible_args :: Type -&gt; [Type] -&gt; [Type]
</span><a href="#local-6989586621682114971"><span class="hs-identifier hs-var hs-var">filter_out_invisible_args</span></a></span></span><span> </span><span id="local-6989586621682114972"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114972"><span class="hs-identifier hs-var">ty_head</span></a></span></span><span> </span><span id="local-6989586621682114973"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114973"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2587"></span><span>      </span><span class="annot"><span class="annottext">[Bool] -&gt; [Type] -&gt; [Type]
forall a. [Bool] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForAllTyFlag -&gt; Bool) -&gt; [ForAllTyFlag] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisibleForAllTyFlag"><span class="hs-identifier hs-var">isVisibleForAllTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">([ForAllTyFlag] -&gt; [Bool]) -&gt; [ForAllTyFlag] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [ForAllTyFlag]
</span><a href="GHC.Core.Type.html#appTyForAllTyFlags"><span class="hs-identifier hs-var">appTyForAllTyFlags</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114972"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114973"><span class="hs-identifier hs-var">ty_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2588"></span><span>                   </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682114973"><span class="hs-identifier hs-var">ty_args</span></a></span><span>
</span><span id="line-2589"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621682114976"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682114976"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114979"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682114979"><span class="hs-identifier hs-var">af</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114982"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114982"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114984"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114984"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2590"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isInvisibleFunArg"><span class="hs-identifier hs-var">isInvisibleFunArg</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682114979"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-var">reify_for_all</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="GHC.Types.Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114976"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-comment">-- Types like ((?x::Int) =&gt; Char -&gt; Char)</span><span>
</span><span id="line-2591"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682114987"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114987"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682114988"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114988"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114982"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114984"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2592"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ArrowT/Language.Haskell.TH.Syntax.html#ArrowT"><span class="hs-identifier hs-var">TH.ArrowT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114987"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114988"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2593"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621682114989"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682114989"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114990"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682114990"><span class="hs-identifier hs-var">af</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114991"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114991"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114992"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114992"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682114993"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114993"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2594"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isInvisibleFunArg"><span class="hs-identifier hs-var">isInvisibleFunArg</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682114990"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnrepresentableTypeDescr -&gt; Type -&gt; TcM Type
forall a. UnrepresentableTypeDescr -&gt; Type -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-var">noTH</span></a></span><span> </span><span class="annot"><span class="annottext">UnrepresentableTypeDescr
</span><a href="GHC.Tc.Errors.Types.html#LinearInvisibleArgument"><span class="hs-identifier hs-var">LinearInvisibleArgument</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114989"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2595"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682114996"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114996"><span class="hs-identifier hs-var">rm</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682114997"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114997"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682114998"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114998"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114991"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114992"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114993"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2596"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#MulArrowT/Language.Haskell.TH.Syntax.html#MulArrowT"><span class="hs-identifier hs-var">TH.MulArrowT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114996"><span class="hs-identifier hs-var">rm</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114997"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682114998"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2597"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682115000"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115000"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115000"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- Casts are ignored in TH</span><span>
</span><span id="line-2598"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621682115001"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682115001"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnrepresentableTypeDescr -&gt; Type -&gt; TcM Type
forall a. UnrepresentableTypeDescr -&gt; Type -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-var">noTH</span></a></span><span> </span><span class="annot"><span class="annottext">UnrepresentableTypeDescr
</span><a href="GHC.Tc.Errors.Types.html#CoercionsInTypes"><span class="hs-identifier hs-var">CoercionsInTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115001"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2599"></span><span>
</span><span id="line-2600"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-type">reify_for_all</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#ForAllTyFlag"><span class="hs-identifier hs-type">TyCoRep.ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">TyCoRep.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2601"></span><span class="hs-comment">-- Arg of reify_for_all is always ForAllTy or a predicate FunTy</span><span>
</span><span id="line-2602"></span><span id="reify_for_all"><span class="annot"><span class="annottext">reify_for_all :: ForAllTyFlag -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-var hs-var">reify_for_all</span></a></span></span><span> </span><span id="local-6989586621682115004"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682115004"><span class="hs-identifier hs-var">argf</span></a></span></span><span> </span><span id="local-6989586621682115005"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115005"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2603"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisibleForAllTyFlag"><span class="hs-identifier hs-var">isVisibleForAllTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682115004"><span class="hs-identifier hs-var">argf</span></a></span><span>
</span><span id="line-2604"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682115006"><span class="annot"><span class="annottext">[TcReqTVBinder]
</span><a href="#local-6989586621682115006"><span class="hs-identifier hs-var">req_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115007"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115007"><span class="hs-identifier hs-var">phi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TcReqTVBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllReqTVBinders"><span class="hs-identifier hs-var">tcSplitForAllReqTVBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115005"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2605"></span><span>       </span><span id="local-6989586621682115009"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682115009"><span class="hs-identifier hs-var">tvbndrs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcReqTVBinder] -&gt; TcM [TyVarBndr ()]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcReqTVBinder]
</span><a href="#local-6989586621682115006"><span class="hs-identifier hs-var">req_bndrs</span></a></span><span>
</span><span id="line-2606"></span><span>       </span><span id="local-6989586621682115010"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115010"><span class="hs-identifier hs-var">phi'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115007"><span class="hs-identifier hs-var">phi</span></a></span><span>
</span><span id="line-2607"></span><span>       </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()] -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ForallVisT/Language.Haskell.TH.Syntax.html#ForallVisT"><span class="hs-identifier hs-var">TH.ForallVisT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621682115009"><span class="hs-identifier hs-var">tvbndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115010"><span class="hs-identifier hs-var">phi'</span></a></span><span>
</span><span id="line-2608"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2609"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682115011"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682115011"><span class="hs-identifier hs-var">inv_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115012"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115012"><span class="hs-identifier hs-var">phi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([InvisTVBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllInvisTVBinders"><span class="hs-identifier hs-var">tcSplitForAllInvisTVBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115005"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2610"></span><span>       </span><span id="local-6989586621682115014"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682115014"><span class="hs-identifier hs-var">tvbndrs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682115011"><span class="hs-identifier hs-var">inv_bndrs</span></a></span><span>
</span><span id="line-2611"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682115015"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115015"><span class="hs-identifier hs-var">cxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115016"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115016"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115012"><span class="hs-identifier hs-var">phi</span></a></span><span>
</span><span id="line-2612"></span><span>       </span><span id="local-6989586621682115018"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115018"><span class="hs-identifier hs-var">cxt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115015"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-2613"></span><span>       </span><span id="local-6989586621682115019"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115019"><span class="hs-identifier hs-var">tau'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115016"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-2614"></span><span>       </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ForallT/Language.Haskell.TH.Syntax.html#ForallT"><span class="hs-identifier hs-var">TH.ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682115014"><span class="hs-identifier hs-var">tvbndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115018"><span class="hs-identifier hs-var">cxt'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115019"><span class="hs-identifier hs-var">tau'</span></a></span><span>
</span><span id="line-2615"></span><span>
</span><span id="line-2616"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-type">reifyTyLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyLit"><span class="hs-identifier hs-type">TyCoRep.TyLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyLit/Language.Haskell.TH.Syntax.html#TyLit"><span class="hs-identifier hs-type">TH.TyLit</span></a></span><span>
</span><span id="line-2617"></span><span id="reifyTyLit"><span class="annot"><span class="annottext">reifyTyLit :: TyLit -&gt; TcM TyLit
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-var hs-var">reifyTyLit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NumTyLit"><span class="hs-identifier hs-type">NumTyLit</span></a></span><span> </span><span id="local-6989586621682115021"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682115021"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TcM TyLit
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; TyLit
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NumTyLit/Language.Haskell.TH.Syntax.html#NumTyLit"><span class="hs-identifier hs-var">TH.NumTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682115021"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2618"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-var">reifyTyLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#StrTyLit"><span class="hs-identifier hs-type">StrTyLit</span></a></span><span> </span><span id="local-6989586621682115024"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682115024"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TcM TyLit
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TyLit
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#StrTyLit/Language.Haskell.TH.Syntax.html#StrTyLit"><span class="hs-identifier hs-var">TH.StrTyLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682115024"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2619"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-var">reifyTyLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CharTyLit"><span class="hs-identifier hs-type">CharTyLit</span></a></span><span> </span><span id="local-6989586621682115027"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682115027"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TcM TyLit
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; TyLit
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#CharTyLit/Language.Haskell.TH.Syntax.html#CharTyLit"><span class="hs-identifier hs-var">TH.CharTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682115027"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2620"></span><span>
</span><span id="line-2621"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-type">reifyTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2622"></span><span id="reifyTypes"><span class="annot"><span class="annottext">reifyTypes :: [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var hs-var">reifyTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; [Type] -&gt; TcM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2623"></span><span>
</span><span id="line-2624"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-type">reifyPatSynType</span></a></span><span>
</span><span id="line-2625"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2626"></span><span class="hs-comment">-- reifies a pattern synonym's type and returns its *complete* type</span><span>
</span><span id="line-2627"></span><span class="hs-comment">-- signature; see Note [Pattern synonym type signatures and Template</span><span>
</span><span id="line-2628"></span><span class="hs-comment">-- Haskell] in GHC.ThToHs</span><span>
</span><span id="line-2629"></span><span id="reifyPatSynType"><span class="annot"><span class="annottext">reifyPatSynType :: ([InvisTVBinder], [Type], [InvisTVBinder], [Type], [Scaled Type],
 Type)
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-var hs-var">reifyPatSynType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682115030"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682115030"><span class="hs-identifier hs-var">univTyVars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115031"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115031"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115032"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682115032"><span class="hs-identifier hs-var">exTyVars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115033"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115033"><span class="hs-identifier hs-var">prov</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115034"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682115034"><span class="hs-identifier hs-var">argTys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115035"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115035"><span class="hs-identifier hs-var">resTy</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2630"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682115036"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682115036"><span class="hs-identifier hs-var">univTyVars'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682115030"><span class="hs-identifier hs-var">univTyVars</span></a></span><span>
</span><span id="line-2631"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115037"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115037"><span class="hs-identifier hs-var">req'</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115031"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-2632"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115038"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682115038"><span class="hs-identifier hs-var">exTyVars'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682115032"><span class="hs-identifier hs-var">exTyVars</span></a></span><span>
</span><span id="line-2633"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115039"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115039"><span class="hs-identifier hs-var">prov'</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115033"><span class="hs-identifier hs-var">prov</span></a></span><span>
</span><span id="line-2634"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115040"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115040"><span class="hs-identifier hs-var">tau'</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Type -&gt; Type
(() :: Constraint) =&gt; [Scaled Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkScaledFunTys"><span class="hs-identifier hs-var">mkScaledFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682115034"><span class="hs-identifier hs-var">argTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115035"><span class="hs-identifier hs-var">resTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2635"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ForallT/Language.Haskell.TH.Syntax.html#ForallT"><span class="hs-identifier hs-var">TH.ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682115036"><span class="hs-identifier hs-var">univTyVars'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115037"><span class="hs-identifier hs-var">req'</span></a></span><span>
</span><span id="line-2636"></span><span>                </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ForallT/Language.Haskell.TH.Syntax.html#ForallT"><span class="hs-identifier hs-var">TH.ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621682115038"><span class="hs-identifier hs-var">exTyVars'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115039"><span class="hs-identifier hs-var">prov'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115040"><span class="hs-identifier hs-var">tau'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2637"></span><span>
</span><span id="line-2638"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-type">reifyKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Kind/Language.Haskell.TH.Syntax.html#Kind"><span class="hs-identifier hs-type">TH.Kind</span></a></span><span>
</span><span id="line-2639"></span><span id="reifyKind"><span class="annot"><span class="annottext">reifyKind :: Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var hs-var">reifyKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2640"></span><span>
</span><span id="line-2641"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-type">reifyCxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Pred/Language.Haskell.TH.Syntax.html#Pred"><span class="hs-identifier hs-type">TH.Pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2642"></span><span id="reifyCxt"><span class="annot"><span class="annottext">reifyCxt :: [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var hs-var">reifyCxt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; [Type] -&gt; TcM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2643"></span><span>
</span><span id="line-2644"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFunDep"><span class="hs-identifier hs-type">reifyFunDep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#FunDep/Language.Haskell.TH.Syntax.html#FunDep"><span class="hs-identifier hs-type">TH.FunDep</span></a></span><span>
</span><span id="line-2645"></span><span id="reifyFunDep"><span class="annot"><span class="annottext">reifyFunDep :: FunDep Id -&gt; FunDep
</span><a href="GHC.Tc.Gen.Splice.html#reifyFunDep"><span class="hs-identifier hs-var hs-var">reifyFunDep</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682115044"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682115044"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115045"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682115045"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; FunDep
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#FunDep/Language.Haskell.TH.Syntax.html#FunDep"><span class="hs-identifier hs-var">TH.FunDep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682115044"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682115045"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2646"></span><span>
</span><span id="line-2647"></span><span class="hs-keyword">class</span><span> </span><span id="ReifyFlag"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-var">ReifyFlag</span></a></span></span><span> </span><span id="local-6989586621682112372"><span class="annot"><a href="#local-6989586621682112372"><span class="hs-identifier hs-type">flag</span></a></span></span><span> </span><span id="local-6989586621682112373"><span class="annot"><a href="#local-6989586621682112373"><span class="hs-identifier hs-type">flag'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621682112372"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682112373"><span class="hs-identifier hs-type">flag'</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2648"></span><span>    </span><span id="reifyFlag"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-type">reifyFlag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682112372"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682112373"><span class="hs-identifier hs-type">flag'</span></a></span><span>
</span><span id="line-2649"></span><span>
</span><span id="line-2650"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-type">ReifyFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2651"></span><span>    </span><span id="local-6989586621682115050"><span class="annot"><span class="annottext">reifyFlag :: () -&gt; ()
</span><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-var hs-var hs-var hs-var">reifyFlag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2652"></span><span>
</span><span id="line-2653"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-type">ReifyFlag</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Specificity"><span class="hs-identifier hs-type">Specificity</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Specificity/Language.Haskell.TH.Syntax.html#Specificity"><span class="hs-identifier hs-type">TH.Specificity</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2654"></span><span>    </span><span id="local-6989586621682115052"><span class="annot"><span class="annottext">reifyFlag :: Specificity -&gt; Specificity
</span><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-var hs-var hs-var hs-var">reifyFlag</span></a></span></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SpecifiedSpec/Language.Haskell.TH.Syntax.html#SpecifiedSpec"><span class="hs-identifier hs-var">TH.SpecifiedSpec</span></a></span><span>
</span><span id="line-2655"></span><span>    </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-var">reifyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#InferredSpec"><span class="hs-identifier hs-var">InferredSpec</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InferredSpec/Language.Haskell.TH.Syntax.html#InferredSpec"><span class="hs-identifier hs-var">TH.InferredSpec</span></a></span><span>
</span><span id="line-2656"></span><span>
</span><span id="line-2657"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-type">reifyTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyVarBndr/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2658"></span><span id="reifyTyVars"><span class="annot"><span class="annottext">reifyTyVars :: [Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var hs-var">reifyTyVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcReqTVBinder] -&gt; TcM [TyVarBndr ()]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">([TcReqTVBinder] -&gt; TcM [TyVarBndr ()])
-&gt; ([Id] -&gt; [TcReqTVBinder]) -&gt; [Id] -&gt; TcM [TyVarBndr ()]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; TcReqTVBinder) -&gt; [Id] -&gt; [TcReqTVBinder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcReqTVBinder
forall {var}. var -&gt; VarBndr var ()
</span><a href="#local-6989586621682115056"><span class="hs-identifier hs-var">mk_bndr</span></a></span><span>
</span><span id="line-2659"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2660"></span><span>    </span><span id="local-6989586621682115056"><span class="annot"><span class="annottext">mk_bndr :: var -&gt; VarBndr var ()
</span><a href="#local-6989586621682115056"><span class="hs-identifier hs-var hs-var">mk_bndr</span></a></span></span><span> </span><span id="local-6989586621682115057"><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621682115057"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">var -&gt; () -&gt; VarBndr var ()
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621682115057"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2661"></span><span>
</span><span id="line-2662"></span><span id="local-6989586621682112334"><span id="local-6989586621682112335"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-type">reifyTyVarBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-type">ReifyFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112334"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112335"><span class="hs-identifier hs-type">flag'</span></a></span><span>
</span><span id="line-2663"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112334"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyVarBndr/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112335"><span class="hs-identifier hs-type">flag'</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-2664"></span><span id="reifyTyVarBndrs"><span class="annot"><span class="annottext">reifyTyVarBndrs :: forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var hs-var">reifyTyVarBndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarBndr Id flag
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag'))
-&gt; [VarBndr Id flag]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyVarBndr flag']
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr Id flag -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag')
forall {flag} {flag}.
ReifyFlag flag flag =&gt;
VarBndr Id flag -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag)
</span><a href="#local-6989586621682115062"><span class="hs-identifier hs-var">reify_tvbndr</span></a></span><span>
</span><span id="line-2665"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2666"></span><span>    </span><span class="hs-comment">-- even if the kind is *, we need to include a kind annotation,</span><span>
</span><span id="line-2667"></span><span>    </span><span class="hs-comment">-- in case a poly-kind would be inferred without the annotation.</span><span>
</span><span id="line-2668"></span><span>    </span><span class="hs-comment">-- See #8953 or test th/T8953</span><span>
</span><span id="line-2669"></span><span>    </span><span id="local-6989586621682115062"><span class="annot"><span class="annottext">reify_tvbndr :: VarBndr Id flag -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag)
</span><a href="#local-6989586621682115062"><span class="hs-identifier hs-var hs-var">reify_tvbndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682115067"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115067"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682115068"><span class="annot"><span class="annottext">flag
</span><a href="#local-6989586621682115068"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; flag -&gt; Type -&gt; TyVarBndr flag
forall flag. Name -&gt; flag -&gt; Type -&gt; TyVarBndr flag
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#KindedTV/Language.Haskell.TH.Syntax.html#KindedTV"><span class="hs-identifier hs-var">TH.KindedTV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115067"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2670"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">flag -&gt; flag
forall flag flag'. ReifyFlag flag flag' =&gt; flag -&gt; flag'
</span><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-var">reifyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">flag
</span><a href="#local-6989586621682115068"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2671"></span><span>                                            </span><span class="annot"><span class="annottext">(Type -&gt; TyVarBndr flag)
-&gt; TcM Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115067"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2672"></span><span>
</span><span id="line-2673"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-type">reifyTyVarsToMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TyVarBndr/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2674"></span><span id="reifyTyVarsToMaybe"><span class="annot"><span class="annottext">reifyTyVarsToMaybe :: [Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var hs-var">reifyTyVarsToMaybe</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; TcM (Maybe [TyVarBndr ()])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2675"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span id="local-6989586621682115069"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682115069"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()] -&gt; Maybe [TyVarBndr ()]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">([TyVarBndr ()] -&gt; Maybe [TyVarBndr ()])
-&gt; TcM [TyVarBndr ()] -&gt; TcM (Maybe [TyVarBndr ()])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682115069"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2676"></span><span>
</span><span id="line-2677"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reify_tc_app"><span class="hs-identifier hs-type">reify_tc_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2678"></span><span id="reify_tc_app"><span class="annot"><span class="annottext">reify_tc_app :: TyCon -&gt; [Type] -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_tc_app"><span class="hs-identifier hs-var hs-var">reify_tc_app</span></a></span></span><span> </span><span id="local-6989586621682115070"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682115071"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115071"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2679"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682115072"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115072"><span class="hs-identifier hs-var">tys'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115071"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2680"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="#local-6989586621682115073"><span class="hs-identifier hs-var">maybe_sig_t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115074"><span class="hs-identifier hs-var">r_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115072"><span class="hs-identifier hs-var">tys'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2681"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2682"></span><span>    </span><span id="local-6989586621682115075"><span class="annot"><span class="annottext">arity :: SumArity
</span><a href="#local-6989586621682115075"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SumArity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2683"></span><span>
</span><span id="line-2684"></span><span>    </span><span id="local-6989586621682115074"><span class="annot"><span class="annottext">r_tc :: Type
</span><a href="#local-6989586621682115074"><span class="hs-identifier hs-var hs-var">r_tc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedSumTyCon"><span class="hs-identifier hs-var">isUnboxedSumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#UnboxedSumT/Language.Haskell.TH.Syntax.html#UnboxedSumT"><span class="hs-identifier hs-var">TH.UnboxedSumT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682115075"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; SumArity -&gt; SumArity
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Real.html#div/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2685"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#UnboxedTupleT/Language.Haskell.TH.Syntax.html#UnboxedTupleT"><span class="hs-identifier hs-var">TH.UnboxedTupleT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682115075"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; SumArity -&gt; SumArity
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Real.html#div/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2686"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPromotedTupleTyCon"><span class="hs-identifier hs-var">isPromotedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedTupleT/Language.Haskell.TH.Syntax.html#PromotedTupleT"><span class="hs-identifier hs-var">TH.PromotedTupleT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682115075"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; SumArity -&gt; SumArity
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Real.html#div/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2687"></span><span>             </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-2688"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTupleTyCon"><span class="hs-identifier hs-var">isTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPromotedDataCon"><span class="hs-identifier hs-var">isPromotedDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2689"></span><span>                                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedTupleT/Language.Haskell.TH.Syntax.html#PromotedTupleT"><span class="hs-identifier hs-var">TH.PromotedTupleT</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682115075"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-2690"></span><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#TupleT/Language.Haskell.TH.Syntax.html#TupleT"><span class="hs-identifier hs-var">TH.TupleT</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682115075"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-2691"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#constraintKindTyConKey"><span class="hs-identifier hs-var">constraintKindTyConKey</span></a></span><span>
</span><span id="line-2692"></span><span>                                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConstraintT/Language.Haskell.TH.Syntax.html#ConstraintT"><span class="hs-identifier hs-var">TH.ConstraintT</span></a></span><span>
</span><span id="line-2693"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unrestrictedFunTyConKey"><span class="hs-identifier hs-var">unrestrictedFunTyConKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ArrowT/Language.Haskell.TH.Syntax.html#ArrowT"><span class="hs-identifier hs-var">TH.ArrowT</span></a></span><span>
</span><span id="line-2694"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#listTyConKey"><span class="hs-identifier hs-var">listTyConKey</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ListT/Language.Haskell.TH.Syntax.html#ListT"><span class="hs-identifier hs-var">TH.ListT</span></a></span><span>
</span><span id="line-2695"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#nilDataConKey"><span class="hs-identifier hs-var">nilDataConKey</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedNilT/Language.Haskell.TH.Syntax.html#PromotedNilT"><span class="hs-identifier hs-var">TH.PromotedNilT</span></a></span><span>
</span><span id="line-2696"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#consDataConKey"><span class="hs-identifier hs-var">consDataConKey</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedConsT/Language.Haskell.TH.Syntax.html#PromotedConsT"><span class="hs-identifier hs-var">TH.PromotedConsT</span></a></span><span>
</span><span id="line-2697"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#heqTyConKey"><span class="hs-identifier hs-var">heqTyConKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#EqualityT/Language.Haskell.TH.Syntax.html#EqualityT"><span class="hs-identifier hs-var">TH.EqualityT</span></a></span><span>
</span><span id="line-2698"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#EqualityT/Language.Haskell.TH.Syntax.html#EqualityT"><span class="hs-identifier hs-var">TH.EqualityT</span></a></span><span>
</span><span id="line-2699"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#coercibleTyCon"><span class="hs-identifier hs-var">coercibleTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2700"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataKindsPromotedDataCon"><span class="hs-identifier hs-var">isDataKindsPromotedDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PromotedT/Language.Haskell.TH.Syntax.html#PromotedT"><span class="hs-identifier hs-var">TH.PromotedT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2701"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ConT/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2702"></span><span>
</span><span id="line-2703"></span><span>    </span><span class="hs-comment">-- See Note [When does a tycon application need an explicit kind</span><span>
</span><span id="line-2704"></span><span>    </span><span class="hs-comment">-- signature?] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-2705"></span><span>    </span><span id="local-6989586621682115073"><span class="annot"><span class="annottext">maybe_sig_t :: Type -&gt; TcM Type
</span><a href="#local-6989586621682115073"><span class="hs-identifier hs-var hs-var">maybe_sig_t</span></a></span></span><span> </span><span id="local-6989586621682115094"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115094"><span class="hs-identifier hs-var">th_type</span></a></span></span><span>
</span><span id="line-2706"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TyCon -&gt; SumArity -&gt; Bool
</span><a href="GHC.Core.Type.html#tyConAppNeedsKindSig"><span class="hs-identifier hs-var">tyConAppNeedsKindSig</span></a></span><span>
</span><span id="line-2707"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- We don't reify types using visible kind applications, so</span><span>
</span><span id="line-2708"></span><span>                </span><span class="hs-comment">-- don't count specified binders as contributing towards</span><span>
</span><span id="line-2709"></span><span>                </span><span class="hs-comment">-- injective positions in the kind of the tycon.</span><span>
</span><span id="line-2710"></span><span>          </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; SumArity
forall a. [a] -&gt; SumArity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; SumArity
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115071"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2711"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682115095"><span class="annot"><span class="annottext">full_kind :: Type
</span><a href="#local-6989586621682115095"><span class="hs-identifier hs-var hs-var">full_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115070"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115071"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2712"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115096"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115096"><span class="hs-identifier hs-var">th_full_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115095"><span class="hs-identifier hs-var">full_kind</span></a></span><span>
</span><span id="line-2713"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SigT/Language.Haskell.TH.Syntax.html#SigT"><span class="hs-identifier hs-var">TH.SigT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115094"><span class="hs-identifier hs-var">th_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115096"><span class="hs-identifier hs-var">th_full_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2714"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2715"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115094"><span class="hs-identifier hs-var">th_type</span></a></span><span>
</span><span id="line-2716"></span><span>
</span><span id="line-2717"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2718"></span><span id="local-6989586621682112258"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-type">reifyName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112258"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682112258"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span></span><span>
</span><span id="line-2719"></span><span id="reifyName"><span class="annot"><span class="annottext">reifyName :: forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var hs-var">reifyName</span></a></span></span><span> </span><span id="local-6989586621682115108"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682115108"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-2720"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115110"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2721"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="#local-6989586621682115111"><span class="hs-identifier hs-var">mk_varg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115112"><span class="hs-identifier hs-var">pkg_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115113"><span class="hs-identifier hs-var">mod_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115114"><span class="hs-identifier hs-var">occ_str</span></a></span><span>
</span><span id="line-2722"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Integer -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkNameU/Language.Haskell.TH.Syntax.html#mkNameU"><span class="hs-identifier hs-var">TH.mkNameU</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115114"><span class="hs-identifier hs-var">occ_str</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="../../base-4.18.3.0/src/GHC.Real.html#toInteger/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Integer) -&gt; Word64 -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Word64
</span><a href="GHC.Types.Unique.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115110"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2723"></span><span>        </span><span class="hs-comment">-- Many of the things we reify have local bindings, and</span><span>
</span><span id="line-2724"></span><span>        </span><span class="hs-comment">-- NameL's aren't supposed to appear in binding positions, so</span><span>
</span><span id="line-2725"></span><span>        </span><span class="hs-comment">-- we use NameU.  When/if we start to reify nested things, that</span><span>
</span><span id="line-2726"></span><span>        </span><span class="hs-comment">-- have free variables, we may need to generate NameL's for them.</span><span>
</span><span id="line-2727"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2728"></span><span>    </span><span id="local-6989586621682115110"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682115110"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682115108"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-2729"></span><span>    </span><span id="local-6989586621682115116"><span class="annot"><span class="annottext">mod :: GenModule Unit
</span><a href="#local-6989586621682115116"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GenModule Unit -&gt; GenModule Unit
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115110"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; GenModule Unit)
-&gt; GenModule Unit -&gt; GenModule Unit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Name -&gt; GenModule Unit
Name -&gt; GenModule Unit
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115110"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2730"></span><span>    </span><span id="local-6989586621682115112"><span class="annot"><span class="annottext">pkg_str :: String
</span><a href="#local-6989586621682115112"><span class="hs-identifier hs-var hs-var">pkg_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
forall u. IsUnitId u =&gt; u -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115116"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2731"></span><span>    </span><span id="local-6989586621682115113"><span class="annot"><span class="annottext">mod_str :: String
</span><a href="#local-6989586621682115113"><span class="hs-identifier hs-var hs-var">mod_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115116"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2732"></span><span>    </span><span id="local-6989586621682115114"><span class="annot"><span class="annottext">occ_str :: String
</span><a href="#local-6989586621682115114"><span class="hs-identifier hs-var hs-var">occ_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; String
</span><a href="GHC.Types.Name.Occurrence.html#occNameString"><span class="hs-identifier hs-var">occNameString</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682115119"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-2733"></span><span>    </span><span id="local-6989586621682115119"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621682115119"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115110"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2734"></span><span>    </span><span id="local-6989586621682115111"><span class="annot"><span class="annottext">mk_varg :: String -&gt; String -&gt; String -&gt; Name
</span><a href="#local-6989586621682115111"><span class="hs-identifier hs-var hs-var">mk_varg</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isDataOcc"><span class="hs-identifier hs-var">OccName.isDataOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682115119"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkNameG_d/Language.Haskell.TH.Syntax.html#mkNameG_d"><span class="hs-identifier hs-var">TH.mkNameG_d</span></a></span><span>
</span><span id="line-2735"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isVarOcc"><span class="hs-identifier hs-var">OccName.isVarOcc</span></a></span><span>  </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682115119"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkNameG_v/Language.Haskell.TH.Syntax.html#mkNameG_v"><span class="hs-identifier hs-var">TH.mkNameG_v</span></a></span><span>
</span><span id="line-2736"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isTcOcc"><span class="hs-identifier hs-var">OccName.isTcOcc</span></a></span><span>   </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682115119"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkNameG_tc/Language.Haskell.TH.Syntax.html#mkNameG_tc"><span class="hs-identifier hs-var">TH.mkNameG_tc</span></a></span><span>
</span><span id="line-2737"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; String -&gt; String -&gt; String -&gt; Name
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyName&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115110"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2738"></span><span>
</span><span id="line-2739"></span><span class="hs-comment">-- See Note [Reifying field labels]</span><span>
</span><span id="line-2740"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-type">reifyFieldLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-2741"></span><span id="reifyFieldLabel"><span class="annot"><span class="annottext">reifyFieldLabel :: FieldLabel -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-var hs-var">reifyFieldLabel</span></a></span></span><span> </span><span id="local-6989586621682115124"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682115124"><span class="hs-identifier hs-var">fl</span></a></span></span><span>
</span><span id="line-2742"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Bool
</span><a href="GHC.Types.FieldLabel.html#flIsOverloaded"><span class="hs-identifier hs-var">flIsOverloaded</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682115124"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-2743"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; NameFlavour -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-var">TH.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; OccName
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkOccName/Language.Haskell.TH.Syntax.html#mkOccName"><span class="hs-identifier hs-var">TH.mkOccName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115127"><span class="hs-identifier hs-var">occ_str</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModName -&gt; NameFlavour
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NameQ/Language.Haskell.TH.Syntax.html#NameQ"><span class="hs-identifier hs-var">TH.NameQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModName
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkModName/Language.Haskell.TH.Syntax.html#mkModName"><span class="hs-identifier hs-var">TH.mkModName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115129"><span class="hs-identifier hs-var">mod_str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2744"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#mkNameG_v/Language.Haskell.TH.Syntax.html#mkNameG_v"><span class="hs-identifier hs-var">TH.mkNameG_v</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115130"><span class="hs-identifier hs-var">pkg_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115129"><span class="hs-identifier hs-var">mod_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115127"><span class="hs-identifier hs-var">occ_str</span></a></span><span>
</span><span id="line-2745"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2746"></span><span>    </span><span id="local-6989586621682115131"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682115131"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682115124"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-2747"></span><span>    </span><span id="local-6989586621682115132"><span class="annot"><span class="annottext">mod :: GenModule Unit
</span><a href="#local-6989586621682115132"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GenModule Unit -&gt; GenModule Unit
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115131"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; GenModule Unit)
-&gt; GenModule Unit -&gt; GenModule Unit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Name -&gt; GenModule Unit
Name -&gt; GenModule Unit
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115131"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2748"></span><span>    </span><span id="local-6989586621682115130"><span class="annot"><span class="annottext">pkg_str :: String
</span><a href="#local-6989586621682115130"><span class="hs-identifier hs-var hs-var">pkg_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
forall u. IsUnitId u =&gt; u -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115132"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2749"></span><span>    </span><span id="local-6989586621682115129"><span class="annot"><span class="annottext">mod_str :: String
</span><a href="#local-6989586621682115129"><span class="hs-identifier hs-var hs-var">mod_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115132"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2750"></span><span>    </span><span id="local-6989586621682115127"><span class="annot"><span class="annottext">occ_str :: String
</span><a href="#local-6989586621682115127"><span class="hs-identifier hs-var hs-var">occ_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; FastString
</span><a href="Language.Haskell.Syntax.Basic.html#field_label"><span class="hs-identifier hs-var">field_label</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; FastString) -&gt; FieldLabelString -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682115124"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2751"></span><span>
</span><span id="line-2752"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifySelector"><span class="hs-identifier hs-type">reifySelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-2753"></span><span id="reifySelector"><span class="annot"><span class="annottext">reifySelector :: Id -&gt; TyCon -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifySelector"><span class="hs-identifier hs-var hs-var">reifySelector</span></a></span></span><span> </span><span id="local-6989586621682115135"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115135"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682115136"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115136"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-2754"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Bool) -&gt; [FieldLabel] -&gt; Maybe FieldLabel
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#find/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115135"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (FieldLabel -&gt; Name) -&gt; FieldLabel -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [FieldLabel]
</span><a href="GHC.Core.TyCon.html#tyConFieldLabels"><span class="hs-identifier hs-var">tyConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115136"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2755"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682115139"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682115139"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-var">reifyFieldLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682115139"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-2756"></span><span>      </span><span class="annot"><span class="annottext">Maybe FieldLabel
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Name
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifySelector: missing field&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115135"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115136"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2757"></span><span>
</span><span id="line-2758"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2759"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFixity"><span class="hs-identifier hs-type">reifyFixity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Fixity/Language.Haskell.TH.Syntax.html#Fixity"><span class="hs-identifier hs-type">TH.Fixity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2760"></span><span id="reifyFixity"><span class="annot"><span class="annottext">reifyFixity :: Name -&gt; TcM (Maybe Fixity)
</span><a href="GHC.Tc.Gen.Splice.html#reifyFixity"><span class="hs-identifier hs-var hs-var">reifyFixity</span></a></span></span><span> </span><span id="local-6989586621682115140"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115140"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2761"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682115141"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682115141"><span class="hs-identifier hs-var">found</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682115142"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621682115142"><span class="hs-identifier hs-var">fix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Bool, Fixity)
</span><a href="GHC.Rename.Fixity.html#lookupFixityRn_help"><span class="hs-identifier hs-var">lookupFixityRn_help</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115140"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2762"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Fixity -&gt; TcM (Maybe Fixity)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682115141"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Fixity -&gt; Maybe Fixity
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fixity -&gt; Fixity
</span><a href="#local-6989586621682115143"><span class="hs-identifier hs-var">conv_fix</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621682115142"><span class="hs-identifier hs-var">fix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Fixity
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2763"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2764"></span><span>      </span><span id="local-6989586621682115143"><span class="annot"><span class="annottext">conv_fix :: Fixity -&gt; Fixity
</span><a href="#local-6989586621682115143"><span class="hs-identifier hs-var hs-var">conv_fix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Fixity.html#Fixity"><span class="hs-identifier hs-type">Hs.Fixity</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682115145"><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682115145"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682115146"><span class="annot"><span class="annottext">FixityDirection
</span><a href="#local-6989586621682115146"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SumArity -&gt; FixityDirection -&gt; Fixity
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Fixity/Language.Haskell.TH.Syntax.html#Fixity"><span class="hs-identifier hs-var">TH.Fixity</span></a></span><span> </span><span class="annot"><span class="annottext">SumArity
</span><a href="#local-6989586621682115145"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FixityDirection -&gt; FixityDirection
</span><a href="#local-6989586621682115148"><span class="hs-identifier hs-var">conv_dir</span></a></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="#local-6989586621682115146"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2765"></span><span>      </span><span id="local-6989586621682115148"><span class="annot"><span class="annottext">conv_dir :: FixityDirection -&gt; FixityDirection
</span><a href="#local-6989586621682115148"><span class="hs-identifier hs-var hs-var">conv_dir</span></a></span></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="GHC.Types.Fixity.html#InfixR"><span class="hs-identifier hs-var">Hs.InfixR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InfixR/Language.Haskell.TH.Syntax.html#InfixR"><span class="hs-identifier hs-var">TH.InfixR</span></a></span><span>
</span><span id="line-2766"></span><span>      </span><span class="annot"><a href="#local-6989586621682115148"><span class="hs-identifier hs-var">conv_dir</span></a></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="GHC.Types.Fixity.html#InfixL"><span class="hs-identifier hs-var">Hs.InfixL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InfixL/Language.Haskell.TH.Syntax.html#InfixL"><span class="hs-identifier hs-var">TH.InfixL</span></a></span><span>
</span><span id="line-2767"></span><span>      </span><span class="annot"><a href="#local-6989586621682115148"><span class="hs-identifier hs-var">conv_dir</span></a></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="GHC.Types.Fixity.html#InfixN"><span class="hs-identifier hs-var">Hs.InfixN</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#InfixN/Language.Haskell.TH.Syntax.html#InfixN"><span class="hs-identifier hs-var">TH.InfixN</span></a></span><span>
</span><span id="line-2768"></span><span>
</span><span id="line-2769"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-type">reifyUnpackedness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#SrcUnpackedness"><span class="hs-identifier hs-type">DataCon.SrcUnpackedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceUnpackedness/Language.Haskell.TH.Syntax.html#SourceUnpackedness"><span class="hs-identifier hs-type">TH.SourceUnpackedness</span></a></span><span>
</span><span id="line-2770"></span><span id="reifyUnpackedness"><span class="annot"><span class="annottext">reifyUnpackedness :: SrcUnpackedness -&gt; SourceUnpackedness
</span><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var hs-var">reifyUnpackedness</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="Language.Haskell.Syntax.Basic.html#NoSrcUnpack"><span class="hs-identifier hs-var">NoSrcUnpack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NoSourceUnpackedness/Language.Haskell.TH.Syntax.html#NoSourceUnpackedness"><span class="hs-identifier hs-var">TH.NoSourceUnpackedness</span></a></span><span>
</span><span id="line-2771"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var">reifyUnpackedness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="Language.Haskell.Syntax.Basic.html#SrcNoUnpack"><span class="hs-identifier hs-var">SrcNoUnpack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceNoUnpack/Language.Haskell.TH.Syntax.html#SourceNoUnpack"><span class="hs-identifier hs-var">TH.SourceNoUnpack</span></a></span><span>
</span><span id="line-2772"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var">reifyUnpackedness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="Language.Haskell.Syntax.Basic.html#SrcUnpack"><span class="hs-identifier hs-var">SrcUnpack</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceUnpack/Language.Haskell.TH.Syntax.html#SourceUnpack"><span class="hs-identifier hs-var">TH.SourceUnpack</span></a></span><span>
</span><span id="line-2773"></span><span>
</span><span id="line-2774"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-type">reifyStrictness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#SrcStrictness"><span class="hs-identifier hs-type">DataCon.SrcStrictness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceStrictness/Language.Haskell.TH.Syntax.html#SourceStrictness"><span class="hs-identifier hs-type">TH.SourceStrictness</span></a></span><span>
</span><span id="line-2775"></span><span id="reifyStrictness"><span class="annot"><span class="annottext">reifyStrictness :: SrcStrictness -&gt; SourceStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var hs-var">reifyStrictness</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="Language.Haskell.Syntax.Basic.html#NoSrcStrict"><span class="hs-identifier hs-var">NoSrcStrict</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#NoSourceStrictness/Language.Haskell.TH.Syntax.html#NoSourceStrictness"><span class="hs-identifier hs-var">TH.NoSourceStrictness</span></a></span><span>
</span><span id="line-2776"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var">reifyStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="Language.Haskell.Syntax.Basic.html#SrcStrict"><span class="hs-identifier hs-var">SrcStrict</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceStrict/Language.Haskell.TH.Syntax.html#SourceStrict"><span class="hs-identifier hs-var">TH.SourceStrict</span></a></span><span>
</span><span id="line-2777"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var">reifyStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="Language.Haskell.Syntax.Basic.html#SrcLazy"><span class="hs-identifier hs-var">SrcLazy</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceLazy/Language.Haskell.TH.Syntax.html#SourceLazy"><span class="hs-identifier hs-var">TH.SourceLazy</span></a></span><span>
</span><span id="line-2778"></span><span>
</span><span id="line-2779"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifySourceBang"><span class="hs-identifier hs-type">reifySourceBang</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">DataCon.HsSrcBang</span></a></span><span>
</span><span id="line-2780"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceUnpackedness/Language.Haskell.TH.Syntax.html#SourceUnpackedness"><span class="hs-identifier hs-type">TH.SourceUnpackedness</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#SourceStrictness/Language.Haskell.TH.Syntax.html#SourceStrictness"><span class="hs-identifier hs-type">TH.SourceStrictness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2781"></span><span id="reifySourceBang"><span class="annot"><span class="annottext">reifySourceBang :: HsSrcBang -&gt; (SourceUnpackedness, SourceStrictness)
</span><a href="GHC.Tc.Gen.Splice.html#reifySourceBang"><span class="hs-identifier hs-var hs-var">reifySourceBang</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682115170"><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="#local-6989586621682115170"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682115171"><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621682115171"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcUnpackedness -&gt; SourceUnpackedness
</span><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var">reifyUnpackedness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="#local-6989586621682115170"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcStrictness -&gt; SourceStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var">reifyStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621682115171"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2782"></span><span>
</span><span id="line-2783"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-type">reifyDecidedStrictness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsImplBang"><span class="hs-identifier hs-type">DataCon.HsImplBang</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DecidedStrictness/Language.Haskell.TH.Syntax.html#DecidedStrictness"><span class="hs-identifier hs-type">TH.DecidedStrictness</span></a></span><span>
</span><span id="line-2784"></span><span id="reifyDecidedStrictness"><span class="annot"><span class="annottext">reifyDecidedStrictness :: HsImplBang -&gt; DecidedStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var hs-var">reifyDecidedStrictness</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="GHC.Core.DataCon.html#HsLazy"><span class="hs-identifier hs-var">HsLazy</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecidedStrictness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DecidedLazy/Language.Haskell.TH.Syntax.html#DecidedLazy"><span class="hs-identifier hs-var">TH.DecidedLazy</span></a></span><span>
</span><span id="line-2785"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var">reifyDecidedStrictness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#HsStrict"><span class="hs-identifier hs-type">HsStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecidedStrictness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DecidedStrict/Language.Haskell.TH.Syntax.html#DecidedStrict"><span class="hs-identifier hs-var">TH.DecidedStrict</span></a></span><span>
</span><span id="line-2786"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var">reifyDecidedStrictness</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsUnpack"><span class="hs-identifier hs-type">HsUnpack</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecidedStrictness
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#DecidedUnpack/Language.Haskell.TH.Syntax.html#DecidedUnpack"><span class="hs-identifier hs-var">TH.DecidedUnpack</span></a></span><span>
</span><span id="line-2787"></span><span>
</span><span id="line-2788"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTypeOfThing"><span class="hs-identifier hs-type">reifyTypeOfThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2789"></span><span id="reifyTypeOfThing"><span class="annot"><span class="annottext">reifyTypeOfThing :: Name -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypeOfThing"><span class="hs-identifier hs-var hs-var">reifyTypeOfThing</span></a></span></span><span> </span><span id="local-6989586621682115178"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115178"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2790"></span><span>  </span><span id="local-6989586621682115179"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682115179"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var">getThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115178"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-2791"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621682115179"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2792"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621682115180"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115180"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115180"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2793"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621682115181"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115181"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682115181"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2794"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621682115183"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682115183"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2795"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682115183"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2796"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621682115184"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682115184"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2797"></span><span>      </span><span class="annot"><span class="annottext">([InvisTVBinder], [Type], [InvisTVBinder], [Type], [Scaled Type],
 Type)
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-var">reifyPatSynType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn
-&gt; ([InvisTVBinder], [Type], [InvisTVBinder], [Type],
    [Scaled Type], Type)
</span><a href="GHC.Core.PatSyn.html#patSynSigBndr"><span class="hs-identifier hs-var">patSynSigBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682115184"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2798"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Id
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682115185"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115185"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115185"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; (Type -&gt; TcM Type) -&gt; TcM Type
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2799"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682115186"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115186"><span class="hs-identifier hs-var">tctv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682115186"><span class="hs-identifier hs-var">tctv</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; (Type -&gt; TcM Type) -&gt; TcM Type
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2800"></span><span>    </span><span class="hs-comment">-- Impossible cases, supposedly:</span><span>
</span><span id="line-2801"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ACoAxiom"><span class="hs-identifier hs-type">ACoAxiom</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Type
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyTypeOfThing: ACoAxiom&quot;</span></span><span>
</span><span id="line-2802"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#ATcTyCon"><span class="hs-identifier hs-type">ATcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Type
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyTypeOfThing: ATcTyCon&quot;</span></span><span>
</span><span id="line-2803"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#APromotionErr"><span class="hs-identifier hs-type">APromotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Type
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyTypeOfThing: APromotionErr&quot;</span></span><span>
</span><span id="line-2804"></span><span>
</span><span id="line-2805"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2806"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-type">lookupThAnnLookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AnnLookup/Language.Haskell.TH.Syntax.html#AnnLookup"><span class="hs-identifier hs-type">TH.AnnLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#CoreAnnTarget"><span class="hs-identifier hs-type">CoreAnnTarget</span></a></span><span>
</span><span id="line-2807"></span><span id="lookupThAnnLookup"><span class="annot"><span class="annottext">lookupThAnnLookup :: AnnLookup -&gt; TcM CoreAnnTarget
</span><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var hs-var">lookupThAnnLookup</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AnnLookupName/Language.Haskell.TH.Syntax.html#AnnLookupName"><span class="hs-identifier hs-type">TH.AnnLookupName</span></a></span><span> </span><span id="local-6989586621682115191"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115191"><span class="hs-identifier hs-var">th_nm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CoreAnnTarget) -&gt; TcM Name -&gt; TcM CoreAnnTarget
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreAnnTarget
forall name. name -&gt; AnnTarget name
</span><a href="GHC.Types.Annotations.html#NamedTarget"><span class="hs-identifier hs-var">NamedTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682115191"><span class="hs-identifier hs-var">th_nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2808"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var">lookupThAnnLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AnnLookupModule/Language.Haskell.TH.Syntax.html#AnnLookupModule"><span class="hs-identifier hs-type">TH.AnnLookupModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Module/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span> </span><span id="local-6989586621682115195"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621682115195"><span class="hs-identifier hs-var">pn</span></a></span></span><span> </span><span id="local-6989586621682115196"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621682115196"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2809"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget -&gt; TcM CoreAnnTarget
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreAnnTarget -&gt; TcM CoreAnnTarget)
-&gt; CoreAnnTarget -&gt; TcM CoreAnnTarget
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; CoreAnnTarget
forall name. GenModule Unit -&gt; AnnTarget name
</span><a href="GHC.Types.Annotations.html#ModuleTarget"><span class="hs-identifier hs-var">ModuleTarget</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; CoreAnnTarget)
-&gt; GenModule Unit -&gt; CoreAnnTarget
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2810"></span><span>    </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Unit
</span><a href="GHC.Unit.Types.html#stringToUnit"><span class="hs-identifier hs-var">stringToUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Unit) -&gt; String -&gt; Unit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PkgName -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#pkgString/Language.Haskell.TH.Syntax.html#pkgString"><span class="hs-identifier hs-var">TH.pkgString</span></a></span><span> </span><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621682115195"><span class="hs-identifier hs-var">pn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ModuleName) -&gt; String -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModName -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#modString/Language.Haskell.TH.Syntax.html#modString"><span class="hs-identifier hs-var">TH.modString</span></a></span><span> </span><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621682115196"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2811"></span><span>
</span><span id="line-2812"></span><span id="local-6989586621682115202"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyAnnotations"><span class="hs-identifier hs-type">reifyAnnotations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Data.html#Data/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682115202"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AnnLookup/Language.Haskell.TH.Syntax.html#AnnLookup"><span class="hs-identifier hs-type">TH.AnnLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682115202"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-2813"></span><span id="reifyAnnotations"><span class="annot"><span class="annottext">reifyAnnotations :: forall a. Data a =&gt; AnnLookup -&gt; TcM [a]
</span><a href="GHC.Tc.Gen.Splice.html#reifyAnnotations"><span class="hs-identifier hs-var hs-var">reifyAnnotations</span></a></span></span><span> </span><span id="local-6989586621682115215"><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621682115215"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-2814"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682115216"><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682115216"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TcM CoreAnnTarget
</span><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var">lookupThAnnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621682115215"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-2815"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115217"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682115217"><span class="hs-identifier hs-var">topEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-2816"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115218"><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621682115218"><span class="hs-identifier hs-var">epsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv)
-&gt; IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe ModGuts -&gt; IO AnnEnv
</span><a href="GHC.Driver.Env.html#prepareAnnotations"><span class="hs-identifier hs-var">prepareAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682115217"><span class="hs-identifier hs-var">topEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2817"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682115219"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682115219"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2818"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682115220"><span class="annot"><span class="annottext">selectedEpsHptAnns :: [a]
</span><a href="#local-6989586621682115220"><span class="hs-identifier hs-var hs-var">selectedEpsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
forall a.
Typeable a =&gt;
([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
</span><a href="GHC.Types.Annotations.html#findAnns"><span class="hs-identifier hs-var">findAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; a
forall a. Data a =&gt; [Word8] -&gt; a
</span><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#deserializeWithData/GHC.Serialized.html#deserializeWithData"><span class="hs-identifier hs-var">deserializeWithData</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621682115218"><span class="hs-identifier hs-var">epsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682115216"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2819"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682115223"><span class="annot"><span class="annottext">selectedTcgAnns :: [a]
</span><a href="#local-6989586621682115223"><span class="hs-identifier hs-var hs-var">selectedTcgAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
forall a.
Typeable a =&gt;
([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
</span><a href="GHC.Types.Annotations.html#findAnns"><span class="hs-identifier hs-var">findAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; a
forall a. Data a =&gt; [Word8] -&gt; a
</span><a href="../../ghc-boot-9.6.7/src/GHC.Serialized.html#deserializeWithData/GHC.Serialized.html#deserializeWithData"><span class="hs-identifier hs-var">deserializeWithData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; AnnEnv
</span><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var">tcg_ann_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682115219"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621682115216"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2820"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; TcM [a]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682115220"><span class="hs-identifier hs-var">selectedEpsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682115223"><span class="hs-identifier hs-var">selectedTcgAnns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2821"></span><span>
</span><span id="line-2822"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2823"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-type">modToTHMod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Module/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span>
</span><span id="line-2824"></span><span id="modToTHMod"><span class="annot"><span class="annottext">modToTHMod :: GenModule Unit -&gt; Module
</span><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-var hs-var">modToTHMod</span></a></span></span><span> </span><span id="local-6989586621682115226"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115226"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgName -&gt; ModName -&gt; Module
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Module/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-var">TH.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PkgName
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PkgName/Language.Haskell.TH.Syntax.html#PkgName"><span class="hs-identifier hs-var">TH.PkgName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PkgName) -&gt; String -&gt; PkgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
forall u. IsUnitId u =&gt; u -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span>  </span><span class="annot"><span class="annottext">(Unit -&gt; String) -&gt; Unit -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115226"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2825"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModName
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ModName/Language.Haskell.TH.Syntax.html#ModName"><span class="hs-identifier hs-var">TH.ModName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ModName) -&gt; String -&gt; ModName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; String) -&gt; ModuleName -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115226"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2826"></span><span>
</span><span id="line-2827"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyModule"><span class="hs-identifier hs-type">reifyModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Module/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ModuleInfo/Language.Haskell.TH.Syntax.html#ModuleInfo"><span class="hs-identifier hs-type">TH.ModuleInfo</span></a></span><span>
</span><span id="line-2828"></span><span id="reifyModule"><span class="annot"><span class="annottext">reifyModule :: Module -&gt; TcM ModuleInfo
</span><a href="GHC.Tc.Gen.Splice.html#reifyModule"><span class="hs-identifier hs-var hs-var">reifyModule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Module/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#PkgName/Language.Haskell.TH.Syntax.html#PkgName"><span class="hs-identifier hs-type">TH.PkgName</span></a></span><span> </span><span id="local-6989586621682115229"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115229"><span class="hs-identifier hs-var">pkgString</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ModName/Language.Haskell.TH.Syntax.html#ModName"><span class="hs-identifier hs-type">TH.ModName</span></a></span><span> </span><span id="local-6989586621682115230"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115230"><span class="hs-identifier hs-var">mString</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2829"></span><span>  </span><span id="local-6989586621682115231"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115231"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-2830"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682115232"><span class="annot"><span class="annottext">reifMod :: GenModule Unit
</span><a href="#local-6989586621682115232"><span class="hs-identifier hs-var hs-var">reifMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Unit
</span><a href="GHC.Unit.Types.html#stringToUnit"><span class="hs-identifier hs-var">stringToUnit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115229"><span class="hs-identifier hs-var">pkgString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682115230"><span class="hs-identifier hs-var">mString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2831"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115232"><span class="hs-identifier hs-var">reifMod</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; GenModule Unit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115231"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TcM ModuleInfo
</span><a href="#local-6989586621682115233"><span class="hs-identifier hs-var">reifyThisModule</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; TcM ModuleInfo
</span><a href="#local-6989586621682115234"><span class="hs-identifier hs-var">reifyFromIface</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115232"><span class="hs-identifier hs-var">reifMod</span></a></span><span>
</span><span id="line-2832"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2833"></span><span>      </span><span id="local-6989586621682115233"><span class="annot"><span class="annottext">reifyThisModule :: TcM ModuleInfo
</span><a href="#local-6989586621682115233"><span class="hs-identifier hs-var hs-var">reifyThisModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2834"></span><span>        </span><span id="local-6989586621682115238"><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682115238"><span class="hs-identifier hs-var">usages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImportAvails -&gt; [Module])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ImportAvails
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Module) -&gt; [GenModule Unit] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Module
</span><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-var">modToTHMod</span></a></span><span> </span><span class="annot"><span class="annottext">([GenModule Unit] -&gt; [Module])
-&gt; (ImportAvails -&gt; [GenModule Unit]) -&gt; ImportAvails -&gt; [Module]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleEnv [ImportedBy] -&gt; [GenModule Unit]
forall a. ModuleEnv a -&gt; [GenModule Unit]
</span><a href="GHC.Unit.Module.Env.html#moduleEnvKeys"><span class="hs-identifier hs-var">moduleEnvKeys</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleEnv [ImportedBy] -&gt; [GenModule Unit])
-&gt; (ImportAvails -&gt; ModuleEnv [ImportedBy])
-&gt; ImportAvails
-&gt; [GenModule Unit]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; ModuleEnv [ImportedBy]
</span><a href="GHC.Unit.Module.Deps.html#imp_mods"><span class="hs-identifier hs-var">imp_mods</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) ImportAvails
</span><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier hs-var">getImports</span></a></span><span>
</span><span id="line-2835"></span><span>        </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TcM ModuleInfo
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleInfo -&gt; TcM ModuleInfo) -&gt; ModuleInfo -&gt; TcM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; ModuleInfo
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ModuleInfo/Language.Haskell.TH.Syntax.html#ModuleInfo"><span class="hs-identifier hs-var">TH.ModuleInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682115238"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-2836"></span><span>
</span><span id="line-2837"></span><span>      </span><span id="local-6989586621682115234"><span class="annot"><span class="annottext">reifyFromIface :: GenModule Unit -&gt; TcM ModuleInfo
</span><a href="#local-6989586621682115234"><span class="hs-identifier hs-var hs-var">reifyFromIface</span></a></span></span><span> </span><span id="local-6989586621682115249"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115249"><span class="hs-identifier hs-var">reifMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2838"></span><span>        </span><span id="local-6989586621682115250"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682115250"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; GenModule Unit -&gt; IOEnv (Env TcGblEnv TcLclEnv) ModIface
</span><a href="GHC.Iface.Load.html#loadInterfaceForModule"><span class="hs-identifier hs-var">loadInterfaceForModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifying module from TH for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115249"><span class="hs-identifier hs-var">reifMod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115249"><span class="hs-identifier hs-var">reifMod</span></a></span><span>
</span><span id="line-2839"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682115252"><span class="annot"><span class="annottext">usages :: [Module]
</span><a href="#local-6989586621682115252"><span class="hs-identifier hs-var hs-var">usages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Module
</span><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-var">modToTHMod</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115253"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682115254"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621682115254"><span class="hs-identifier hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; [Usage]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [Usage]
</span><a href="GHC.Unit.Module.ModIface.html#mi_usages"><span class="hs-identifier hs-var">mi_usages</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682115250"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2840"></span><span>                                     </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682115253"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115253"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unit -&gt; Usage -&gt; Maybe (GenModule Unit)
</span><a href="#local-6989586621682115256"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115249"><span class="hs-identifier hs-var">reifMod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621682115254"><span class="hs-identifier hs-var">usage</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2841"></span><span>        </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TcM ModuleInfo
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleInfo -&gt; TcM ModuleInfo) -&gt; ModuleInfo -&gt; TcM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; ModuleInfo
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#ModuleInfo/Language.Haskell.TH.Syntax.html#ModuleInfo"><span class="hs-identifier hs-var">TH.ModuleInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621682115252"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-2842"></span><span>
</span><span id="line-2843"></span><span>      </span><span class="annot"><a href="#local-6989586621682115256"><span class="hs-identifier hs-type">usageToModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#Usage"><span class="hs-identifier hs-type">Usage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2844"></span><span>      </span><span id="local-6989586621682115256"><span class="annot"><span class="annottext">usageToModule :: Unit -&gt; Usage -&gt; Maybe (GenModule Unit)
</span><a href="#local-6989586621682115256"><span class="hs-identifier hs-var hs-var">usageToModule</span></a></span></span><span> </span><span class="annot"><span class="annottext">Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#UsageFile"><span class="hs-identifier hs-type">UsageFile</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (GenModule Unit)
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2845"></span><span>      </span><span class="annot"><a href="#local-6989586621682115256"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span id="local-6989586621682115258"><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621682115258"><span class="hs-identifier hs-var">this_pkg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#UsageHomeModule"><span class="hs-identifier hs-type">UsageHomeModule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">usg_mod_name :: Usage -&gt; ModuleName
</span><a href="GHC.Unit.Module.Deps.html#usg_mod_name"><span class="hs-identifier hs-var">usg_mod_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682115261"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682115261"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Maybe (GenModule Unit)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Maybe (GenModule Unit))
-&gt; GenModule Unit -&gt; Maybe (GenModule Unit)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621682115258"><span class="hs-identifier hs-var">this_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682115261"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-2846"></span><span>      </span><span class="annot"><a href="#local-6989586621682115256"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#UsagePackageModule"><span class="hs-identifier hs-type">UsagePackageModule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">usg_mod :: Usage -&gt; GenModule Unit
</span><a href="GHC.Unit.Module.Deps.html#usg_mod"><span class="hs-identifier hs-var">usg_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682115264"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115264"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Maybe (GenModule Unit)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115264"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2847"></span><span>      </span><span class="annot"><a href="#local-6989586621682115256"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#UsageMergedRequirement"><span class="hs-identifier hs-type">UsageMergedRequirement</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">usg_mod :: Usage -&gt; GenModule Unit
</span><a href="GHC.Unit.Module.Deps.html#usg_mod"><span class="hs-identifier hs-var">usg_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682115266"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115266"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Maybe (GenModule Unit)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621682115266"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2848"></span><span>      </span><span class="annot"><a href="#local-6989586621682115256"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span id="local-6989586621682115267"><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621682115267"><span class="hs-identifier hs-var">this_pkg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#UsageHomeModuleInterface"><span class="hs-identifier hs-type">UsageHomeModuleInterface</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">usg_mod_name :: Usage -&gt; ModuleName
</span><a href="GHC.Unit.Module.Deps.html#usg_mod_name"><span class="hs-identifier hs-var">usg_mod_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682115269"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682115269"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Maybe (GenModule Unit)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Maybe (GenModule Unit))
-&gt; GenModule Unit -&gt; Maybe (GenModule Unit)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621682115267"><span class="hs-identifier hs-var">this_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682115269"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-2849"></span><span>
</span><span id="line-2850"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2851"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-type">mkThAppTs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Type/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2852"></span><span id="mkThAppTs"><span class="annot"><span class="annottext">mkThAppTs :: Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var hs-var">mkThAppTs</span></a></span></span><span> </span><span id="local-6989586621682115270"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115270"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621682115271"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115271"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; [Type] -&gt; Type
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#AppT/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-identifier hs-var">TH.AppT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115270"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682115271"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-2853"></span><span>
</span><span id="line-2854"></span><span id="local-6989586621682112369"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-type">noTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#UnrepresentableTypeDescr"><span class="hs-identifier hs-type">UnrepresentableTypeDescr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112369"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2855"></span><span id="noTH"><span class="annot"><span class="annottext">noTH :: forall a. UnrepresentableTypeDescr -&gt; Type -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-var hs-var">noTH</span></a></span></span><span> </span><span id="local-6989586621682115273"><span class="annot"><span class="annottext">UnrepresentableTypeDescr
</span><a href="#local-6989586621682115273"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682115274"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115274"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM a
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM a) -&gt; TcRnMessage -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnrepresentableTypeDescr -&gt; Type -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnCannotRepresentType"><span class="hs-identifier hs-var">TcRnCannotRepresentType</span></a></span><span> </span><span class="annot"><span class="annottext">UnrepresentableTypeDescr
</span><a href="#local-6989586621682115273"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682115274"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2856"></span><span>
</span><span id="line-2857"></span><span id="local-6989586621682112241"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-type">ppr_th</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Ppr.html#Ppr/Language.Haskell.TH.Ppr.html#Ppr"><span class="hs-identifier hs-type">TH.Ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682112241"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682112241"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-2858"></span><span id="ppr_th"><span class="annot"><span class="annottext">ppr_th :: forall a. Ppr a =&gt; a -&gt; SDoc
</span><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-var hs-var">ppr_th</span></a></span></span><span> </span><span id="local-6989586621682115279"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682115279"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell-2.20.0.0/src/Language.Haskell.TH.Ppr.html#pprint/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682115279"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2859"></span><span>
</span><span id="line-2860"></span><span class="hs-comment">{-
Note [Reifying field labels]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When reifying a datatype declared with DuplicateRecordFields enabled, we want
the reified names of the fields to be labels rather than selector functions.
That is, we want (reify ''T) and (reify 'foo) to produce

    data T = MkT { foo :: Int }
    foo :: T -&gt; Int

rather than

    data T = MkT { $sel:foo:MkT :: Int }
    $sel:foo:MkT :: T -&gt; Int

because otherwise TH code that uses the field names as strings will silently do
the wrong thing.  Thus we use the field label (e.g. foo) as the OccName, rather
than the selector (e.g. $sel:foo:MkT).  Since the Orig name M.foo isn't in the
environment, NameG can't be used to represent such fields.  Instead,
reifyFieldLabel uses NameQ.

However, this means that extracting the field name from the output of reify, and
trying to reify it again, may fail with an ambiguity error if there are multiple
such fields defined in the module (see the test case
overloadedrecflds/should_fail/T11103.hs).  The &quot;proper&quot; fix requires changes to
the TH AST to make it able to represent duplicate record fields.
-}</span><span>
</span><span id="line-2887"></span><span>
</span><span id="line-2888"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-type">tcGetInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-2889"></span><span id="tcGetInterp"><span class="annot"><span class="annottext">tcGetInterp :: TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var hs-var">tcGetInterp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2890"></span><span>   </span><span id="local-6989586621682115280"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682115280"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-2891"></span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682115280"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2892"></span><span>      </span><span class="annot"><span class="annottext">Maybe Interp
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Interp -&gt; TcM Interp
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Interp -&gt; TcM Interp) -&gt; IO Interp -&gt; TcM Interp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO Interp
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../base-4.18.3.0/src/GHC.IO.html#throwIO/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Template haskell requires a target code interpreter&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2893"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682115282"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682115282"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; TcM Interp
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682115282"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2894"></span></pre></body></html>