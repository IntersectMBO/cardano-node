<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TypeFamilies, DataKinds, GADTs, FlexibleInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-5"></span><span> </span><span class="hs-comment">-- To permit: type instance XLet 'InferTaggedBinders = XLet 'SomePass</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wname-shadowing #-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Stg.InferTags</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTags"><span class="hs-identifier">inferTags</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#id/GHC.Base.html#id"><span class="hs-identifier">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#tagSigInfo"><span class="hs-identifier">tagSigInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#CbvMark"><span class="hs-identifier">CbvMark</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier">mkSplitUniqSupply</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.RepType.html#dataConRuntimeRepStrictness"><span class="hs-identifier">dataConRuntimeRepStrictness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier">AltCon</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier">mapAccumL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier">zipWithEqual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier">zipEqual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier">notNull</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html"><span class="hs-identifier">GHC.Stg.InferTags.Types</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html"><span class="hs-identifier">GHC.Stg.InferTags.Rewrite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTopBinds"><span class="hs-identifier">rewriteTopBinds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier">mkNameEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier">NameEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">{- Note [Tag Inference]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The purpose of this pass is to attach to every binder a flag
to indicate whether or not it is &quot;properly tagged&quot;.  A binder
is properly tagged if it is guaranteed:
 - to point to a heap-allocated *value*
 - and to have the tag of the value encoded in the pointer

For example
  let x = Just y in ...

Here x will be properly tagged: it will point to the heap-allocated
values for (Just y), and the tag-bits of the pointer will encode
the tag for Just so there is no need to re-enter the closure or even
check for the presence of tag bits. The impacts of this can be very large.

For containers the reduction in runtimes with this optimization was as follows:

intmap-benchmarks:    89.30%
intset-benchmarks:    90.87%
map-benchmarks:       88.00%
sequence-benchmarks:  99.84%
set-benchmarks:       85.00%
set-operations-intmap:88.64%
set-operations-map:   74.23%
set-operations-set:   76.50%
lookupge-intmap:      89.57%
lookupge-map:         70.95%

With nofib being ~0.3% faster as well.

See Note [Tag inference passes] for how we proceed to generate and use this information.

Note [Strict Field Invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As part of tag inference we introduce the Strict Field Invariant.
Which consists of us saying that:

* Pointers in strict fields must (a) point directly to the value, and
  (b) must be properly tagged.

For example, given
  data T = MkT ![Int]

the Strict Field Invariant guarantees that the first field of any `MkT` constructor
will either point directly to nil, or directly to a cons cell;
and will be tagged with `001` or `010` respectively.
It will never point to a thunk, nor will it be tagged `000` (meaning &quot;might be a thunk&quot;).
NB: Note that the proper tag for some objects is indeed `000`. Currently this is the case for PAPs.

This works analogous to how `WorkerLikeId`s work. See also Note [CBV Function Ids].

Why do we care? Because if we have code like:

case strictPair of
  SP x y -&gt;
    case x of ...

It allows us to safely omit the code to enter x and the check
for the presence of a tag that goes along with it.
However we might still branch on the tag as usual.
See Note [Tag Inference] for how much impact this can have for
some code.

This is enforced by the code GHC.Stg.InferTags.Rewrite
where we:

* Look at all constructor allocations.
* Check if arguments to their strict fields are known to be properly tagged
* If not we convert `StrictJust x` into `case x of x' -&gt; StrictJust x'`

This is usually very beneficial but can cause regressions in rare edge cases where
we fail to proof that x is properly tagged, or where it simply isn't.
See Note [How untagged pointers can end up in strict fields] for how the second case
can arise.

For a full example of the worst case consider this code:

foo ... = ...
  let c = StrictJust x
  in ...

Here we would rewrite `let c = StrictJust x` into `let c = case x of x' -&gt; StrictJust x'`
However that is horrible! We end up allocating a thunk for `c` first, which only when
evaluated will allocate the constructor.

So we do our best to establish that `x` is already tagged (which it almost always is)
to avoid this cost. In my benchmarks I haven't seen any cases where this causes regressions.

Note that there are similar constraints around Note [CBV Function Ids].

Note [How untagged pointers can end up in strict fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  data Set a = Tip | Bin !a (Set a) (Set a)

We make a wrapper for Bin that evaluates its arguments
  $WBin x a b = case x of xv -&gt; Bin xv a b
Here `xv` will always be evaluated and properly tagged, just as the
Strict Field Invariant requires.

But alas the Simplifier can destroy the invariant: see #15696.
We start with
  thk = f ()
  g x = ...(case thk of xv -&gt; Bin xv Tip Tip)...

So far so good; the argument to Bin (which is strict) is evaluated.
Now we do float-out. And in doing so we do a reverse binder-swap (see
Note [Binder-swap during float-out] in SetLevels) thus

  g x = ...(case thk of xv -&gt; Bin thk Nil Nil)...

The goal of the reverse binder-swap is to allow more floating -- and
indeed it does! We float the Bin to top level:

  lvl = Bin thk Tip Tip
  g x = ...(case thk of xv -&gt; lvl)...

Now you can see that the argument of Bin, namely thk, points to the
thunk, not to the value as it did before.

In short, although it may be rare, the output of optimisation passes
cannot guarantee to obey the Strict Field Invariant. For this reason
we run tag inference. See Note [Tag inference passes].

Note [Tag inference passes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Tag inference proceeds in two passes:
* The first pass is an analysis to compute which binders are properly tagged.
  The result is then attached to /binders/.
  This is implemented by `inferTagsAnal` in GHC.Stg.InferTags
* The second pass walks over the AST checking if the Strict Field Invariant is upheld.
  See Note [Strict Field Invariant].
  If required this pass modifies the program to uphold this invariant.
  Tag information is also moved from /binders/ to /occurrences/ during this pass.
  This is done by `GHC.Stg.InferTags.Rewrite (rewriteTopBinds)`.
* Finally the code generation uses this information to skip the thunk check when branching on
  values. This is done by `cgExpr`/`cgCase` in the backend.

Last but not least we also export the tag sigs of top level bindings to allow this optimization
 to work across module boundaries.

Note [TagInfo of functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
The purpose of tag inference is really to figure out when we don't have to enter
value closures. There the meaning of the tag is fairly obvious.
For functions we never make use of the tag info so we have two choices:
* Treat them as TagDunno
* Treat them as TagProper (as they *are* tagged with their arity) and be really
  careful to make sure we still enter them when needed.
As it makes little difference for runtime performance I've treated functions as TagDunno in a few places where
it made the code simpler. But besides implementation complexity there isn't any reason
why we couldn't be more rigorous in dealing with functions.

NB: It turned in #21193 that PAPs get tag zero, so the tag check can't be omitted for functions.
So option two isn't really an option without reworking this anyway.

Note [Tag inference debugging]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There is a flag -dtag-inference-checks which inserts various
compile/runtime checks in order to ensure the Strict Field Invariant
holds. It should cover all places
where tags matter and disable optimizations which interfere with checking
the invariant like generation of AP-Thunks.

Note [Polymorphic StgPass for inferTagExpr]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In order to reach a fixpoint we sometimes have to re-analyse an expression
multiple times. But after the initial run the Ast will be parameterized by
a different StgPass! To handle this a large part of the analysis is polymorphic
over the exact StgPass we are using. Which allows us to run the analysis on
the output of itself.

Note [Tag inference for interpreted code]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The bytecode interpreter has a different behaviour when it comes
to the tagging of binders in certain situations than the StgToCmm code generator.

a) Tags for let-bindings:

  When compiling a binding for a constructor like `let x = Just True`
  Weither or not `x` results in x pointing depends on the backend.
  For the interpreter x points to a BCO which once
  evaluated returns a properly tagged pointer to the heap object.
  In the Cmm backend for the same binding we would allocate the constructor right
  away and x will immediately be represented by a tagged pointer.
  This means for interpreted code we can not assume let bound constructors are
  properly tagged. Hence we distinguish between targeting bytecode and native in
  the analysis.
  We make this differentiation in `mkLetSig` where we simply never assume
  lets are tagged when targeting bytecode.

b) When referencing ids from other modules the Cmm backend will try to put a
   proper tag on these references through various means. When doing analysis we
   usually predict these cases to improve precision of the analysis.
   But to my knowledge the bytecode generator makes no such attempts so we must
   not infer imported bindings as tagged.
   This is handled in GHC.Stg.InferTags.Types.lookupInfo


-}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                         Tag inference pass
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTags"><span class="hs-identifier hs-type">inferTags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPprOpts"><span class="hs-identifier hs-type">StgPprOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">GHC.Unit.Types.Module</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgTopBinding"><span class="hs-identifier hs-type">TgStgTopBinding</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span id="inferTags"><span class="annot"><span class="annottext">inferTags :: StgPprOpts
-&gt; Bool
-&gt; Logger
-&gt; Module
-&gt; [CgStgTopBinding]
-&gt; IO ([CgStgTopBinding], NameEnv TagSig)
</span><a href="GHC.Stg.InferTags.html#inferTags"><span class="hs-identifier hs-var hs-var">inferTags</span></a></span></span><span> </span><span id="local-6989586621681821131"><span class="annot"><span class="annottext">StgPprOpts
</span><a href="#local-6989586621681821131"><span class="hs-identifier hs-var">ppr_opts</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681821132"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681821132"><span class="hs-identifier hs-var">for_bytecode</span></a></span></span><span> </span><span id="local-6989586621681821133"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681821133"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681821134"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681821134"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681821135"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681821135"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-comment">-- pprTraceM &quot;inferTags for &quot; (ppr this_mod &lt;&gt; text &quot; bytecode:&quot; &lt;&gt; ppr for_bytecode)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-comment">-- Annotate binders with tag information.</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681821136"><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681821136"><span class="hs-identifier hs-var">stg_binds_w_tags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;StgTagFields&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-247"></span><span>                                        </span><span class="annot"><span class="annottext">Bool -&gt; [CgStgTopBinding] -&gt; [GenStgTopBinding 'InferTaggedBinders]
</span><a href="GHC.Stg.InferTags.html#inferTagsAnal"><span class="hs-identifier hs-var">inferTagsAnal</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681821132"><span class="hs-identifier hs-var">for_bytecode</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681821135"><span class="hs-identifier hs-var">stg_binds</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681821133"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_stg_tags"><span class="hs-identifier hs-var">Opt_D_dump_stg_tags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CodeGenAnal STG:&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatSTG"><span class="hs-identifier hs-var">FormatSTG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgPprOpts -&gt; [GenStgTopBinding 'InferTaggedBinders] -&gt; SDoc
forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; [GenStgTopBinding pass] -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprGenStgTopBindings"><span class="hs-identifier hs-var">pprGenStgTopBindings</span></a></span><span> </span><span class="annot"><span class="annottext">StgPprOpts
</span><a href="#local-6989586621681821131"><span class="hs-identifier hs-var">ppr_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681821136"><span class="hs-identifier hs-var">stg_binds_w_tags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681821142"><span class="annot"><span class="annottext">export_tag_info :: NameEnv TagSig
</span><a href="#local-6989586621681821142"><span class="hs-identifier hs-var hs-var">export_tag_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders] -&gt; NameEnv TagSig
</span><a href="GHC.Stg.InferTags.html#collectExportInfo"><span class="hs-identifier hs-var">collectExportInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681821136"><span class="hs-identifier hs-var">stg_binds_w_tags</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-comment">-- Rewrite STG to uphold the strict field invariant</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621681821144"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681821144"><span class="hs-identifier hs-var">us_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; IO UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier hs-var">mkSplitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'t'</span></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681821145"><span class="annot"><span class="annottext">rewritten_binds :: [CgStgTopBinding]
</span><a href="#local-6989586621681821145"><span class="hs-identifier hs-var hs-var">rewritten_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;StgTagRewrite&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">Module
-&gt; UniqSupply
-&gt; [GenStgTopBinding 'InferTaggedBinders]
-&gt; [CgStgTopBinding]
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTopBinds"><span class="hs-identifier hs-var">rewriteTopBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681821134"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681821144"><span class="hs-identifier hs-var">us_t</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681821136"><span class="hs-identifier hs-var">stg_binds_w_tags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgTopBinding"><span class="hs-identifier hs-type">TgStgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">([CgStgTopBinding], NameEnv TagSig)
-&gt; IO ([CgStgTopBinding], NameEnv TagSig)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681821145"><span class="hs-identifier hs-var">rewritten_binds</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">NameEnv TagSig
</span><a href="#local-6989586621681821142"><span class="hs-identifier hs-var">export_tag_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                         Main inference algorithm
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-keyword">type</span><span> </span><span id="OutputableInferPass"><span class="annot"><a href="GHC.Stg.InferTags.html#OutputableInferPass"><span class="hs-identifier hs-var">OutputableInferPass</span></a></span></span><span> </span><span id="local-6989586621681821146"><span class="annot"><a href="#local-6989586621681821146"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821146"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821146"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821146"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821146"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | This constraint encodes the fact that no matter what pass</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- we use the Let/Closure extension points are the same as these for</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- 'InferTaggedBinders.</span><span>
</span><span id="line-272"></span><span class="hs-keyword">type</span><span> </span><span id="InferExtEq"><span class="annot"><a href="GHC.Stg.InferTags.html#InferExtEq"><span class="hs-identifier hs-var">InferExtEq</span></a></span></span><span> </span><span id="local-6989586621681821147"><span class="annot"><a href="#local-6989586621681821147"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#XLet"><span class="hs-identifier hs-type">XLet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821147"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#XLet"><span class="hs-identifier hs-type">XLet</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span>
</span><span id="line-273"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#XLetNoEscape"><span class="hs-identifier hs-type">XLetNoEscape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821147"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#XLetNoEscape"><span class="hs-identifier hs-type">XLetNoEscape</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span>
</span><span id="line-274"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#XRhsClosure"><span class="hs-identifier hs-type">XRhsClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821147"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#XRhsClosure"><span class="hs-identifier hs-type">XRhsClosure</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagsAnal"><span class="hs-identifier hs-type">inferTagsAnal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span id="inferTagsAnal"><span class="annot"><span class="annottext">inferTagsAnal :: Bool -&gt; [CgStgTopBinding] -&gt; [GenStgTopBinding 'InferTaggedBinders]
</span><a href="GHC.Stg.InferTags.html#inferTagsAnal"><span class="hs-identifier hs-var hs-var">inferTagsAnal</span></a></span></span><span> </span><span id="local-6989586621681821148"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681821148"><span class="hs-identifier hs-var">for_bytecode</span></a></span></span><span> </span><span id="local-6989586621681821149"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681821149"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-comment">-- pprTrace &quot;Binds&quot; (pprGenStgTopBindings shortStgPprOpts $ binds) $</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="annottext">(TagEnv 'CodeGen, [GenStgTopBinding 'InferTaggedBinders])
-&gt; [GenStgTopBinding 'InferTaggedBinders]
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TagEnv 'CodeGen
 -&gt; CgStgTopBinding
 -&gt; (TagEnv 'CodeGen, GenStgTopBinding 'InferTaggedBinders))
-&gt; TagEnv 'CodeGen
-&gt; [CgStgTopBinding]
-&gt; (TagEnv 'CodeGen, [GenStgTopBinding 'InferTaggedBinders])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv 'CodeGen
-&gt; CgStgTopBinding
-&gt; (TagEnv 'CodeGen, GenStgTopBinding 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagTopBind"><span class="hs-identifier hs-var">inferTagTopBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; TagEnv 'CodeGen
</span><a href="GHC.Stg.InferTags.Types.html#initEnv"><span class="hs-identifier hs-var">initEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681821148"><span class="hs-identifier hs-var">for_bytecode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681821149"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-282"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagTopBind"><span class="hs-identifier hs-type">inferTagTopBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a></span><span>
</span><span id="line-283"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span id="inferTagTopBind"><span class="annot"><span class="annottext">inferTagTopBind :: TagEnv 'CodeGen
-&gt; CgStgTopBinding
-&gt; (TagEnv 'CodeGen, GenStgTopBinding 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagTopBind"><span class="hs-identifier hs-var hs-var">inferTagTopBind</span></a></span></span><span> </span><span id="local-6989586621681821153"><span class="annot"><span class="annottext">TagEnv 'CodeGen
</span><a href="#local-6989586621681821153"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621681821155"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821155"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681821156"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681821156"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv 'CodeGen
</span><a href="#local-6989586621681821153"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; ByteString -&gt; GenStgTopBinding 'InferTaggedBinders
forall (pass :: StgPass). Id -&gt; ByteString -&gt; GenStgTopBinding pass
</span><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-var">StgTopStringLit</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821155"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681821156"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagTopBind"><span class="hs-identifier hs-var">inferTagTopBind</span></a></span><span> </span><span id="local-6989586621681821157"><span class="annot"><span class="annottext">TagEnv 'CodeGen
</span><a href="#local-6989586621681821157"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span id="local-6989586621681821159"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621681821159"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv 'CodeGen
</span><a href="#local-6989586621681821160"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
-&gt; GenStgTopBinding 'InferTaggedBinders
forall (pass :: StgPass).
GenStgBinding pass -&gt; GenStgTopBinding pass
</span><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681821161"><span class="hs-identifier hs-var">bind'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821160"><span class="annot"><span class="annottext">TagEnv 'CodeGen
</span><a href="#local-6989586621681821160"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821161"><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681821161"><span class="hs-identifier hs-var">bind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv 'CodeGen
-&gt; GenStgBinding 'CodeGen
-&gt; (TagEnv 'CodeGen, GenStgBinding 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgBinding p -&gt; (TagEnv p, GenStgBinding 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagBind"><span class="hs-identifier hs-var">inferTagBind</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv 'CodeGen
</span><a href="#local-6989586621681821157"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621681821159"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- Why is this polymorphic over the StgPass? See Note [Polymorphic StgPass for inferTagExpr]</span><span>
</span><span id="line-293"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-294"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-type">inferTagExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681820984"><span class="annot"><a href="#local-6989586621681820984"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.html#OutputableInferPass"><span class="hs-identifier hs-type">OutputableInferPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820984"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.html#InferExtEq"><span class="hs-identifier hs-type">InferExtEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820984"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820984"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820984"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagInfo"><span class="hs-identifier hs-type">TagInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span id="inferTagExpr"><span class="annot"><span class="annottext">inferTagExpr :: forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var hs-var">inferTagExpr</span></a></span></span><span> </span><span id="local-6989586621681821206"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821206"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621681821208"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821208"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681821209"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821209"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">--pprTrace &quot;inferTagExpr1&quot;</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-comment">-- (ppr fun &lt;+&gt; ppr args $$ ppr info $$</span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-comment">--  text &quot;deadEndInfo:&quot; &lt;&gt; ppr (isDeadEndId fun, idArity fun, length args)</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-comment">-- )</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821210"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [StgArg] -&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821208"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821209"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681821211"><span class="annot"><span class="annottext">fun_arity :: Arity
</span><a href="#local-6989586621681821211"><span class="hs-identifier hs-var hs-var">fun_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Arity
</span><a href="GHC.Types.Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821208"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621681821210"><span class="annot"><span class="annottext">info :: TagInfo
</span><a href="#local-6989586621681821210"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681821211"><span class="hs-identifier hs-var">fun_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- Unknown arity =&gt; Thunk or unknown call</span><span>
</span><span id="line-305"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadEndId"><span class="hs-identifier hs-var">isDeadEndId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821208"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-308"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681821211"><span class="hs-identifier hs-var">fun_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821209"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-comment">-- Implies we will simply call the function.</span><span>
</span><span id="line-309"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span> </span><span class="hs-comment">-- See Note [Bottom functions are TagTagged]</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span> </span><span id="local-6989586621681821218"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821218"><span class="hs-identifier hs-var">res_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Maybe TagSig
</span><a href="GHC.Types.Id.Info.html#tagSigInfo"><span class="hs-identifier hs-var">tagSigInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Id -&gt; IdInfo
Id -&gt; IdInfo
</span><a href="GHC.Types.Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821208"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681821211"><span class="hs-identifier hs-var">fun_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821209"><span class="hs-identifier hs-var">args</span></a></span><span>  </span><span class="hs-comment">-- Saturated</span><span>
</span><span id="line-313"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821218"><span class="hs-identifier hs-var">res_info</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span> </span><span id="local-6989586621681821220"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821220"><span class="hs-identifier hs-var">res_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; Id -&gt; Maybe TagSig
forall (p :: StgPass). TagEnv p -&gt; Id -&gt; Maybe TagSig
</span><a href="GHC.Stg.InferTags.Types.html#lookupSig"><span class="hs-identifier hs-var">lookupSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821206"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821208"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-316"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681821211"><span class="hs-identifier hs-var">fun_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821209"><span class="hs-identifier hs-var">args</span></a></span><span>  </span><span class="hs-comment">-- Saturated</span><span>
</span><span id="line-317"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821220"><span class="hs-identifier hs-var">res_info</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-320"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">--pprTrace &quot;inferAppUnknown&quot; (ppr fun) $</span><span>
</span><span id="line-321"></span><span>           </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span>
</span><span id="line-322"></span><span class="hs-comment">-- TODO:</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- If we have something like:</span><span>
</span><span id="line-324"></span><span class="hs-comment">--   let x = thunk in</span><span>
</span><span id="line-325"></span><span class="hs-comment">--   f g = case g of g' -&gt; (# x, g' #)</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- then we *do* know that g' will be properly tagged,</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- so we should return TagTagged [TagDunno,TagProper] but currently we infer</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- TagTagged [TagDunno,TagDunno] because of the unknown arity case in inferTagExpr.</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- Seems not to matter much but should be changed eventually.</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span id="local-6989586621681821222"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821222"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621681821224"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821224"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681821225"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681821225"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span id="local-6989586621681821226"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821226"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681821227"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681821227"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; DataCon -&gt; [StgArg] -&gt; TagInfo
forall (p :: StgPass). TagEnv p -&gt; DataCon -&gt; [StgArg] -&gt; TagInfo
</span><a href="GHC.Stg.InferTags.html#inferConTag"><span class="hs-identifier hs-var">inferConTag</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821222"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821224"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821226"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ConstructorNumber
-&gt; [StgArg]
-&gt; [Type]
-&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
DataCon
-&gt; ConstructorNumber -&gt; [StgArg] -&gt; [Type] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821224"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681821225"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821226"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681821227"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-type">StgLit</span></a></span><span> </span><span id="local-6989586621681821230"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681821230"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass). Literal -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-var">StgLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681821230"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span id="local-6989586621681821231"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821231"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span id="local-6989586621681821233"><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681821233"><span class="hs-identifier hs-var">tick</span></a></span></span><span> </span><span id="local-6989586621681821234"><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821234"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821235"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgTickish
-&gt; GenStgExpr 'InferTaggedBinders -&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681821233"><span class="hs-identifier hs-var">tick</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821236"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821235"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821235"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821236"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821236"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821231"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821234"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span id="local-6989586621681821238"><span class="annot"><span class="annottext">StgOp
</span><a href="#local-6989586621681821238"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621681821239"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821239"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681821240"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681821240"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Do any primops guarantee to return a properly tagged value?</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">-- I think not.  Ditto foreign calls.</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgOp -&gt; [StgArg] -&gt; Type -&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
StgOp -&gt; [StgArg] -&gt; Type -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a></span><span> </span><span class="annot"><span class="annottext">StgOp
</span><a href="#local-6989586621681821238"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821239"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681821240"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span id="local-6989586621681821241"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821241"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span id="local-6989586621681821243"><span class="annot"><span class="annottext">XLet p
</span><a href="#local-6989586621681821243"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621681821244"><span class="annot"><span class="annottext">GenStgBinding p
</span><a href="#local-6989586621681821244"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621681821245"><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821245"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821246"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XLet 'InferTaggedBinders
-&gt; GenStgBinding 'InferTaggedBinders
-&gt; GenStgExpr 'InferTaggedBinders
-&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet p
XLet 'InferTaggedBinders
</span><a href="#local-6989586621681821243"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681821247"><span class="hs-identifier hs-var">bind'</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821248"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821249"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821249"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821247"><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681821247"><span class="hs-identifier hs-var">bind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgBinding p -&gt; (TagEnv p, GenStgBinding 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgBinding p -&gt; (TagEnv p, GenStgBinding 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagBind"><span class="hs-identifier hs-var">inferTagBind</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821241"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding p
</span><a href="#local-6989586621681821244"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821246"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821246"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821248"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821248"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821249"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821245"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span id="local-6989586621681821250"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821250"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-type">StgLetNoEscape</span></a></span><span> </span><span id="local-6989586621681821252"><span class="annot"><span class="annottext">XLetNoEscape p
</span><a href="#local-6989586621681821252"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621681821253"><span class="annot"><span class="annottext">GenStgBinding p
</span><a href="#local-6989586621681821253"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621681821254"><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821254"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821255"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XLetNoEscape 'InferTaggedBinders
-&gt; GenStgBinding 'InferTaggedBinders
-&gt; GenStgExpr 'InferTaggedBinders
-&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
XLetNoEscape pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-var">StgLetNoEscape</span></a></span><span> </span><span class="annot"><span class="annottext">XLetNoEscape p
XLetNoEscape 'InferTaggedBinders
</span><a href="#local-6989586621681821252"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681821256"><span class="hs-identifier hs-var">bind'</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821257"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821258"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821258"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821256"><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681821256"><span class="hs-identifier hs-var">bind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgBinding p -&gt; (TagEnv p, GenStgBinding 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgBinding p -&gt; (TagEnv p, GenStgBinding 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagBind"><span class="hs-identifier hs-var">inferTagBind</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821250"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding p
</span><a href="#local-6989586621681821253"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821255"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821255"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821257"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821257"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821258"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821254"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span id="local-6989586621681821259"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821259"><span class="hs-identifier hs-var">in_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span id="local-6989586621681821261"><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821261"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621681821262"><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821262"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681821263"><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681821263"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681821264"><span class="annot"><span class="annottext">[GenStgAlt p]
</span><a href="#local-6989586621681821264"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- Unboxed tuples get their info from the expression we scrutinise if any</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">alt_con :: forall (pass :: StgPass). GenStgAlt pass -&gt; AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621681821268"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821268"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: forall (pass :: StgPass). GenStgAlt pass -&gt; [BinderP pass]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681821270"><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821270"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_rhs :: forall (pass :: StgPass). GenStgAlt pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681821272"><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821272"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenStgAlt p]
</span><a href="#local-6989586621681821264"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821268"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681821274"><span class="annot"><span class="annottext">[TagInfo]
</span><a href="#local-6989586621681821274"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[BinderP p] -&gt; Maybe [TagInfo]
</span><a href="#local-6989586621681821275"><span class="hs-identifier hs-var">scrut_infos</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821270"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681821276"><span class="annot"><span class="annottext">bndrs' :: [(Id, TagSig)]
</span><a href="#local-6989586621681821276"><span class="hs-identifier hs-var hs-var">bndrs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (BinderP p -&gt; TagInfo -&gt; (Id, TagSig))
-&gt; [BinderP p]
-&gt; [TagInfo]
-&gt; [(Id, TagSig)]
forall a b c.
(() :: Constraint) =&gt;
String -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferTagExpr&quot;</span></span><span> </span><span class="annot"><span class="annottext">BinderP p -&gt; TagInfo -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821277"><span class="hs-identifier hs-var">mk_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821270"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[TagInfo]
</span><a href="#local-6989586621681821274"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><a href="#local-6989586621681821277"><span class="hs-identifier hs-type">mk_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820984"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagInfo"><span class="hs-identifier hs-type">TagInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>        </span><span id="local-6989586621681821277"><span class="annot"><span class="annottext">mk_bndr :: BinderP p -&gt; TagInfo -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821277"><span class="hs-identifier hs-var hs-var">mk_bndr</span></a></span></span><span> </span><span id="local-6989586621681821278"><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821278"><span class="hs-identifier hs-var">tup_bndr</span></a></span></span><span> </span><span id="local-6989586621681821279"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821279"><span class="hs-identifier hs-var">tup_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-367"></span><span>            </span><span class="hs-comment">--  pprTrace &quot;mk_ubx_bndr_info&quot; ( ppr bndr &lt;+&gt; ppr info ) $</span><span>
</span><span id="line-368"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; Id
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; Id
</span><a href="GHC.Stg.InferTags.Types.html#getBinderId"><span class="hs-identifier hs-var">getBinderId</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821259"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821278"><span class="hs-identifier hs-var">tup_bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821279"><span class="hs-identifier hs-var">tup_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-comment">-- no case binder in alt_env here, unboxed tuple binders are dead after unarise</span><span>
</span><span id="line-370"></span><span>        </span><span id="local-6989586621681821281"><span class="annot"><span class="annottext">alt_env :: TagEnv p
</span><a href="#local-6989586621681821281"><span class="hs-identifier hs-var hs-var">alt_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
forall (p :: StgPass). TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
</span><a href="GHC.Stg.InferTags.Types.html#extendSigEnv"><span class="hs-identifier hs-var">extendSigEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821259"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681821276"><span class="hs-identifier hs-var">bndrs'</span></a></span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681821283"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821283"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821284"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821284"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821281"><span class="hs-identifier hs-var">alt_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821272"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-comment">-- pprTrace &quot;inferCase1&quot; (</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-comment">--   text &quot;scrut:&quot; &lt;&gt; ppr scrut $$</span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">--   text &quot;bndr:&quot; &lt;&gt; ppr bndr $$</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">--   text &quot;infos&quot; &lt;&gt; ppr infos $$</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">--   text &quot;out_bndrs&quot; &lt;&gt; ppr bndrs') $</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821283"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
-&gt; BinderP 'InferTaggedBinders
-&gt; AltType
-&gt; [GenStgAlt 'InferTaggedBinders]
-&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
GenStgExpr pass
-&gt; BinderP pass -&gt; AltType -&gt; [GenStgAlt pass] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821285"><span class="hs-identifier hs-var">scrut'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
</span><a href="GHC.Stg.InferTags.Types.html#noSig"><span class="hs-identifier hs-var">noSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821259"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821262"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681821263"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">alt_con :: AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821268"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-379"></span><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: [BinderP 'InferTaggedBinders]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[(Id, TagSig)]
[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681821276"><span class="hs-identifier hs-var">bndrs'</span></a></span><span>
</span><span id="line-380"></span><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_rhs :: GenStgExpr 'InferTaggedBinders
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821284"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GenStgAlt p] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgAlt p]
</span><a href="#local-6989586621681821264"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="hs-comment">-- Empty case, but I might just be paranoid.</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;inferCase2&quot; empty $</span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
-&gt; BinderP 'InferTaggedBinders
-&gt; AltType
-&gt; [GenStgAlt 'InferTaggedBinders]
-&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
GenStgExpr pass
-&gt; BinderP pass -&gt; AltType -&gt; [GenStgAlt pass] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821285"><span class="hs-identifier hs-var">scrut'</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig)
BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681821288"><span class="hs-identifier hs-var">bndr'</span></a></span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681821263"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-comment">-- More than one alternative OR non-TagTuple single alternative.</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-389"></span><span>        </span><span id="local-6989586621681821289"><span class="annot"><span class="annottext">case_env :: TagEnv p
</span><a href="#local-6989586621681821289"><span class="hs-identifier hs-var hs-var">case_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
forall (p :: StgPass). TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
</span><a href="GHC.Stg.InferTags.Types.html#extendSigEnv"><span class="hs-identifier hs-var">extendSigEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821259"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Id, TagSig)
</span><a href="#local-6989586621681821288"><span class="hs-identifier hs-var">bndr'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681821290"><span class="annot"><span class="annottext">[TagInfo]
</span><a href="#local-6989586621681821290"><span class="hs-identifier hs-var">infos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821291"><span class="annot"><span class="annottext">[GenStgAlt 'InferTaggedBinders]
</span><a href="#local-6989586621681821291"><span class="hs-identifier hs-var">alts'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TagInfo, GenStgAlt 'InferTaggedBinders)]
-&gt; ([TagInfo], [GenStgAlt 'InferTaggedBinders])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821293"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenStgAlt p
</span><a href="#local-6989586621681821294"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="#local-6989586621681821295"><span class="hs-identifier hs-type">bndrs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="#local-6989586621681821296"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681821294"><span class="annot"><span class="annottext">g :: GenStgAlt p
</span><a href="#local-6989586621681821294"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">alt_con :: forall (pass :: StgPass). GenStgAlt pass -&gt; AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681821297"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621681821297"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-394"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: forall (pass :: StgPass). GenStgAlt pass -&gt; [BinderP pass]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681821298"><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821298"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span>
</span><span id="line-395"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_rhs :: forall (pass :: StgPass). GenStgAlt pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681821299"><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821299"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-396"></span><span>                               </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenStgAlt p]
</span><a href="#local-6989586621681821264"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-397"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821300"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821300"><span class="hs-identifier hs-var">alt_env</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821295"><span class="annot"><span class="annottext">[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681821295"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; AltCon
-&gt; [BinderP p]
-&gt; (TagEnv p, [BinderP 'InferTaggedBinders])
forall (p :: StgPass).
TagEnv p
-&gt; AltCon
-&gt; [BinderP p]
-&gt; (TagEnv p, [BinderP 'InferTaggedBinders])
</span><a href="GHC.Stg.InferTags.html#addAltBndrInfo"><span class="hs-identifier hs-var">addAltBndrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821289"><span class="hs-identifier hs-var">case_env</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621681821297"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821298"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-398"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621681821293"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821293"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821296"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821296"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821300"><span class="hs-identifier hs-var">alt_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821299"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-399"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-400"></span><span>        </span><span id="local-6989586621681821302"><span class="annot"><span class="annottext">alt_info :: TagInfo
</span><a href="#local-6989586621681821302"><span class="hs-identifier hs-var hs-var">alt_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TagInfo -&gt; TagInfo -&gt; TagInfo) -&gt; TagInfo -&gt; [TagInfo] -&gt; TagInfo
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo -&gt; TagInfo -&gt; TagInfo
</span><a href="GHC.Stg.InferTags.Types.html#combineAltInfo"><span class="hs-identifier hs-var">combineAltInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span> </span><span class="annot"><span class="annottext">[TagInfo]
</span><a href="#local-6989586621681821290"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821302"><span class="hs-identifier hs-var">alt_info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
-&gt; BinderP 'InferTaggedBinders
-&gt; AltType
-&gt; [GenStgAlt 'InferTaggedBinders]
-&gt; GenStgExpr 'InferTaggedBinders
forall (pass :: StgPass).
GenStgExpr pass
-&gt; BinderP pass -&gt; AltType -&gt; [GenStgAlt pass] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821285"><span class="hs-identifier hs-var">scrut'</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig)
BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681821288"><span class="hs-identifier hs-var">bndr'</span></a></span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681821263"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgAlt 'InferTaggedBinders]
</span><a href="#local-6989586621681821291"><span class="hs-identifier hs-var">alts'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-comment">-- Single unboxed tuple alternative</span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621681821275"><span class="annot"><span class="annottext">scrut_infos :: [BinderP p] -&gt; Maybe [TagInfo]
</span><a href="#local-6989586621681821275"><span class="hs-identifier hs-var hs-var">scrut_infos</span></a></span></span><span> </span><span id="local-6989586621681821305"><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821305"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821306"><span class="hs-identifier hs-var">scrut_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>      </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TagInfo] -&gt; Maybe [TagInfo]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">([TagInfo] -&gt; Maybe [TagInfo]) -&gt; [TagInfo] -&gt; Maybe [TagInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; TagInfo -&gt; [TagInfo]
forall a. Arity -&gt; a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#replicate/GHC.List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BinderP p] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821305"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span>
</span><span id="line-406"></span><span>      </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagTuple"><span class="hs-identifier hs-type">TagTuple</span></a></span><span> </span><span id="local-6989586621681821310"><span class="annot"><span class="annottext">[TagInfo]
</span><a href="#local-6989586621681821310"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TagInfo] -&gt; Maybe [TagInfo]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[TagInfo]
</span><a href="#local-6989586621681821310"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="annottext">TagInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [TagInfo]
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821306"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821306"><span class="hs-identifier hs-var">scrut_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821285"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821285"><span class="hs-identifier hs-var">scrut'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821259"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821261"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span id="local-6989586621681821288"><span class="annot"><span class="annottext">bndr' :: (Id, TagSig)
</span><a href="#local-6989586621681821288"><span class="hs-identifier hs-var hs-var">bndr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; Id
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; Id
</span><a href="GHC.Stg.InferTags.Types.html#getBinderId"><span class="hs-identifier hs-var">getBinderId</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821259"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821262"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-- Compute binder sigs based on the constructors strict fields.</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- NB: Not used if we have tuple info from the scrutinee.</span><span>
</span><span id="line-413"></span><span class="annot"><a href="GHC.Stg.InferTags.html#addAltBndrInfo"><span class="hs-identifier hs-type">addAltBndrInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681821020"><span class="annot"><a href="#local-6989586621681821020"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821020"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821020"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821020"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span id="addAltBndrInfo"><span class="annot"><span class="annottext">addAltBndrInfo :: forall (p :: StgPass).
TagEnv p
-&gt; AltCon
-&gt; [BinderP p]
-&gt; (TagEnv p, [BinderP 'InferTaggedBinders])
</span><a href="GHC.Stg.InferTags.html#addAltBndrInfo"><span class="hs-identifier hs-var hs-var">addAltBndrInfo</span></a></span></span><span> </span><span id="local-6989586621681821313"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821313"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621681821314"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821314"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681821315"><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821315"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821314"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821314"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821319"><span class="hs-identifier hs-var">out_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681821320"><span class="hs-identifier hs-var">out_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621681821321"><span class="annot"><span class="annottext">marks :: [StrictnessMark]
</span><a href="#local-6989586621681821321"><span class="hs-identifier hs-var hs-var">marks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DataCon -&gt; [StrictnessMark]
DataCon -&gt; [StrictnessMark]
</span><a href="GHC.Types.RepType.html#dataConRuntimeRepStrictness"><span class="hs-identifier hs-var">dataConRuntimeRepStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821314"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span>    </span><span id="local-6989586621681821320"><span class="annot"><span class="annottext">out_bndrs :: [(Id, TagSig)]
</span><a href="#local-6989586621681821320"><span class="hs-identifier hs-var hs-var">out_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BinderP p -&gt; StrictnessMark -&gt; (Id, TagSig))
-&gt; [BinderP p] -&gt; [StrictnessMark] -&gt; [(Id, TagSig)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p -&gt; StrictnessMark -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821323"><span class="hs-identifier hs-var">mk_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821315"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[StrictnessMark]
</span><a href="#local-6989586621681821321"><span class="hs-identifier hs-var">marks</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621681821319"><span class="annot"><span class="annottext">out_env :: TagEnv p
</span><a href="#local-6989586621681821319"><span class="hs-identifier hs-var hs-var">out_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
forall (p :: StgPass). TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
</span><a href="GHC.Stg.InferTags.Types.html#extendSigEnv"><span class="hs-identifier hs-var">extendSigEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821313"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681821320"><span class="hs-identifier hs-var">out_bndrs</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="#local-6989586621681821323"><span class="hs-identifier hs-type">mk_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821020"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621681821323"><span class="annot"><span class="annottext">mk_bndr :: BinderP p -&gt; StrictnessMark -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821323"><span class="hs-identifier hs-var hs-var">mk_bndr</span></a></span></span><span> </span><span id="local-6989586621681821324"><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821324"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681821325"><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621681821325"><span class="hs-identifier hs-var">mark</span></a></span></span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821328"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">StrictnessMark -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isMarkedStrict"><span class="hs-identifier hs-var">isMarkedStrict</span></a></span><span> </span><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621681821325"><span class="hs-identifier hs-var">mark</span></a></span><span>
</span><span id="line-425"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821328"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
</span><a href="GHC.Stg.InferTags.Types.html#noSig"><span class="hs-identifier hs-var">noSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821313"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821324"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>          </span><span id="local-6989586621681821328"><span class="annot"><span class="annottext">id :: Id
</span><a href="#local-6989586621681821328"><span class="hs-identifier hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; Id
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; Id
</span><a href="GHC.Stg.InferTags.Types.html#getBinderId"><span class="hs-identifier hs-var">getBinderId</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821313"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821324"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><a href="GHC.Stg.InferTags.html#addAltBndrInfo"><span class="hs-identifier hs-var">addAltBndrInfo</span></a></span><span> </span><span id="local-6989586621681821330"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821330"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681821331"><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821331"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821330"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(BinderP p -&gt; (Id, TagSig)) -&gt; [BinderP p] -&gt; [(Id, TagSig)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
</span><a href="GHC.Stg.InferTags.Types.html#noSig"><span class="hs-identifier hs-var">noSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821330"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821331"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-434"></span><span id="local-6989586621681820983"><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagBind"><span class="hs-identifier hs-type">inferTagBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.html#OutputableInferPass"><span class="hs-identifier hs-type">OutputableInferPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820983"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.html#InferExtEq"><span class="hs-identifier hs-type">InferExtEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820983"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820983"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820983"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681820983"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-436"></span><span id="inferTagBind"><span class="annot"><span class="annottext">inferTagBind :: forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgBinding p -&gt; (TagEnv p, GenStgBinding 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagBind"><span class="hs-identifier hs-var hs-var">inferTagBind</span></a></span></span><span> </span><span id="local-6989586621681821347"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821347"><span class="hs-identifier hs-var">in_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681821349"><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821349"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681821350"><span class="annot"><span class="annottext">GenStgRhs p
</span><a href="#local-6989586621681821350"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-comment">-- pprTrace &quot;inferBindNonRec&quot; (</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">--   ppr bndr $$</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-comment">--   ppr (isDeadEndId id) $$</span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-comment">--   ppr sig)</span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821351"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BinderP 'InferTaggedBinders
-&gt; GenStgRhs 'InferTaggedBinders
-&gt; GenStgBinding 'InferTaggedBinders
forall (pass :: StgPass).
BinderP pass -&gt; GenStgRhs pass -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821352"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821353"><span class="hs-identifier hs-var">out_sig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><a href="#local-6989586621681821354"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-444"></span><span>    </span><span id="local-6989586621681821352"><span class="annot"><span class="annottext">id :: Id
</span><a href="#local-6989586621681821352"><span class="hs-identifier hs-var hs-var">id</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; Id
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; Id
</span><a href="GHC.Stg.InferTags.Types.html#getBinderId"><span class="hs-identifier hs-var">getBinderId</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821347"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821349"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821355"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821355"><span class="hs-identifier hs-var">in_sig</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821354"><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><a href="#local-6989586621681821354"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; TagEnv p
-&gt; GenStgRhs p
-&gt; (TagSig, GenStgRhs 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
Id
-&gt; TagEnv p
-&gt; GenStgRhs p
-&gt; (TagSig, GenStgRhs 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagRhs"><span class="hs-identifier hs-var">inferTagRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821352"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821347"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs p
</span><a href="#local-6989586621681821350"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621681821353"><span class="annot"><span class="annottext">out_sig :: TagSig
</span><a href="#local-6989586621681821353"><span class="hs-identifier hs-var hs-var">out_sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; TagSig -&gt; TagSig
forall (p :: StgPass). TagEnv p -&gt; TagSig -&gt; TagSig
</span><a href="GHC.Stg.InferTags.html#mkLetSig"><span class="hs-identifier hs-var">mkLetSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821347"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821355"><span class="hs-identifier hs-var">in_sig</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621681821351"><span class="annot"><span class="annottext">env' :: TagEnv p
</span><a href="#local-6989586621681821351"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
forall (p :: StgPass). TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
</span><a href="GHC.Stg.InferTags.Types.html#extendSigEnv"><span class="hs-identifier hs-var">extendSigEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821347"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821352"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821353"><span class="hs-identifier hs-var">out_sig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagBind"><span class="hs-identifier hs-var">inferTagBind</span></a></span><span> </span><span id="local-6989586621681821358"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821358"><span class="hs-identifier hs-var">in_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681821360"><span class="annot"><span class="annottext">[(BinderP p, GenStgRhs p)]
</span><a href="#local-6989586621681821360"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;rec&quot; (ppr (map fst pairs) $$ ppr (in_env { te_env = out_env }, StgRec pairs')) $</span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821358"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#te_env"><span class="hs-identifier hs-var">te_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681821362"><span class="hs-identifier hs-type">out_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
-&gt; GenStgBinding 'InferTaggedBinders
forall (pass :: StgPass).
[(BinderP pass, GenStgRhs pass)] -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a></span><span> </span><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681821363"><span class="hs-identifier hs-var">pairs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821364"><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821364"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821365"><span class="annot"><span class="annottext">[GenStgRhs p]
</span><a href="#local-6989586621681821365"><span class="hs-identifier hs-var">rhss</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BinderP p, GenStgRhs p)] -&gt; ([BinderP p], [GenStgRhs p])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(BinderP p, GenStgRhs p)]
</span><a href="#local-6989586621681821360"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-454"></span><span>    </span><span id="local-6989586621681821366"><span class="annot"><span class="annottext">in_ids :: [Id]
</span><a href="#local-6989586621681821366"><span class="hs-identifier hs-var hs-var">in_ids</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BinderP p -&gt; Id) -&gt; [BinderP p] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; Id
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; Id
</span><a href="GHC.Stg.InferTags.Types.html#getBinderId"><span class="hs-identifier hs-var">getBinderId</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821358"><span class="hs-identifier hs-var">in_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821364"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span id="local-6989586621681821367"><span class="annot"><span class="annottext">init_sigs :: [TagSig]
</span><a href="#local-6989586621681821367"><span class="hs-identifier hs-var hs-var">init_sigs</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, GenStgRhs p) -&gt; TagSig) -&gt; [(Id, GenStgRhs p)] -&gt; [TagSig]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id, GenStgRhs p) -&gt; TagSig
forall (p :: StgPass). (Id, GenStgRhs p) -&gt; TagSig
</span><a href="GHC.Stg.InferTags.html#initSig"><span class="hs-identifier hs-var">initSig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Id, GenStgRhs p)] -&gt; [TagSig])
-&gt; [(Id, GenStgRhs p)] -&gt; [TagSig]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [GenStgRhs p] -&gt; [(Id, GenStgRhs p)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681821366"><span class="hs-identifier hs-var">in_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgRhs p]
</span><a href="#local-6989586621681821365"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821362"><span class="annot"><span class="annottext">TagSigEnv
</span><a href="#local-6989586621681821362"><span class="hs-identifier hs-var">out_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821363"><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681821363"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; [TagSig]
-&gt; [GenStgRhs p]
-&gt; (TagSigEnv, [((Id, TagSig), GenStgRhs 'InferTaggedBinders)])
forall (q :: StgPass).
(OutputableInferPass q, InferExtEq q) =&gt;
TagEnv q
-&gt; [TagSig]
-&gt; [GenStgRhs q]
-&gt; (TagSigEnv, [((Id, TagSig), GenStgRhs 'InferTaggedBinders)])
</span><a href="#local-6989586621681821369"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821358"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">[TagSig]
</span><a href="#local-6989586621681821367"><span class="hs-identifier hs-var">init_sigs</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgRhs p]
</span><a href="#local-6989586621681821365"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><a href="#local-6989586621681821369"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681821042"><span class="annot"><a href="#local-6989586621681821042"><span class="hs-identifier hs-type">q</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.html#OutputableInferPass"><span class="hs-identifier hs-type">OutputableInferPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821042"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.html#InferExtEq"><span class="hs-identifier hs-type">InferExtEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821042"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821042"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821042"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-459"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagSigEnv"><span class="hs-identifier hs-type">TagSigEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>    </span><span id="local-6989586621681821369"><span class="annot"><span class="annottext">go :: forall (q :: StgPass).
(OutputableInferPass q, InferExtEq q) =&gt;
TagEnv q
-&gt; [TagSig]
-&gt; [GenStgRhs q]
-&gt; (TagSigEnv, [((Id, TagSig), GenStgRhs 'InferTaggedBinders)])
</span><a href="#local-6989586621681821369"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681821400"><span class="annot"><span class="annottext">TagEnv q
</span><a href="#local-6989586621681821400"><span class="hs-identifier hs-var">go_env</span></a></span></span><span> </span><span id="local-6989586621681821401"><span class="annot"><span class="annottext">[TagSig]
</span><a href="#local-6989586621681821401"><span class="hs-identifier hs-var">in_sigs</span></a></span></span><span> </span><span id="local-6989586621681821402"><span class="annot"><span class="annottext">[GenStgRhs q]
</span><a href="#local-6989586621681821402"><span class="hs-identifier hs-var">go_rhss</span></a></span></span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-comment">--   | pprTrace &quot;go&quot; (ppr in_ids $$ ppr in_sigs $$ ppr out_sigs $$ ppr rhss') False</span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-comment">--  = undefined</span><span>
</span><span id="line-463"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TagSig]
</span><a href="#local-6989586621681821401"><span class="hs-identifier hs-var">in_sigs</span></a></span><span> </span><span class="annot"><span class="annottext">[TagSig] -&gt; [TagSig] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[TagSig]
</span><a href="#local-6989586621681821403"><span class="hs-identifier hs-var">out_sigs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv q -&gt; TagSigEnv
forall (p :: StgPass). TagEnv p -&gt; TagSigEnv
</span><a href="GHC.Stg.InferTags.Types.html#te_env"><span class="hs-identifier hs-var">te_env</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv q
</span><a href="#local-6989586621681821404"><span class="hs-identifier hs-var">rhs_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681821405"><span class="hs-identifier hs-var">out_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
-&gt; [GenStgRhs 'InferTaggedBinders]
-&gt; [((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgRhs 'InferTaggedBinders]
</span><a href="#local-6989586621681821406"><span class="hs-identifier hs-var">rhss'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv 'InferTaggedBinders
-&gt; [TagSig]
-&gt; [GenStgRhs 'InferTaggedBinders]
-&gt; (TagSigEnv, [((Id, TagSig), GenStgRhs 'InferTaggedBinders)])
forall (q :: StgPass).
(OutputableInferPass q, InferExtEq q) =&gt;
TagEnv q
-&gt; [TagSig]
-&gt; [GenStgRhs q]
-&gt; (TagSigEnv, [((Id, TagSig), GenStgRhs 'InferTaggedBinders)])
</span><a href="#local-6989586621681821369"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv 'InferTaggedBinders
</span><a href="#local-6989586621681821407"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">[TagSig]
</span><a href="#local-6989586621681821403"><span class="hs-identifier hs-var">out_sigs</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgRhs 'InferTaggedBinders]
</span><a href="#local-6989586621681821406"><span class="hs-identifier hs-var">rhss'</span></a></span><span>
</span><span id="line-465"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-466"></span><span>         </span><span id="local-6989586621681821408"><span class="annot"><span class="annottext">in_bndrs :: [(Id, TagSig)]
</span><a href="#local-6989586621681821408"><span class="hs-identifier hs-var hs-var">in_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681821366"><span class="hs-identifier hs-var">in_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [TagSig] -&gt; [(Id, TagSig)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[TagSig]
</span><a href="#local-6989586621681821401"><span class="hs-identifier hs-var">in_sigs</span></a></span><span>
</span><span id="line-467"></span><span>         </span><span id="local-6989586621681821405"><span class="annot"><span class="annottext">out_bndrs :: [(Id, TagSig)]
</span><a href="#local-6989586621681821405"><span class="hs-identifier hs-var hs-var">out_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, TagSig) -&gt; (Id, TagSig)) -&gt; [(Id, TagSig)] -&gt; [(Id, TagSig)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821409"><span class="hs-identifier hs-var">updateBndr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681821408"><span class="hs-identifier hs-var">in_bndrs</span></a></span><span> </span><span class="hs-comment">-- TODO: Keeps in_ids alive</span><span>
</span><span id="line-468"></span><span>         </span><span id="local-6989586621681821404"><span class="annot"><span class="annottext">rhs_env :: TagEnv q
</span><a href="#local-6989586621681821404"><span class="hs-identifier hs-var hs-var">rhs_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv q -&gt; [(Id, TagSig)] -&gt; TagEnv q
forall (p :: StgPass). TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
</span><a href="GHC.Stg.InferTags.Types.html#extendSigEnv"><span class="hs-identifier hs-var">extendSigEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv q
</span><a href="#local-6989586621681821400"><span class="hs-identifier hs-var">go_env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681821408"><span class="hs-identifier hs-var">in_bndrs</span></a></span><span>
</span><span id="line-469"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681821403"><span class="annot"><span class="annottext">[TagSig]
</span><a href="#local-6989586621681821403"><span class="hs-identifier hs-var">out_sigs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821406"><span class="annot"><span class="annottext">[GenStgRhs 'InferTaggedBinders]
</span><a href="#local-6989586621681821406"><span class="hs-identifier hs-var">rhss'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TagSig, GenStgRhs 'InferTaggedBinders)]
-&gt; ([TagSig], [GenStgRhs 'InferTaggedBinders])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; (Id -&gt; GenStgRhs q -&gt; (TagSig, GenStgRhs 'InferTaggedBinders))
-&gt; [Id]
-&gt; [GenStgRhs q]
-&gt; [(TagSig, GenStgRhs 'InferTaggedBinders)]
forall a b c.
(() :: Constraint) =&gt;
String -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferTagBind&quot;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; GenStgRhs q -&gt; (TagSig, GenStgRhs 'InferTaggedBinders)
</span><a href="#local-6989586621681821410"><span class="hs-identifier hs-var">anaRhs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681821366"><span class="hs-identifier hs-var">in_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgRhs q]
</span><a href="#local-6989586621681821402"><span class="hs-identifier hs-var">go_rhss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>         </span><span id="local-6989586621681821407"><span class="annot"><span class="annottext">env' :: TagEnv 'InferTaggedBinders
</span><a href="#local-6989586621681821407"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv q -&gt; TagEnv 'InferTaggedBinders
forall (p :: StgPass). TagEnv p -&gt; TagEnv 'InferTaggedBinders
</span><a href="GHC.Stg.InferTags.Types.html#makeTagged"><span class="hs-identifier hs-var">makeTagged</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv q
</span><a href="#local-6989586621681821400"><span class="hs-identifier hs-var">go_env</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>         </span><span class="annot"><a href="#local-6989586621681821410"><span class="hs-identifier hs-type">anaRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821042"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>         </span><span id="local-6989586621681821410"><span class="annot"><span class="annottext">anaRhs :: Id -&gt; GenStgRhs q -&gt; (TagSig, GenStgRhs 'InferTaggedBinders)
</span><a href="#local-6989586621681821410"><span class="hs-identifier hs-var hs-var">anaRhs</span></a></span></span><span> </span><span id="local-6989586621681821412"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821412"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span id="local-6989586621681821413"><span class="annot"><span class="annottext">GenStgRhs q
</span><a href="#local-6989586621681821413"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-474"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821414"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821414"><span class="hs-identifier hs-var">sig_rhs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821415"><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><a href="#local-6989586621681821415"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; TagEnv q
-&gt; GenStgRhs q
-&gt; (TagSig, GenStgRhs 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
Id
-&gt; TagEnv p
-&gt; GenStgRhs p
-&gt; (TagSig, GenStgRhs 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagRhs"><span class="hs-identifier hs-var">inferTagRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821412"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv q
</span><a href="#local-6989586621681821404"><span class="hs-identifier hs-var">rhs_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs q
</span><a href="#local-6989586621681821413"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-475"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv q -&gt; TagSig -&gt; TagSig
forall (p :: StgPass). TagEnv p -&gt; TagSig -&gt; TagSig
</span><a href="GHC.Stg.InferTags.html#mkLetSig"><span class="hs-identifier hs-var">mkLetSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv q
</span><a href="#local-6989586621681821400"><span class="hs-identifier hs-var">go_env</span></a></span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821414"><span class="hs-identifier hs-var">sig_rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><a href="#local-6989586621681821415"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>         </span><span class="annot"><a href="#local-6989586621681821409"><span class="hs-identifier hs-type">updateBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>         </span><span id="local-6989586621681821409"><span class="annot"><span class="annottext">updateBndr :: (Id, TagSig) -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821409"><span class="hs-identifier hs-var hs-var">updateBndr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821416"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821416"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821417"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821417"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TagSig -&gt; Id
</span><a href="GHC.Types.Id.html#setIdTagSig"><span class="hs-identifier hs-var">setIdTagSig</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821416"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821417"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821417"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><a href="GHC.Stg.InferTags.html#initSig"><span class="hs-identifier hs-type">initSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681821039"><span class="annot"><a href="#local-6989586621681821039"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821039"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span>
</span><span id="line-482"></span><span class="hs-comment">-- Initial signature for the fixpoint loop</span><span>
</span><span id="line-483"></span><span id="initSig"><span class="annot"><span class="annottext">initSig :: forall (p :: StgPass). (Id, GenStgRhs p) -&gt; TagSig
</span><a href="GHC.Stg.InferTags.html#initSig"><span class="hs-identifier hs-var hs-var">initSig</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821419"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821419"><span class="hs-identifier hs-var">_bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span>
</span><span id="line-484"></span><span class="annot"><a href="GHC.Stg.InferTags.html#initSig"><span class="hs-identifier hs-var">initSig</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821421"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821421"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><span class="annottext">TagSig -&gt; Maybe TagSig -&gt; TagSig
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821424"><span class="hs-identifier hs-var">defaultSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Maybe TagSig
</span><a href="GHC.Types.Id.html#idTagSig_maybe"><span class="hs-identifier hs-var">idTagSig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821421"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681821424"><span class="annot"><span class="annottext">defaultSig :: TagSig
</span><a href="#local-6989586621681821424"><span class="hs-identifier hs-var hs-var">defaultSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="hs-comment">{- Note [Bottom functions are TagTagged]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we have a function with two branches with one
being bottom, and the other returning a tagged
unboxed tuple what is the result? We give it TagTagged!
To answer why consider this function:

foo :: Bool -&gt; (# Bool, Bool #)
foo x = case x of
    True -&gt; (# True,True #)
    False -&gt; undefined

The true branch is obviously tagged. The other branch isn't.
We want to treat the *result* of foo as tagged as well so that
the combination of the branches also is tagged if all non-bottom
branches are tagged.
This is safe because the function is still always called/entered as long
as it's applied to arguments. Since the function will never return we can give
it safely any tag sig we like.
So we give it TagTagged, as it allows the combined tag sig of the case expression
to be the combination of all non-bottoming branches.

-}</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-513"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagRhs"><span class="hs-identifier hs-type">inferTagRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681821036"><span class="annot"><a href="#local-6989586621681821036"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-514"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.html#OutputableInferPass"><span class="hs-identifier hs-type">OutputableInferPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821036"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.html#InferExtEq"><span class="hs-identifier hs-type">InferExtEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821036"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Id we are binding to.</span></span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821036"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-comment">-- ^</span><span>
</span><span id="line-517"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821036"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-comment">-- ^</span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span id="inferTagRhs"><span class="annot"><span class="annottext">inferTagRhs :: forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
Id
-&gt; TagEnv p
-&gt; GenStgRhs p
-&gt; (TagSig, GenStgRhs 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagRhs"><span class="hs-identifier hs-var hs-var">inferTagRhs</span></a></span></span><span> </span><span id="local-6989586621681821442"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821442"><span class="hs-identifier hs-var">bnd_id</span></a></span></span><span> </span><span id="local-6989586621681821443"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821443"><span class="hs-identifier hs-var">in_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621681821444"><span class="annot"><span class="annottext">XRhsClosure p
</span><a href="#local-6989586621681821444"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621681821445"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681821445"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621681821446"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681821446"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621681821447"><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821447"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621681821448"><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821448"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadEndId"><span class="hs-identifier hs-var">isDeadEndId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821442"><span class="hs-identifier hs-var">bnd_id</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821447"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-comment">-- See Note [Bottom functions are TagTagged]</span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'InferTaggedBinders
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'InferTaggedBinders]
-&gt; GenStgExpr 'InferTaggedBinders
-&gt; GenStgRhs 'InferTaggedBinders
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure p
XRhsClosure 'InferTaggedBinders
</span><a href="#local-6989586621681821444"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681821445"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681821446"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681821450"><span class="hs-identifier hs-var">out_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821451"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">--pprTrace &quot;inferTagRhsClosure&quot; (ppr (_top, _grp_ids, env,info')) $</span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821452"><span class="hs-identifier hs-var">info'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'InferTaggedBinders
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'InferTaggedBinders]
-&gt; GenStgExpr 'InferTaggedBinders
-&gt; GenStgRhs 'InferTaggedBinders
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure p
XRhsClosure 'InferTaggedBinders
</span><a href="#local-6989586621681821444"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681821445"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681821446"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681821450"><span class="hs-identifier hs-var">out_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821451"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-527"></span><span>    </span><span id="local-6989586621681821450"><span class="annot"><span class="annottext">out_bndrs :: [(Id, TagSig)]
</span><a href="#local-6989586621681821450"><span class="hs-identifier hs-var hs-var">out_bndrs</span></a></span></span><span>
</span><span id="line-528"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681821453"><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681821453"><span class="hs-identifier hs-var">marks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe [CbvMark]
</span><a href="GHC.Types.Id.html#idCbvMarks_maybe"><span class="hs-identifier hs-var">idCbvMarks_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821442"><span class="hs-identifier hs-var">bnd_id</span></a></span><span>
</span><span id="line-529"></span><span>      </span><span class="hs-comment">-- Sometimes an we eta-expand foo with additional arguments after ww, and we also trim</span><span>
</span><span id="line-530"></span><span>      </span><span class="hs-comment">-- the list of marks to the last strict entry. So we can conservatively</span><span>
</span><span id="line-531"></span><span>      </span><span class="hs-comment">-- assume these are not strict</span><span>
</span><span id="line-532"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BinderP p -&gt; CbvMark -&gt; (Id, TagSig))
-&gt; [BinderP p] -&gt; [CbvMark] -&gt; [(Id, TagSig)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinderP p -&gt; CbvMark -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821455"><span class="hs-identifier hs-var">mkArgSig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821447"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681821453"><span class="hs-identifier hs-var">marks</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark] -&gt; [CbvMark] -&gt; [CbvMark]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CbvMark -&gt; [CbvMark]
forall a. a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#repeat/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">CbvMark
</span><a href="GHC.Types.Basic.html#NotMarkedCbv"><span class="hs-identifier hs-var">NotMarkedCbv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BinderP p -&gt; (Id, TagSig)) -&gt; [BinderP p] -&gt; [(Id, TagSig)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; (Id, TagSig)
</span><a href="GHC.Stg.InferTags.Types.html#noSig"><span class="hs-identifier hs-var">noSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821458"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821447"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>    </span><span id="local-6989586621681821458"><span class="annot"><span class="annottext">env' :: TagEnv p
</span><a href="#local-6989586621681821458"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
forall (p :: StgPass). TagEnv p -&gt; [(Id, TagSig)] -&gt; TagEnv p
</span><a href="GHC.Stg.InferTags.Types.html#extendSigEnv"><span class="hs-identifier hs-var">extendSigEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821443"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681821450"><span class="hs-identifier hs-var">out_bndrs</span></a></span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681821459"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821459"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681821451"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681821451"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
forall (p :: StgPass).
(OutputableInferPass p, InferExtEq p) =&gt;
TagEnv p
-&gt; GenStgExpr p -&gt; (TagInfo, GenStgExpr 'InferTaggedBinders)
</span><a href="GHC.Stg.InferTags.html#inferTagExpr"><span class="hs-identifier hs-var">inferTagExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821458"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr p
</span><a href="#local-6989586621681821448"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span id="local-6989586621681821452"><span class="annot"><span class="annottext">info' :: TagInfo
</span><a href="#local-6989586621681821452"><span class="hs-identifier hs-var hs-var">info'</span></a></span></span><span>
</span><span id="line-538"></span><span>      </span><span class="hs-comment">-- It's a thunk</span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[BinderP p] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP p]
</span><a href="#local-6989586621681821447"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span>
</span><span id="line-541"></span><span>      </span><span class="hs-comment">-- TODO: We could preserve tuple fields for thunks</span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-comment">-- as well. But likely not worth the complexity.</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821459"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>    </span><span class="annot"><a href="#local-6989586621681821455"><span class="hs-identifier hs-type">mkArgSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821036"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#CbvMark"><span class="hs-identifier hs-type">CbvMark</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621681821455"><span class="annot"><span class="annottext">mkArgSig :: BinderP p -&gt; CbvMark -&gt; (Id, TagSig)
</span><a href="#local-6989586621681821455"><span class="hs-identifier hs-var hs-var">mkArgSig</span></a></span></span><span> </span><span id="local-6989586621681821460"><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821460"><span class="hs-identifier hs-var">bndp</span></a></span></span><span> </span><span id="local-6989586621681821461"><span class="annot"><span class="annottext">CbvMark
</span><a href="#local-6989586621681821461"><span class="hs-identifier hs-var">mark</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681821462"><span class="annot"><span class="annottext">id :: Id
</span><a href="#local-6989586621681821462"><span class="hs-identifier hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; BinderP p -&gt; Id
forall (p :: StgPass). TagEnv p -&gt; BinderP p -&gt; Id
</span><a href="GHC.Stg.InferTags.Types.html#getBinderId"><span class="hs-identifier hs-var">getBinderId</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821443"><span class="hs-identifier hs-var">in_env</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP p
</span><a href="#local-6989586621681821460"><span class="hs-identifier hs-var">bndp</span></a></span><span>
</span><span id="line-549"></span><span>          </span><span id="local-6989586621681821463"><span class="annot"><span class="annottext">tag :: TagInfo
</span><a href="#local-6989586621681821463"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CbvMark
</span><a href="#local-6989586621681821461"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-550"></span><span>            </span><span class="annot"><span class="annottext">CbvMark
</span><a href="GHC.Types.Basic.html#MarkedCbv"><span class="hs-identifier hs-var">MarkedCbv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span>
</span><span id="line-551"></span><span>            </span><span class="annot"><span class="annottext">CbvMark
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-552"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821462"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span>
</span><span id="line-553"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821462"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821463"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><a href="GHC.Stg.InferTags.html#inferTagRhs"><span class="hs-identifier hs-var">inferTagRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681821465"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821465"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681821466"><span class="annot"><span class="annottext">_rhs :: GenStgRhs p
</span><a href="#local-6989586621681821466"><span class="hs-identifier hs-var">_rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621681821467"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681821467"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621681821468"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821468"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681821469"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681821469"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span id="local-6989586621681821470"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681821470"><span class="hs-identifier hs-var">ticks</span></a></span></span><span> </span><span id="local-6989586621681821471"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821471"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span class="hs-comment">-- Constructors, which have untagged arguments to strict fields</span><span>
</span><span id="line-558"></span><span class="hs-comment">-- become thunks. We encode this by giving changing RhsCon nodes the info TagDunno</span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">--pprTrace &quot;inferTagRhsCon&quot; (ppr grp_ids) $</span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; DataCon -&gt; [StgArg] -&gt; TagInfo
forall (p :: StgPass). TagEnv p -&gt; DataCon -&gt; [StgArg] -&gt; TagInfo
</span><a href="GHC.Stg.InferTags.html#inferConTag"><span class="hs-identifier hs-var">inferConTag</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821465"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821468"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821471"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; GenStgRhs 'InferTaggedBinders
forall (pass :: StgPass).
CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681821467"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821468"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681821469"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681821470"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821471"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="hs-comment">-- Adjust let semantics to the targeted backend.</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- See Note [Tag inference for interpreted code]</span><span>
</span><span id="line-564"></span><span id="local-6989586621681821037"><span class="annot"><a href="GHC.Stg.InferTags.html#mkLetSig"><span class="hs-identifier hs-type">mkLetSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821037"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span></span><span>
</span><span id="line-565"></span><span id="mkLetSig"><span class="annot"><span class="annottext">mkLetSig :: forall (p :: StgPass). TagEnv p -&gt; TagSig -&gt; TagSig
</span><a href="GHC.Stg.InferTags.html#mkLetSig"><span class="hs-identifier hs-var hs-var">mkLetSig</span></a></span></span><span> </span><span id="local-6989586621681821472"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821472"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681821473"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821473"><span class="hs-identifier hs-var">in_sig</span></a></span></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681821474"><span class="hs-identifier hs-var">for_bytecode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821473"><span class="hs-identifier hs-var">in_sig</span></a></span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-569"></span><span>    </span><span id="local-6989586621681821474"><span class="annot"><span class="annottext">for_bytecode :: Bool
</span><a href="#local-6989586621681821474"><span class="hs-identifier hs-var hs-var">for_bytecode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; Bool
forall (p :: StgPass). TagEnv p -&gt; Bool
</span><a href="GHC.Stg.InferTags.Types.html#te_bytecode"><span class="hs-identifier hs-var">te_bytecode</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821472"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="hs-comment">{- Note [Constructor TagSigs]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
@inferConTag@ will infer the proper tag signature for a binding who's RHS is a constructor
or a StgConApp expression.
Usually these will simply be TagProper. But there are exceptions.
If any of the fields in the constructor are strict, but any argument to these
fields is not tagged then we will have to case on the argument before storing
in the constructor. Which means for let bindings the RHS turns into a thunk
which obviously is no longer properly tagged.
For example we might start with:

    let x&lt;TagDunno&gt; = f ...
    let c&lt;TagProper&gt; = StrictPair x True

But we know during the rewrite stage x will need to be evaluated in the RHS
of `c` so we will infer:

    let x&lt;TagDunno&gt; = f ...
    let c&lt;TagDunno&gt; = StrictPair x True

Which in the rewrite stage will then be rewritten into:

    let x&lt;TagDunno&gt; = f ...
    let c&lt;TagDunno&gt; = case x of x' -&gt; StrictPair x' True

The other exception is unboxed tuples. These will get a TagTuple
signature with a list of TagInfo about their individual binders
as argument. As example:

    let c&lt;TagProper&gt; = True
    let x&lt;TagDunno&gt; = ...
    let f&lt;?&gt; z = case z of z'&lt;TagProper&gt; -&gt; (# c, x #)

Here we will infer for f the Signature &lt;TagTuple[TagProper,TagDunno]&gt;.
This information will be used if we scrutinize a saturated application of
`f` in order to determine the taggedness of the result.
That is for `case f x of (# r1,r2 #) -&gt; rhs` we can infer
r1&lt;TagProper&gt; and r2&lt;TagDunno&gt; which allows us to skip all tag checks on `r1`
in `rhs`.

Things get a bit more complicated with nesting:

    let closeFd&lt;TagTuple[...]&gt; = ...
    let f x = ...
        case x of
          _ -&gt; Solo# closeFd

The &quot;natural&quot; signature for the Solo# branch in `f` would be &lt;TagTuple[TagTuple[...]]&gt;.
But we flatten this out to &lt;TagTuple[TagDunno]&gt; for the time being as it improves compile
time and there doesn't seem to huge benefit to doing differently.

  -}</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="hs-comment">-- See Note [Constructor TagSigs]</span><span>
</span><span id="line-625"></span><span id="local-6989586621681821001"><span class="annot"><a href="GHC.Stg.InferTags.html#inferConTag"><span class="hs-identifier hs-type">inferConTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#TagEnv"><span class="hs-identifier hs-type">TagEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681821001"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagInfo"><span class="hs-identifier hs-type">TagInfo</span></a></span></span><span>
</span><span id="line-626"></span><span id="inferConTag"><span class="annot"><span class="annottext">inferConTag :: forall (p :: StgPass). TagEnv p -&gt; DataCon -&gt; [StgArg] -&gt; TagInfo
</span><a href="GHC.Stg.InferTags.html#inferConTag"><span class="hs-identifier hs-var hs-var">inferConTag</span></a></span></span><span> </span><span id="local-6989586621681821479"><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821479"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681821480"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821480"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681821481"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821481"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821480"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TagInfo] -&gt; TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTuple"><span class="hs-identifier hs-var">TagTuple</span></a></span><span> </span><span class="annot"><span class="annottext">([TagInfo] -&gt; TagInfo) -&gt; [TagInfo] -&gt; TagInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; TagInfo) -&gt; [StgArg] -&gt; [TagInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; TagInfo
</span><a href="#local-6989586621681821482"><span class="hs-identifier hs-var">flatten_arg_tag</span></a></span><span> </span><span class="annot"><span class="annottext">(TagInfo -&gt; TagInfo) -&gt; (StgArg -&gt; TagInfo) -&gt; StgArg -&gt; TagInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p -&gt; StgArg -&gt; TagInfo
forall (p :: StgPass). TagEnv p -&gt; StgArg -&gt; TagInfo
</span><a href="GHC.Stg.InferTags.Types.html#lookupInfo"><span class="hs-identifier hs-var">lookupInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821479"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821481"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-630"></span><span>    </span><span class="hs-comment">-- pprTrace &quot;inferConTag&quot;</span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-comment">--   ( text &quot;con:&quot; &lt;&gt; ppr con $$</span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-comment">--     text &quot;args:&quot; &lt;&gt; ppr args $$</span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-comment">--     text &quot;marks:&quot; &lt;&gt; ppr (dataConRuntimeRepStrictness con) $$</span><span>
</span><span id="line-634"></span><span>    </span><span class="hs-comment">--     text &quot;arg_info:&quot; &lt;&gt; ppr (map (lookupInfo env) args) $$</span><span>
</span><span id="line-635"></span><span>    </span><span class="hs-comment">--     text &quot;info:&quot; &lt;&gt; ppr info) $</span><span>
</span><span id="line-636"></span><span>    </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821485"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-638"></span><span>    </span><span id="local-6989586621681821485"><span class="annot"><span class="annottext">info :: TagInfo
</span><a href="#local-6989586621681821485"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">((StgArg, StrictnessMark) -&gt; Bool)
-&gt; [(StgArg, StrictnessMark)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">(StgArg, StrictnessMark) -&gt; Bool
</span><a href="#local-6989586621681821487"><span class="hs-identifier hs-var">arg_needs_eval</span></a></span><span> </span><span class="annot"><span class="annottext">[(StgArg, StrictnessMark)]
</span><a href="#local-6989586621681821488"><span class="hs-identifier hs-var">strictArgs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span>
</span><span id="line-639"></span><span>    </span><span id="local-6989586621681821488"><span class="annot"><span class="annottext">strictArgs :: [(StgArg, StrictnessMark)]
</span><a href="#local-6989586621681821488"><span class="hs-identifier hs-var hs-var">strictArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [StgArg] -&gt; [StrictnessMark] -&gt; [(StgArg, StrictnessMark)]
forall a b. (() :: Constraint) =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferTagRhs&quot;</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681821481"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DataCon -&gt; [StrictnessMark]
DataCon -&gt; [StrictnessMark]
</span><a href="GHC.Types.RepType.html#dataConRuntimeRepStrictness"><span class="hs-identifier hs-var">dataConRuntimeRepStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681821480"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>    </span><span id="local-6989586621681821487"><span class="annot"><span class="annottext">arg_needs_eval :: (StgArg, StrictnessMark) -&gt; Bool
</span><a href="#local-6989586621681821487"><span class="hs-identifier hs-var hs-var">arg_needs_eval</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821489"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681821489"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821490"><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621681821490"><span class="hs-identifier hs-var">strict</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>      </span><span class="hs-comment">-- lazy args</span><span>
</span><span id="line-642"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictnessMark -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isMarkedStrict"><span class="hs-identifier hs-var">isMarkedStrict</span></a></span><span> </span><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621681821490"><span class="hs-identifier hs-var">strict</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-643"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681821491"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821491"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagEnv p -&gt; StgArg -&gt; TagInfo
forall (p :: StgPass). TagEnv p -&gt; StgArg -&gt; TagInfo
</span><a href="GHC.Stg.InferTags.Types.html#lookupInfo"><span class="hs-identifier hs-var">lookupInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TagEnv p
</span><a href="#local-6989586621681821479"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681821489"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>      </span><span class="hs-comment">-- banged args need to be tagged, or require eval</span><span>
</span><span id="line-645"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; Bool
</span><a href="GHC.Stg.InferTags.Types.html#isTaggedInfo"><span class="hs-identifier hs-var">isTaggedInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681821491"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span>    </span><span id="local-6989586621681821482"><span class="annot"><span class="annottext">flatten_arg_tag :: TagInfo -&gt; TagInfo
</span><a href="#local-6989586621681821482"><span class="hs-identifier hs-var hs-var">flatten_arg_tag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span>
</span><span id="line-648"></span><span>    </span><span class="annot"><a href="#local-6989586621681821482"><span class="hs-identifier hs-var">flatten_arg_tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span>
</span><span id="line-649"></span><span>    </span><span class="annot"><a href="#local-6989586621681821482"><span class="hs-identifier hs-var">flatten_arg_tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagTuple"><span class="hs-identifier hs-type">TagTuple</span></a></span><span> </span><span class="annot"><span class="annottext">[TagInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span> </span><span class="hs-comment">-- See Note [Constructor TagSigs]</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><a href="#local-6989586621681821482"><span class="hs-identifier hs-var">flatten_arg_tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="annot"><a href="GHC.Stg.InferTags.html#collectExportInfo"><span class="hs-identifier hs-type">collectExportInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span>
</span><span id="line-654"></span><span id="collectExportInfo"><span class="annot"><span class="annottext">collectExportInfo :: [GenStgTopBinding 'InferTaggedBinders] -&gt; NameEnv TagSig
</span><a href="GHC.Stg.InferTags.html#collectExportInfo"><span class="hs-identifier hs-var hs-var">collectExportInfo</span></a></span></span><span> </span><span id="local-6989586621681821493"><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681821493"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-655"></span><span>  </span><span class="annot"><span class="annottext">[(Name, TagSig)] -&gt; NameEnv TagSig
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TagSig)]
</span><a href="#local-6989586621681821494"><span class="hs-identifier hs-var">bndr_info</span></a></span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-657"></span><span>    </span><span id="local-6989586621681821494"><span class="annot"><span class="annottext">bndr_info :: [(Name, TagSig)]
</span><a href="#local-6989586621681821494"><span class="hs-identifier hs-var hs-var">bndr_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenStgTopBinding 'InferTaggedBinders -&gt; [(Name, TagSig)])
-&gt; [GenStgTopBinding 'InferTaggedBinders] -&gt; [(Name, TagSig)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgTopBinding 'InferTaggedBinders -&gt; [(Name, TagSig)]
forall {pass :: StgPass}.
(BinderP pass ~ (Id, TagSig)) =&gt;
GenStgTopBinding pass -&gt; [(Name, TagSig)]
</span><a href="#local-6989586621681821496"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681821493"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621681821496"><span class="annot"><span class="annottext">collect :: GenStgTopBinding pass -&gt; [(Name, TagSig)]
</span><a href="#local-6989586621681821496"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><a href="#local-6989586621681821496"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span id="local-6989586621681821499"><span class="annot"><span class="annottext">GenStgBinding pass
</span><a href="#local-6989586621681821499"><span class="hs-identifier hs-var">bnd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-661"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenStgBinding pass
</span><a href="#local-6989586621681821499"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-662"></span><span>        </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821500"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821500"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821501"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821501"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681821502"><span class="annot"><span class="annottext">GenStgRhs pass
</span><a href="#local-6989586621681821502"><span class="hs-identifier hs-var">_rhs</span></a></span></span><span>
</span><span id="line-663"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821501"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-664"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821500"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821501"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-665"></span><span>        </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681821504"><span class="annot"><span class="annottext">[(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621681821504"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, GenStgRhs pass)] -&gt; [(Name, TagSig)]
forall rhs.
[(BinderP 'InferTaggedBinders, rhs)] -&gt; [(Name, TagSig)]
</span><a href="#local-6989586621681821505"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">[(BinderP pass, GenStgRhs pass)]
[(BinderP 'InferTaggedBinders, GenStgRhs pass)]
</span><a href="#local-6989586621681821504"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>    </span><span id="local-6989586621681821077"><span class="annot"><a href="#local-6989586621681821505"><span class="hs-identifier hs-type">collectRec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681821077"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621681821505"><span class="annot"><span class="annottext">collectRec :: forall rhs.
[(BinderP 'InferTaggedBinders, rhs)] -&gt; [(Name, TagSig)]
</span><a href="#local-6989586621681821505"><span class="hs-identifier hs-var hs-var">collectRec</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-669"></span><span>    </span><span class="annot"><a href="#local-6989586621681821505"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821506"><span class="annot"><span class="annottext">(BinderP 'InferTaggedBinders, rhs)
</span><a href="#local-6989586621681821506"><span class="hs-identifier hs-var">bnd</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681821507"><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, rhs)]
</span><a href="#local-6989586621681821507"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821508"><span class="annot"><span class="annottext">BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681821508"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821509"><span class="annot"><span class="annottext">rhs
</span><a href="#local-6989586621681821509"><span class="hs-identifier hs-var">_rhs</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BinderP 'InferTaggedBinders, rhs)
</span><a href="#local-6989586621681821506"><span class="hs-identifier hs-var">bnd</span></a></span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681821510"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821510"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681821511"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821511"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681821508"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-672"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821511"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681821510"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681821511"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name, TagSig) -&gt; [(Name, TagSig)] -&gt; [(Name, TagSig)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, rhs)] -&gt; [(Name, TagSig)]
forall rhs.
[(BinderP 'InferTaggedBinders, rhs)] -&gt; [(Name, TagSig)]
</span><a href="#local-6989586621681821505"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, rhs)]
</span><a href="#local-6989586621681821507"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-674"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, rhs)] -&gt; [(Name, TagSig)]
forall rhs.
[(BinderP 'InferTaggedBinders, rhs)] -&gt; [(Name, TagSig)]
</span><a href="#local-6989586621681821505"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, rhs)]
</span><a href="#local-6989586621681821507"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-675"></span></pre></body></html>