<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs         #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.GenerateCgIPEStub</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier">generateCgIPEStub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#lookupEstimatedTicks"><span class="hs-identifier">lookupEstimatedTicks</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Strict.html#/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Strict.html#/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Semigroup.html#/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier">CLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#mkAsmTempLabel"><span class="hs-identifier">mkAsmTempLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html"><span class="hs-identifier">GHC.Cmm.Dataflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier">blockSplit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier">blockToList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Collections.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Collections</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier">Label</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html"><span class="hs-identifier">GHC.Cmm.Info.Build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier">emptySRT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Pipeline.html"><span class="hs-identifier">GHC.Cmm.Pipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier">cmmPipeline</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier">Stream</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Stream</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier">hsc_dflags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier">hsc_logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html"><span class="hs-identifier">GHC.Driver.Env.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier">HscEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html"><span class="hs-identifier">GHC.Driver.Flags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier">GeneralFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier">DumpFlag</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_ipe_stats"><span class="hs-identifier">Opt_D_ipe_stats</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier">gopt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier">targetPlatform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.StgToCmm.html"><span class="hs-identifier">GHC.Driver.Config.StgToCmm</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Cmm.html"><span class="hs-identifier">GHC.Driver.Config.Cmm</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#isStackRep"><span class="hs-identifier">isStackRep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.html"><span class="hs-identifier">GHC.Settings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#platformTablesNextToCode"><span class="hs-identifier">platformTablesNextToCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html"><span class="hs-identifier">GHC.StgToCmm.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getCmm"><span class="hs-identifier">getCmm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#initC"><span class="hs-identifier">initC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#runC"><span class="hs-identifier">runC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#initFCodeState"><span class="hs-identifier">initFCodeState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Prof.html"><span class="hs-identifier">GHC.StgToCmm.Prof</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Prof.html#initInfoTableProv"><span class="hs-identifier">initInfoTableProv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier">CmmCgInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier">ModuleLFInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html"><span class="hs-identifier">GHC.StgToCmm.Utils</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html"><span class="hs-identifier">GHC.Types.IPE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier">InfoTableProvMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.IPE.html#provInfoTables"><span class="hs-identifier">provInfoTables</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#NonCaffySet"><span class="hs-identifier">NonCaffySet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#GenTickish"><span class="hs-identifier">GenTickish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier">SourceNote</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier">moduleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier">moduleNameString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Logger</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">{-
Note [Stacktraces from Info Table Provenance Entries (IPE based stack unwinding)]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Stacktraces can be created from return frames as they are pushed to stack for every case scrutinee.
But to make them readable / meaningful, one needs to know the source location of each return frame.

Every return frame has a distinct info table and thus a distinct code pointer (for tables next to
code) or at least a distinct address itself. Info Table Provenance Entries (IPEs) are searchable by
this pointer and contain a source location.

The info table / info table code pointer to source location map is described in:
Note [Mapping Info Tables to Source Positions]

To be able to lookup IPEs for return frames one needs to emit them during compile time. This is done
by `generateCgIPEStub`.

This leads to the question: How to figure out the source location of a return frame?

The algorithm for determining source locations for stack info tables is implemented in
`lookupEstimatedTicks` as two passes over every 'CmmGroupSRTs'. The first pass generates estimated
source locations for any labels potentially corresponding to stack info tables in the Cmm code. The
second pass walks over the Cmm decls and creates an entry in the IPE map for every info table,
looking up source locations for stack info tables in the map generated during the first pass.

The rest of this note will document exactly how the first pass generates the map from labels to
estimated source positions. The algorithms are different depending on whether tables-next-to-code
is on or off. Both algorithms have in common that we are looking for a `CmmNode.CmmTick`
(containing a `SourceNote`) that is near what we estimate to be the label of a return stack frame.

With tables-next-to-code
~~~~~~~~~~~~~~~~~~~~~~~~

Let's consider this example:
```
 Main.returnFrame_entry() { //  [R2]
         { info_tbls: [(c18g,
                        label: block_c18g_info
                        rep: StackRep []
                        srt: Just GHC.CString.unpackCString#_closure),
                       (c18r,
                        label: Main.returnFrame_info
                        rep: HeapRep static { Fun {arity: 1 fun_type: ArgSpec 5} }
                        srt: Nothing)]
           stack_info: arg_space: 8
         }
     {offset

      [...]

       c18u: // global
           //tick src&lt;Main.hs:(7,1)-(16,15)&gt;
           I64[Hp - 16] = sat_s16B_info;
           P64[Hp] = _s16r::P64;
           _c17j::P64 = Hp - 16;
           //tick src&lt;Main.hs:8:25-39&gt;
           I64[Sp - 8] = c18g;
           R3 = _c17j::P64;
           R2 = GHC.IO.Unsafe.unsafePerformIO_closure;
           R1 = GHC.Base.$_closure;
           Sp = Sp - 8;
           call stg_ap_pp_fast(R3,
                               R2,
                               R1) returns to c18g, args: 8, res: 8, upd: 8;
```

The return frame `block_c18g_info` has the label `c18g` which is used in the call to `stg_ap_pp_fast`
(`returns to c18g`) as continuation (`cml_cont`). The source location we're after, is the nearest
`//tick` before the call (`//tick src&lt;Main.hs:8:25-39&gt;`).

In code the Cmm program is represented as a Hoopl graph. Hoopl distinguishes nodes by defining if they
are open or closed on entry (one can fallthrough to them from the previous instruction) and if they are
open or closed on exit (one can fallthrough from them to the next node).

Please refer to the paper &quot;Hoopl: A Modular, Reusable Library for Dataflow Analysis and Transformation&quot;
for a detailed explanation.

Here we use the fact, that calls (represented by `CmmNode.CmmCall`) are always closed on exit
(`CmmNode O C`, `O` means open, `C` closed). In other words, they are always at the end of a block.

So, given a `CmmGraph`:
  - Look at the end of every block: If it is a `CmmNode.CmmCall` returning to some label, lookup
    the nearest `CmmNode.CmmTick` by traversing the middle part of the block backwards (from end to
    beginning).
  - Take the first `CmmNode.CmmTick` that contains a `Tickish.SourceNote` and map the label we
    found to it's payload as an `IpeSourceLocation`. (There are other `Tickish` constructors like
    `ProfNote` or `HpcTick`, these are ignored.)

See `labelsToSourcesWithTNTC` for the implementation of this algorithm.

Without tables-next-to-code
~~~~~~~~~~~~~~~~~~~~~~~~~~~

When tables-next-to-code is off, there is no return frame / continuation label in calls. The continuation (i.e. return
frame) is set in an explicit Cmm assignment. Thus the tick lookup algorithm has to be slightly different.

```
 sat_s16G_entry() { //  [R1]
         { info_tbls: [(c18O,
                        label: sat_s16G_info
                        rep: HeapRep { Thunk }
                        srt: Just _u18Z_srt)]
           stack_info: arg_space: 0
         }
     {offset
       c18O: // global
           _s16G::P64 = R1;
           if ((Sp + 8) - 40 &lt; SpLim) (likely: False) goto c18P; else goto c18Q;
       c18P: // global
           R1 = _s16G::P64;
           call (stg_gc_enter_1)(R1) args: 8, res: 0, upd: 8;
       c18Q: // global
           I64[Sp - 16] = stg_upd_frame_info;
           P64[Sp - 8] = _s16G::P64;
           //tick src&lt;Main.hs:20:9-13&gt;
           I64[Sp - 24] = block_c18M_info;
           R1 = GHC.Show.$fShow[]_closure;
           P64[Sp - 32] = GHC.Show.$fShowChar_closure;
           Sp = Sp - 32;
           call stg_ap_p_fast(R1) args: 16, res: 8, upd: 24;
     }
 },
 _blk_c18M() { //  [R1]
         { info_tbls: [(c18M,
                        label: block_c18M_info
                        rep: StackRep []
                        srt: Just System.IO.print_closure)]
           stack_info: arg_space: 0
         }
     {offset
       c18M: // global
           _s16F::P64 = R1;
           R1 = System.IO.print_closure;
           P64[Sp] = _s16F::P64;
           call stg_ap_p_fast(R1) args: 32, res: 0, upd: 24;
     }
 },
```

In this example we have to lookup `//tick src&lt;Main.hs:20:9-13&gt;` for the return frame `c18M`.
Notice, that this cannot be done with the `Label` `c18M`, but with the `CLabel` `block_c18M_info`
(`label: block_c18M_info` is actually a `CLabel`).

Given a `CmmGraph`:
  - Check every `CmmBlock` from top (first) to bottom (last).
  - If a `CmmTick` holding a `SourceNote` is found, remember the source location in the tick.
  - If an assignment of the form `... = block_c18M_info;` (a `CmmStore` whose RHS is a
    `CmmLit (CmmLabel l)`) is found, map that label to the most recently visited source note's
    location.

See `labelsToSourcesSansTNTC` for the implementation of this algorithm.
-}</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier hs-type">generateCgIPEStub</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NonCaffySet"><span class="hs-identifier hs-type">NonCaffySet</span></a></span><span>
</span><span id="line-197"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier hs-type">ModuleLFInfos</span></a></span><span>
</span><span id="line-198"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span>
</span><span id="line-200"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span>
</span><span id="line-202"></span><span id="generateCgIPEStub"><span class="annot"><span class="annottext">generateCgIPEStub :: HscEnv
-&gt; Module
-&gt; InfoTableProvMap
-&gt; (NonCaffySet, ModuleLFInfos,
    Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; Stream IO CmmGroupSRTs CmmCgInfos
</span><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier hs-var hs-var">generateCgIPEStub</span></a></span></span><span> </span><span id="local-6989586621681936079"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681936079"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681936080"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681936080"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681936081"><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681936081"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681936082"><span class="annot"><span class="annottext">NonCaffySet
</span><a href="#local-6989586621681936082"><span class="hs-identifier hs-var">nonCaffySet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936083"><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621681936083"><span class="hs-identifier hs-var">moduleLFInfos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936084"><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936084"><span class="hs-identifier hs-var">infoTablesWithTickishes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936085"><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936085"><span class="hs-identifier hs-var">initStats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681936086"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681936086"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681936079"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-204"></span><span>      </span><span id="local-6989586621681936087"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681936087"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681936086"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-205"></span><span>      </span><span id="local-6989586621681936088"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621681936088"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681936079"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span id="local-6989586621681936089"><span class="annot"><span class="annottext">fstate :: FCodeState
</span><a href="#local-6989586621681936089"><span class="hs-identifier hs-var hs-var">fstate</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; FCodeState
</span><a href="GHC.StgToCmm.Monad.html#initFCodeState"><span class="hs-identifier hs-var">initFCodeState</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681936087"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span id="local-6989586621681936090"><span class="annot"><span class="annottext">cmm_cfg :: CmmConfig
</span><a href="#local-6989586621681936090"><span class="hs-identifier hs-var hs-var">cmm_cfg</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; CmmConfig
</span><a href="GHC.Driver.Config.Cmm.html#initCmmConfig"><span class="hs-identifier hs-var">initCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681936086"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span id="local-6989586621681936092"><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681936092"><span class="hs-identifier hs-var">cgState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CgState -&gt; Stream IO CmmGroupSRTs CgState
forall a. IO a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO CgState
</span><a href="GHC.StgToCmm.Monad.html#initC"><span class="hs-identifier hs-var">initC</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-comment">-- Yield Cmm for Info Table Provenance Entries (IPEs)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681936093"><span class="annot"><span class="annottext">denv' :: InfoTableProvMap
</span><a href="#local-6989586621681936093"><span class="hs-identifier hs-var hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681936081"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Types.IPE.html#provInfoTables"><span class="hs-identifier hs-var">provInfoTables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#mapKeys/Data.Map.Internal.html#mapKeys"><span class="hs-identifier hs-type">Map.mapKeys</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#cit_lbl"><span class="hs-identifier hs-var">cit_lbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681936084"><span class="hs-identifier hs-type">infoTablesWithTickishes</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681936096"><span class="annot"><span class="annottext">Maybe (IPEStats, CStub)
</span><a href="#local-6989586621681936096"><span class="hs-identifier hs-var">mIpeStub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936097"><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681936097"><span class="hs-identifier hs-var">ipeCmmGroup</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; FCodeState
-&gt; CgState
-&gt; FCode (Maybe (IPEStats, CStub), CmmGroup)
-&gt; ((Maybe (IPEStats, CStub), CmmGroup), CgState)
forall a.
StgToCmmConfig -&gt; FCodeState -&gt; CgState -&gt; FCode a -&gt; (a, CgState)
</span><a href="GHC.StgToCmm.Monad.html#runC"><span class="hs-identifier hs-var">runC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; StgToCmmConfig
</span><a href="GHC.Driver.Config.StgToCmm.html#initStgToCmmConfig"><span class="hs-identifier hs-var">initStgToCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681936086"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681936080"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FCodeState
</span><a href="#local-6989586621681936089"><span class="hs-identifier hs-var">fstate</span></a></span><span> </span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681936092"><span class="hs-identifier hs-var">cgState</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode (Maybe (IPEStats, CStub), CmmGroup)
 -&gt; ((Maybe (IPEStats, CStub), CmmGroup), CgState))
-&gt; FCode (Maybe (IPEStats, CStub), CmmGroup)
-&gt; ((Maybe (IPEStats, CStub), CmmGroup), CgState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FCode (Maybe (IPEStats, CStub))
-&gt; FCode (Maybe (IPEStats, CStub), CmmGroup)
forall a. FCode a -&gt; FCode (a, CmmGroup)
</span><a href="GHC.StgToCmm.Monad.html#getCmm"><span class="hs-identifier hs-var">getCmm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IPEStats
-&gt; [CmmInfoTable]
-&gt; InfoTableProvMap
-&gt; FCode (Maybe (IPEStats, CStub))
</span><a href="GHC.StgToCmm.Prof.html#initInfoTableProv"><span class="hs-identifier hs-var">initInfoTableProv</span></a></span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936085"><span class="hs-identifier hs-var">initStats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation) -&gt; [CmmInfoTable]
forall k a. Map k a -&gt; [k]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#keys/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936084"><span class="hs-identifier hs-var">infoTablesWithTickishes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681936093"><span class="hs-identifier hs-var">denv'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936100"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681936100"><span class="hs-identifier hs-var">ipeCmmGroupSRTs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ModuleSRTInfo, CmmGroupSRTs)
-&gt; Stream IO CmmGroupSRTs (ModuleSRTInfo, CmmGroupSRTs)
forall a. IO a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ModuleSRTInfo, CmmGroupSRTs)
 -&gt; Stream IO CmmGroupSRTs (ModuleSRTInfo, CmmGroupSRTs))
-&gt; IO (ModuleSRTInfo, CmmGroupSRTs)
-&gt; Stream IO CmmGroupSRTs (ModuleSRTInfo, CmmGroupSRTs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; CmmConfig
-&gt; ModuleSRTInfo
-&gt; CmmGroup
-&gt; IO (ModuleSRTInfo, CmmGroupSRTs)
</span><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier hs-var">cmmPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681936088"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621681936090"><span class="hs-identifier hs-var">cmm_cfg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleSRTInfo
</span><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-var">emptySRT</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681936080"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681936097"><span class="hs-identifier hs-var">ipeCmmGroup</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; Stream IO CmmGroupSRTs ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Stream m a ()
</span><a href="GHC.Data.Stream.html#yield"><span class="hs-identifier hs-var">Stream.yield</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681936100"><span class="hs-identifier hs-var">ipeCmmGroupSRTs</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>  </span><span id="local-6989586621681936102"><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621681936102"><span class="hs-identifier hs-var">ipeStub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (IPEStats, CStub)
</span><a href="#local-6989586621681936096"><span class="hs-identifier hs-var">mIpeStub</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681936103"><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936103"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936104"><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621681936104"><span class="hs-identifier hs-var">stub</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-comment">-- Print ipe stats if requested</span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; Stream IO CmmGroupSRTs ()
forall a. IO a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Stream IO CmmGroupSRTs ())
-&gt; IO () -&gt; Stream IO CmmGroupSRTs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-222"></span><span>          </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">Logger.putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681936088"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_ipe_stats"><span class="hs-identifier hs-var">Opt_D_ipe_stats</span></a></span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IPE Stats for module &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; String) -&gt; ModuleName -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681936080"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">Logger.FormatText</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IPEStats -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936103"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">CStub -&gt; Stream IO CmmGroupSRTs CStub
forall a. a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621681936104"><span class="hs-identifier hs-var">stub</span></a></span><span>
</span><span id="line-228"></span><span>      </span><span class="annot"><span class="annottext">Maybe (IPEStats, CStub)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CStub -&gt; Stream IO CmmGroupSRTs CStub
forall a. a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CStub
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="annottext">CmmCgInfos -&gt; Stream IO CmmGroupSRTs CmmCgInfos
forall a. a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">cgNonCafs :: NonCaffySet
</span><a href="GHC.StgToCmm.Types.html#cgNonCafs"><span class="hs-identifier hs-var">cgNonCafs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonCaffySet
</span><a href="#local-6989586621681936082"><span class="hs-identifier hs-var">nonCaffySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgLFInfos :: ModuleLFInfos
</span><a href="GHC.StgToCmm.Types.html#cgLFInfos"><span class="hs-identifier hs-var">cgLFInfos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621681936083"><span class="hs-identifier hs-var">moduleLFInfos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgIPEStub :: CStub
</span><a href="GHC.StgToCmm.Types.html#cgIPEStub"><span class="hs-identifier hs-var">cgIPEStub</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621681936102"><span class="hs-identifier hs-var">ipeStub</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">-- | Given:</span><span>
</span><span id="line-233"></span><span class="hs-comment">--   * an initial mapping from info tables to possible source locations,</span><span>
</span><span id="line-234"></span><span class="hs-comment">--   * initial 'IPEStats',</span><span>
</span><span id="line-235"></span><span class="hs-comment">--   * a 'CmmGroupSRTs',</span><span>
</span><span id="line-236"></span><span class="hs-comment">--</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- map every info table listed in the 'CmmProc's of the group to their possible</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- source locations and update 'IPEStats' for skipped stack info tables (in case</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- both -finfo-table-map and -fno-info-table-map-with-stack were given). See:</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- Note [Stacktraces from Info Table Provenance Entries (IPE based stack unwinding)]</span><span>
</span><span id="line-241"></span><span class="hs-comment">--</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- Note: While it would be cleaner if we could keep the recursion and</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- accumulation internal to this function, this cannot be done without</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- separately traversing stream of 'CmmGroupSRTs' in 'GHC.Driver.Main'. The</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- initial implementation of this logic did such a thing, and code generation</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- performance suffered considerably as a result (see #23103).</span><span>
</span><span id="line-247"></span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#lookupEstimatedTicks"><span class="hs-identifier hs-type">lookupEstimatedTicks</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span id="lookupEstimatedTicks"><span class="annot"><span class="annottext">lookupEstimatedTicks :: HscEnv
-&gt; Map CmmInfoTable (Maybe IpeSourceLocation)
-&gt; IPEStats
-&gt; CmmGroupSRTs
-&gt; IO (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
</span><a href="GHC.Driver.GenerateCgIPEStub.html#lookupEstimatedTicks"><span class="hs-identifier hs-var hs-var">lookupEstimatedTicks</span></a></span></span><span> </span><span id="local-6989586621681936113"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681936113"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681936114"><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936114"><span class="hs-identifier hs-var">ipes</span></a></span></span><span> </span><span id="local-6989586621681936115"><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936115"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span id="local-6989586621681936116"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681936116"><span class="hs-identifier hs-var">cmm_group_srts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-comment">-- Pass 2: Create an entry in the IPE map for every info table listed in</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- this CmmGroupSRTs. If the info table is a stack info table and</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-comment">-- -finfo-table-map-with-stack is enabled, look up its estimated source</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- location in the map generate during Pass 1. If the info table is a stack</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-comment">-- info table and -finfo-table-map-with-stack is not enabled, skip the table</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-comment">-- and note it as skipped in the IPE stats. If the info table is not a stack</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-comment">-- info table, insert into the IPE map with no source location information</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-comment">-- (for now; see `convertInfoProvMap` in GHC.StgToCmm.Utils to see how source</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-comment">-- locations for these tables get filled in)</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="annottext">(Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; IO (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">((Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
 -&gt; IO (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats))
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; IO (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
 -&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
 -&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats))
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; CmmGroupSRTs
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
</span><a href="#local-6989586621681936118"><span class="hs-identifier hs-var">collectInfoTables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936114"><span class="hs-identifier hs-var">ipes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936115"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681936116"><span class="hs-identifier hs-var">cmm_group_srts</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621681936119"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681936119"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681936113"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621681936120"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681936120"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681936119"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- Pass 1: Map every label meeting the conditions described in Note</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- [Stacktraces from Info Table Provenance Entries (IPE based stack</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-comment">-- unwinding)] to the estimated source location (also as described in the</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-comment">-- aformentioned note)</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-comment">-- Note: It's important that this remains a thunk so we do not compute this</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- map if -fno-info-table-with-stack is given</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="#local-6989586621681936121"><span class="hs-identifier hs-type">labelsToSources</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621681936121"><span class="annot"><span class="annottext">labelsToSources :: Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936121"><span class="hs-identifier hs-var hs-var">labelsToSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformTablesNextToCode"><span class="hs-identifier hs-var">platformTablesNextToCode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681936120"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">(Map CLabel IpeSourceLocation
 -&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
 -&gt; Map CLabel IpeSourceLocation)
-&gt; Map CLabel IpeSourceLocation
-&gt; CmmGroupSRTs
-&gt; Map CLabel IpeSourceLocation
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
-&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; Map CLabel IpeSourceLocation
</span><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesWithTNTC"><span class="hs-identifier hs-var">labelsToSourcesWithTNTC</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681936116"><span class="hs-identifier hs-var">cmm_group_srts</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">(Map CLabel IpeSourceLocation
 -&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
 -&gt; Map CLabel IpeSourceLocation)
-&gt; Map CLabel IpeSourceLocation
-&gt; CmmGroupSRTs
-&gt; Map CLabel IpeSourceLocation
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
-&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; Map CLabel IpeSourceLocation
</span><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesSansTNTC"><span class="hs-identifier hs-var">labelsToSourcesSansTNTC</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681936116"><span class="hs-identifier hs-var">cmm_group_srts</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="#local-6989586621681936118"><span class="hs-identifier hs-type">collectInfoTables</span></a></span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmTopInfo"><span class="hs-identifier hs-type">CmmTopInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621681936118"><span class="annot"><span class="annottext">collectInfoTables :: (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
</span><a href="#local-6989586621681936118"><span class="hs-identifier hs-var hs-var">collectInfoTables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681936125"><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936125"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681936126"><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936126"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621681936127"><span class="annot"><span class="annottext">CmmTopInfo
</span><a href="#local-6989586621681936127"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="annottext">((Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
 -&gt; KeyOf LabelMap
 -&gt; CmmInfoTable
 -&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats))
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; LabelMap CmmInfoTable
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
forall b a. (b -&gt; KeyOf LabelMap -&gt; a -&gt; b) -&gt; b -&gt; LabelMap a -&gt; b
forall (map :: * -&gt; *) b a.
IsMap map =&gt;
(b -&gt; KeyOf map -&gt; a -&gt; b) -&gt; b -&gt; map a -&gt; b
</span><a href="GHC.Cmm.Dataflow.Collections.html#mapFoldlWithKey"><span class="hs-identifier hs-var">mapFoldlWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; KeyOf LabelMap
-&gt; CmmInfoTable
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
(Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; Label
-&gt; CmmInfoTable
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
</span><a href="#local-6989586621681936129"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936125"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936126"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmTopInfo -&gt; LabelMap CmmInfoTable
</span><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="annot"><span class="annottext">CmmTopInfo
</span><a href="#local-6989586621681936127"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><a href="#local-6989586621681936129"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span>
</span><span id="line-291"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span>
</span><span id="line-292"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#IPEStats"><span class="hs-identifier hs-type">IPEStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621681936129"><span class="annot"><span class="annottext">go :: (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
-&gt; Label
-&gt; CmmInfoTable
-&gt; (Map CmmInfoTable (Maybe IpeSourceLocation), IPEStats)
</span><a href="#local-6989586621681936129"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681936131"><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936131"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681936132"><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936132"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681936133"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681936133"><span class="hs-identifier hs-var">lbl'</span></a></span></span><span> </span><span id="local-6989586621681936134"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681936134"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-295"></span><span>            </span><span id="local-6989586621681936135"><span class="annot"><span class="annottext">lbl :: CLabel
</span><a href="#local-6989586621681936135"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformTablesNextToCode"><span class="hs-identifier hs-var">platformTablesNextToCode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681936120"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-comment">-- TNTC case, the mapped CLabel will be the result of</span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-comment">-- mkAsmTempLabel on the info table label</span><span>
</span><span id="line-299"></span><span>                </span><span class="annot"><span class="annottext">Label -&gt; CLabel
forall a. Uniquable a =&gt; a -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkAsmTempLabel"><span class="hs-identifier hs-var">mkAsmTempLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681936133"><span class="hs-identifier hs-var">lbl'</span></a></span><span>
</span><span id="line-300"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-301"></span><span>                </span><span class="hs-comment">-- Non-TNTC case, the mapped CLabel will be the CLabel of the</span><span>
</span><span id="line-302"></span><span>                </span><span class="hs-comment">-- info table itself</span><span>
</span><span id="line-303"></span><span>                </span><span class="annot"><span class="annottext">CmmInfoTable -&gt; CLabel
</span><a href="GHC.Cmm.html#cit_lbl"><span class="hs-identifier hs-var">cit_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681936134"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-304"></span><span>          </span><span class="hs-keyword">in</span><span>
</span><span id="line-305"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isStackRep"><span class="hs-identifier hs-var">isStackRep</span></a></span><span> </span><span class="annot"><span class="annottext">(SMRep -&gt; Bool) -&gt; (CmmInfoTable -&gt; SMRep) -&gt; CmmInfoTable -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable -&gt; SMRep
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681936134"><span class="hs-identifier hs-var">tbl</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-306"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_InfoTableMapWithStack"><span class="hs-identifier hs-var">Opt_InfoTableMapWithStack</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681936119"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-307"></span><span>                </span><span class="hs-comment">-- This is a stack info table and we DO want to put it in the</span><span>
</span><span id="line-308"></span><span>                </span><span class="hs-comment">-- info table map</span><span>
</span><span id="line-309"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable
-&gt; Maybe IpeSourceLocation
-&gt; Map CmmInfoTable (Maybe IpeSourceLocation)
-&gt; Map CmmInfoTable (Maybe IpeSourceLocation)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insert/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681936134"><span class="hs-identifier hs-var">tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Map CLabel IpeSourceLocation -&gt; Maybe IpeSourceLocation
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681936135"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936121"><span class="hs-identifier hs-var">labelsToSources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936131"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936132"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-311"></span><span>                </span><span class="hs-comment">-- This is a stack info table but we DO NOT want to put it in</span><span>
</span><span id="line-312"></span><span>                </span><span class="hs-comment">-- the info table map (-fno-info-table-map-with-stack was</span><span>
</span><span id="line-313"></span><span>                </span><span class="hs-comment">-- given), track it as skipped</span><span>
</span><span id="line-314"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936131"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936132"><span class="hs-identifier hs-var">stats</span></a></span><span> </span><span class="annot"><span class="annottext">IPEStats -&gt; IPEStats -&gt; IPEStats
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="GHC.StgToCmm.Utils.html#skippedIpeStats"><span class="hs-identifier hs-var">skippedIpeStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-316"></span><span>              </span><span class="hs-comment">-- This is not a stack info table, so put it in the map with no</span><span>
</span><span id="line-317"></span><span>              </span><span class="hs-comment">-- source location (for now)</span><span>
</span><span id="line-318"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable
-&gt; Maybe IpeSourceLocation
-&gt; Map CmmInfoTable (Maybe IpeSourceLocation)
-&gt; Map CmmInfoTable (Maybe IpeSourceLocation)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insert/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681936134"><span class="hs-identifier hs-var">tbl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936131"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936132"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="#local-6989586621681936118"><span class="hs-identifier hs-var">collectInfoTables</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681936142"><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936142"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681936143"><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936143"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CmmInfoTable (Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936142"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IPEStats
</span><a href="#local-6989586621681936143"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">-- | See Note [Stacktraces from Info Table Provenance Entries (IPE based stack unwinding)]</span></span><span>
</span><span id="line-322"></span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesWithTNTC"><span class="hs-identifier hs-type">labelsToSourcesWithTNTC</span></a></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmTopInfo"><span class="hs-identifier hs-type">CmmTopInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-326"></span><span id="labelsToSourcesWithTNTC"><span class="annot"><span class="annottext">labelsToSourcesWithTNTC :: Map CLabel IpeSourceLocation
-&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; Map CLabel IpeSourceLocation
</span><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesWithTNTC"><span class="hs-identifier hs-var hs-var">labelsToSourcesWithTNTC</span></a></span></span><span> </span><span id="local-6989586621681936144"><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936144"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">CmmTopInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681936145"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621681936145"><span class="hs-identifier hs-var">cmm_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><span class="annottext">(Map CLabel IpeSourceLocation
 -&gt; CmmBlock -&gt; Map CLabel IpeSourceLocation)
-&gt; Map CLabel IpeSourceLocation
-&gt; [CmmBlock]
-&gt; Map CLabel IpeSourceLocation
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
-&gt; CmmBlock -&gt; Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936146"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936144"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGraph -&gt; [CmmBlock]
</span><a href="GHC.Cmm.html#toBlockList"><span class="hs-identifier hs-var">toBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621681936145"><span class="hs-identifier hs-var">cmm_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="#local-6989586621681936146"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621681936146"><span class="annot"><span class="annottext">go :: Map CLabel IpeSourceLocation
-&gt; CmmBlock -&gt; Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936146"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681936148"><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936148"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681936149"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621681936149"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; IpeSourceLocation -&gt; (CLabel, IpeSourceLocation))
-&gt; Maybe CLabel
-&gt; Maybe (IpeSourceLocation -&gt; (CLabel, IpeSourceLocation))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CLabel
</span><a href="#local-6989586621681936151"><span class="hs-identifier hs-var">returnFrameLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IpeSourceLocation -&gt; (CLabel, IpeSourceLocation))
-&gt; Maybe IpeSourceLocation -&gt; Maybe (CLabel, IpeSourceLocation)
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681936152"><span class="hs-identifier hs-var">lastTickInBlock</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-332"></span><span>          </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681936153"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681936153"><span class="hs-identifier hs-var">clabel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936154"><span class="annot"><span class="annottext">IpeSourceLocation
</span><a href="#local-6989586621681936154"><span class="hs-identifier hs-var">src_loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CLabel
-&gt; IpeSourceLocation
-&gt; Map CLabel IpeSourceLocation
-&gt; Map CLabel IpeSourceLocation
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insert/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681936153"><span class="hs-identifier hs-var">clabel</span></a></span><span> </span><span class="annot"><span class="annottext">IpeSourceLocation
</span><a href="#local-6989586621681936154"><span class="hs-identifier hs-var">src_loc</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936148"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-333"></span><span>          </span><span class="annot"><span class="annottext">Maybe (CLabel, IpeSourceLocation)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936148"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936155"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681936155"><span class="hs-identifier hs-var">middleBlock</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936156"><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621681936156"><span class="hs-identifier hs-var">endBlock</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; (CmmNode C O, Block CmmNode O O, CmmNode O C)
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n C C -&gt; (n C O, Block n O O, n O C)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621681936149"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><a href="#local-6989586621681936151"><span class="hs-identifier hs-type">returnFrameLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span id="local-6989586621681936151"><span class="annot"><span class="annottext">returnFrameLabel :: Maybe CLabel
</span><a href="#local-6989586621681936151"><span class="hs-identifier hs-var hs-var">returnFrameLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621681936156"><span class="hs-identifier hs-var">endBlock</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-340"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681936161"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681936161"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe CLabel
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; Maybe CLabel) -&gt; CLabel -&gt; Maybe CLabel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Label -&gt; CLabel
forall a. Uniquable a =&gt; a -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkAsmTempLabel"><span class="hs-identifier hs-var">mkAsmTempLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681936161"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-341"></span><span>            </span><span class="annot"><span class="annottext">CmmNode O C
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CLabel
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>        </span><span id="local-6989586621681936152"><span class="annot"><span class="annottext">lastTickInBlock :: Maybe IpeSourceLocation
</span><a href="#local-6989586621681936152"><span class="hs-identifier hs-var hs-var">lastTickInBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; Maybe IpeSourceLocation -&gt; Maybe IpeSourceLocation)
-&gt; Maybe IpeSourceLocation
-&gt; [CmmNode O O]
-&gt; Maybe IpeSourceLocation
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O O -&gt; Maybe IpeSourceLocation -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681936163"><span class="hs-identifier hs-var">maybeTick</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; [CmmNode O O]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n O O -&gt; [n O O]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681936155"><span class="hs-identifier hs-var">middleBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><a href="#local-6989586621681936163"><span class="hs-identifier hs-type">maybeTick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-346"></span><span>        </span><span id="local-6989586621681936163"><span class="annot"><span class="annottext">maybeTick :: CmmNode O O -&gt; Maybe IpeSourceLocation -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681936163"><span class="hs-identifier hs-var hs-var">maybeTick</span></a></span></span><span> </span><span class="annot"><span class="annottext">CmmNode O O
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681936164"><span class="annot"><span class="annottext">s :: Maybe IpeSourceLocation
</span><a href="#local-6989586621681936164"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">IpeSourceLocation
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681936164"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span class="annot"><a href="#local-6989586621681936163"><span class="hs-identifier hs-var">maybeTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-type">CmmTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier hs-type">SourceNote</span></a></span><span> </span><span id="local-6989586621681936168"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681936168"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621681936169"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681936169"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IpeSourceLocation -&gt; Maybe IpeSourceLocation
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681936168"><span class="hs-identifier hs-var">span</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681936169"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><a href="#local-6989586621681936163"><span class="hs-identifier hs-var">maybeTick</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O O
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-349"></span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesWithTNTC"><span class="hs-identifier hs-var">labelsToSourcesWithTNTC</span></a></span><span> </span><span id="local-6989586621681936170"><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936170"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936170"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><span class="hs-comment">-- | See Note [Stacktraces from Info Table Provenance Entries (IPE based stack unwinding)]</span></span><span>
</span><span id="line-352"></span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesSansTNTC"><span class="hs-identifier hs-type">labelsToSourcesSansTNTC</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmTopInfo"><span class="hs-identifier hs-type">CmmTopInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-356"></span><span id="labelsToSourcesSansTNTC"><span class="annot"><span class="annottext">labelsToSourcesSansTNTC :: Map CLabel IpeSourceLocation
-&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; Map CLabel IpeSourceLocation
</span><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesSansTNTC"><span class="hs-identifier hs-var hs-var">labelsToSourcesSansTNTC</span></a></span></span><span> </span><span id="local-6989586621681936171"><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936171"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">CmmTopInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681936172"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621681936172"><span class="hs-identifier hs-var">cmm_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><span class="annottext">(Map CLabel IpeSourceLocation
 -&gt; CmmBlock -&gt; Map CLabel IpeSourceLocation)
-&gt; Map CLabel IpeSourceLocation
-&gt; [CmmBlock]
-&gt; Map CLabel IpeSourceLocation
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
-&gt; CmmBlock -&gt; Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936173"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936171"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGraph -&gt; [CmmBlock]
</span><a href="GHC.Cmm.html#toBlockList"><span class="hs-identifier hs-var">toBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621681936172"><span class="hs-identifier hs-var">cmm_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><a href="#local-6989586621681936173"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span id="local-6989586621681936173"><span class="annot"><span class="annottext">go :: Map CLabel IpeSourceLocation
-&gt; CmmBlock -&gt; Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936173"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681936174"><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936174"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681936175"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621681936175"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
-&gt; Map CLabel IpeSourceLocation
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
 -&gt; Map CLabel IpeSourceLocation)
-&gt; (Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
-&gt; Map CLabel IpeSourceLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
 -&gt; CmmNode O O
 -&gt; (Map CLabel IpeSourceLocation, Maybe IpeSourceLocation))
-&gt; (Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
-&gt; [CmmNode O O]
-&gt; (Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
-&gt; CmmNode O O
-&gt; (Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936177"><span class="hs-identifier hs-var">collectLabels</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936174"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; [CmmNode O O]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n O O -&gt; [n O O]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681936178"><span class="hs-identifier hs-var">middleBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936178"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681936178"><span class="hs-identifier hs-var">middleBlock</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; (CmmNode C O, Block CmmNode O O, CmmNode O C)
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n C C -&gt; (n C O, Block n O O, n O C)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621681936175"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><a href="#local-6989586621681936177"><span class="hs-identifier hs-type">collectLabels</span></a></span><span>
</span><span id="line-365"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-367"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>        </span><span id="local-6989586621681936177"><span class="annot"><span class="annottext">collectLabels :: (Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
-&gt; CmmNode O O
-&gt; (Map CLabel IpeSourceLocation, Maybe IpeSourceLocation)
</span><a href="#local-6989586621681936177"><span class="hs-identifier hs-var hs-var">collectLabels</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681936179"><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936179"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681936180"><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681936180"><span class="hs-identifier hs-var">lastTick</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681936181"><span class="annot"><span class="annottext">CmmNode O O
</span><a href="#local-6989586621681936181"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode O O
</span><a href="#local-6989586621681936181"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681936180"><span class="hs-identifier hs-var">lastTick</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621681936188"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681936188"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681936189"><span class="annot"><span class="annottext">IpeSourceLocation
</span><a href="#local-6989586621681936189"><span class="hs-identifier hs-var">src_loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel
-&gt; IpeSourceLocation
-&gt; Map CLabel IpeSourceLocation
-&gt; Map CLabel IpeSourceLocation
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insert/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681936188"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">IpeSourceLocation
</span><a href="#local-6989586621681936189"><span class="hs-identifier hs-var">src_loc</span></a></span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936179"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-type">CmmTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier hs-type">SourceNote</span></a></span><span> </span><span id="local-6989586621681936192"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681936192"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621681936193"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681936193"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936179"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IpeSourceLocation -&gt; Maybe IpeSourceLocation
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681936192"><span class="hs-identifier hs-var">span</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681936193"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="annottext">(CmmNode O O, Maybe IpeSourceLocation)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936179"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681936180"><span class="hs-identifier hs-var">lastTick</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#labelsToSourcesSansTNTC"><span class="hs-identifier hs-var">labelsToSourcesSansTNTC</span></a></span><span> </span><span id="local-6989586621681936194"><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936194"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map CLabel IpeSourceLocation
</span><a href="#local-6989586621681936194"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-376"></span></pre></body></html>