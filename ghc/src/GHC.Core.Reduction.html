<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Core.Reduction</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-7"></span><span>     </span><span class="annot"><span class="hs-comment">-- * Reductions</span></span><span>
</span><span id="line-8"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier">Reduction</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ReductionN"><span class="hs-identifier">ReductionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ReductionR"><span class="hs-identifier">ReductionR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#HetReduction"><span class="hs-identifier">HetReduction</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier">Reductions</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier">mkReduction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkReductions"><span class="hs-identifier">mkReductions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkHetReduction"><span class="hs-identifier">mkHetReduction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#coercionRedn"><span class="hs-identifier">coercionRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#reductionOriginalType"><span class="hs-identifier">reductionOriginalType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#downgradeRedn"><span class="hs-identifier">downgradeRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkSubRedn"><span class="hs-identifier">mkSubRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkTransRedn"><span class="hs-identifier">mkTransRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCoherenceRightRedn"><span class="hs-identifier">mkCoherenceRightRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCoherenceRightMRedn"><span class="hs-identifier">mkCoherenceRightMRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCastRedn1"><span class="hs-identifier">mkCastRedn1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCastRedn2"><span class="hs-identifier">mkCastRedn2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier">mkReflRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflRightRedn"><span class="hs-identifier">mkGReflRightRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflRightMRedn"><span class="hs-identifier">mkGReflRightMRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflLeftRedn"><span class="hs-identifier">mkGReflLeftRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflLeftMRedn"><span class="hs-identifier">mkGReflLeftMRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkAppRedn"><span class="hs-identifier">mkAppRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkAppRedns"><span class="hs-identifier">mkAppRedns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkFunRedn"><span class="hs-identifier">mkFunRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkForAllRedn"><span class="hs-identifier">mkForAllRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkHomoForAllRedn"><span class="hs-identifier">mkHomoForAllRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkTyConAppRedn"><span class="hs-identifier">mkTyConAppRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkClassPredRedn"><span class="hs-identifier">mkClassPredRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#mkProofIrrelRedn"><span class="hs-identifier">mkProofIrrelRedn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkReflCoRedn"><span class="hs-identifier">mkReflCoRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#homogeniseHetRedn"><span class="hs-identifier">homogeniseHetRedn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#unzipRedns"><span class="hs-identifier">unzipRedns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>     </span><span class="annot"><span class="hs-comment">-- * Rewriting type arguments</span></span><span>
</span><span id="line-24"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier">ArgsReductions</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>     </span><span class="annot"><a href="GHC.Core.Reduction.html#simplifyArgsWorker"><span class="hs-identifier">simplifyArgsWorker</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier">Class</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier">classTyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier">mkClassPred</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier">TyCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html"><span class="hs-identifier">GHC.Data.Pair</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier">Pair</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier">Pair</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html"><span class="hs-identifier">GHC.Data.List.Infinite</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier">Infinite</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html"><span class="hs-identifier">GHC.Data.List.Infinite</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Inf</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier">VarBndr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#setTyVarKind"><span class="hs-identifier">setTyVarKind</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier">mkInScopeSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier">TyCoVarSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier">HasDebugCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier">equalLength</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier">assertPpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
      Reductions
%*                                                                      *
%************************************************************************

Note [The Reduction type]
~~~~~~~~~~~~~~~~~~~~~~~~~
Many functions in the type-checker rewrite a type, using Given type equalitie
or type-family reductions, and return a Reduction, which is just a pair of the
coercion and the RHS type of the coercion:
  data Reduction = Reduction Coercion !Type

The order of the arguments to the constructor serves as a reminder
of what the Type is.  In
    Reduction co ty
`ty` appears to the right of `co`, reminding us that we must have:
    co :: unrewritten_ty ~ ty

Example functions that use this datatype:
   GHC.Core.FamInstEnv.topNormaliseType_maybe
     :: FamInstEnvs -&gt; Type -&gt; Maybe Reduction
   GHC.Tc.Solver.Rewrite.rewrite
     :: CtEvidence -&gt; TcType -&gt; TcS Reduction

Having Reduction as a data type, with a strict Type field, rather than using
a pair (Coercion,Type) gives several advantages (see #20161)
* The strictness in Type improved performance in rewriting of type families
  (around 2.5% improvement in T9872),
* Compared to the situation before, it gives improved consistency around
  orientation of rewritings, as a Reduction is always left-to-right
  (the coercion's RHS type is always the type stored in the 'Reduction').
  No more 'mkSymCo's needed to convert between left-to-right and right-to-left.

One could imagine storing the LHS type of the coercion in the Reduction as well,
but in fact `reductionOriginalType` is very seldom used, so it's not worth it.
-}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | A 'Reduction' is the result of an operation that rewrites a type @ty_in@.</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- The 'Reduction' includes the rewritten type @ty_out@ and a 'Coercion' @co@</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- such that @co :: ty_in ~ ty_out@, where the role of the coercion is determined</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- by the context. That is, the LHS type of the coercion is the original type</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- @ty_in@, while its RHS type is the rewritten type @ty_out@.</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- A Reduction is always homogeneous, unless it is wrapped inside a 'HetReduction',</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- which separately stores the kind coercion.</span><span>
</span><span id="line-96"></span><span class="hs-comment">--</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- See Note [The Reduction type].</span><span>
</span><span id="line-98"></span><span class="hs-keyword">data</span><span> </span><span id="Reduction"><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-var">Reduction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>  </span><span id="Reduction"><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-var">Reduction</span></a></span></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="reductionCoercion"><span class="annot"><span class="annottext">Reduction -&gt; Coercion
</span><a href="GHC.Core.Reduction.html#reductionCoercion"><span class="hs-identifier hs-var hs-var">reductionCoercion</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="reductionReducedType"><span class="annot"><span class="annottext">Reduction -&gt; Type
</span><a href="GHC.Core.Reduction.html#reductionReducedType"><span class="hs-identifier hs-var hs-var">reductionReducedType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- N.B. the 'Coercion' field must be lazy: see for instance GHC.Tc.Solver.Rewrite.rewrite_tyvar2</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- which returns an error in the 'Coercion' field when dealing with a Derived constraint</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- (which is OK as this Coercion gets ignored later).</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- We might want to revisit the strictness once Deriveds are removed.</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | Stores a heterogeneous reduction.</span><span>
</span><span id="line-109"></span><span class="hs-comment">--</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- The stored kind coercion must relate the kinds of the</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- stored reduction. That is, in @HetReduction (Reduction co xi) kco@,</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- we must have:</span><span>
</span><span id="line-113"></span><span class="hs-comment">--</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- &gt;  co :: ty ~ xi</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- &gt; kco :: typeKind ty ~ typeKind xi</span><span>
</span><span id="line-116"></span><span class="hs-keyword">data</span><span> </span><span id="HetReduction"><span class="annot"><a href="GHC.Core.Reduction.html#HetReduction"><span class="hs-identifier hs-var">HetReduction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>  </span><span id="HetReduction"><span class="annot"><a href="GHC.Core.Reduction.html#HetReduction"><span class="hs-identifier hs-var">HetReduction</span></a></span></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">-- N.B. strictness annotations don't seem to make a difference here</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Create a heterogeneous reduction.</span><span>
</span><span id="line-123"></span><span class="hs-comment">--</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- Pre-condition: the provided kind coercion (second argument)</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- relates the kinds of the stored reduction.</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- That is, if the coercion stored in the 'Reduction' is of the form</span><span>
</span><span id="line-127"></span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- &gt; co :: ty ~ xi</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- Then the kind coercion supplied must be of the form:</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- &gt; kco :: typeKind ty ~ typeKind xi</span><span>
</span><span id="line-133"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkHetReduction"><span class="hs-identifier hs-type">mkHetReduction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ heterogeneous reduction</span></span><span>
</span><span id="line-134"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ kind coercion</span></span><span>
</span><span id="line-135"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#HetReduction"><span class="hs-identifier hs-type">HetReduction</span></a></span><span>
</span><span id="line-136"></span><span id="mkHetReduction"><span class="annot"><span class="annottext">mkHetReduction :: Reduction -&gt; MCoercionN -&gt; HetReduction
</span><a href="GHC.Core.Reduction.html#mkHetReduction"><span class="hs-identifier hs-var hs-var">mkHetReduction</span></a></span></span><span> </span><span id="local-6989586621681625064"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625064"><span class="hs-identifier hs-var">redn</span></a></span></span><span> </span><span id="local-6989586621681625065"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625065"><span class="hs-identifier hs-var">mco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; MCoercionN -&gt; HetReduction
</span><a href="GHC.Core.Reduction.html#HetReduction"><span class="hs-identifier hs-var">HetReduction</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625064"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625065"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-137"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkHetReduction"><span class="hs-pragma hs-type">mkHetReduction</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- | Homogenise a heterogeneous reduction.</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- Given @HetReduction (Reduction co xi) kco@, with</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- &gt;  co :: ty ~ xi</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- &gt; kco :: typeKind(ty) ~ typeKind(xi)</span><span>
</span><span id="line-145"></span><span class="hs-comment">--</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- this returns the homogeneous reduction:</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- &gt; hco :: ty ~ ( xi |&gt; sym kco )</span><span>
</span><span id="line-149"></span><span class="annot"><a href="GHC.Core.Reduction.html#homogeniseHetRedn"><span class="hs-identifier hs-type">homogeniseHetRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#HetReduction"><span class="hs-identifier hs-type">HetReduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-150"></span><span id="homogeniseHetRedn"><span class="annot"><span class="annottext">homogeniseHetRedn :: Role -&gt; HetReduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#homogeniseHetRedn"><span class="hs-identifier hs-var hs-var">homogeniseHetRedn</span></a></span></span><span> </span><span id="local-6989586621681625066"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625066"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#HetReduction"><span class="hs-identifier hs-type">HetReduction</span></a></span><span> </span><span id="local-6989586621681625067"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625067"><span class="hs-identifier hs-var">redn</span></a></span></span><span> </span><span id="local-6989586621681625068"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625068"><span class="hs-identifier hs-var">kco</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Reduction -&gt; MCoercionN -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkCoherenceRightMRedn"><span class="hs-identifier hs-var">mkCoherenceRightMRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625066"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625067"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MCoercionN -&gt; MCoercionN
</span><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var">mkSymMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625068"><span class="hs-identifier hs-var">kco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#homogeniseHetRedn"><span class="hs-pragma hs-type">homogeniseHetRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Create a 'Reduction' from a pair of a 'Coercion' and a 'Type.</span><span>
</span><span id="line-155"></span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- Pre-condition: the RHS type of the coercion matches the provided type</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- (perhaps up to zonking).</span><span>
</span><span id="line-158"></span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- Use 'coercionRedn' when you only have the coercion.</span><span>
</span><span id="line-160"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-type">mkReduction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-161"></span><span id="mkReduction"><span class="annot"><span class="annottext">mkReduction :: Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var hs-var">mkReduction</span></a></span></span><span> </span><span id="local-6989586621681625070"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625070"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681625071"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625071"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-var">Reduction</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625070"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625071"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-162"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-pragma hs-type">mkReduction</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621681625090"><span class="annot"><span class="annottext">ppr :: Reduction -&gt; SDoc
</span><a href="#local-6989586621681625090"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span id="local-6989586621681625092"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625092"><span class="hs-identifier hs-var">redn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-167"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reductionOriginalType:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reduction -&gt; Type
</span><a href="GHC.Core.Reduction.html#reductionOriginalType"><span class="hs-identifier hs-var">reductionOriginalType</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625092"><span class="hs-identifier hs-var">redn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; reductionReducedType:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reduction -&gt; Type
</span><a href="GHC.Core.Reduction.html#reductionReducedType"><span class="hs-identifier hs-var">reductionReducedType</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625092"><span class="hs-identifier hs-var">redn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    reductionCoercion:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reduction -&gt; Coercion
</span><a href="GHC.Core.Reduction.html#reductionCoercion"><span class="hs-identifier hs-var">reductionCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625092"><span class="hs-identifier hs-var">redn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- | A 'Reduction' in which the 'Coercion' has 'Nominal' role.</span></span><span>
</span><span id="line-173"></span><span class="hs-keyword">type</span><span> </span><span id="ReductionN"><span class="annot"><a href="GHC.Core.Reduction.html#ReductionN"><span class="hs-identifier hs-var">ReductionN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><span class="hs-comment">-- | A 'Reduction' in which the 'Coercion' has 'Representational' role.</span></span><span>
</span><span id="line-176"></span><span class="hs-keyword">type</span><span> </span><span id="ReductionR"><span class="annot"><a href="GHC.Core.Reduction.html#ReductionR"><span class="hs-identifier hs-var">ReductionR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Get the original, unreduced type corresponding to a 'Reduction'.</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- This is obtained by computing the LHS kind of the stored coercion,</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- which may be slow.</span><span>
</span><span id="line-182"></span><span class="annot"><a href="GHC.Core.Reduction.html#reductionOriginalType"><span class="hs-identifier hs-type">reductionOriginalType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-183"></span><span id="reductionOriginalType"><span class="annot"><span class="annottext">reductionOriginalType :: Reduction -&gt; Type
</span><a href="GHC.Core.Reduction.html#reductionOriginalType"><span class="hs-identifier hs-var hs-var">reductionOriginalType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Type) -&gt; (Reduction -&gt; Coercion) -&gt; Reduction -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; Coercion
</span><a href="GHC.Core.Reduction.html#reductionCoercion"><span class="hs-identifier hs-var">reductionCoercion</span></a></span><span>
</span><span id="line-184"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#reductionOriginalType"><span class="hs-pragma hs-type">reductionOriginalType</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | Turn a 'Coercion' into a 'Reduction'</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- by inspecting the RHS type of the coercion.</span><span>
</span><span id="line-188"></span><span class="hs-comment">--</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- Prefer using 'mkReduction' when you already know</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- the RHS type of the coercion, to avoid computing it anew.</span><span>
</span><span id="line-191"></span><span class="annot"><a href="GHC.Core.Reduction.html#coercionRedn"><span class="hs-identifier hs-type">coercionRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-192"></span><span id="coercionRedn"><span class="annot"><span class="annottext">coercionRedn :: Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#coercionRedn"><span class="hs-identifier hs-var hs-var">coercionRedn</span></a></span></span><span> </span><span id="local-6989586621681625101"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625101"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-var">Reduction</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625101"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625101"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#coercionRedn"><span class="hs-pragma hs-type">coercionRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><span class="hs-comment">-- | Downgrade the role of the coercion stored in the 'Reduction'.</span></span><span>
</span><span id="line-196"></span><span class="annot"><a href="GHC.Core.Reduction.html#downgradeRedn"><span class="hs-identifier hs-type">downgradeRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ desired role</span></span><span>
</span><span id="line-197"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ current role</span></span><span>
</span><span id="line-198"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-199"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-200"></span><span id="downgradeRedn"><span class="annot"><span class="annottext">downgradeRedn :: Role -&gt; Role -&gt; Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#downgradeRedn"><span class="hs-identifier hs-var hs-var">downgradeRedn</span></a></span></span><span> </span><span id="local-6989586621681625103"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625103"><span class="hs-identifier hs-var">new_role</span></a></span></span><span> </span><span id="local-6989586621681625104"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625104"><span class="hs-identifier hs-var">old_role</span></a></span></span><span> </span><span id="local-6989586621681625105"><span class="annot"><span class="annottext">redn :: Reduction
</span><a href="#local-6989586621681625105"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625106"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625106"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625105"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#reductionCoercion"><span class="hs-identifier hs-var">reductionCoercion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-type">downgradeRole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681625103"><span class="hs-identifier hs-type">new_role</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681625104"><span class="hs-identifier hs-type">old_role</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681625106"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-202"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#downgradeRedn"><span class="hs-pragma hs-type">downgradeRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | Downgrade the role of the coercion stored in the 'Reduction',</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- from 'Nominal' to 'Representational'.</span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkSubRedn"><span class="hs-identifier hs-type">mkSubRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-207"></span><span id="mkSubRedn"><span class="annot"><span class="annottext">mkSubRedn :: Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkSubRedn"><span class="hs-identifier hs-var hs-var">mkSubRedn</span></a></span></span><span> </span><span id="local-6989586621681625108"><span class="annot"><span class="annottext">redn :: Reduction
</span><a href="#local-6989586621681625108"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625109"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625109"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625108"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#reductionCoercion"><span class="hs-identifier hs-var">reductionCoercion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-type">mkSubCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681625109"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkSubRedn"><span class="hs-pragma hs-type">mkSubRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | Compose a reduction with a coercion on the left.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- Pre-condition: the provided coercion's RHS type must match the LHS type</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- of the coercion that is stored in the reduction.</span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkTransRedn"><span class="hs-identifier hs-type">mkTransRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-215"></span><span id="mkTransRedn"><span class="annot"><span class="annottext">mkTransRedn :: Coercion -&gt; Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkTransRedn"><span class="hs-identifier hs-var hs-var">mkTransRedn</span></a></span></span><span> </span><span id="local-6989586621681625111"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625111"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681625112"><span class="annot"><span class="annottext">redn :: Reduction
</span><a href="#local-6989586621681625112"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625113"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625113"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625112"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#reductionCoercion"><span class="hs-identifier hs-var">reductionCoercion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681625111"><span class="hs-identifier hs-type">co1</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-type">`mkTransCo`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681625113"><span class="hs-identifier hs-type">co2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkTransRedn"><span class="hs-pragma hs-type">mkTransRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><span class="hs-comment">-- | The reflexive reduction.</span></span><span>
</span><span id="line-220"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-type">mkReflRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-221"></span><span id="mkReflRedn"><span class="annot"><span class="annottext">mkReflRedn :: Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var hs-var">mkReflRedn</span></a></span></span><span> </span><span id="local-6989586621681625115"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625115"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681625116"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625116"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625115"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625116"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625116"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Create a 'Reduction' from a kind cast, in which</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- the casted type is the rewritten type.</span><span>
</span><span id="line-225"></span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- Given @ty :: k1@, @mco :: k1 ~ k2@,</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- produces the 'Reduction' @ty ~res_co~&gt; (ty |&gt; mco)@</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- at the given 'Role'.</span><span>
</span><span id="line-229"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflRightRedn"><span class="hs-identifier hs-type">mkGReflRightRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-230"></span><span id="mkGReflRightRedn"><span class="annot"><span class="annottext">mkGReflRightRedn :: Role -&gt; Type -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflRightRedn"><span class="hs-identifier hs-var hs-var">mkGReflRightRedn</span></a></span></span><span> </span><span id="local-6989586621681625119"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625119"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625120"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625120"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681625121"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625121"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var">mkGReflRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625119"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625120"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625121"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625120"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625121"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflRightRedn"><span class="hs-pragma hs-type">mkGReflRightRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Create a 'Reduction' from a kind cast, in which</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- the casted type is the rewritten type.</span><span>
</span><span id="line-238"></span><span class="hs-comment">--</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- Given @ty :: k1@, @mco :: k1 ~ k2@,</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- produces the 'Reduction' @ty ~res_co~&gt; (ty |&gt; mco)@</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- at the given 'Role'.</span><span>
</span><span id="line-242"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflRightMRedn"><span class="hs-identifier hs-type">mkGReflRightMRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-243"></span><span id="mkGReflRightMRedn"><span class="annot"><span class="annottext">mkGReflRightMRedn :: Role -&gt; Type -&gt; MCoercionN -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflRightMRedn"><span class="hs-identifier hs-var hs-var">mkGReflRightMRedn</span></a></span></span><span> </span><span id="local-6989586621681625124"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625124"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625125"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625125"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681625126"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625126"><span class="hs-identifier hs-var">mco</span></a></span></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercionN -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier hs-var">mkGReflRightMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625124"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625125"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625126"><span class="hs-identifier hs-var">mco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MCoercionN -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-var">mkCastTyMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625125"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625126"><span class="hs-identifier hs-var">mco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflRightMRedn"><span class="hs-pragma hs-type">mkGReflRightMRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">-- | Create a 'Reduction' from a kind cast, in which</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- the casted type is the original (non-rewritten) type.</span><span>
</span><span id="line-251"></span><span class="hs-comment">--</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- Given @ty :: k1@, @mco :: k1 ~ k2@,</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- produces the 'Reduction' @(ty |&gt; mco) ~res_co~&gt; ty@</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- at the given 'Role'.</span><span>
</span><span id="line-255"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflLeftRedn"><span class="hs-identifier hs-type">mkGReflLeftRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-256"></span><span id="mkGReflLeftRedn"><span class="annot"><span class="annottext">mkGReflLeftRedn :: Role -&gt; Type -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflLeftRedn"><span class="hs-identifier hs-var hs-var">mkGReflLeftRedn</span></a></span></span><span> </span><span id="local-6989586621681625129"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625129"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625130"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625130"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681625131"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625131"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var">mkGReflLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625129"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625130"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625131"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625130"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-260"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflLeftRedn"><span class="hs-pragma hs-type">mkGReflLeftRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Create a 'Reduction' from a kind cast, in which</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- the casted type is the original (non-rewritten) type.</span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- Given @ty :: k1@, @mco :: k1 ~ k2@,</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- produces the 'Reduction' @(ty |&gt; mco) ~res_co~&gt; ty@</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- at the given 'Role'.</span><span>
</span><span id="line-268"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflLeftMRedn"><span class="hs-identifier hs-type">mkGReflLeftMRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-269"></span><span id="mkGReflLeftMRedn"><span class="annot"><span class="annottext">mkGReflLeftMRedn :: Role -&gt; Type -&gt; MCoercionN -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflLeftMRedn"><span class="hs-identifier hs-var hs-var">mkGReflLeftMRedn</span></a></span></span><span> </span><span id="local-6989586621681625133"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625133"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625134"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625134"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681625135"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625135"><span class="hs-identifier hs-var">mco</span></a></span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercionN -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier hs-var">mkGReflLeftMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625133"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625134"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625135"><span class="hs-identifier hs-var">mco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>      </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625134"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-273"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkGReflLeftMRedn"><span class="hs-pragma hs-type">mkGReflLeftMRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-comment">-- | Apply a cast to the result of a 'Reduction'.</span><span>
</span><span id="line-276"></span><span class="hs-comment">--</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- Given a 'Reduction' @ty1 ~co1~&gt; (ty2 :: k2)@ and a kind coercion @kco@</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- with LHS kind @k2@, produce a new 'Reduction' @ty1 ~co2~&gt; ( ty2 |&gt; kco )@</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- of the given 'Role' (which must match the role of the coercion stored</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- in the 'Reduction' argument).</span><span>
</span><span id="line-281"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkCoherenceRightRedn"><span class="hs-identifier hs-type">mkCoherenceRightRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-282"></span><span id="mkCoherenceRightRedn"><span class="annot"><span class="annottext">mkCoherenceRightRedn :: Role -&gt; Reduction -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkCoherenceRightRedn"><span class="hs-identifier hs-var hs-var">mkCoherenceRightRedn</span></a></span></span><span> </span><span id="local-6989586621681625137"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625137"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625138"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625138"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681625139"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625139"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681625140"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625140"><span class="hs-identifier hs-var">kco</span></a></span></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625137"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625139"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625140"><span class="hs-identifier hs-var">kco</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625138"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625139"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625140"><span class="hs-identifier hs-var">kco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCoherenceRightRedn"><span class="hs-pragma hs-type">mkCoherenceRightRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">-- | Apply a cast to the result of a 'Reduction', using an 'MCoercionN'.</span><span>
</span><span id="line-289"></span><span class="hs-comment">--</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- Given a 'Reduction' @ty1 ~co1~&gt; (ty2 :: k2)@ and a kind coercion @mco@</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- with LHS kind @k2@, produce a new 'Reduction' @ty1 ~co2~&gt; ( ty2 |&gt; mco )@</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- of the given 'Role' (which must match the role of the coercion stored</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- in the 'Reduction' argument).</span><span>
</span><span id="line-294"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkCoherenceRightMRedn"><span class="hs-identifier hs-type">mkCoherenceRightMRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-295"></span><span id="mkCoherenceRightMRedn"><span class="annot"><span class="annottext">mkCoherenceRightMRedn :: Role -&gt; Reduction -&gt; MCoercionN -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkCoherenceRightMRedn"><span class="hs-identifier hs-var hs-var">mkCoherenceRightMRedn</span></a></span></span><span> </span><span id="local-6989586621681625142"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625142"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625143"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625143"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681625144"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625144"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681625145"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625145"><span class="hs-identifier hs-var">kco</span></a></span></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercionN -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier hs-var">mkCoherenceRightMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625142"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625144"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625145"><span class="hs-identifier hs-var">kco</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625143"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MCoercionN -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-var">mkCastTyMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625144"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625145"><span class="hs-identifier hs-var">kco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCoherenceRightMRedn"><span class="hs-pragma hs-type">mkCoherenceRightMRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- | Apply a cast to a 'Reduction', casting both the original and the reduced type.</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- Given @cast_co@ and 'Reduction' @ty ~co~&gt; xi@, this function returns</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- the 'Reduction' @(ty |&gt; cast_co) ~return_co~&gt; (xi |&gt; cast_co)@</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- of the given 'Role' (which must match the role of the coercion stored</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- in the 'Reduction' argument).</span><span>
</span><span id="line-307"></span><span class="hs-comment">--</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- Pre-condition: the 'Type' passed in is the same as the LHS type</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- of the coercion stored in the 'Reduction'.</span><span>
</span><span id="line-310"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkCastRedn1"><span class="hs-identifier hs-type">mkCastRedn1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-311"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ original type</span></span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ coercion to cast with</span></span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ rewritten type, with rewriting coercion</span></span><span>
</span><span id="line-314"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-315"></span><span id="mkCastRedn1"><span class="annot"><span class="annottext">mkCastRedn1 :: Role -&gt; Type -&gt; Coercion -&gt; Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkCastRedn1"><span class="hs-identifier hs-var hs-var">mkCastRedn1</span></a></span></span><span> </span><span id="local-6989586621681625147"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625147"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681625148"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625148"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681625149"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625149"><span class="hs-identifier hs-var">cast_co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625150"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625150"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681625151"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625151"><span class="hs-identifier hs-var">xi</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-comment">-- co :: ty ~r ty'</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-comment">-- return_co :: (ty |&gt; cast_co) ~r (ty' |&gt; cast_co)</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-319"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier hs-var">castCoercionKind1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625150"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625147"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625148"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625151"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625149"><span class="hs-identifier hs-var">cast_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625151"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625149"><span class="hs-identifier hs-var">cast_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCastRedn1"><span class="hs-pragma hs-type">mkCastRedn1</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- | Apply casts on both sides of a 'Reduction' (of the given 'Role').</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- Use 'mkCastRedn1' when you want to cast both the original and reduced types</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- in a 'Reduction' using the same coercion.</span><span>
</span><span id="line-327"></span><span class="hs-comment">--</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- Pre-condition: the 'Type' passed in is the same as the LHS type</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- of the coercion stored in the 'Reduction'.</span><span>
</span><span id="line-330"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkCastRedn2"><span class="hs-identifier hs-type">mkCastRedn2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ original type</span></span><span>
</span><span id="line-332"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ coercion to cast with on the left</span></span><span>
</span><span id="line-333"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ rewritten type, with rewriting coercion</span></span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ coercion to cast with on the right</span></span><span>
</span><span id="line-335"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-336"></span><span id="mkCastRedn2"><span class="annot"><span class="annottext">mkCastRedn2 :: Role -&gt; Type -&gt; Coercion -&gt; Reduction -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkCastRedn2"><span class="hs-identifier hs-var hs-var">mkCastRedn2</span></a></span></span><span> </span><span id="local-6989586621681625153"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625153"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681625154"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625154"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681625155"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625155"><span class="hs-identifier hs-var">cast_co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625156"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625156"><span class="hs-identifier hs-var">nco</span></a></span></span><span> </span><span id="local-6989586621681625157"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625157"><span class="hs-identifier hs-var">nty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681625158"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625158"><span class="hs-identifier hs-var">cast_co'</span></a></span></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
-&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-var">castCoercionKind2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625156"><span class="hs-identifier hs-var">nco</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625153"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625154"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625157"><span class="hs-identifier hs-var">nty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625155"><span class="hs-identifier hs-var">cast_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625158"><span class="hs-identifier hs-var">cast_co'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625157"><span class="hs-identifier hs-var">nty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625158"><span class="hs-identifier hs-var">cast_co'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkCastRedn2"><span class="hs-pragma hs-type">mkCastRedn2</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-comment">-- | Apply one 'Reduction' to another.</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- Combines 'mkAppCo' and 'mkAppTy`.</span><span>
</span><span id="line-345"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkAppRedn"><span class="hs-identifier hs-type">mkAppRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-346"></span><span id="mkAppRedn"><span class="annot"><span class="annottext">mkAppRedn :: Reduction -&gt; Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkAppRedn"><span class="hs-identifier hs-var hs-var">mkAppRedn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625161"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625161"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681625162"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625162"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625163"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625163"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span id="local-6989586621681625164"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625164"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625161"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625163"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625162"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625164"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkAppRedn"><span class="hs-pragma hs-type">mkAppRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-comment">-- | Create a function 'Reduction'.</span><span>
</span><span id="line-351"></span><span class="hs-comment">--</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- Combines 'mkFunCo' and 'mkFunTy'.</span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkFunRedn"><span class="hs-identifier hs-type">mkFunRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-354"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#FunTyFlag"><span class="hs-identifier hs-type">FunTyFlag</span></a></span><span>
</span><span id="line-355"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ReductionN"><span class="hs-identifier hs-type">ReductionN</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ multiplicity reduction</span></span><span>
</span><span id="line-356"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ argument reduction</span></span><span>
</span><span id="line-357"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ result reduction</span></span><span>
</span><span id="line-358"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-359"></span><span id="mkFunRedn"><span class="annot"><span class="annottext">mkFunRedn :: Role
-&gt; FunTyFlag -&gt; Reduction -&gt; Reduction -&gt; Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkFunRedn"><span class="hs-identifier hs-var hs-var">mkFunRedn</span></a></span></span><span> </span><span id="local-6989586621681625167"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625167"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681625168"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621681625168"><span class="hs-identifier hs-var">af</span></a></span></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625169"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625169"><span class="hs-identifier hs-var">w_co</span></a></span></span><span> </span><span id="local-6989586621681625170"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625170"><span class="hs-identifier hs-var">w_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625171"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625171"><span class="hs-identifier hs-var">arg_co</span></a></span></span><span> </span><span id="local-6989586621681625172"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625172"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625173"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625173"><span class="hs-identifier hs-var">res_co</span></a></span></span><span> </span><span id="local-6989586621681625174"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625174"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt;
Role -&gt; FunTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
Role -&gt; FunTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo1"><span class="hs-identifier hs-var">mkFunCo1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625167"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621681625168"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625169"><span class="hs-identifier hs-var">w_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625171"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625173"><span class="hs-identifier hs-var">res_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; FunTyFlag -&gt; Type -&gt; Type -&gt; Type -&gt; Type
FunTyFlag -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a></span><span>    </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621681625168"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625170"><span class="hs-identifier hs-var">w_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625172"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625174"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkFunRedn"><span class="hs-pragma hs-type">mkFunRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="hs-comment">-- | Create a 'Reduction' associated to a &#928; type,</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- from a kind 'Reduction' and a body 'Reduction'.</span><span>
</span><span id="line-370"></span><span class="hs-comment">--</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- Combines 'mkForAllCo' and 'mkForAllTy'.</span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkForAllRedn"><span class="hs-identifier hs-type">mkForAllRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span>
</span><span id="line-373"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>
</span><span id="line-374"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ReductionN"><span class="hs-identifier hs-type">ReductionN</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ kind reduction</span></span><span>
</span><span id="line-375"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ body reduction</span></span><span>
</span><span id="line-376"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-377"></span><span id="mkForAllRedn"><span class="annot"><span class="annottext">mkForAllRedn :: ForAllTyFlag -&gt; TyVar -&gt; Reduction -&gt; Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkForAllRedn"><span class="hs-identifier hs-var hs-var">mkForAllRedn</span></a></span></span><span> </span><span id="local-6989586621681625178"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621681625178"><span class="hs-identifier hs-var">vis</span></a></span></span><span> </span><span id="local-6989586621681625179"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681625179"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625180"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625180"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621681625181"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625181"><span class="hs-identifier hs-var">ki'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625182"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625182"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681625183"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625183"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681625179"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625180"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625182"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681625185"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621681625178"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625183"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>    </span><span id="local-6989586621681625185"><span class="annot"><span class="annottext">tv2 :: TyVar
</span><a href="#local-6989586621681625185"><span class="hs-identifier hs-var hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Type -&gt; TyVar
</span><a href="GHC.Types.Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681625179"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625181"><span class="hs-identifier hs-var">ki'</span></a></span><span>
</span><span id="line-383"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkForAllRedn"><span class="hs-pragma hs-type">mkForAllRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | Create a 'Reduction' of a quantified type from a</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- 'Reduction' of the body.</span><span>
</span><span id="line-387"></span><span class="hs-comment">--</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- Combines 'mkHomoForAllCos' and 'mkForAllTys'.</span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkHomoForAllRedn"><span class="hs-identifier hs-type">mkHomoForAllRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-390"></span><span id="mkHomoForAllRedn"><span class="annot"><span class="annottext">mkHomoForAllRedn :: [ForAllTyBinder] -&gt; Reduction -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkHomoForAllRedn"><span class="hs-identifier hs-var hs-var">mkHomoForAllRedn</span></a></span></span><span> </span><span id="local-6989586621681625189"><span class="annot"><span class="annottext">[ForAllTyBinder]
</span><a href="#local-6989586621681625189"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625190"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625190"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681625191"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625191"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-392"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var">mkHomoForAllCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForAllTyBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[ForAllTyBinder]
</span><a href="#local-6989586621681625189"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625190"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForAllTyBinder] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[ForAllTyBinder]
</span><a href="#local-6989586621681625189"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625191"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkHomoForAllRedn"><span class="hs-pragma hs-type">mkHomoForAllRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">-- | Create a 'Reduction' from a coercion between coercions.</span><span>
</span><span id="line-397"></span><span class="hs-comment">--</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- Combines 'mkProofIrrelCo' and 'mkCoercionTy'.</span><span>
</span><span id="line-399"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkProofIrrelRedn"><span class="hs-identifier hs-type">mkProofIrrelRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ role of the created coercion, &quot;r&quot;</span></span><span>
</span><span id="line-400"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ co :: phi1 ~N phi2</span></span><span>
</span><span id="line-401"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ g1 :: phi1</span></span><span>
</span><span id="line-402"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ g2 :: phi2</span></span><span>
</span><span id="line-403"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ res_co :: g1 ~r g2</span></span><span>
</span><span id="line-404"></span><span id="mkProofIrrelRedn"><span class="annot"><span class="annottext">mkProofIrrelRedn :: Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkProofIrrelRedn"><span class="hs-identifier hs-var hs-var">mkProofIrrelRedn</span></a></span></span><span> </span><span id="local-6989586621681625195"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625195"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625196"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625196"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681625197"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625197"><span class="hs-identifier hs-var">g1</span></a></span></span><span> </span><span id="local-6989586621681625198"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625198"><span class="hs-identifier hs-var">g2</span></a></span></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625195"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625196"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625197"><span class="hs-identifier hs-var">g1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625198"><span class="hs-identifier hs-var">g2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625198"><span class="hs-identifier hs-var">g2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkProofIrrelRedn"><span class="hs-pragma hs-type">mkProofIrrelRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | Create a reflexive 'Reduction' whose RHS is the given 'Coercion',</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- with the specified 'Role'.</span><span>
</span><span id="line-412"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkReflCoRedn"><span class="hs-identifier hs-type">mkReflCoRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-413"></span><span id="mkReflCoRedn"><span class="annot"><span class="annottext">mkReflCoRedn :: Role -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflCoRedn"><span class="hs-identifier hs-var hs-var">mkReflCoRedn</span></a></span></span><span> </span><span id="local-6989586621681625199"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625199"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625200"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625200"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625199"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625201"><span class="hs-identifier hs-var">co_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625201"><span class="hs-identifier hs-var">co_ty</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621681625201"><span class="annot"><span class="annottext">co_ty :: Type
</span><a href="#local-6989586621681625201"><span class="hs-identifier hs-var hs-var">co_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625200"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-419"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkReflCoRedn"><span class="hs-pragma hs-type">mkReflCoRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">-- | A collection of 'Reduction's where the coercions and the types are stored separately.</span><span>
</span><span id="line-422"></span><span class="hs-comment">--</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- Use 'unzipRedns' to obtain 'Reductions' from a list of 'Reduction's.</span><span>
</span><span id="line-424"></span><span class="hs-comment">--</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- This datatype is used in 'mkAppRedns', 'mkClassPredRedns' and 'mkTyConAppRedn',</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- which expect separate types and coercions.</span><span>
</span><span id="line-427"></span><span class="hs-comment">--</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- Invariant: the two stored lists are of the same length,</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- and the RHS type of each coercion is the corresponding type.</span><span>
</span><span id="line-430"></span><span class="hs-keyword">data</span><span> </span><span id="Reductions"><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-var">Reductions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Reductions"><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-var">Reductions</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-comment">-- | Create 'Reductions' from individual lists of coercions and types.</span><span>
</span><span id="line-433"></span><span class="hs-comment">--</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- The lists should be of the same length, and the RHS type of each coercion</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- should match the specified type in the other list.</span><span>
</span><span id="line-436"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkReductions"><span class="hs-identifier hs-type">mkReductions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span>
</span><span id="line-437"></span><span id="mkReductions"><span class="annot"><span class="annottext">mkReductions :: [Coercion] -&gt; [Type] -&gt; Reductions
</span><a href="GHC.Core.Reduction.html#mkReductions"><span class="hs-identifier hs-var hs-var">mkReductions</span></a></span></span><span> </span><span id="local-6989586621681625203"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625203"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621681625204"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625204"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Type] -&gt; Reductions
</span><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-var">Reductions</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625203"><span class="hs-identifier hs-var">cos</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625204"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-438"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkReductions"><span class="hs-pragma hs-type">mkReductions</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="annot"><span class="hs-comment">-- | Combines 'mkAppCos' and 'mkAppTys'.</span></span><span>
</span><span id="line-441"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkAppRedns"><span class="hs-identifier hs-type">mkAppRedns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-442"></span><span id="mkAppRedns"><span class="annot"><span class="annottext">mkAppRedns :: Reduction -&gt; Reductions -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkAppRedns"><span class="hs-identifier hs-var hs-var">mkAppRedns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625207"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625207"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681625208"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625208"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span id="local-6989586621681625209"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625209"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621681625210"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625210"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625207"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625209"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625208"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625210"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkAppRedns"><span class="hs-pragma hs-type">mkAppRedns</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="annot"><span class="hs-comment">-- | 'TyConAppCo' for 'Reduction's: combines 'mkTyConAppCo' and `mkTyConApp`.</span></span><span>
</span><span id="line-447"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkTyConAppRedn"><span class="hs-identifier hs-type">mkTyConAppRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-448"></span><span id="mkTyConAppRedn"><span class="annot"><span class="annottext">mkTyConAppRedn :: Role -&gt; TyCon -&gt; Reductions -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkTyConAppRedn"><span class="hs-identifier hs-var hs-var">mkTyConAppRedn</span></a></span></span><span> </span><span id="local-6989586621681625213"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625213"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625214"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681625214"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span id="local-6989586621681625215"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625215"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621681625216"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625216"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625213"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681625214"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625215"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681625214"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625216"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkTyConAppRedn"><span class="hs-pragma hs-type">mkTyConAppRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="annot"><span class="hs-comment">-- | Reduce the arguments of a 'Class' 'TyCon'.</span></span><span>
</span><span id="line-453"></span><span class="annot"><a href="GHC.Core.Reduction.html#mkClassPredRedn"><span class="hs-identifier hs-type">mkClassPredRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-454"></span><span id="mkClassPredRedn"><span class="annot"><span class="annottext">mkClassPredRedn :: Class -&gt; Reductions -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkClassPredRedn"><span class="hs-identifier hs-var hs-var">mkClassPredRedn</span></a></span></span><span> </span><span id="local-6989586621681625217"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681625217"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span id="local-6989586621681625218"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625218"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621681625219"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625219"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681625217"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625218"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681625217"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625219"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#mkClassPredRedn"><span class="hs-pragma hs-type">mkClassPredRedn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="annot"><span class="hs-comment">-- | Obtain 'Reductions' from a list of 'Reduction's by unzipping.</span></span><span>
</span><span id="line-461"></span><span class="annot"><a href="GHC.Core.Reduction.html#unzipRedns"><span class="hs-identifier hs-type">unzipRedns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span>
</span><span id="line-462"></span><span id="unzipRedns"><span class="annot"><span class="annottext">unzipRedns :: [Reduction] -&gt; Reductions
</span><a href="GHC.Core.Reduction.html#unzipRedns"><span class="hs-identifier hs-var hs-var">unzipRedns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reduction -&gt; Reductions -&gt; Reductions)
-&gt; Reductions -&gt; [Reduction] -&gt; Reductions
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; Reductions -&gt; Reductions
</span><a href="#local-6989586621681625221"><span class="hs-identifier hs-var">accRedn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion] -&gt; [Type] -&gt; Reductions
</span><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-var">Reductions</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><a href="#local-6989586621681625221"><span class="hs-identifier hs-type">accRedn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621681625221"><span class="annot"><span class="annottext">accRedn :: Reduction -&gt; Reductions -&gt; Reductions
</span><a href="#local-6989586621681625221"><span class="hs-identifier hs-var hs-var">accRedn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625222"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625222"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681625223"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625223"><span class="hs-identifier hs-var">xi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span id="local-6989586621681625224"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625224"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621681625225"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625225"><span class="hs-identifier hs-var">xis</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Type] -&gt; Reductions
</span><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-var">Reductions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625222"><span class="hs-identifier hs-var">co</span></a></span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; [Coercion]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625224"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625223"><span class="hs-identifier hs-var">xi</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625225"><span class="hs-identifier hs-var">xis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#unzipRedns"><span class="hs-pragma hs-type">unzipRedns</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- NB: this function is currently used in two locations:</span><span>
</span><span id="line-469"></span><span class="hs-comment">--</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- - GHC.Tc.Gen.Foreign.normaliseFfiType', with one call of the form:</span><span>
</span><span id="line-471"></span><span class="hs-comment">--</span><span>
</span><span id="line-472"></span><span class="hs-comment">--   unzipRedns &lt;$&gt; zipWithM f tys roles</span><span>
</span><span id="line-473"></span><span class="hs-comment">--</span><span>
</span><span id="line-474"></span><span class="hs-comment">-- - GHC.Tc.Solver.Monad.breakTyEqCycle_maybe, with two calls of the form:</span><span>
</span><span id="line-475"></span><span class="hs-comment">--</span><span>
</span><span id="line-476"></span><span class="hs-comment">--   unzipRedns &lt;$&gt; mapM f tys</span><span>
</span><span id="line-477"></span><span class="hs-comment">--</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- It is possible to write 'mapAndUnzipM' functions to handle these cases,</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- but the above locations aren't performance critical, so it was deemed</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- to not be worth it.</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
       Simplifying types
%*                                                                      *
%************************************************************************

The function below morally belongs in GHC.Tc.Solver.Rewrite, but it is used also in
FamInstEnv, and so lives here.

Note [simplifyArgsWorker]
~~~~~~~~~~~~~~~~~~~~~~~~~
Invariant (F2) of Note [Rewriting] in GHC.Tc.Solver.Rewrite says that
rewriting is homogeneous.
This causes some trouble when rewriting a function applied to a telescope
of arguments, perhaps with dependency. For example, suppose

  type family F :: forall (j :: Type) (k :: Type). Maybe j -&gt; Either j k -&gt; Bool -&gt; [k]

and we wish to rewrite the args of (with kind applications explicit)

  F @a @b (Just @a c) (Right @a @b d) False

where all variables are skolems and

  a :: Type
  b :: Type
  c :: a
  d :: b

  [G] aco :: a ~ fa
  [G] bco :: b ~ fb
  [G] cco :: c ~ fc
  [G] dco :: d ~ fd

The first step is to rewrite all the arguments. This is done before calling
simplifyArgsWorker. We start from

  a
  b
  Just @a c
  Right @a @b d
  False

and get left-to-right reductions whose coercions are as follows:

  co1 :: a ~ fa
  co2 :: b ~ fb
  co3 :: (Just @a c) ~ (Just @fa (fc |&gt; aco) |&gt; co6)
  co4 :: (Right @a @b d) ~ (Right @fa @fb (fd |&gt; bco) |&gt; co7)
  co5 :: False ~ False

where
  co6 = Maybe (sym aco) :: Maybe fa ~ Maybe a
  co7 = Either (sym aco) (sym bco) :: Either fa fb ~ Either a b

We now process the rewritten args in left-to-right order. The first two args
need no further processing. But now consider the third argument. Let f3 = the rewritten
result, Just fa (fc |&gt; aco) |&gt; co6.
This f3 rewritten argument has kind (Maybe a), due to homogeneity of rewriting (F2).
And yet, when we build the application (F @fa @fb ...), we need this
argument to have kind (Maybe fa), not (Maybe a). We must cast this argument.
The coercion to use is determined by the kind of F:
we see in F's kind that the third argument has kind Maybe j.
Critically, we also know that the argument corresponding to j
(in our example, a) rewrote with a coercion co1. We can thus know the
coercion needed for the 3rd argument is (Maybe co1), thus building
(f3 |&gt; Maybe co1)

More generally, we must use the Lifting Lemma, as implemented in
Coercion.liftCoSubst. As we work left-to-right, any variable that is a
dependent parameter (j and k, in our example) gets mapped in a lifting context
to the coercion that is output from rewriting the corresponding argument (co1
and co2, in our example). Then, after rewriting later arguments, we lift the
kind of these arguments in the lifting context that we've be building up.
This coercion is then used to keep the result of rewriting well-kinded.

Working through our example, this is what happens:

  1. Extend the (empty) LC with [j |-&gt; co1]. No new casting must be done,
     because the binder associated with the first argument has a closed type (no
     variables).

  2. Extend the LC with [k |-&gt; co2]. No casting to do.

  3. Lifting the kind (Maybe j) with our LC
     yields co8 :: Maybe a ~ Maybe fa. Use (f3 |&gt; co8) as the argument to F.

  4. Lifting the kind (Either j k) with our LC
     yields co9 :: Either a b ~ Either fa fb. Use (f4 |&gt; co9) as the 4th
     argument to F, where f4 is the rewritten form of argument 4, written above.

  5. We lift Bool with our LC, getting &lt;Bool&gt;; casting has no effect.

We're now almost done, but the new application

  F @fa @fb (f3 |&gt; co8) (f4 |&gt; co9) False

has the wrong kind. Its kind is [fb], instead of the original [b].
So we must use our LC one last time to lift the result kind [k],
getting res_co :: [fb] ~ [b], and we cast our result.

Accordingly, the final result is

  F
    @fa
    @fb
    (Just @fa (fc |&gt; aco) |&gt; Maybe (sym aco) |&gt; sym (Maybe (sym aco)))
    (Right @fa @fb (fd |&gt; bco) |&gt; Either (sym aco) (sym bco) |&gt; sym (Either (sym aco) (sym bco)))
    False
  |&gt; [sym bco]

The res_co (in this case, [sym bco]) is the third component of the
tuple returned by simplifyArgsWorker.

Note [Last case in simplifyArgsWorker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In writing simplifyArgsWorker's `go`, we know here that args cannot be empty,
because that case is first. We've run out of
binders. But perhaps inner_ki is a tyvar that has been instantiated with a
&#928;-type.

Here is an example.

  a :: forall (k :: Type). k -&gt; k
  Proxy :: forall j. j -&gt; Type
  type family Star
  axStar :: Star ~ Type
  type family NoWay :: Bool
  axNoWay :: NoWay ~ False
  bo :: Type
  [G] bc :: bo ~ Bool   (in inert set)

  co :: (forall j. j -&gt; Type) ~ (forall (j :: Star). (j |&gt; axStar) -&gt; Star)
  co = forall (j :: sym axStar). (&lt;j&gt; -&gt; sym axStar)

  We are rewriting:
  a (forall (j :: Star). (j |&gt; axStar) -&gt; Star)   -- 1
    (Proxy |&gt; co)                                 -- 2
    (bo |&gt; sym axStar)                            -- 3
    (NoWay |&gt; sym bc)                             -- 4
      :: Star

First, we rewrite all the arguments (before simplifyArgsWorker), like so:

    co1 :: (forall (j :: Star). (j |&gt; axStar) -&gt; Star) ~ (forall j. j -&gt; Type) -- 1
    co2 :: (Proxy |&gt; co) ~ (Proxy |&gt; co)                                       -- 2
    co3 :: (bo |&gt; sym axStar) ~ (Bool |&gt; sym axStar)                           -- 3
    co4 :: (NoWay |&gt; sym bc) ~ (False |&gt; sym bc)                               -- 4

Then we do the process described in Note [simplifyArgsWorker].

1. Lifting Type (the kind of the first arg) gives us a reflexive coercion, so we
   don't use it. But we do build a lifting context [k -&gt; co1] (where co1 is a
   result of rewriting an argument, written above).

2. Lifting k gives us co1, so the second argument becomes (Proxy |&gt; co |&gt; co1).
   This is not a dependent argument, so we don't extend the lifting context.

Now we need to deal with argument (3).
The way we normally proceed is to lift the kind of the binder, to see whether
it's dependent.
But here, the remainder of the kind of `a` that we're left with
after processing two arguments is just `k`.

The way forward is look up k in the lifting context, getting co1. If we're at
all well-typed, co1 will be a coercion between &#928;-types, with at least one binder.
So, let's decompose co1 with decomposePiCos. This decomposition needs arguments to use
to instantiate any kind parameters. Look at the type of co1. If we just
decomposed it, we would end up with coercions whose types include j, which is
out of scope here. Accordingly, decomposePiCos takes a list of types whose
kinds are the *unrewritten* types in the decomposed coercion. (See comments on
decomposePiCos.) Because the rewritten types have unrewritten kinds (because
rewriting is homogeneous), passing the list of rewritten types to decomposePiCos
just won't do: later arguments' kinds won't be as expected. So we need to get
the *unrewritten* types to pass to decomposePiCos. We can do this easily enough
by taking the kind of the argument coercions, passed in originally.

(Alternative 1: We could re-engineer decomposePiCos to deal with this situation.
But that function is already gnarly, and other call sites of decomposePiCos
would suffer from the change, even though they are much more common than this one.)

(Alternative 2: We could avoid calling decomposePiCos entirely, integrating its
behavior into simplifyArgsWorker. This would work, I think, but then all of the
complication of decomposePiCos would end up layered on top of all the complication
here. Please, no.)

(Alternative 3: We could pass the unrewritten arguments into simplifyArgsWorker
so that we don't have to recreate them. But that would complicate the interface
of this function to handle a very dark, dark corner case. Better to keep our
demons to ourselves here instead of exposing them to callers. This decision is
easily reversed if there is ever any performance trouble due to the call of
coercionKind.)

So we now call

  decomposePiCos co1
                 (Pair (forall (j :: Star). (j |&gt; axStar) -&gt; Star) (forall j. j -&gt; Type))
                 [bo |&gt; sym axStar, NoWay |&gt; sym bc]

to get

  co5 :: Star ~ Type
  co6 :: (j |&gt; axStar) ~ (j |&gt; co5), substituted to
                              (bo |&gt; sym axStar |&gt; axStar) ~ (bo |&gt; sym axStar |&gt; co5)
                           == bo ~ bo
  res_co :: Type ~ Star

We then use these casts on (the rewritten) (3) and (4) to get

  (Bool |&gt; sym axStar |&gt; co5 :: Type)   -- (C3)
  (False |&gt; sym bc |&gt; co6    :: bo)     -- (C4)

We can simplify to

  Bool                        -- (C3)
  (False |&gt; sym bc :: bo)     -- (C4)

Of course, we still must do the processing in Note [simplifyArgsWorker] to finish
the job. We thus want to recur. Our new function kind is the left-hand type of
co1 (gotten, recall, by lifting the variable k that was the return kind of the
original function). Why the left-hand type (as opposed to the right-hand type)?
Because we have casted all the arguments according to decomposePiCos, which gets
us from the right-hand type to the left-hand one. We thus recur with that new
function kind, zapping our lifting context, because we have essentially applied
it.

This recursive call returns ([Bool, False], [...], Refl). The Bool and False
are the correct arguments we wish to return. But we must be careful about the
result coercion: our new, rewritten application will have kind Type, but we
want to make sure that the result coercion casts this back to Star. (Why?
Because we started with an application of kind Star, and rewriting is homogeneous.)

So, we have to twiddle the result coercion appropriately.

Let's check whether this is well-typed. We know

  a :: forall (k :: Type). k -&gt; k

  a (forall j. j -&gt; Type) :: (forall j. j -&gt; Type) -&gt; forall j. j -&gt; Type

  a (forall j. j -&gt; Type)
    Proxy
      :: forall j. j -&gt; Type

  a (forall j. j -&gt; Type)
    Proxy
    Bool
      :: Bool -&gt; Type

  a (forall j. j -&gt; Type)
    Proxy
    Bool
    False
      :: Type

  a (forall j. j -&gt; Type)
    Proxy
    Bool
    False
     |&gt; res_co
     :: Star

as desired.

Whew.

Historical note: I (Richard E) once thought that the final part of the kind
had to be a variable k (as in the example above). But it might not be: it could
be an application of a variable. Here is the example:

  let f :: forall (a :: Type) (b :: a -&gt; Type). b (Any @a)
      k :: Type
      x :: k

  rewrite (f @Type @((-&gt;) k) x)

After instantiating [a |-&gt; Type, b |-&gt; ((-&gt;) k)], we see that `b (Any @a)`
is `k -&gt; Any @a`, and thus the third argument of `x :: k` is well-kinded.

-}</span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">-- | Stores 'Reductions' as well as a kind coercion.</span><span>
</span><span id="line-765"></span><span class="hs-comment">--</span><span>
</span><span id="line-766"></span><span class="hs-comment">-- Used when rewriting arguments to a type function @f@.</span><span>
</span><span id="line-767"></span><span class="hs-comment">--</span><span>
</span><span id="line-768"></span><span class="hs-comment">-- Invariant:</span><span>
</span><span id="line-769"></span><span class="hs-comment">--   when the stored reductions are of the form</span><span>
</span><span id="line-770"></span><span class="hs-comment">--     co_i :: ty_i ~ xi_i,</span><span>
</span><span id="line-771"></span><span class="hs-comment">--   the kind coercion is of the form</span><span>
</span><span id="line-772"></span><span class="hs-comment">--      kco :: typeKind (f ty_1 ... ty_n) ~ typeKind (f xi_1 ... xi_n)</span><span>
</span><span id="line-773"></span><span class="hs-comment">--</span><span>
</span><span id="line-774"></span><span class="hs-comment">-- The type function @f@ depends on context.</span><span>
</span><span id="line-775"></span><span class="hs-keyword">data</span><span> </span><span id="ArgsReductions"><span class="annot"><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-var">ArgsReductions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-776"></span><span>  </span><span id="ArgsReductions"><span class="annot"><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-var">ArgsReductions</span></a></span></span><span>
</span><span id="line-777"></span><span>    </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span>
</span><span id="line-778"></span><span>    </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-comment">-- The strictness annotations and UNPACK pragma here are crucial</span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-comment">-- to getting good performance in simplifyArgsWorker's tight loop.</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span class="hs-comment">-- This is shared between the rewriter and the normaliser in GHC.Core.FamInstEnv.</span><span>
</span><span id="line-783"></span><span class="hs-comment">-- See Note [simplifyArgsWorker]</span><span>
</span><span id="line-784"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#simplifyArgsWorker"><span class="hs-pragma hs-type">simplifyArgsWorker</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-785"></span><span class="hs-comment">-- NB. INLINE yields a ~1% decrease in allocations in T9872d compared to INLINEABLE</span><span>
</span><span id="line-786"></span><span class="hs-comment">-- This function is only called in two locations, so the amount of code duplication</span><span>
</span><span id="line-787"></span><span class="hs-comment">-- should be rather reasonable despite the size of the function.</span><span>
</span><span id="line-788"></span><span class="annot"><a href="GHC.Core.Reduction.html#simplifyArgsWorker"><span class="hs-identifier hs-type">simplifyArgsWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-789"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#PiTyBinder"><span class="hs-identifier hs-type">PiTyBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>
</span><span id="line-790"></span><span>                       </span><span class="hs-comment">-- the binders &amp; result kind (not a &#928;-type) of the function applied to the args</span><span>
</span><span id="line-791"></span><span>                       </span><span class="hs-comment">-- list of binders can be shorter or longer than the list of args</span><span>
</span><span id="line-792"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>   </span><span class="hs-comment">-- free vars of the args</span><span>
</span><span id="line-793"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier hs-type">Infinite</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-comment">-- list of roles, r</span><span>
</span><span id="line-794"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- rewritten type arguments, arg_i</span><span>
</span><span id="line-795"></span><span>                                   </span><span class="hs-comment">-- each comes with the coercion used to rewrite it,</span><span>
</span><span id="line-796"></span><span>                                   </span><span class="hs-comment">-- arg_co_i :: ty_i ~ arg_i</span><span>
</span><span id="line-797"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-type">ArgsReductions</span></a></span><span>
</span><span id="line-798"></span><span class="hs-comment">-- Returns ArgsReductions (Reductions cos xis) res_co, where co_i :: ty_i ~ xi_i,</span><span>
</span><span id="line-799"></span><span class="hs-comment">-- and res_co :: kind (f ty_1 ... ty_n) ~ kind (f xi_1 ... xi_n), where f is the function</span><span>
</span><span id="line-800"></span><span class="hs-comment">-- that we are applying.</span><span>
</span><span id="line-801"></span><span class="hs-comment">-- Precondition: if f :: forall bndrs. inner_ki (where bndrs and inner_ki are passed in),</span><span>
</span><span id="line-802"></span><span class="hs-comment">-- then (f ty_1 ... ty_n) is well kinded. Note that (f arg_1 ... arg_n) might *not* be well-kinded.</span><span>
</span><span id="line-803"></span><span class="hs-comment">-- Massaging the arg_i in order to make the function application well-kinded is what this</span><span>
</span><span id="line-804"></span><span class="hs-comment">-- function is all about. That is, (f xi_1 ... xi_n), where xi_i are the returned arguments,</span><span>
</span><span id="line-805"></span><span class="annot"><span class="hs-comment">-- *is* well kinded.</span></span><span>
</span><span id="line-806"></span><span id="simplifyArgsWorker"><span class="annot"><span class="annottext">simplifyArgsWorker :: (() :: Constraint) =&gt;
[PiTyBinder]
-&gt; Type
-&gt; TyCoVarSet
-&gt; Infinite Role
-&gt; [Reduction]
-&gt; ArgsReductions
</span><a href="GHC.Core.Reduction.html#simplifyArgsWorker"><span class="hs-identifier hs-var hs-var">simplifyArgsWorker</span></a></span></span><span> </span><span id="local-6989586621681625241"><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625241"><span class="hs-identifier hs-var">orig_ki_binders</span></a></span></span><span> </span><span id="local-6989586621681625242"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625242"><span class="hs-identifier hs-var">orig_inner_ki</span></a></span></span><span> </span><span id="local-6989586621681625243"><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621681625243"><span class="hs-identifier hs-var">orig_fvs</span></a></span></span><span>
</span><span id="line-807"></span><span>                   </span><span id="local-6989586621681625244"><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621681625244"><span class="hs-identifier hs-var">orig_roles</span></a></span></span><span> </span><span id="local-6989586621681625245"><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625245"><span class="hs-identifier hs-var">orig_simplified_args</span></a></span></span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext
-&gt; [PiTyBinder]
-&gt; Type
-&gt; Infinite Role
-&gt; [Reduction]
-&gt; ArgsReductions
</span><a href="#local-6989586621681625246"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625247"><span class="hs-identifier hs-var">orig_lc</span></a></span><span>
</span><span id="line-809"></span><span>       </span><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625241"><span class="hs-identifier hs-var">orig_ki_binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625242"><span class="hs-identifier hs-var">orig_inner_ki</span></a></span><span>
</span><span id="line-810"></span><span>       </span><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621681625244"><span class="hs-identifier hs-var">orig_roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625245"><span class="hs-identifier hs-var">orig_simplified_args</span></a></span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-812"></span><span>    </span><span id="local-6989586621681625247"><span class="annot"><span class="annottext">orig_lc :: LiftingContext
</span><a href="#local-6989586621681625247"><span class="hs-identifier hs-var hs-var">orig_lc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier hs-var">emptyLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; LiftingContext) -&gt; InScopeSet -&gt; LiftingContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621681625243"><span class="hs-identifier hs-var">orig_fvs</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span>    </span><span class="annot"><a href="#local-6989586621681625246"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>  </span><span class="hs-comment">-- mapping from tyvars to rewriting coercions</span><span>
</span><span id="line-815"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#PiTyBinder"><span class="hs-identifier hs-type">PiTyBinder</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Unsubsted binders of function's kind</span><span>
</span><span id="line-816"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>            </span><span class="hs-comment">-- Unsubsted result kind of function (not a Pi-type)</span><span>
</span><span id="line-817"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier hs-type">Infinite</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>   </span><span class="hs-comment">-- Roles at which to rewrite these ...</span><span>
</span><span id="line-818"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- rewritten arguments, with their rewriting coercions</span><span>
</span><span id="line-819"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-type">ArgsReductions</span></a></span><span>
</span><span id="line-820"></span><span>    </span><span id="local-6989586621681625246"><span class="annot"><span class="annottext">go :: LiftingContext
-&gt; [PiTyBinder]
-&gt; Type
-&gt; Infinite Role
-&gt; [Reduction]
-&gt; ArgsReductions
</span><a href="#local-6989586621681625246"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681625249"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625249"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621681625250"><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625250"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681625251"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625251"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span> </span><span class="annot"><span class="annottext">Infinite Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-821"></span><span>        </span><span class="hs-comment">-- The !lc makes the function strict in the lifting context</span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-comment">-- which means GHC can unbox that pair.  A modest win.</span><span>
</span><span id="line-823"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reductions -&gt; MCoercionN -&gt; ArgsReductions
</span><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-var">ArgsReductions</span></a></span><span>
</span><span id="line-824"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion] -&gt; [Type] -&gt; Reductions
</span><a href="GHC.Core.Reduction.html#mkReductions"><span class="hs-identifier hs-var">mkReductions</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>          </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625252"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-826"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-827"></span><span>        </span><span id="local-6989586621681625253"><span class="annot"><span class="annottext">final_kind :: Type
</span><a href="#local-6989586621681625253"><span class="hs-identifier hs-var hs-var">final_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PiTyBinder] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkPiTys"><span class="hs-identifier hs-var">mkPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625250"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625251"><span class="hs-identifier hs-var">inner_ki</span></a></span><span>
</span><span id="line-828"></span><span>        </span><span id="local-6989586621681625252"><span class="annot"><span class="annottext">kind_co :: MCoercionN
</span><a href="#local-6989586621681625252"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625253"><span class="hs-identifier hs-var">final_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-829"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercionN
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; MCoercionN) -&gt; Coercion -&gt; MCoercionN
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625249"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625253"><span class="hs-identifier hs-var">final_kind</span></a></span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span>    </span><span class="annot"><a href="#local-6989586621681625246"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681625259"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625259"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681625260"><span class="annot"><span class="annottext">PiTyBinder
</span><a href="#local-6989586621681625260"><span class="hs-identifier hs-var">binder</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681625261"><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625261"><span class="hs-identifier hs-var">binders</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681625262"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625262"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.List.Infinite.html#Inf"><span class="hs-identifier hs-type">Inf</span></a></span><span> </span><span id="local-6989586621681625264"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625264"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681625265"><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621681625265"><span class="hs-identifier hs-var">roles</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681625266"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625266"><span class="hs-identifier hs-var">arg_redn</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681625267"><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625267"><span class="hs-identifier hs-var">arg_redns</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- We rewrite an argument ty with arg_redn = Reduction arg_co arg</span><span>
</span><span id="line-833"></span><span>         </span><span class="hs-comment">-- By Note [Rewriting] in GHC.Tc.Solver.Rewrite invariant (F2),</span><span>
</span><span id="line-834"></span><span>         </span><span class="hs-comment">-- typeKind(ty) = typeKind(arg).</span><span>
</span><span id="line-835"></span><span>         </span><span class="hs-comment">-- However, it is possible that arg will be used as an argument to a function</span><span>
</span><span id="line-836"></span><span>         </span><span class="hs-comment">-- whose kind is different, if earlier arguments have been rewritten.</span><span>
</span><span id="line-837"></span><span>         </span><span class="hs-comment">-- We thus need to compose the reduction with a kind coercion to ensure</span><span>
</span><span id="line-838"></span><span>         </span><span class="hs-comment">-- well-kindedness (see the call to mkCoherenceRightRedn below).</span><span>
</span><span id="line-839"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-840"></span><span>         </span><span class="hs-comment">-- The bangs here have been observed to improve performance</span><span>
</span><span id="line-841"></span><span>         </span><span class="hs-comment">-- significantly in optimized builds; see #18502</span><span>
</span><span id="line-842"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681625268"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621681625268"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625259"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PiTyBinder -&gt; Type
</span><a href="GHC.Types.Var.html#piTyBinderType"><span class="hs-identifier hs-var">piTyBinderType</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyBinder
</span><a href="#local-6989586621681625260"><span class="hs-identifier hs-var">binder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span>             </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621681625270"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625270"><span class="hs-identifier hs-var">casted_co</span></a></span></span><span> </span><span id="local-6989586621681625271"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625271"><span class="hs-identifier hs-var">casted_xi</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Reduction -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkCoherenceRightRedn"><span class="hs-identifier hs-var">mkCoherenceRightRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681625264"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621681625266"><span class="hs-identifier hs-var">arg_redn</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625268"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-845"></span><span>         </span><span class="hs-comment">-- now, extend the lifting context with the new binding</span><span>
</span><span id="line-846"></span><span>             </span><span class="hs-glyph">!</span><span id="local-6989586621681625272"><span class="annot"><span class="annottext">new_lc :: LiftingContext
</span><a href="#local-6989586621681625272"><span class="hs-identifier hs-var hs-var">new_lc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681625273"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681625273"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PiTyBinder -&gt; Maybe TyVar
</span><a href="GHC.Types.Var.html#namedPiTyBinder_maybe"><span class="hs-identifier hs-var">namedPiTyBinder_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyBinder
</span><a href="#local-6989586621681625260"><span class="hs-identifier hs-var">binder</span></a></span><span>
</span><span id="line-847"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; TyVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier hs-var">extendLiftingContextAndInScope</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625259"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681625273"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625270"><span class="hs-identifier hs-var">casted_co</span></a></span><span>
</span><span id="line-848"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-849"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625259"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-850"></span><span>             </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-type">ArgsReductions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span id="local-6989586621681625276"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625276"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621681625277"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625277"><span class="hs-identifier hs-var">xis</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681625278"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625278"><span class="hs-identifier hs-var">final_kind_co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext
-&gt; [PiTyBinder]
-&gt; Type
-&gt; Infinite Role
-&gt; [Reduction]
-&gt; ArgsReductions
</span><a href="#local-6989586621681625246"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625272"><span class="hs-identifier hs-var">new_lc</span></a></span><span> </span><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625261"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625262"><span class="hs-identifier hs-var">inner_ki</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621681625265"><span class="hs-identifier hs-var">roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625267"><span class="hs-identifier hs-var">arg_redns</span></a></span><span>
</span><span id="line-852"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Reductions -&gt; MCoercionN -&gt; ArgsReductions
</span><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-var">ArgsReductions</span></a></span><span>
</span><span id="line-853"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion] -&gt; [Type] -&gt; Reductions
</span><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-var">Reductions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625270"><span class="hs-identifier hs-var">casted_co</span></a></span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; [Coercion]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625276"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625271"><span class="hs-identifier hs-var">casted_xi</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625277"><span class="hs-identifier hs-var">xis</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>              </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625278"><span class="hs-identifier hs-var">final_kind_co</span></a></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span>    </span><span class="hs-comment">-- See Note [Last case in simplifyArgsWorker]</span><span>
</span><span id="line-857"></span><span>    </span><span class="annot"><a href="#local-6989586621681625246"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681625279"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625279"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681625280"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625280"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span> </span><span id="local-6989586621681625281"><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621681625281"><span class="hs-identifier hs-var">roles</span></a></span></span><span> </span><span id="local-6989586621681625282"><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625282"><span class="hs-identifier hs-var">arg_redns</span></a></span></span><span>
</span><span id="line-858"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681625283"><span class="annot"><span class="annottext">co1 :: Coercion
</span><a href="#local-6989586621681625283"><span class="hs-identifier hs-var hs-var">co1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625279"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625280"><span class="hs-identifier hs-var">inner_ki</span></a></span><span>
</span><span id="line-859"></span><span>            </span><span id="local-6989586621681625284"><span class="annot"><span class="annottext">co1_kind :: Pair Type
</span><a href="#local-6989586621681625284"><span class="hs-identifier hs-var hs-var">co1_kind</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625283"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-860"></span><span>            </span><span id="local-6989586621681625286"><span class="annot"><span class="annottext">unrewritten_tys :: [Type]
</span><a href="#local-6989586621681625286"><span class="hs-identifier hs-var hs-var">unrewritten_tys</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reduction -&gt; Type) -&gt; [Reduction] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; Type
</span><a href="GHC.Core.Reduction.html#reductionOriginalType"><span class="hs-identifier hs-var">reductionOriginalType</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625282"><span class="hs-identifier hs-var">arg_redns</span></a></span><span>
</span><span id="line-861"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681625287"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625287"><span class="hs-identifier hs-var">arg_cos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681625288"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625288"><span class="hs-identifier hs-var">res_co</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt;
Coercion -&gt; Pair Type -&gt; [Type] -&gt; ([Coercion], Coercion)
Coercion -&gt; Pair Type -&gt; [Type] -&gt; ([Coercion], Coercion)
</span><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier hs-var">decomposePiCos</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625283"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681625284"><span class="hs-identifier hs-var">co1_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681625286"><span class="hs-identifier hs-var">unrewritten_tys</span></a></span><span>
</span><span id="line-862"></span><span>            </span><span id="local-6989586621681625290"><span class="annot"><span class="annottext">casted_args :: [Reduction]
</span><a href="#local-6989586621681625290"><span class="hs-identifier hs-var hs-var">casted_args</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [Reduction] -&gt; [Reduction]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reduction] -&gt; [Coercion] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625282"><span class="hs-identifier hs-var">arg_redns</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625287"><span class="hs-identifier hs-var">arg_cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-863"></span><span>                                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reduction] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625282"><span class="hs-identifier hs-var">arg_redns</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625287"><span class="hs-identifier hs-var">arg_cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>                                  </span><span class="annot"><span class="annottext">([Reduction] -&gt; [Reduction]) -&gt; [Reduction] -&gt; [Reduction]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Role -&gt; Reduction -&gt; Coercion -&gt; Reduction)
-&gt; [Role] -&gt; [Reduction] -&gt; [Coercion] -&gt; [Reduction]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zipWith3/GHC.List.html#zipWith3"><span class="hs-identifier hs-var">zipWith3</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Reduction -&gt; Coercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkCoherenceRightRedn"><span class="hs-identifier hs-var">mkCoherenceRightRedn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Infinite Role -&gt; [Role]
forall a. Infinite a -&gt; [a]
</span><a href="GHC.Data.List.Infinite.html#toList"><span class="hs-identifier hs-var">Inf.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621681625281"><span class="hs-identifier hs-var">roles</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625282"><span class="hs-identifier hs-var">arg_redns</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681625287"><span class="hs-identifier hs-var">arg_cos</span></a></span><span>
</span><span id="line-865"></span><span>               </span><span class="hs-comment">-- In general decomposePiCos can return fewer cos than tys,</span><span>
</span><span id="line-866"></span><span>               </span><span class="hs-comment">-- but not here; because we're well typed, there will be enough</span><span>
</span><span id="line-867"></span><span>               </span><span class="hs-comment">-- binders. Note that decomposePiCos does substitutions, so even</span><span>
</span><span id="line-868"></span><span>               </span><span class="hs-comment">-- if the original substitution results in something ending with</span><span>
</span><span id="line-869"></span><span>               </span><span class="hs-comment">-- ... -&gt; k, that k will be substituted to perhaps reveal more</span><span>
</span><span id="line-870"></span><span>               </span><span class="hs-comment">-- binders.</span><span>
</span><span id="line-871"></span><span>            </span><span id="local-6989586621681625294"><span class="annot"><span class="annottext">zapped_lc :: LiftingContext
</span><a href="#local-6989586621681625294"><span class="hs-identifier hs-var hs-var">zapped_lc</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier hs-var">zapLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625279"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-872"></span><span>            </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681625296"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625296"><span class="hs-identifier hs-var">rewritten_kind</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681625284"><span class="hs-identifier hs-var">co1_kind</span></a></span><span>
</span><span id="line-873"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681625297"><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625297"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681625298"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625298"><span class="hs-identifier hs-var">new_inner</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([PiTyBinder], Type)
</span><a href="GHC.Core.Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625296"><span class="hs-identifier hs-var">rewritten_kind</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span>            </span><span class="annot"><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-type">ArgsReductions</span></a></span><span> </span><span id="local-6989586621681625300"><span class="annot"><span class="annottext">Reductions
</span><a href="#local-6989586621681625300"><span class="hs-identifier hs-var">redns_out</span></a></span></span><span> </span><span id="local-6989586621681625301"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625301"><span class="hs-identifier hs-var">res_co_out</span></a></span></span><span>
</span><span id="line-876"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext
-&gt; [PiTyBinder]
-&gt; Type
-&gt; Infinite Role
-&gt; [Reduction]
-&gt; ArgsReductions
</span><a href="#local-6989586621681625246"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681625294"><span class="hs-identifier hs-var">zapped_lc</span></a></span><span> </span><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621681625297"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681625298"><span class="hs-identifier hs-var">new_inner</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621681625281"><span class="hs-identifier hs-var">roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduction]
</span><a href="#local-6989586621681625290"><span class="hs-identifier hs-var">casted_args</span></a></span><span>
</span><span id="line-877"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-878"></span><span>          </span><span class="annot"><span class="annottext">Reductions -&gt; MCoercionN -&gt; ArgsReductions
</span><a href="GHC.Core.Reduction.html#ArgsReductions"><span class="hs-identifier hs-var">ArgsReductions</span></a></span><span> </span><span class="annot"><span class="annottext">Reductions
</span><a href="#local-6989586621681625300"><span class="hs-identifier hs-var">redns_out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681625288"><span class="hs-identifier hs-var">res_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercionN -&gt; MCoercionN
</span><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-operator hs-var">`mkTransMCoR`</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621681625301"><span class="hs-identifier hs-var">res_co_out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span></pre></body></html>