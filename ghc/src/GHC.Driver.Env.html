<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.Env</span><span>
</span><span id="line-4"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier">Hsc</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier">HscEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateFlags"><span class="hs-identifier">hscUpdateFlags</span></a></span><span>
</span><span id="line-7"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscSetFlags"><span class="hs-identifier">hscSetFlags</span></a></span><span>
</span><span id="line-8"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier">hsc_home_unit</span></a></span><span>
</span><span id="line-9"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_home_unit_maybe"><span class="hs-identifier">hsc_home_unit_maybe</span></a></span><span>
</span><span id="line-10"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier">hsc_units</span></a></span><span>
</span><span id="line-11"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier">hsc_HPT</span></a></span><span>
</span><span id="line-12"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HUE"><span class="hs-identifier">hsc_HUE</span></a></span><span>
</span><span id="line-13"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier">hsc_HUG</span></a></span><span>
</span><span id="line-14"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_all_home_unit_ids"><span class="hs-identifier">hsc_all_home_unit_ids</span></a></span><span>
</span><span id="line-15"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateLoggerFlags"><span class="hs-identifier">hscUpdateLoggerFlags</span></a></span><span>
</span><span id="line-16"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateHUG"><span class="hs-identifier">hscUpdateHUG</span></a></span><span>
</span><span id="line-17"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateHPT_lazy"><span class="hs-identifier">hscUpdateHPT_lazy</span></a></span><span>
</span><span id="line-18"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateHPT"><span class="hs-identifier">hscUpdateHPT</span></a></span><span>
</span><span id="line-19"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscSetActiveHomeUnit"><span class="hs-identifier">hscSetActiveHomeUnit</span></a></span><span>
</span><span id="line-20"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier">hscSetActiveUnitId</span></a></span><span>
</span><span id="line-21"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscActiveUnitId"><span class="hs-identifier">hscActiveUnitId</span></a></span><span>
</span><span id="line-22"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier">runHsc</span></a></span><span>
</span><span id="line-23"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#runHsc%27"><span class="hs-identifier">runHsc'</span></a></span><span>
</span><span id="line-24"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#mkInteractiveHscEnv"><span class="hs-identifier">mkInteractiveHscEnv</span></a></span><span>
</span><span id="line-25"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier">runInteractiveHsc</span></a></span><span>
</span><span id="line-26"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier">hscEPS</span></a></span><span>
</span><span id="line-27"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier">hscInterp</span></a></span><span>
</span><span id="line-28"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hptCompleteSigs"><span class="hs-identifier">hptCompleteSigs</span></a></span><span>
</span><span id="line-29"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hptAllInstances"><span class="hs-identifier">hptAllInstances</span></a></span><span>
</span><span id="line-30"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hptInstancesBelow"><span class="hs-identifier">hptInstancesBelow</span></a></span><span>
</span><span id="line-31"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hptAnns"><span class="hs-identifier">hptAnns</span></a></span><span>
</span><span id="line-32"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hptAllThings"><span class="hs-identifier">hptAllThings</span></a></span><span>
</span><span id="line-33"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hptSomeThingsBelowUs"><span class="hs-identifier">hptSomeThingsBelowUs</span></a></span><span>
</span><span id="line-34"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hptRules"><span class="hs-identifier">hptRules</span></a></span><span>
</span><span id="line-35"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#prepareAnnotations"><span class="hs-identifier">prepareAnnotations</span></a></span><span>
</span><span id="line-36"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#discardIC"><span class="hs-identifier">discardIC</span></a></span><span>
</span><span id="line-37"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#lookupType"><span class="hs-identifier">lookupType</span></a></span><span>
</span><span id="line-38"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#lookupIfaceByModule"><span class="hs-identifier">lookupIfaceByModule</span></a></span><span>
</span><span id="line-39"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#mainModIs"><span class="hs-identifier">mainModIs</span></a></span><span>
</span><span id="line-40"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html"><span class="hs-identifier">GHC.Driver.Errors</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html#printOrThrowDiagnostics"><span class="hs-identifier">printOrThrowDiagnostics</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html"><span class="hs-identifier">GHC.Driver.Errors.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier">GhcMessage</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Logger.html"><span class="hs-identifier">GHC.Driver.Config.Logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Logger.html#initLogFlags"><span class="hs-identifier">initLogFlags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier">initDiagOpts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initPrintConfig"><span class="hs-identifier">initPrintConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html"><span class="hs-identifier">GHC.Driver.Env.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier">Hsc</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier">HscEnv</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html"><span class="hs-identifier">GHC.Runtime.Context</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier">Interp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html"><span class="hs-identifier">GHC.Unit.Module.ModGuts</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html"><span class="hs-identifier">GHC.Unit.Module.ModDetails</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.External.html"><span class="hs-identifier">GHC.Unit.External</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier">CoreRule</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html"><span class="hs-identifier">GHC.Types.Annotations</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier">Annotation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#AnnEnv"><span class="hs-identifier">AnnEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#mkAnnEnv"><span class="hs-identifier">mkAnnEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#plusAnnEnv"><span class="hs-identifier">plusAnnEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html"><span class="hs-identifier">GHC.Types.CompleteMatch</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier">emptyMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier">Messages</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#gHC_PRIM"><span class="hs-identifier">gHC_PRIM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ex</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.IORef.html#/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.html#/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.html#/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html"><span class="hs-identifier">GHC.Unit.Module.Graph</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.OldList.html#sort/Data.OldList.html#sort"><span class="hs-identifier">sort</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.html#/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span id="local-6989586621681887387"><span class="annot"><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-type">runHsc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887387"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681887387"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-93"></span><span id="runHsc"><span class="annot"><span class="annottext">runHsc :: forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var hs-var">runHsc</span></a></span></span><span> </span><span id="local-6989586621681887599"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887599"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span id="local-6989586621681887601"><span class="annot"><span class="annottext">HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage)
</span><a href="#local-6989586621681887601"><span class="hs-identifier hs-var">hsc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681887602"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681887602"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681887603"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621681887603"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage)
</span><a href="#local-6989586621681887601"><span class="hs-identifier hs-var">hsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887599"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681887604"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681887604"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887599"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681887606"><span class="annot"><span class="annottext">diag_opts :: DiagOpts
</span><a href="#local-6989586621681887606"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681887604"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621681887607"><span class="annot"><span class="annottext">print_config :: DiagnosticOpts GhcMessage
</span><a href="#local-6989586621681887607"><span class="hs-identifier hs-var hs-var">print_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagnosticOpts GhcMessage
</span><a href="GHC.Driver.Config.Diagnostic.html#initPrintConfig"><span class="hs-identifier hs-var">initPrintConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681887604"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="annottext">Logger
-&gt; GhcMessageOpts -&gt; DiagOpts -&gt; Messages GhcMessage -&gt; IO ()
</span><a href="GHC.Driver.Errors.html#printOrThrowDiagnostics"><span class="hs-identifier hs-var">printOrThrowDiagnostics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887599"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DiagnosticOpts GhcMessage
GhcMessageOpts
</span><a href="#local-6989586621681887607"><span class="hs-identifier hs-var">print_config</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621681887606"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621681887603"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681887602"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span id="local-6989586621681887400"><span class="annot"><a href="GHC.Driver.Env.html#runHsc%27"><span class="hs-identifier hs-type">runHsc'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887400"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681887400"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-102"></span><span id="runHsc%27"><span class="annot"><span class="annottext">runHsc' :: forall a. HscEnv -&gt; Hsc a -&gt; IO (a, Messages GhcMessage)
</span><a href="GHC.Driver.Env.html#runHsc%27"><span class="hs-identifier hs-var hs-var">runHsc'</span></a></span></span><span> </span><span id="local-6989586621681887609"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887609"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span id="local-6989586621681887610"><span class="annot"><span class="annottext">HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage)
</span><a href="#local-6989586621681887610"><span class="hs-identifier hs-var">hsc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Messages GhcMessage -&gt; IO (a, Messages GhcMessage)
</span><a href="#local-6989586621681887610"><span class="hs-identifier hs-var">hsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887609"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><span class="hs-comment">-- | Switches in the DynFlags and Plugins from the InteractiveContext</span></span><span>
</span><span id="line-105"></span><span class="annot"><a href="GHC.Driver.Env.html#mkInteractiveHscEnv"><span class="hs-identifier hs-type">mkInteractiveHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-106"></span><span id="mkInteractiveHscEnv"><span class="annot"><span class="annottext">mkInteractiveHscEnv :: HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#mkInteractiveHscEnv"><span class="hs-identifier hs-var hs-var">mkInteractiveHscEnv</span></a></span></span><span> </span><span id="local-6989586621681887611"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887611"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681887612"><span class="annot"><span class="annottext">ic :: InteractiveContext
</span><a href="#local-6989586621681887612"><span class="hs-identifier hs-var hs-var">ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887611"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DynFlags -&gt; HscEnv -&gt; HscEnv
DynFlags -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetFlags"><span class="hs-identifier hs-var">hscSetFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; DynFlags
</span><a href="GHC.Runtime.Context.html#ic_dflags"><span class="hs-identifier hs-var">ic_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681887612"><span class="hs-identifier hs-var">ic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; HscEnv -&gt; HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-109"></span><span>       </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887611"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_plugins"><span class="hs-identifier hs-var">ic_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887612"><span class="hs-identifier hs-type">ic</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- | A variant of runHsc that switches in the DynFlags and Plugins from the</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- InteractiveContext before running the Hsc computation.</span><span>
</span><span id="line-113"></span><span id="local-6989586621681887617"><span class="annot"><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-type">runInteractiveHsc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887617"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681887617"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-114"></span><span id="runInteractiveHsc"><span class="annot"><span class="annottext">runInteractiveHsc :: forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runInteractiveHsc"><span class="hs-identifier hs-var hs-var">runInteractiveHsc</span></a></span></span><span> </span><span id="local-6989586621681887618"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887618"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc a -&gt; IO a
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#mkInteractiveHscEnv"><span class="hs-identifier hs-var">mkInteractiveHscEnv</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887618"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-type">hsc_home_unit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span>
</span><span id="line-117"></span><span id="hsc_home_unit"><span class="annot"><span class="annottext">hsc_home_unit :: HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var hs-var">hsc_home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; HomeUnit
</span><a href="GHC.Unit.Env.html#unsafeGetHomeUnit"><span class="hs-identifier hs-var">unsafeGetHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnv -&gt; HomeUnit) -&gt; (HscEnv -&gt; UnitEnv) -&gt; HscEnv -&gt; HomeUnit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><a href="GHC.Driver.Env.html#hsc_home_unit_maybe"><span class="hs-identifier hs-type">hsc_home_unit_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span>
</span><span id="line-120"></span><span id="hsc_home_unit_maybe"><span class="annot"><span class="annottext">hsc_home_unit_maybe :: HscEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit_maybe"><span class="hs-identifier hs-var hs-var">hsc_home_unit_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Unit.Env.html#ue_homeUnit"><span class="hs-identifier hs-var">ue_homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnv -&gt; Maybe HomeUnit)
-&gt; (HscEnv -&gt; UnitEnv) -&gt; HscEnv -&gt; Maybe HomeUnit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-type">hsc_units</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-123"></span><span id="hsc_units"><span class="annot"><span class="annottext">hsc_units :: (() :: Constraint) =&gt; HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var hs-var">hsc_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitEnv -&gt; UnitState
UnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#ue_units"><span class="hs-identifier hs-var">ue_units</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnv -&gt; UnitState)
-&gt; (HscEnv -&gt; UnitEnv) -&gt; HscEnv -&gt; UnitState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-type">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-126"></span><span id="hsc_HPT"><span class="annot"><span class="annottext">hsc_HPT :: HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitEnv -&gt; HomePackageTable
UnitEnv -&gt; HomePackageTable
</span><a href="GHC.Unit.Env.html#ue_hpt"><span class="hs-identifier hs-var">ue_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnv -&gt; HomePackageTable)
-&gt; (HscEnv -&gt; UnitEnv) -&gt; HscEnv -&gt; HomePackageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HUE"><span class="hs-identifier hs-type">hsc_HUE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitEnv"><span class="hs-identifier hs-type">HomeUnitEnv</span></a></span><span>
</span><span id="line-129"></span><span id="hsc_HUE"><span class="annot"><span class="annottext">hsc_HUE :: HscEnv -&gt; HomeUnitEnv
</span><a href="GHC.Driver.Env.html#hsc_HUE"><span class="hs-identifier hs-var hs-var">hsc_HUE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitEnv -&gt; HomeUnitEnv
UnitEnv -&gt; HomeUnitEnv
</span><a href="GHC.Unit.Env.html#ue_currentHomeUnitEnv"><span class="hs-identifier hs-var">ue_currentHomeUnitEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnv -&gt; HomeUnitEnv)
-&gt; (HscEnv -&gt; UnitEnv) -&gt; HscEnv -&gt; HomeUnitEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-type">hsc_HUG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span>
</span><span id="line-132"></span><span id="hsc_HUG"><span class="annot"><span class="annottext">hsc_HUG :: HscEnv -&gt; HomeUnitGraph
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var hs-var">hsc_HUG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; HomeUnitGraph
</span><a href="GHC.Unit.Env.html#ue_home_unit_graph"><span class="hs-identifier hs-var">ue_home_unit_graph</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnv -&gt; HomeUnitGraph)
-&gt; (HscEnv -&gt; UnitEnv) -&gt; HscEnv -&gt; HomeUnitGraph
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.Driver.Env.html#hsc_all_home_unit_ids"><span class="hs-identifier hs-type">hsc_all_home_unit_ids</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-135"></span><span id="hsc_all_home_unit_ids"><span class="annot"><span class="annottext">hsc_all_home_unit_ids :: HscEnv -&gt; Set UnitId
</span><a href="GHC.Driver.Env.html#hsc_all_home_unit_ids"><span class="hs-identifier hs-var hs-var">hsc_all_home_unit_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph -&gt; Set UnitId
forall v. UnitEnvGraph v -&gt; Set UnitId
</span><a href="GHC.Unit.Env.html#unitEnv_keys"><span class="hs-identifier hs-var">unitEnv_keys</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeUnitGraph -&gt; Set UnitId)
-&gt; (HscEnv -&gt; HomeUnitGraph) -&gt; HscEnv -&gt; Set UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnitGraph
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateHPT_lazy"><span class="hs-identifier hs-type">hscUpdateHPT_lazy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-138"></span><span id="hscUpdateHPT_lazy"><span class="annot"><span class="annottext">hscUpdateHPT_lazy :: (HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHPT_lazy"><span class="hs-identifier hs-var hs-var">hscUpdateHPT_lazy</span></a></span></span><span> </span><span id="local-6989586621681887631"><span class="annot"><span class="annottext">HomePackageTable -&gt; HomePackageTable
</span><a href="#local-6989586621681887631"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681887632"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887632"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681887633"><span class="annot"><span class="annottext">res :: UnitEnv
</span><a href="#local-6989586621681887633"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; HomePackageTable) -&gt; UnitEnv -&gt; UnitEnv
</span><a href="GHC.Unit.Env.html#updateHpt_lazy"><span class="hs-identifier hs-var">updateHpt_lazy</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; HomePackageTable
</span><a href="#local-6989586621681887631"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887632"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887632"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681887633"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateHPT"><span class="hs-identifier hs-type">hscUpdateHPT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-143"></span><span id="hscUpdateHPT"><span class="annot"><span class="annottext">hscUpdateHPT :: (HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHPT"><span class="hs-identifier hs-var hs-var">hscUpdateHPT</span></a></span></span><span> </span><span id="local-6989586621681887635"><span class="annot"><span class="annottext">HomePackageTable -&gt; HomePackageTable
</span><a href="#local-6989586621681887635"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681887636"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887636"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681887637"><span class="annot"><span class="annottext">res :: UnitEnv
</span><a href="#local-6989586621681887637"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; HomePackageTable) -&gt; UnitEnv -&gt; UnitEnv
</span><a href="GHC.Unit.Env.html#updateHpt"><span class="hs-identifier hs-var">updateHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; HomePackageTable
</span><a href="#local-6989586621681887635"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887636"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887636"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681887637"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateHUG"><span class="hs-identifier hs-type">hscUpdateHUG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-148"></span><span id="hscUpdateHUG"><span class="annot"><span class="annottext">hscUpdateHUG :: (HomeUnitGraph -&gt; HomeUnitGraph) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHUG"><span class="hs-identifier hs-var hs-var">hscUpdateHUG</span></a></span></span><span> </span><span id="local-6989586621681887639"><span class="annot"><span class="annottext">HomeUnitGraph -&gt; HomeUnitGraph
</span><a href="#local-6989586621681887639"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681887640"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887640"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887640"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#updateHug"><span class="hs-identifier hs-type">updateHug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887639"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887640"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">{-

Note [Target code interpreter]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Template Haskell and GHCi use an interpreter to execute code that is built for
the compiler target platform (= code host platform) on the compiler host
platform (= code build platform).

The internal interpreter can be used when both platforms are the same and when
the built code is compatible with the compiler itself (same way, etc.). This
interpreter is not always available: for instance stage1 compiler doesn't have
it because there might be an ABI mismatch between the code objects (built by
stage1 compiler) and the stage1 compiler itself (built by stage0 compiler).

In most cases, an external interpreter can be used instead: it runs in a
separate process and it communicates with the compiler via a two-way message
passing channel. The process is lazily spawned to avoid overhead when it is not
used.

The target code interpreter to use can be selected per session via the
`hsc_interp` field of `HscEnv`. There may be no interpreter available at all, in
which case Template Haskell and GHCi will fail to run. The interpreter to use is
configured via command-line flags (in `GHC.setSessionDynFlags`).


-}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- Note [hsc_type_env_var hack]</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- hsc_type_env_var is used to initialize tcg_type_env_var, and</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- eventually it is the mutable variable that is queried from</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- if_rec_types to get a TypeEnv.  So, clearly, it's something</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- related to knot-tying (see Note [Tying the knot]).</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- hsc_type_env_var is used in two places: initTcRn (where</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- it initializes tcg_type_env_var) and initIfaceCheck</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- (where it initializes if_rec_types).</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- But why do we need a way to feed a mutable variable in?  Why</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- can't we just initialize tcg_type_env_var when we start</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- typechecking?  The problem is we need to knot-tie the</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- EPS, and we may start adding things to the EPS before type</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- checking starts.</span><span>
</span><span id="line-193"></span><span class="hs-comment">--</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- Here is a concrete example. Suppose we are running</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- &quot;ghc -c A.hs&quot;, and we have this file system state:</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span class="hs-comment">--  A.hs-boot   A.hi-boot **up to date**</span><span>
</span><span id="line-198"></span><span class="hs-comment">--  B.hs        B.hi      **up to date**</span><span>
</span><span id="line-199"></span><span class="hs-comment">--  A.hs        A.hi      **stale**</span><span>
</span><span id="line-200"></span><span class="hs-comment">--</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- The first thing we do is run checkOldIface on A.hi.</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- checkOldIface will call loadInterface on B.hi so it can</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- get its hands on the fingerprints, to find out if A.hi</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- needs recompilation.  But loadInterface also populates</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- the EPS!  And so if compilation turns out to be necessary,</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- as it is in this case, the thunks we put into the EPS for</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- B.hi need to have the correct if_rec_types mutable variable</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- to query.</span><span>
</span><span id="line-209"></span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- If the mutable variable is only allocated WHEN we start</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- typechecking, then that's too late: we can't get the</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- information to the thunks.  So we need to pre-commit</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- to a type variable in 'hscIncrementalCompile' BEFORE we</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- check the old interface.</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- This is all a massive hack because arguably checkOldIface</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- should not populate the EPS. But that's a refactor for</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- another day.</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><span class="hs-comment">-- | Retrieve the ExternalPackageState cache.</span></span><span>
</span><span id="line-221"></span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-type">hscEPS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span>
</span><span id="line-222"></span><span id="hscEPS"><span class="annot"><span class="annottext">hscEPS :: HscEnv -&gt; IO ExternalPackageState
</span><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-var hs-var">hscEPS</span></a></span></span><span> </span><span id="local-6989586621681887642"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887642"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef ExternalPackageState -&gt; IO ExternalPackageState
forall a. IORef a -&gt; IO a
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#readIORef/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalUnitCache -&gt; IORef ExternalPackageState
</span><a href="GHC.Unit.External.html#euc_eps"><span class="hs-identifier hs-var">euc_eps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; ExternalUnitCache
</span><a href="GHC.Unit.Env.html#ue_eps"><span class="hs-identifier hs-var">ue_eps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887642"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="GHC.Driver.Env.html#hptCompleteSigs"><span class="hs-identifier hs-type">hptCompleteSigs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span id="hptCompleteSigs"><span class="annot"><span class="annottext">hptCompleteSigs :: HscEnv -&gt; [CompleteMatch]
</span><a href="GHC.Driver.Env.html#hptCompleteSigs"><span class="hs-identifier hs-var hs-var">hptCompleteSigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [CompleteMatch]) -&gt; HscEnv -&gt; [CompleteMatch]
forall a. (HomeModInfo -&gt; [a]) -&gt; HscEnv -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptAllThings"><span class="hs-identifier hs-var">hptAllThings</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; [CompleteMatch]
</span><a href="GHC.Unit.Module.ModDetails.html#md_complete_matches"><span class="hs-identifier hs-var">md_complete_matches</span></a></span><span> </span><span class="annot"><span class="annottext">(ModDetails -&gt; [CompleteMatch])
-&gt; (HomeModInfo -&gt; ModDetails) -&gt; HomeModInfo -&gt; [CompleteMatch]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModDetails
</span><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- | Find all the instance declarations (of classes and families) from</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- the Home Package Table filtered by the provided predicate function.</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Used in @tcRnImports@, to select the instances that are in the</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- transitive closure of imports from the currently compiled module.</span><span>
</span><span id="line-231"></span><span class="annot"><a href="GHC.Driver.Env.html#hptAllInstances"><span class="hs-identifier hs-type">hptAllInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span id="hptAllInstances"><span class="annot"><span class="annottext">hptAllInstances :: HscEnv -&gt; (InstEnv, [FamInst])
</span><a href="GHC.Driver.Env.html#hptAllInstances"><span class="hs-identifier hs-var hs-var">hptAllInstances</span></a></span></span><span> </span><span id="local-6989586621681887648"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887648"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681887649"><span class="annot"><span class="annottext">[InstEnv]
</span><a href="#local-6989586621681887649"><span class="hs-identifier hs-var">insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681887650"><span class="annot"><span class="annottext">[[FamInst]]
</span><a href="#local-6989586621681887650"><span class="hs-identifier hs-var">famInsts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(InstEnv, [FamInst])] -&gt; ([InstEnv], [[FamInst]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">([(InstEnv, [FamInst])] -&gt; ([InstEnv], [[FamInst]]))
-&gt; [(InstEnv, [FamInst])] -&gt; ([InstEnv], [[FamInst]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((HomeModInfo -&gt; [(InstEnv, [FamInst])])
 -&gt; HscEnv -&gt; [(InstEnv, [FamInst])])
-&gt; HscEnv
-&gt; (HomeModInfo -&gt; [(InstEnv, [FamInst])])
-&gt; [(InstEnv, [FamInst])]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [(InstEnv, [FamInst])])
-&gt; HscEnv -&gt; [(InstEnv, [FamInst])]
forall a. (HomeModInfo -&gt; [a]) -&gt; HscEnv -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptAllThings"><span class="hs-identifier hs-var">hptAllThings</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887648"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">((HomeModInfo -&gt; [(InstEnv, [FamInst])]) -&gt; [(InstEnv, [FamInst])])
-&gt; (HomeModInfo -&gt; [(InstEnv, [FamInst])])
-&gt; [(InstEnv, [FamInst])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681887653"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887653"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681887654"><span class="annot"><span class="annottext">details :: ModDetails
</span><a href="#local-6989586621681887654"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModDetails
</span><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887653"><span class="hs-identifier hs-var">mod_info</span></a></span><span>
</span><span id="line-235"></span><span>                </span><span class="annot"><span class="annottext">(InstEnv, [FamInst]) -&gt; [(InstEnv, [FamInst])]
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; InstEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_insts"><span class="hs-identifier hs-var">md_insts</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681887654"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModDetails -&gt; [FamInst]
</span><a href="GHC.Unit.Module.ModDetails.html#md_fam_insts"><span class="hs-identifier hs-var">md_fam_insts</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681887654"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InstEnv -&gt; InstEnv -&gt; InstEnv) -&gt; InstEnv -&gt; [InstEnv] -&gt; InstEnv
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv -&gt; InstEnv -&gt; InstEnv
</span><a href="GHC.Core.InstEnv.html#unionInstEnv"><span class="hs-identifier hs-var">unionInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="GHC.Core.InstEnv.html#emptyInstEnv"><span class="hs-identifier hs-var">emptyInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[InstEnv]
</span><a href="#local-6989586621681887649"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[[FamInst]] -&gt; [FamInst]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">[[FamInst]]
</span><a href="#local-6989586621681887650"><span class="hs-identifier hs-var">famInsts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><span class="hs-comment">-- | Find instances visible from the given set of imports</span></span><span>
</span><span id="line-239"></span><span class="annot"><a href="GHC.Driver.Env.html#hptInstancesBelow"><span class="hs-identifier hs-type">hptInstancesBelow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span id="hptInstancesBelow"><span class="annot"><span class="annottext">hptInstancesBelow :: HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; (InstEnv, [FamInst])
</span><a href="GHC.Driver.Env.html#hptInstancesBelow"><span class="hs-identifier hs-var hs-var">hptInstancesBelow</span></a></span></span><span> </span><span id="local-6989586621681887661"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887661"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681887662"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887662"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621681887663"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887663"><span class="hs-identifier hs-var">mnwib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621681887664"><span class="annot"><span class="annottext">mn :: ModuleName
</span><a href="#local-6989586621681887664"><span class="hs-identifier hs-var hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; ModuleName
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887663"><span class="hs-identifier hs-var">mnwib</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681887666"><span class="annot"><span class="annottext">[InstEnv]
</span><a href="#local-6989586621681887666"><span class="hs-identifier hs-var">insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681887667"><span class="annot"><span class="annottext">[[FamInst]]
</span><a href="#local-6989586621681887667"><span class="hs-identifier hs-var">famInsts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">[(InstEnv, [FamInst])] -&gt; ([InstEnv], [[FamInst]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">([(InstEnv, [FamInst])] -&gt; ([InstEnv], [[FamInst]]))
-&gt; [(InstEnv, [FamInst])] -&gt; ([InstEnv], [[FamInst]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [(InstEnv, [FamInst])])
-&gt; Bool
-&gt; HscEnv
-&gt; UnitId
-&gt; ModuleNameWithIsBoot
-&gt; [(InstEnv, [FamInst])]
forall a.
(HomeModInfo -&gt; [a])
-&gt; Bool -&gt; HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptSomeThingsBelowUs"><span class="hs-identifier hs-var">hptSomeThingsBelowUs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681887668"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887668"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-245"></span><span>                                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681887669"><span class="annot"><span class="annottext">details :: ModDetails
</span><a href="#local-6989586621681887669"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModDetails
</span><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887668"><span class="hs-identifier hs-var">mod_info</span></a></span><span>
</span><span id="line-246"></span><span>                                     </span><span class="hs-comment">-- Don't include instances for the current module</span><span>
</span><span id="line-247"></span><span>                                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; GenModule Unit
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; GenModule Unit
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887668"><span class="hs-identifier hs-var">mod_info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887664"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-248"></span><span>                                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>                                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; InstEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_insts"><span class="hs-identifier hs-var">md_insts</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681887669"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModDetails -&gt; [FamInst]
</span><a href="GHC.Unit.Module.ModDetails.html#md_fam_insts"><span class="hs-identifier hs-var">md_fam_insts</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681887669"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>                             </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Include -hi-boot</span><span>
</span><span id="line-251"></span><span>                             </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887661"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-252"></span><span>                             </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887662"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-253"></span><span>                             </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887663"><span class="hs-identifier hs-var">mnwib</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InstEnv -&gt; InstEnv -&gt; InstEnv) -&gt; InstEnv -&gt; [InstEnv] -&gt; InstEnv
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv -&gt; InstEnv -&gt; InstEnv
</span><a href="GHC.Core.InstEnv.html#unionInstEnv"><span class="hs-identifier hs-var">unionInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="GHC.Core.InstEnv.html#emptyInstEnv"><span class="hs-identifier hs-var">emptyInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[InstEnv]
</span><a href="#local-6989586621681887666"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[[FamInst]] -&gt; [FamInst]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">[[FamInst]]
</span><a href="#local-6989586621681887667"><span class="hs-identifier hs-var">famInsts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><span class="hs-comment">-- | Get rules from modules &quot;below&quot; this one (in the dependency sense)</span></span><span>
</span><span id="line-257"></span><span class="annot"><a href="GHC.Driver.Env.html#hptRules"><span class="hs-identifier hs-type">hptRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span id="hptRules"><span class="annot"><span class="annottext">hptRules :: HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [CoreRule]
</span><a href="GHC.Driver.Env.html#hptRules"><span class="hs-identifier hs-var hs-var">hptRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [CoreRule])
-&gt; Bool -&gt; HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [CoreRule]
forall a.
(HomeModInfo -&gt; [a])
-&gt; Bool -&gt; HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptSomeThingsBelowUs"><span class="hs-identifier hs-var">hptSomeThingsBelowUs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; [CoreRule]
</span><a href="GHC.Unit.Module.ModDetails.html#md_rules"><span class="hs-identifier hs-var">md_rules</span></a></span><span> </span><span class="annot"><span class="annottext">(ModDetails -&gt; [CoreRule])
-&gt; (HomeModInfo -&gt; ModDetails) -&gt; HomeModInfo -&gt; [CoreRule]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModDetails
</span><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><span class="hs-comment">-- | Get annotations from modules &quot;below&quot; this one (in the dependency sense)</span></span><span>
</span><span id="line-262"></span><span class="annot"><a href="GHC.Driver.Env.html#hptAnns"><span class="hs-identifier hs-type">hptAnns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span id="hptAnns"><span class="annot"><span class="annottext">hptAnns :: HscEnv -&gt; Maybe (UnitId, ModuleNameWithIsBoot) -&gt; [Annotation]
</span><a href="GHC.Driver.Env.html#hptAnns"><span class="hs-identifier hs-var hs-var">hptAnns</span></a></span></span><span> </span><span id="local-6989586621681887674"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887674"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681887675"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887675"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681887676"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887676"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [Annotation])
-&gt; Bool -&gt; HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [Annotation]
forall a.
(HomeModInfo -&gt; [a])
-&gt; Bool -&gt; HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptSomeThingsBelowUs"><span class="hs-identifier hs-var">hptSomeThingsBelowUs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; [Annotation]
</span><a href="GHC.Unit.Module.ModDetails.html#md_anns"><span class="hs-identifier hs-var">md_anns</span></a></span><span> </span><span class="annot"><span class="annottext">(ModDetails -&gt; [Annotation])
-&gt; (HomeModInfo -&gt; ModDetails) -&gt; HomeModInfo -&gt; [Annotation]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModDetails
</span><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887674"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887675"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887676"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-264"></span><span class="annot"><a href="GHC.Driver.Env.html#hptAnns"><span class="hs-identifier hs-var">hptAnns</span></a></span><span> </span><span id="local-6989586621681887678"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887678"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (UnitId, ModuleNameWithIsBoot)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [Annotation]) -&gt; HscEnv -&gt; [Annotation]
forall a. (HomeModInfo -&gt; [a]) -&gt; HscEnv -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptAllThings"><span class="hs-identifier hs-var">hptAllThings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; [Annotation]
</span><a href="GHC.Unit.Module.ModDetails.html#md_anns"><span class="hs-identifier hs-var">md_anns</span></a></span><span> </span><span class="annot"><span class="annottext">(ModDetails -&gt; [Annotation])
-&gt; (HomeModInfo -&gt; ModDetails) -&gt; HomeModInfo -&gt; [Annotation]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModDetails
</span><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887678"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span id="local-6989586621681887427"><span class="annot"><a href="GHC.Driver.Env.html#hptAllThings"><span class="hs-identifier hs-type">hptAllThings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681887427"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681887427"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-267"></span><span id="hptAllThings"><span class="annot"><span class="annottext">hptAllThings :: forall a. (HomeModInfo -&gt; [a]) -&gt; HscEnv -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptAllThings"><span class="hs-identifier hs-var hs-var">hptAllThings</span></a></span></span><span> </span><span id="local-6989586621681887681"><span class="annot"><span class="annottext">HomeModInfo -&gt; [a]
</span><a href="#local-6989586621681887681"><span class="hs-identifier hs-var">extract</span></a></span></span><span> </span><span id="local-6989586621681887682"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887682"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((UnitId, HomeUnitEnv) -&gt; [a]) -&gt; [(UnitId, HomeUnitEnv)] -&gt; [a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [a]) -&gt; [HomeModInfo] -&gt; [a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; [a]
</span><a href="#local-6989586621681887681"><span class="hs-identifier hs-var">extract</span></a></span><span> </span><span class="annot"><span class="annottext">([HomeModInfo] -&gt; [a])
-&gt; ((UnitId, HomeUnitEnv) -&gt; [HomeModInfo])
-&gt; (UnitId, HomeUnitEnv)
-&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; [HomeModInfo]
</span><a href="GHC.Unit.Home.ModInfo.html#eltsHpt"><span class="hs-identifier hs-var">eltsHpt</span></a></span><span> </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; [HomeModInfo])
-&gt; ((UnitId, HomeUnitEnv) -&gt; HomePackageTable)
-&gt; (UnitId, HomeUnitEnv)
-&gt; [HomeModInfo]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; HomePackageTable
</span><a href="GHC.Unit.Env.html#homeUnitEnv_hpt"><span class="hs-identifier hs-var">homeUnitEnv_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeUnitEnv -&gt; HomePackageTable)
-&gt; ((UnitId, HomeUnitEnv) -&gt; HomeUnitEnv)
-&gt; (UnitId, HomeUnitEnv)
-&gt; HomePackageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, HomeUnitEnv) -&gt; HomeUnitEnv
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitGraph -&gt; [(UnitId, HomeUnitEnv)]
</span><a href="GHC.Unit.Env.html#hugElts"><span class="hs-identifier hs-var">hugElts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnitGraph
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887682"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- | This function returns all the modules belonging to the home-unit that can</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- be reached by following the given dependencies. Additionally, if both the</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- boot module and the non-boot module can be reached, it only returns the</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- non-boot one.</span><span>
</span><span id="line-274"></span><span class="annot"><a href="GHC.Driver.Env.html#hptModulesBelow"><span class="hs-identifier hs-type">hptModulesBelow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span>
</span><span id="line-275"></span><span id="hptModulesBelow"><span class="annot"><span class="annottext">hptModulesBelow :: HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; Set ModNodeKeyWithUid
</span><a href="GHC.Driver.Env.html#hptModulesBelow"><span class="hs-identifier hs-var hs-var">hptModulesBelow</span></a></span></span><span> </span><span id="local-6989586621681887689"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887689"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681887690"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887690"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621681887691"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887691"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid] -&gt; Set ModNodeKeyWithUid
</span><a href="#local-6989586621681887692"><span class="hs-identifier hs-var">filtered_mods</span></a></span><span> </span><span class="annot"><span class="annottext">([ModNodeKeyWithUid] -&gt; Set ModNodeKeyWithUid)
-&gt; [ModNodeKeyWithUid] -&gt; Set ModNodeKeyWithUid
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621681887693"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-type">NodeKey_Module</span></a></span><span> </span><span id="local-6989586621681887693"><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621681887693"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681887695"><span class="hs-identifier hs-var">modules_below</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-277"></span><span>    </span><span id="local-6989586621681887696"><span class="annot"><span class="annottext">td_map :: Map NodeKey (Set NodeKey)
</span><a href="#local-6989586621681887696"><span class="hs-identifier hs-var hs-var">td_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; Map NodeKey (Set NodeKey)
</span><a href="GHC.Unit.Module.Graph.html#mgTransDeps"><span class="hs-identifier hs-var">mgTransDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph
</span><a href="GHC.Driver.Env.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887689"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621681887695"><span class="annot"><span class="annottext">modules_below :: [NodeKey]
</span><a href="#local-6989586621681887695"><span class="hs-identifier hs-var hs-var">modules_below</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
-&gt; (Set NodeKey -&gt; [NodeKey]) -&gt; Maybe (Set NodeKey) -&gt; [NodeKey]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Set NodeKey -&gt; [NodeKey]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set NodeKey) -&gt; [NodeKey])
-&gt; Maybe (Set NodeKey) -&gt; [NodeKey]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Map NodeKey (Set NodeKey) -&gt; Maybe (Set NodeKey)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; UnitId -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-var">ModNodeKeyWithUid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887691"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887690"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map NodeKey (Set NodeKey)
</span><a href="#local-6989586621681887696"><span class="hs-identifier hs-var">td_map</span></a></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621681887692"><span class="annot"><span class="annottext">filtered_mods :: [ModNodeKeyWithUid] -&gt; Set ModNodeKeyWithUid
</span><a href="#local-6989586621681887692"><span class="hs-identifier hs-var hs-var">filtered_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid] -&gt; Set ModNodeKeyWithUid
forall a. [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromDistinctAscList/Data.Set.Internal.html#fromDistinctAscList"><span class="hs-identifier hs-var">Set.fromDistinctAscList</span></a></span><span> </span><span class="annot"><span class="annottext">([ModNodeKeyWithUid] -&gt; Set ModNodeKeyWithUid)
-&gt; ([ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid])
-&gt; [ModNodeKeyWithUid]
-&gt; Set ModNodeKeyWithUid
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
</span><a href="#local-6989586621681887706"><span class="hs-identifier hs-var">filter_mods</span></a></span><span> </span><span class="annot"><span class="annottext">([ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid])
-&gt; ([ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid])
-&gt; [ModNodeKeyWithUid]
-&gt; [ModNodeKeyWithUid]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#sort/Data.OldList.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- IsBoot and NotBoot modules are necessarily consecutive in the sorted list</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-comment">-- (cf Ord instance of GenWithIsBoot). Hence we only have to perform a</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">-- linear sweep with a window of size 2 to remove boot modules for which we</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-comment">-- have the corresponding non-boot.</span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621681887706"><span class="annot"><span class="annottext">filter_mods :: [ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
</span><a href="#local-6989586621681887706"><span class="hs-identifier hs-var hs-var">filter_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681887710"><span class="annot"><span class="annottext">r1 :: ModNodeKeyWithUid
</span><a href="#local-6989586621681887710"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span id="local-6989586621681887712"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887712"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621681887713"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681887713"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681887714"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887714"><span class="hs-identifier hs-var">uid1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681887715"><span class="annot"><span class="annottext">r2 :: ModNodeKeyWithUid
</span><a href="#local-6989586621681887715"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span id="local-6989586621681887716"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887716"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681887717"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887717"><span class="hs-identifier hs-var">uid2</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681887718"><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621681887718"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887712"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887716"><span class="hs-identifier hs-var">m2</span></a></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887714"><span class="hs-identifier hs-var">uid1</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887717"><span class="hs-identifier hs-var">uid2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-290"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681887720"><span class="annot"><span class="annottext">r' :: ModNodeKeyWithUid
</span><a href="#local-6989586621681887720"><span class="hs-identifier hs-var hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681887713"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-291"></span><span>                                  </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621681887710"><span class="hs-identifier hs-var">r1</span></a></span><span>
</span><span id="line-292"></span><span>                                  </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621681887715"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-293"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621681887720"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; [ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
</span><a href="#local-6989586621681887706"><span class="hs-identifier hs-var">filter_mods</span></a></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621681887718"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621681887710"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; [ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
</span><a href="#local-6989586621681887706"><span class="hs-identifier hs-var">filter_mods</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621681887715"><span class="hs-identifier hs-var">r2</span></a></span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; [ModNodeKeyWithUid] -&gt; [ModNodeKeyWithUid]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621681887718"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>      </span><span id="local-6989586621681887723"><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621681887723"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ModNodeKeyWithUid]
</span><a href="#local-6989586621681887723"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Get things from modules &quot;below&quot; this one (in the dependency sense)</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- C.f Inst.hptInstances</span><span>
</span><span id="line-301"></span><span id="local-6989586621681887444"><span class="annot"><a href="GHC.Driver.Env.html#hptSomeThingsBelowUs"><span class="hs-identifier hs-type">hptSomeThingsBelowUs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681887444"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681887444"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-302"></span><span id="hptSomeThingsBelowUs"><span class="annot"><span class="annottext">hptSomeThingsBelowUs :: forall a.
(HomeModInfo -&gt; [a])
-&gt; Bool -&gt; HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [a]
</span><a href="GHC.Driver.Env.html#hptSomeThingsBelowUs"><span class="hs-identifier hs-var hs-var">hptSomeThingsBelowUs</span></a></span></span><span> </span><span id="local-6989586621681887749"><span class="annot"><span class="annottext">HomeModInfo -&gt; [a]
</span><a href="#local-6989586621681887749"><span class="hs-identifier hs-var">extract</span></a></span></span><span> </span><span id="local-6989586621681887750"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681887750"><span class="hs-identifier hs-var">include_hi_boot</span></a></span></span><span> </span><span id="local-6989586621681887751"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887751"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681887752"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887752"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621681887753"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887753"><span class="hs-identifier hs-var">mn</span></a></span></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GhcMode -&gt; Bool
</span><a href="GHC.Driver.Session.html#isOneShot"><span class="hs-identifier hs-var">isOneShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcMode
</span><a href="GHC.Driver.Session.html#ghcMode"><span class="hs-identifier hs-var">ghcMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887751"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681887756"><span class="annot"><span class="annottext">hug :: HomeUnitGraph
</span><a href="#local-6989586621681887756"><span class="hs-identifier hs-var hs-var">hug</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnitGraph
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887751"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681887757"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-glyph">|</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-comment">-- Find each non-hi-boot module below me</span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681887758"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887758"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: forall mod. GenWithIsBoot mod -&gt; IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681887760"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681887760"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681887761"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887761"><span class="hs-identifier hs-var">mod_uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set ModNodeKeyWithUid -&gt; [ModNodeKeyWithUid]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; Set ModNodeKeyWithUid
</span><a href="GHC.Driver.Env.html#hptModulesBelow"><span class="hs-identifier hs-var">hptModulesBelow</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887751"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887752"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887753"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681887750"><span class="hs-identifier hs-var">include_hi_boot</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681887760"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-comment">-- unsavoury: when compiling the base package with --make, we</span><span>
</span><span id="line-315"></span><span>        </span><span class="hs-comment">-- sometimes try to look up RULES etc for GHC.Prim. GHC.Prim won't</span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-comment">-- be in the HPT, because we never compile it; it's in the EPT</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-comment">-- instead. ToDo: clean up, and remove this slightly bogus filter:</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887758"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="GHC.Builtin.Names.html#gHC_PRIM"><span class="hs-identifier hs-var">gHC_PRIM</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887758"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; ModuleName
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887753"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887752"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887761"><span class="hs-identifier hs-var">mod_uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-comment">-- Look it up in the HPT</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681887765"><span class="annot"><span class="annottext">things :: [a]
</span><a href="#local-6989586621681887765"><span class="hs-identifier hs-var hs-var">things</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph -&gt; UnitId -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Env.html#lookupHug"><span class="hs-identifier hs-var">lookupHug</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621681887756"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887761"><span class="hs-identifier hs-var">mod_uid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887758"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>                    </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681887767"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887767"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; [a]
</span><a href="#local-6989586621681887749"><span class="hs-identifier hs-var">extract</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887767"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-324"></span><span>                    </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; [a] -&gt; [a]
forall a. String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WARNING in hptSomeThingsBelowUs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681887769"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-325"></span><span>          </span><span id="local-6989586621681887769"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681887769"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;missing module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681887758"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-326"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When starting from&quot;</span></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887753"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-327"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;below:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Set ModNodeKeyWithUid -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; Set ModNodeKeyWithUid
</span><a href="GHC.Driver.Env.html#hptModulesBelow"><span class="hs-identifier hs-var">hptModulesBelow</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887751"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887752"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621681887753"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-328"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probable cause: out-of-date interface files&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>                        </span><span class="hs-comment">-- This really shouldn't happen, but see #962</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681887757"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681887757"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681887765"><span class="hs-identifier hs-var">things</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- | Deal with gathering annotations in from all possible places</span><span>
</span><span id="line-336"></span><span class="hs-comment">--   and combining them into a single 'AnnEnv'</span><span>
</span><span id="line-337"></span><span class="annot"><a href="GHC.Driver.Env.html#prepareAnnotations"><span class="hs-identifier hs-type">prepareAnnotations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#AnnEnv"><span class="hs-identifier hs-type">AnnEnv</span></a></span><span>
</span><span id="line-338"></span><span id="prepareAnnotations"><span class="annot"><span class="annottext">prepareAnnotations :: HscEnv -&gt; Maybe ModGuts -&gt; IO AnnEnv
</span><a href="GHC.Driver.Env.html#prepareAnnotations"><span class="hs-identifier hs-var hs-var">prepareAnnotations</span></a></span></span><span> </span><span id="local-6989586621681887774"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887774"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681887775"><span class="annot"><span class="annottext">Maybe ModGuts
</span><a href="#local-6989586621681887775"><span class="hs-identifier hs-var">mb_guts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621681887776"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681887776"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ExternalPackageState
</span><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887774"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Extract annotations from the module being compiled if supplied one</span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621681887777"><span class="annot"><span class="annottext">mb_this_module_anns :: Maybe AnnEnv
</span><a href="#local-6989586621681887777"><span class="hs-identifier hs-var hs-var">mb_this_module_anns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModGuts -&gt; AnnEnv) -&gt; Maybe ModGuts -&gt; Maybe AnnEnv
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Annotation] -&gt; AnnEnv
</span><a href="GHC.Types.Annotations.html#mkAnnEnv"><span class="hs-identifier hs-var">mkAnnEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([Annotation] -&gt; AnnEnv)
-&gt; (ModGuts -&gt; [Annotation]) -&gt; ModGuts -&gt; AnnEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; [Annotation]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_anns"><span class="hs-identifier hs-var">mg_anns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
</span><a href="#local-6989586621681887775"><span class="hs-identifier hs-var">mb_guts</span></a></span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-comment">-- Extract dependencies of the module if we are supplied one,</span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-comment">-- otherwise load annotations from all home package table</span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-comment">-- entries regardless of dependency ordering.</span><span>
</span><span id="line-345"></span><span>        </span><span id="local-6989586621681887779"><span class="annot"><span class="annottext">get_mod :: ModGuts -&gt; (UnitId, ModuleNameWithIsBoot)
</span><a href="#local-6989586621681887779"><span class="hs-identifier hs-var hs-var">get_mod</span></a></span></span><span> </span><span id="local-6989586621681887780"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681887780"><span class="hs-identifier hs-var">mg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; GenModule Unit
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681887780"><span class="hs-identifier hs-var">mg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; ModuleNameWithIsBoot
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; GenModule Unit
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681887780"><span class="hs-identifier hs-var">mg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>        </span><span id="local-6989586621681887783"><span class="annot"><span class="annottext">home_pkg_anns :: AnnEnv
</span><a href="#local-6989586621681887783"><span class="hs-identifier hs-var hs-var">home_pkg_anns</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Annotation] -&gt; AnnEnv
</span><a href="GHC.Types.Annotations.html#mkAnnEnv"><span class="hs-identifier hs-var">mkAnnEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([Annotation] -&gt; AnnEnv)
-&gt; (Maybe (UnitId, ModuleNameWithIsBoot) -&gt; [Annotation])
-&gt; Maybe (UnitId, ModuleNameWithIsBoot)
-&gt; AnnEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe (UnitId, ModuleNameWithIsBoot) -&gt; [Annotation]
</span><a href="GHC.Driver.Env.html#hptAnns"><span class="hs-identifier hs-var">hptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887774"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (UnitId, ModuleNameWithIsBoot) -&gt; AnnEnv)
-&gt; Maybe (UnitId, ModuleNameWithIsBoot) -&gt; AnnEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ModGuts -&gt; (UnitId, ModuleNameWithIsBoot))
-&gt; Maybe ModGuts -&gt; Maybe (UnitId, ModuleNameWithIsBoot)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; (UnitId, ModuleNameWithIsBoot)
</span><a href="#local-6989586621681887779"><span class="hs-identifier hs-var">get_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
</span><a href="#local-6989586621681887775"><span class="hs-identifier hs-var">mb_guts</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span id="local-6989586621681887784"><span class="annot"><span class="annottext">other_pkg_anns :: AnnEnv
</span><a href="#local-6989586621681887784"><span class="hs-identifier hs-var hs-var">other_pkg_anns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; AnnEnv
</span><a href="GHC.Unit.External.html#eps_ann_env"><span class="hs-identifier hs-var">eps_ann_env</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681887776"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span id="local-6989586621681887786"><span class="annot"><span class="annottext">ann_env :: AnnEnv
</span><a href="#local-6989586621681887786"><span class="hs-identifier hs-var hs-var">ann_env</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AnnEnv -&gt; AnnEnv -&gt; AnnEnv) -&gt; [AnnEnv] -&gt; AnnEnv
forall a. HasCallStack =&gt; (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.List.html#foldl1%27/GHC.List.html#foldl1%27"><span class="hs-identifier hs-var">foldl1'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv -&gt; AnnEnv -&gt; AnnEnv
</span><a href="GHC.Types.Annotations.html#plusAnnEnv"><span class="hs-identifier hs-var">plusAnnEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([AnnEnv] -&gt; AnnEnv) -&gt; [AnnEnv] -&gt; AnnEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe AnnEnv] -&gt; [AnnEnv]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#catMaybes/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe AnnEnv
</span><a href="#local-6989586621681887777"><span class="hs-identifier hs-var">mb_this_module_anns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-349"></span><span>                                                         </span><span class="annot"><span class="annottext">AnnEnv -&gt; Maybe AnnEnv
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621681887783"><span class="hs-identifier hs-var">home_pkg_anns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-350"></span><span>                                                         </span><span class="annot"><span class="annottext">AnnEnv -&gt; Maybe AnnEnv
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621681887784"><span class="hs-identifier hs-var">other_pkg_anns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><span class="annottext">AnnEnv -&gt; IO AnnEnv
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621681887786"><span class="hs-identifier hs-var">ann_env</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">-- | Find the 'TyThing' for the given 'Name' by using all the resources</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- at our disposal: the compiled modules in the 'HomePackageTable' and the</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- compiled modules in other packages that live in 'PackageTypeEnv'. Note</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- that this does NOT look up the 'TyThing' in the module being compiled: you</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- have to do that yourself, if desired</span><span>
</span><span id="line-358"></span><span class="annot"><a href="GHC.Driver.Env.html#lookupType"><span class="hs-identifier hs-type">lookupType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span id="lookupType"><span class="annot"><span class="annottext">lookupType :: HscEnv -&gt; Name -&gt; IO (Maybe TyThing)
</span><a href="GHC.Driver.Env.html#lookupType"><span class="hs-identifier hs-var hs-var">lookupType</span></a></span></span><span> </span><span id="local-6989586621681887789"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887789"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681887790"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>   </span><span id="local-6989586621681887791"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681887791"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ExternalPackageState -&gt; IO ExternalPackageState
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ExternalPackageState -&gt; IO ExternalPackageState)
-&gt; IO ExternalPackageState -&gt; IO ExternalPackageState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ExternalPackageState
</span><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887789"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-361"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681887793"><span class="annot"><span class="annottext">pte :: PackageTypeEnv
</span><a href="#local-6989586621681887793"><span class="hs-identifier hs-var hs-var">pte</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; PackageTypeEnv
</span><a href="GHC.Unit.External.html#eps_PTE"><span class="hs-identifier hs-var">eps_PTE</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681887791"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-362"></span><span>       </span><span id="local-6989586621681887795"><span class="annot"><span class="annottext">hpt :: HomeUnitGraph
</span><a href="#local-6989586621681887795"><span class="hs-identifier hs-var hs-var">hpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnitGraph
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887789"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>       </span><span id="local-6989586621681887796"><span class="annot"><span class="annottext">mod :: GenModule Unit
</span><a href="#local-6989586621681887796"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; GenModule Unit -&gt; GenModule Unit
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; GenModule Unit)
-&gt; GenModule Unit -&gt; GenModule Unit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-365"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isHoleName"><span class="hs-identifier hs-var">isHoleName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-366"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; GenModule Unit
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887789"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Name -&gt; GenModule Unit
Name -&gt; GenModule Unit
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Name -&gt; GenModule Unit
Name -&gt; GenModule Unit
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>       </span><span class="hs-glyph">!</span><span id="local-6989586621681887802"><span class="annot"><span class="annottext">ty :: Maybe TyThing
</span><a href="#local-6989586621681887802"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GhcMode -&gt; Bool
</span><a href="GHC.Driver.Session.html#isOneShot"><span class="hs-identifier hs-var">isOneShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcMode
</span><a href="GHC.Driver.Session.html#ghcMode"><span class="hs-identifier hs-var">ghcMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887789"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>               </span><span class="hs-comment">-- in one-shot, we don't use the HPT</span><span>
</span><span id="line-371"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PackageTypeEnv -&gt; Name -&gt; Maybe TyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">PackageTypeEnv
</span><a href="#local-6989586621681887793"><span class="hs-identifier hs-var">pte</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-372"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; HomeUnitGraph -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Env.html#lookupHugByModule"><span class="hs-identifier hs-var">lookupHugByModule</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681887796"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621681887795"><span class="hs-identifier hs-var">hpt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span>                </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681887805"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887805"><span class="hs-identifier hs-var">hm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackageTypeEnv -&gt; Name -&gt; Maybe TyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModDetails -&gt; PackageTypeEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_types"><span class="hs-identifier hs-var">md_types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModDetails
</span><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887805"><span class="hs-identifier hs-var">hm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-374"></span><span>                </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackageTypeEnv -&gt; Name -&gt; Maybe TyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">PackageTypeEnv
</span><a href="#local-6989586621681887793"><span class="hs-identifier hs-var">pte</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887790"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-375"></span><span>   </span><span class="annot"><span class="annottext">Maybe TyThing -&gt; IO (Maybe TyThing)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyThing
</span><a href="#local-6989586621681887802"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-comment">-- | Find the 'ModIface' for a 'Module', searching in both the loaded home</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- and external package module information</span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.Driver.Env.html#lookupIfaceByModule"><span class="hs-identifier hs-type">lookupIfaceByModule</span></a></span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.External.html#PackageIfaceTable"><span class="hs-identifier hs-type">PackageIfaceTable</span></a></span><span>
</span><span id="line-382"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-384"></span><span id="lookupIfaceByModule"><span class="annot"><span class="annottext">lookupIfaceByModule :: HomeUnitGraph
-&gt; PackageIfaceTable
-&gt; GenModule Unit
-&gt; Maybe (ModIface_ 'ModIfaceFinal)
</span><a href="GHC.Driver.Env.html#lookupIfaceByModule"><span class="hs-identifier hs-var hs-var">lookupIfaceByModule</span></a></span></span><span> </span><span id="local-6989586621681887811"><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621681887811"><span class="hs-identifier hs-var">hug</span></a></span></span><span> </span><span id="local-6989586621681887812"><span class="annot"><span class="annottext">PackageIfaceTable
</span><a href="#local-6989586621681887812"><span class="hs-identifier hs-var">pit</span></a></span></span><span> </span><span id="local-6989586621681887813"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681887813"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; HomeUnitGraph -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Env.html#lookupHugByModule"><span class="hs-identifier hs-var">lookupHugByModule</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681887813"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitGraph
</span><a href="#local-6989586621681887811"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-386"></span><span>       </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681887814"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887814"><span class="hs-identifier hs-var">hm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; Maybe (ModIface_ 'ModIfaceFinal)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681887814"><span class="hs-identifier hs-var">hm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>       </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackageIfaceTable
-&gt; GenModule Unit -&gt; Maybe (ModIface_ 'ModIfaceFinal)
forall a. ModuleEnv a -&gt; GenModule Unit -&gt; Maybe a
</span><a href="GHC.Unit.Module.Env.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIfaceTable
</span><a href="#local-6989586621681887812"><span class="hs-identifier hs-var">pit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681887813"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-388"></span><span>   </span><span class="hs-comment">-- If the module does come from the home package, why do we look in the PIT as well?</span><span>
</span><span id="line-389"></span><span>   </span><span class="hs-comment">-- (a) In OneShot mode, even home-package modules accumulate in the PIT</span><span>
</span><span id="line-390"></span><span>   </span><span class="hs-comment">-- (b) Even in Batch (--make) mode, there is *one* case where a home-package</span><span>
</span><span id="line-391"></span><span>   </span><span class="hs-comment">--     module is in the PIT, namely GHC.Prim when compiling the base package.</span><span>
</span><span id="line-392"></span><span>   </span><span class="hs-comment">-- We could eliminate (b) if we wanted, by making GHC.Prim belong to a package</span><span>
</span><span id="line-393"></span><span>   </span><span class="hs-comment">-- of its own, but it doesn't seem worth the bother.</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="annot"><a href="GHC.Driver.Env.html#mainModIs"><span class="hs-identifier hs-type">mainModIs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitEnv"><span class="hs-identifier hs-type">HomeUnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-396"></span><span id="mainModIs"><span class="annot"><span class="annottext">mainModIs :: HomeUnitEnv -&gt; GenModule Unit
</span><a href="GHC.Driver.Env.html#mainModIs"><span class="hs-identifier hs-var hs-var">mainModIs</span></a></span></span><span> </span><span id="local-6989586621681887816"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621681887816"><span class="hs-identifier hs-var">hue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; GenModule Unit
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe HomeUnit -&gt; HomeUnit
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mainModIs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HomeUnit -&gt; HomeUnit) -&gt; Maybe HomeUnit -&gt; HomeUnit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Unit.Env.html#homeUnitEnv_home_unit"><span class="hs-identifier hs-var">homeUnitEnv_home_unit</span></a></span><span>  </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621681887816"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName
</span><a href="GHC.Driver.Session.html#mainModuleNameIs"><span class="hs-identifier hs-var">mainModuleNameIs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621681887816"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-comment">-- | Retrieve the target code interpreter</span><span>
</span><span id="line-399"></span><span class="hs-comment">--</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- Fails if no target code interpreter is available</span><span>
</span><span id="line-401"></span><span class="annot"><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-type">hscInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-402"></span><span id="hscInterp"><span class="annot"><span class="annottext">hscInterp :: HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var hs-var">hscInterp</span></a></span></span><span> </span><span id="local-6989586621681887821"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887821"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887821"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-403"></span><span>   </span><span class="annot"><span class="annottext">Maybe Interp
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; Interp
forall a e. Exception e =&gt; e -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Exception.html#throw/GHC.Exception.html#throw"><span class="hs-identifier hs-var">throw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Couldn't find a target code interpreter. Try with -fexternal-interpreter&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>   </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681887825"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681887825"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681887825"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">-- | Update the LogFlags of the Log in hsc_logger from the DynFlags in</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- hsc_dflags. You need to call this when DynFlags are modified.</span><span>
</span><span id="line-408"></span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateLoggerFlags"><span class="hs-identifier hs-type">hscUpdateLoggerFlags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-409"></span><span id="hscUpdateLoggerFlags"><span class="annot"><span class="annottext">hscUpdateLoggerFlags :: HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateLoggerFlags"><span class="hs-identifier hs-var hs-var">hscUpdateLoggerFlags</span></a></span></span><span> </span><span id="local-6989586621681887826"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887826"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887826"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#setLogFlags"><span class="hs-identifier hs-type">setLogFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887826"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Logger.html#initLogFlags"><span class="hs-identifier hs-type">initLogFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887826"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="annot"><span class="hs-comment">-- | Update Flags</span></span><span>
</span><span id="line-413"></span><span class="annot"><a href="GHC.Driver.Env.html#hscUpdateFlags"><span class="hs-identifier hs-type">hscUpdateFlags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-414"></span><span id="hscUpdateFlags"><span class="annot"><span class="annottext">hscUpdateFlags :: (DynFlags -&gt; DynFlags) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateFlags"><span class="hs-identifier hs-var hs-var">hscUpdateFlags</span></a></span></span><span> </span><span id="local-6989586621681887828"><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="#local-6989586621681887828"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681887829"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887829"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DynFlags -&gt; HscEnv -&gt; HscEnv
DynFlags -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetFlags"><span class="hs-identifier hs-var">hscSetFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="#local-6989586621681887828"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887829"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887829"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="annot"><span class="hs-comment">-- | Set Flags</span></span><span>
</span><span id="line-417"></span><span class="annot"><a href="GHC.Driver.Env.html#hscSetFlags"><span class="hs-identifier hs-type">hscSetFlags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-418"></span><span id="hscSetFlags"><span class="annot"><span class="annottext">hscSetFlags :: (() :: Constraint) =&gt; DynFlags -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetFlags"><span class="hs-identifier hs-var hs-var">hscSetFlags</span></a></span></span><span> </span><span id="local-6989586621681887832"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681887832"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681887833"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887833"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateLoggerFlags"><span class="hs-identifier hs-var">hscUpdateLoggerFlags</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; HscEnv -&gt; HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887833"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681887832"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-420"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#ue_setFlags"><span class="hs-identifier hs-type">ue_setFlags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887832"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887833"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-comment">-- See Note [Multiple Home Units]</span><span>
</span><span id="line-423"></span><span class="annot"><a href="GHC.Driver.Env.html#hscSetActiveHomeUnit"><span class="hs-identifier hs-type">hscSetActiveHomeUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-424"></span><span id="hscSetActiveHomeUnit"><span class="annot"><span class="annottext">hscSetActiveHomeUnit :: (() :: Constraint) =&gt; HomeUnit -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveHomeUnit"><span class="hs-identifier hs-var hs-var">hscSetActiveHomeUnit</span></a></span></span><span> </span><span id="local-6989586621681887837"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621681887837"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitId -&gt; HscEnv -&gt; HscEnv
UnitId -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-var">hscSetActiveUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; UnitId
forall u. GenHomeUnit u -&gt; UnitId
</span><a href="GHC.Unit.Home.html#homeUnitId"><span class="hs-identifier hs-var">homeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621681887837"><span class="hs-identifier hs-var">home_unit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-type">hscSetActiveUnitId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-427"></span><span id="hscSetActiveUnitId"><span class="annot"><span class="annottext">hscSetActiveUnitId :: (() :: Constraint) =&gt; UnitId -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-var hs-var">hscSetActiveUnitId</span></a></span></span><span> </span><span id="local-6989586621681887841"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681887841"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621681887842"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887842"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887842"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#ue_setActiveUnit"><span class="hs-identifier hs-type">ue_setActiveUnit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887841"><span class="hs-identifier hs-type">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887842"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#ue_unitFlags"><span class="hs-identifier hs-type">ue_unitFlags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887841"><span class="hs-identifier hs-type">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681887842"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><a href="GHC.Driver.Env.html#hscActiveUnitId"><span class="hs-identifier hs-type">hscActiveUnitId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-432"></span><span id="hscActiveUnitId"><span class="annot"><span class="annottext">hscActiveUnitId :: HscEnv -&gt; UnitId
</span><a href="GHC.Driver.Env.html#hscActiveUnitId"><span class="hs-identifier hs-var hs-var">hscActiveUnitId</span></a></span></span><span> </span><span id="local-6989586621681887845"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887845"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; UnitId
</span><a href="GHC.Unit.Env.html#ue_currentUnit"><span class="hs-identifier hs-var">ue_currentUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887845"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-comment">-- | Discard the contents of the InteractiveContext, but keep the DynFlags and</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- the loaded plugins.  It will also keep ic_int_print and ic_monad if their</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- names are from external packages.</span><span>
</span><span id="line-437"></span><span class="annot"><a href="GHC.Driver.Env.html#discardIC"><span class="hs-identifier hs-type">discardIC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-438"></span><span id="discardIC"><span class="annot"><span class="annottext">discardIC :: HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#discardIC"><span class="hs-identifier hs-var hs-var">discardIC</span></a></span></span><span> </span><span id="local-6989586621681887847"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887847"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887847"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681887848"><span class="hs-identifier hs-type">empty_ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_int_print"><span class="hs-identifier hs-var">ic_int_print</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681887850"><span class="hs-identifier hs-type">new_ic_int_print</span></a></span><span>
</span><span id="line-440"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_monad"><span class="hs-identifier hs-var">ic_monad</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681887852"><span class="hs-identifier hs-type">new_ic_monad</span></a></span><span>
</span><span id="line-441"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_plugins"><span class="hs-identifier hs-var">ic_plugins</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681887853"><span class="hs-identifier hs-type">old_plugins</span></a></span><span>
</span><span id="line-442"></span><span>                                </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-comment">-- Force the new values for ic_int_print and ic_monad to avoid leaking old_ic</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681887850"><span class="annot"><span class="annottext">new_ic_int_print :: Name
</span><a href="#local-6989586621681887850"><span class="hs-identifier hs-var hs-var">new_ic_int_print</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InteractiveContext -&gt; Name) -&gt; Name
</span><a href="#local-6989586621681887854"><span class="hs-identifier hs-var">keep_external_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Runtime.Context.html#ic_int_print"><span class="hs-identifier hs-var">ic_int_print</span></a></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681887852"><span class="annot"><span class="annottext">new_ic_monad :: Name
</span><a href="#local-6989586621681887852"><span class="hs-identifier hs-var hs-var">new_ic_monad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InteractiveContext -&gt; Name) -&gt; Name
</span><a href="#local-6989586621681887854"><span class="hs-identifier hs-var">keep_external_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Runtime.Context.html#ic_monad"><span class="hs-identifier hs-var">ic_monad</span></a></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681887853"><span class="annot"><span class="annottext">old_plugins :: Plugins
</span><a href="#local-6989586621681887853"><span class="hs-identifier hs-var hs-var">old_plugins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Plugins
</span><a href="GHC.Runtime.Context.html#ic_plugins"><span class="hs-identifier hs-var">ic_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681887855"><span class="hs-identifier hs-var">old_ic</span></a></span><span>
</span><span id="line-448"></span><span>  </span><span id="local-6989586621681887856"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681887856"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; DynFlags
</span><a href="GHC.Runtime.Context.html#ic_dflags"><span class="hs-identifier hs-var">ic_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681887855"><span class="hs-identifier hs-var">old_ic</span></a></span><span>
</span><span id="line-449"></span><span>  </span><span id="local-6989586621681887855"><span class="annot"><span class="annottext">old_ic :: InteractiveContext
</span><a href="#local-6989586621681887855"><span class="hs-identifier hs-var hs-var">old_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887847"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span id="local-6989586621681887848"><span class="annot"><span class="annottext">empty_ic :: InteractiveContext
</span><a href="#local-6989586621681887848"><span class="hs-identifier hs-var hs-var">empty_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; InteractiveContext
</span><a href="GHC.Runtime.Context.html#emptyInteractiveContext"><span class="hs-identifier hs-var">emptyInteractiveContext</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681887856"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-451"></span><span>  </span><span id="local-6989586621681887854"><span class="annot"><span class="annottext">keep_external_name :: (InteractiveContext -&gt; Name) -&gt; Name
</span><a href="#local-6989586621681887854"><span class="hs-identifier hs-var hs-var">keep_external_name</span></a></span></span><span> </span><span id="local-6989586621681887858"><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="#local-6989586621681887858"><span class="hs-identifier hs-var">ic_name</span></a></span></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsFromExternalPackage"><span class="hs-identifier hs-var">nameIsFromExternalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621681887860"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887861"><span class="hs-identifier hs-var">old_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681887861"><span class="hs-identifier hs-var">old_name</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="#local-6989586621681887858"><span class="hs-identifier hs-var">ic_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681887848"><span class="hs-identifier hs-var">empty_ic</span></a></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-455"></span><span>    </span><span id="local-6989586621681887860"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621681887860"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681887847"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span id="local-6989586621681887861"><span class="annot"><span class="annottext">old_name :: Name
</span><a href="#local-6989586621681887861"><span class="hs-identifier hs-var hs-var">old_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="#local-6989586621681887858"><span class="hs-identifier hs-var">ic_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681887855"><span class="hs-identifier hs-var">old_ic</span></a></span><span>
</span><span id="line-457"></span></pre></body></html>