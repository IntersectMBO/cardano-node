<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections       #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span> </span><span class="hs-comment">-- Wrinkle in Note [Trees That Grow]</span><span>
</span><span id="line-8"></span><span>                                      </span><span class="hs-comment">-- in module Language.Haskell.Syntax.Extension</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">{-
%
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Gen.Expr</span><span>
</span><span id="line-19"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier">tcCheckPolyExprNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier">tcCheckMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier">tcCheckMonoExprNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier">tcMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier">tcMonoExprNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier">tcInferRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier">tcInferRhoNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier">tcPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier">tcExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier">tcSyntaxOp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier">tcSyntaxOpGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier">SyntaxOpType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier">synKnownType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcCheckId"><span class="hs-identifier">tcCheckId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html"><span class="hs-identifier">GHC.Tc.Gen.Splice</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedSplice"><span class="hs-identifier">tcTypedSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier">tcTypedBracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier">tcUntypedBracket</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Syn.Type.html"><span class="hs-identifier">GHC.Hs.Syn.Type</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html"><span class="hs-identifier">GHC.Types.FieldLabel</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html"><span class="hs-identifier">GHC.Types.Unique.Map</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html#UniqMap"><span class="hs-identifier">UniqMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html#listToUniqMap"><span class="hs-identifier">listToUniqMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html#lookupUniqMap"><span class="hs-identifier">lookupUniqMap</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html"><span class="hs-identifier">GHC.Tc.Utils.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier">hasFixedRuntimeRep_syntactic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep"><span class="hs-identifier">hasFixedRuntimeRep</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html"><span class="hs-identifier">GHC.Tc.Gen.App</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html"><span class="hs-identifier">GHC.Tc.Gen.Head</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html"><span class="hs-identifier">GHC.Tc.Gen.Bind</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier">tcLocalBinds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier">tcGetFamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier">FamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html"><span class="hs-identifier">GHC.Rename.Expr</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#mkExpandedExpr"><span class="hs-identifier">mkExpandedExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier">addUsedGRE</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Arrow.html"><span class="hs-identifier">GHC.Tc.Gen.Arrow</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html"><span class="hs-identifier">GHC.Tc.Gen.Match</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier">mkSymCo</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Uniques.html"><span class="hs-identifier">GHC.Builtin.Uniques</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Uniques.html#mkBuiltinUnique"><span class="hs-identifier">mkBuiltinUnique</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier">classTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier">UniqSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier">mkUniqSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-identifier">elementOfUniqSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier">nonDetEltsUniqSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier">FieldLabelString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Function.html#/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#partition/Data.OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#sortBy/Data.OldList.html#sortBy"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#intersect/Data.OldList.html#intersect"><span class="hs-identifier">intersect</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.List.NonEmpty.html#/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier">unitBag</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Main wrappers}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-type">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-type">tcCheckPolyExprNC</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>         </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>           </span><span class="hs-comment">-- Expected type (could be a polytype)</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Generalised expr with expected type</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- tcCheckPolyExpr is a convenient place (frequent but not too frequent)</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- place to add context information.</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- The NC version does not do so, usually because the caller wants</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- to do so themselves.</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span id="tcCheckPolyExpr"><span class="annot"><span class="annottext">tcCheckPolyExpr :: LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var hs-var">tcCheckPolyExpr</span></a></span></span><span>   </span><span id="local-6989586621682063108"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063108"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063109"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063109"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier hs-var">tcPolyLExpr</span></a></span><span>   </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063108"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063109"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span id="tcCheckPolyExprNC"><span class="annot"><span class="annottext">tcCheckPolyExprNC :: LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var hs-var">tcCheckPolyExprNC</span></a></span></span><span> </span><span id="local-6989586621682063112"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063112"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063113"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063113"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprNC"><span class="hs-identifier hs-var">tcPolyLExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063112"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063113"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- These versions take an ExpType</span><span>
</span><span id="line-120"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier hs-type">tcPolyLExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprNC"><span class="hs-identifier hs-type">tcPolyLExprNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-121"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="tcPolyLExpr"><span class="annot"><span class="annottext">tcPolyLExpr :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier hs-var hs-var">tcPolyLExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063117"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063117"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063118"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063118"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063119"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063119"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063117"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Set location /first/; see GHC.Tc.Utils.Monad</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063118"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Note [Error contexts in generated code]</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063122"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063122"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063118"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063119"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-127"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063117"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063122"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span id="tcPolyLExprNC"><span class="annot"><span class="annottext">tcPolyLExprNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprNC"><span class="hs-identifier hs-var hs-var">tcPolyLExprNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063123"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063123"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063124"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063124"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063125"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063125"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063123"><span class="hs-identifier hs-var">loc</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063126"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063126"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063124"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063125"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-132"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063123"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063126"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-135"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-type">tcCheckMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-type">tcCheckMonoExprNC</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>     </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>         </span><span class="hs-comment">-- Expected type</span><span>
</span><span id="line-138"></span><span>                         </span><span class="hs-comment">-- Definitely no foralls at the top</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span id="tcCheckMonoExpr"><span class="annot"><span class="annottext">tcCheckMonoExpr :: LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var hs-var">tcCheckMonoExpr</span></a></span></span><span>   </span><span id="local-6989586621682063128"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063128"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063129"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063129"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span>   </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063128"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063129"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span id="tcCheckMonoExprNC"><span class="annot"><span class="annottext">tcCheckMonoExprNC :: LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var hs-var">tcCheckMonoExprNC</span></a></span></span><span> </span><span id="local-6989586621682063130"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063130"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063131"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063131"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063130"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063131"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-type">tcMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-type">tcMonoExprNC</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>     </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>        </span><span class="hs-comment">-- Expected type</span><span>
</span><span id="line-146"></span><span>                         </span><span class="hs-comment">-- Definitely no foralls at the top</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span id="tcMonoExpr"><span class="annot"><span class="annottext">tcMonoExpr :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var hs-var">tcMonoExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063132"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063132"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063133"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063133"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063134"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063134"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063132"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Set location /first/; see GHC.Tc.Utils.Monad</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063133"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Note [Error contexts in generated code]</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063135"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063135"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063133"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063134"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063132"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063135"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span id="tcMonoExprNC"><span class="annot"><span class="annottext">tcMonoExprNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var hs-var">tcMonoExprNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063136"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063136"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063137"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063137"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063138"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063138"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063136"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063139"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063139"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063137"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063138"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063136"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063139"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-161"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-type">tcInferRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-type">tcInferRhoNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- Infer a *rho*-type. The return type is always instantiated.</span><span>
</span><span id="line-163"></span><span id="tcInferRho"><span class="annot"><span class="annottext">tcInferRho :: LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var hs-var">tcInferRho</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063140"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063140"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063141"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063141"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063140"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Set location /first/; see GHC.Tc.Utils.Monad</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063141"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Note [Error contexts in generated code]</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063142"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063142"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063143"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063143"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExpRhoType -&gt; TcM (HsExpr GhcTc)) -&gt; TcM (HsExpr GhcTc, Type)
forall a. (ExpRhoType -&gt; TcM a) -&gt; TcM (a, Type)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063141"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063140"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063142"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063143"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span id="tcInferRhoNC"><span class="annot"><span class="annottext">tcInferRhoNC :: LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var hs-var">tcInferRhoNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063145"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063145"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063146"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063146"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063145"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063147"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063147"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063148"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063148"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExpRhoType -&gt; TcM (HsExpr GhcTc)) -&gt; TcM (HsExpr GhcTc, Type)
forall a. (ExpRhoType -&gt; TcM a) -&gt; TcM (a, Type)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063146"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682063145"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063147"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063148"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
        tcExpr: the main expression typechecker
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-type">tcPolyExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span id="tcPolyExpr"><span class="annot"><span class="annottext">tcPolyExpr :: HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var hs-var">tcPolyExpr</span></a></span></span><span> </span><span id="local-6989586621682063149"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063149"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063150"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063150"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPolyExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063150"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063153"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063153"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063154"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063154"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsWrapper, HsExpr GhcTc)
forall result.
UserTypeCtxt
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM result)
-&gt; TcM (HsWrapper, result)
</span><a href="GHC.Tc.Utils.Unify.html#tcSkolemiseExpType"><span class="hs-identifier hs-var">tcSkolemiseExpType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063150"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpRhoType -&gt; TcM (HsExpr GhcTc))
 -&gt; TcM (HsWrapper, HsExpr GhcTc))
-&gt; (ExpRhoType -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsWrapper, HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063157"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063157"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>                          </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063149"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063157"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-186"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063153"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063154"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-type">tcExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- Use tcApp to typecheck applications, which are treated specially</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- by Quick Look.  Specifically:</span><span>
</span><span id="line-192"></span><span class="hs-comment">--   - HsVar         lone variables, to ensure that they can get an</span><span>
</span><span id="line-193"></span><span class="hs-comment">--                     impredicative instantiation (via Quick Look</span><span>
</span><span id="line-194"></span><span class="hs-comment">--                     driven by res_ty (in checking mode)).</span><span>
</span><span id="line-195"></span><span class="hs-comment">--   - HsApp         value applications</span><span>
</span><span id="line-196"></span><span class="hs-comment">--   - HsAppType     type applications</span><span>
</span><span id="line-197"></span><span class="hs-comment">--   - ExprWithTySig (e :: type)</span><span>
</span><span id="line-198"></span><span class="hs-comment">--   - HsRecSel      overloaded record fields</span><span>
</span><span id="line-199"></span><span class="hs-comment">--   - HsExpanded    renamer expansions</span><span>
</span><span id="line-200"></span><span class="hs-comment">--   - HsOpApp       operator applications</span><span>
</span><span id="line-201"></span><span class="hs-comment">--   - HsOverLit     overloaded literals</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- These constructors are the union of</span><span>
</span><span id="line-203"></span><span class="hs-comment">--   - ones taken apart by GHC.Tc.Gen.Head.splitHsApps</span><span>
</span><span id="line-204"></span><span class="hs-comment">--   - ones understood by GHC.Tc.Gen.Head.tcInferAppHead_maybe</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- See Note [Application chains and heads] in GHC.Tc.Gen.App</span><span>
</span><span id="line-206"></span><span id="tcExpr"><span class="annot"><span class="annottext">tcExpr :: HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var hs-var">tcExpr</span></a></span></span><span> </span><span id="local-6989586621682063159"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063159"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span id="local-6989586621682063161"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063161"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063159"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063161"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-207"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063163"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063163"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span id="local-6989586621682063165"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063165"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063163"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063165"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-208"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063166"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063166"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OpApp"><span class="hs-identifier hs-type">OpApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span id="local-6989586621682063168"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063168"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063166"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063168"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-209"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063169"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063169"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span id="local-6989586621682063171"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063171"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063169"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063171"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-210"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063172"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063172"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span id="local-6989586621682063174"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063174"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063172"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063174"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063175"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063175"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecSel"><span class="hs-identifier hs-type">HsRecSel</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span id="local-6989586621682063177"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063177"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063175"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063177"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-212"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063178"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063178"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpanded"><span class="hs-identifier hs-type">HsExpanded</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063181"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063181"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063178"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063181"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063182"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063182"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063184"><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621682063184"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063185"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063185"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063186"><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
</span><a href="#local-6989586621682063186"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpRhoType -&gt; TcM (Maybe (HsOverLit GhcTc))
</span><a href="GHC.Tc.Utils.Zonk.html#tcShortCutLit"><span class="hs-identifier hs-var">tcShortCutLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621682063184"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063185"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-216"></span><span>         </span><span class="hs-comment">-- See Note [Short cut for overloaded literals] in GHC.Tc.Utils.Zonk</span><span>
</span><span id="line-217"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
</span><a href="#local-6989586621682063186"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682063188"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621682063188"><span class="hs-identifier hs-var">lit'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XOverLitE GhcTc -&gt; HsOverLit GhcTc -&gt; HsExpr GhcTc
forall p. XOverLitE p -&gt; HsOverLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-var">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE GhcTc
EpAnn NoEpAnns
forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621682063188"><span class="hs-identifier hs-var">lit'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>           </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063182"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063185"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- Typecheck an occurrence of an unbound Id</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- Some of these started life as a true expression hole &quot;_&quot;.</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- Others might simply be variables that accidentally have no binding site</span><span>
</span><span id="line-225"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">XUnboundVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063191"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682063191"><span class="hs-identifier hs-var">occ</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063192"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063192"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063193"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063193"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063192"><span class="hs-identifier hs-var">res_ty</span></a></span><span>    </span><span class="hs-comment">-- Allow Int# etc (#12531)</span><span>
</span><span id="line-227"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063195"><span class="annot"><span class="annottext">HoleExprRef
</span><a href="#local-6989586621682063195"><span class="hs-identifier hs-var">her</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Type -&gt; TcM HoleExprRef
</span><a href="GHC.Tc.Utils.TcMType.html#emitNewExprHole"><span class="hs-identifier hs-var">emitNewExprHole</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682063191"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063193"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-228"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="GHC.Core.UsageEnv.html#bottomUE"><span class="hs-identifier hs-var">bottomUE</span></a></span><span>   </span><span class="hs-comment">-- Holes fit any usage environment</span><span>
</span><span id="line-229"></span><span>                                       </span><span class="hs-comment">-- (#18491)</span><span>
</span><span id="line-230"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnboundVar GhcTc -&gt; RdrName -&gt; HsExpr GhcTc
forall p. XUnboundVar p -&gt; RdrName -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-var">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">XUnboundVar GhcTc
HoleExprRef
</span><a href="#local-6989586621682063195"><span class="hs-identifier hs-var">her</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682063191"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063199"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063199"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span id="local-6989586621682063201"><span class="annot"><span class="annottext">XLitE GhcRn
</span><a href="#local-6989586621682063201"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063202"><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621682063202"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063203"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063203"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063204"><span class="annot"><span class="annottext">lit_ty :: Type
</span><a href="#local-6989586621682063204"><span class="hs-identifier hs-var hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn -&gt; Type
forall (p :: Pass). HsLit (GhcPass p) -&gt; Type
</span><a href="GHC.Hs.Syn.Type.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621682063202"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-234"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; Type -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063199"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcRn
XLitE GhcTc
</span><a href="#local-6989586621682063201"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLit GhcRn -&gt; HsLit GhcTc
forall (p1 :: Pass) (p2 :: Pass).
HsLit (GhcPass p1) -&gt; HsLit (GhcPass p2)
</span><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-var">convertLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621682063202"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063204"><span class="hs-identifier hs-var">lit_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063203"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span id="local-6989586621682063209"><span class="annot"><span class="annottext">XPar GhcRn
</span><a href="#local-6989586621682063209"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063210"><span class="annot"><span class="annottext">LHsToken &quot;(&quot; GhcRn
</span><a href="#local-6989586621682063210"><span class="hs-identifier hs-var">lpar</span></a></span></span><span> </span><span id="local-6989586621682063211"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063211"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063212"><span class="annot"><span class="annottext">LHsToken &quot;)&quot; GhcRn
</span><a href="#local-6989586621682063212"><span class="hs-identifier hs-var">rpar</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063213"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063213"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063214"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063214"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063211"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063213"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-238"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPar GhcTc
-&gt; LHsToken &quot;(&quot; GhcTc
-&gt; LHsExpr GhcTc
-&gt; LHsToken &quot;)&quot; GhcTc
-&gt; HsExpr GhcTc
forall p.
XPar p -&gt; LHsToken &quot;(&quot; p -&gt; LHsExpr p -&gt; LHsToken &quot;)&quot; p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-var">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcRn
XPar GhcTc
</span><a href="#local-6989586621682063209"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;(&quot; GhcRn
LHsToken &quot;(&quot; GhcTc
</span><a href="#local-6989586621682063210"><span class="hs-identifier hs-var">lpar</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063214"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;)&quot; GhcRn
LHsToken &quot;)&quot; GhcTc
</span><a href="#local-6989586621682063212"><span class="hs-identifier hs-var">rpar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span id="local-6989586621682063216"><span class="annot"><span class="annottext">XPragE GhcRn
</span><a href="#local-6989586621682063216"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063217"><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621682063217"><span class="hs-identifier hs-var">prag</span></a></span></span><span> </span><span id="local-6989586621682063218"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063218"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063219"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063219"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063220"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063220"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063218"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063219"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPragE GhcTc -&gt; HsPragE GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XPragE p -&gt; HsPragE p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-var">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE GhcRn
XPragE GhcTc
</span><a href="#local-6989586621682063216"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsPragE GhcRn -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-var">tcExprPrag</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621682063217"><span class="hs-identifier hs-var">prag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063220"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#NegApp"><span class="hs-identifier hs-type">NegApp</span></a></span><span> </span><span id="local-6989586621682063223"><span class="annot"><span class="annottext">XNegApp GhcRn
</span><a href="#local-6989586621682063223"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063224"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063224"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063225"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682063225"><span class="hs-identifier hs-var">neg_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063226"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063226"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063227"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063227"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063228"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621682063228"><span class="hs-identifier hs-var">neg_expr'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Type]
    -&gt; [Type]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#NegateOrigin"><span class="hs-identifier hs-var">NegateOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682063225"><span class="hs-identifier hs-var">neg_expr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063226"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Type]
  -&gt; [Type]
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
 -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), SyntaxExprTc))
-&gt; ([Type]
    -&gt; [Type]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-247"></span><span>               </span><span class="hs-glyph">\</span><span class="hs-special">[</span><span id="local-6989586621682063231"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063231"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682063232"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063232"><span class="hs-identifier hs-var">arg_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>               </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063232"><span class="hs-identifier hs-var">arg_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063224"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063231"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XNegApp GhcTc -&gt; LHsExpr GhcTc -&gt; SyntaxExpr GhcTc -&gt; HsExpr GhcTc
forall p. XNegApp p -&gt; LHsExpr p -&gt; SyntaxExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#NegApp"><span class="hs-identifier hs-var">NegApp</span></a></span><span> </span><span class="annot"><span class="annottext">XNegApp GhcRn
XNegApp GhcTc
</span><a href="#local-6989586621682063223"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063227"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
SyntaxExprTc
</span><a href="#local-6989586621682063228"><span class="hs-identifier hs-var">neg_expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063234"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063234"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsIPVar"><span class="hs-identifier hs-type">HsIPVar</span></a></span><span> </span><span class="annot"><span class="annottext">XIPVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063236"><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621682063236"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063237"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063237"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063238"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063238"><span class="hs-identifier hs-var">ip_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-253"></span><span>          </span><span class="hs-comment">-- Create a unification type variable of kind 'Type'.</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-comment">-- (The type of an implicit parameter must have kind 'Type'.)</span><span>
</span><span id="line-255"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063241"><span class="annot"><span class="annottext">ip_name :: Type
</span><a href="#local-6989586621682063241"><span class="hs-identifier hs-var hs-var">ip_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Type
</span><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsIPName -&gt; FastString
</span><a href="Language.Haskell.Syntax.Type.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621682063236"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063244"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682063244"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a></span><span>
</span><span id="line-257"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063247"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063247"><span class="hs-identifier hs-var">ip_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; TcM TyCoVar
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063249"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682063244"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063241"><span class="hs-identifier hs-var">ip_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063238"><span class="hs-identifier hs-var">ip_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; Type -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063234"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-259"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Type -&gt; Type -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621682063251"><span class="hs-identifier hs-var">fromDict</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682063244"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063241"><span class="hs-identifier hs-var">ip_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063238"><span class="hs-identifier hs-var">ip_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; LIdP GhcTc -&gt; HsExpr GhcTc
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; LocatedAn NameAnn TyCoVar
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063247"><span class="hs-identifier hs-var">ip_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>                   </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063238"><span class="hs-identifier hs-var">ip_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063237"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- Coerces a dictionary for `IP &quot;x&quot; t` into `t`.</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621682063251"><span class="annot"><span class="annottext">fromDict :: Class -&gt; Type -&gt; Type -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621682063251"><span class="hs-identifier hs-var hs-var">fromDict</span></a></span></span><span> </span><span id="local-6989586621682063254"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682063254"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span id="local-6989586621682063255"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063255"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063256"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063256"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercionR -&gt; HsWrapper) -&gt; TcCoercionR -&gt; HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-264"></span><span>                          </span><span class="annot"><span class="annottext">Type -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#unwrapIP"><span class="hs-identifier hs-var">unwrapIP</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcCoercionR) -&gt; Type -&gt; TcCoercionR
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682063254"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063255"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063256"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-265"></span><span>  </span><span id="local-6989586621682063249"><span class="annot"><span class="annottext">origin :: CtOrigin
</span><a href="#local-6989586621682063249"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsIPName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#IPOccOrigin"><span class="hs-identifier hs-var">IPOccOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621682063236"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLam"><span class="hs-identifier hs-type">HsLam</span></a></span><span> </span><span class="annot"><span class="annottext">XLam GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063261"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682063261"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063262"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063262"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063263"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063263"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063264"><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063264"><span class="hs-identifier hs-var">match'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
-&gt; TcMatchCtxt HsExpr
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchLambda"><span class="hs-identifier hs-var">tcMatchLambda</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
</span><a href="#local-6989586621682063266"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063267"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682063261"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063262"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063263"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLam GhcTc -&gt; MatchGroup GhcTc (LHsExpr GhcTc) -&gt; HsExpr GhcTc
forall p. XLam p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLam"><span class="hs-identifier hs-var">HsLam</span></a></span><span> </span><span class="annot"><span class="annottext">XLam GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063264"><span class="hs-identifier hs-var">match'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621682063267"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063267"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcTc
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcTc
forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#LambdaExpr"><span class="hs-identifier hs-var">LambdaExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621682063266"><span class="annot"><span class="annottext">herald :: ExpectedFunTyOrigin
</span><a href="#local-6989586621682063266"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn) -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyLam"><span class="hs-identifier hs-var">ExpectedFunTyLam</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682063261"><span class="hs-identifier hs-var">match</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063274"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063274"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLamCase"><span class="hs-identifier hs-type">HsLamCase</span></a></span><span> </span><span id="local-6989586621682063276"><span class="annot"><span class="annottext">XLamCase GhcRn
</span><a href="#local-6989586621682063276"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063277"><span class="annot"><span class="annottext">LamCaseVariant
</span><a href="#local-6989586621682063277"><span class="hs-identifier hs-var">lc_variant</span></a></span></span><span> </span><span id="local-6989586621682063278"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682063278"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063279"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063279"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063280"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063280"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063281"><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063281"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
-&gt; TcMatchCtxt HsExpr
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchLambda"><span class="hs-identifier hs-var">tcMatchLambda</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
</span><a href="#local-6989586621682063282"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063283"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682063278"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063279"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-277"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063280"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XLamCase GhcTc
-&gt; LamCaseVariant
-&gt; MatchGroup GhcTc (LHsExpr GhcTc)
-&gt; HsExpr GhcTc
forall p.
XLamCase p
-&gt; LamCaseVariant -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLamCase"><span class="hs-identifier hs-var">HsLamCase</span></a></span><span> </span><span class="annot"><span class="annottext">XLamCase GhcRn
XLamCase GhcTc
</span><a href="#local-6989586621682063276"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LamCaseVariant
</span><a href="#local-6989586621682063277"><span class="hs-identifier hs-var">lc_variant</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063281"><span class="hs-identifier hs-var">matches'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621682063283"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063283"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcTc
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LamCaseVariant -&gt; HsMatchContext GhcTc
forall p. LamCaseVariant -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#LamCaseAlt"><span class="hs-identifier hs-var">LamCaseAlt</span></a></span><span> </span><span class="annot"><span class="annottext">LamCaseVariant
</span><a href="#local-6989586621682063277"><span class="hs-identifier hs-var">lc_variant</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621682063282"><span class="annot"><span class="annottext">herald :: ExpectedFunTyOrigin
</span><a href="#local-6989586621682063282"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LamCaseVariant -&gt; HsExpr GhcRn -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyLamCase"><span class="hs-identifier hs-var">ExpectedFunTyLamCase</span></a></span><span> </span><span class="annot"><span class="annottext">LamCaseVariant
</span><a href="#local-6989586621682063277"><span class="hs-identifier hs-var">lc_variant</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063274"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Explicit lists
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- Explicit lists [e1,e2,e3] have been expanded already in the renamer</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- The expansion includes an ExplicitList, but it is always the built-in</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- list type, so that's all we need concern ourselves with here.  See</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- GHC.Rename.Expr. Note [Handling overloaded and rebindable constructs]</span><span>
</span><span id="line-296"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-type">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063287"><span class="annot"><span class="annottext">[LHsExpr GhcRn]
</span><a href="#local-6989586621682063287"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063288"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063288"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063289"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063289"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063288"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063290"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063290"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063291"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063291"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (TcCoercionR, Type)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063289"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063293"><span class="annot"><span class="annottext">tc_elt :: LocatedA (HsExpr GhcRn) -&gt; TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621682063293"><span class="hs-identifier hs-var hs-var">tc_elt</span></a></span></span><span> </span><span id="local-6989586621682063294"><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063294"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063294"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063291"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063295"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcTc)]
</span><a href="#local-6989586621682063295"><span class="hs-identifier hs-var">exprs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LocatedA (HsExpr GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; [LocatedA (HsExpr GhcRn)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [GenLocated SrcSpanAnnA (HsExpr GhcTc)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn) -&gt; TcM (LHsExpr GhcTc)
LocatedA (HsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063293"><span class="hs-identifier hs-var">tc_elt</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcRn]
[LocatedA (HsExpr GhcRn)]
</span><a href="#local-6989586621682063287"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063290"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcTc -&gt; [LHsExpr GhcTc] -&gt; HsExpr GhcTc
forall p. XExplicitList p -&gt; [LHsExpr p] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcTc
Type
</span><a href="#local-6989586621682063291"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcTc]
[GenLocated SrcSpanAnnA (HsExpr GhcTc)]
</span><a href="#local-6989586621682063295"><span class="hs-identifier hs-var">exprs'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063298"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621682063298"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-type">ExplicitTuple</span></a></span><span> </span><span id="local-6989586621682063300"><span class="annot"><span class="annottext">XExplicitTuple GhcRn
</span><a href="#local-6989586621682063300"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063301"><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063301"><span class="hs-identifier hs-var">tup_args</span></a></span></span><span> </span><span id="local-6989586621682063302"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682063302"><span class="hs-identifier hs-var">boxity</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063303"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063303"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(HsTupArg GhcRn -&gt; Bool) -&gt; [HsTupArg GhcRn] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">HsTupArg GhcRn -&gt; Bool
forall (p :: Pass). HsTupArg (GhcPass p) -&gt; Bool
</span><a href="GHC.Hs.Expr.html#tupArgPresent"><span class="hs-identifier hs-var">tupArgPresent</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063301"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063306"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621682063306"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063301"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-306"></span><span>             </span><span id="local-6989586621682063308"><span class="annot"><span class="annottext">tup_tc :: TyCon
</span><a href="#local-6989586621682063308"><span class="hs-identifier hs-var hs-var">tup_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682063302"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063306"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-307"></span><span>               </span><span class="hs-comment">-- NB: tupleTyCon doesn't flatten 1-tuples</span><span>
</span><span id="line-308"></span><span>               </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063310"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063310"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063303"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-310"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063311"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063311"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063312"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063312"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; TcM (TcCoercionR, [Type])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682063308"><span class="hs-identifier hs-var">tup_tc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063310"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-311"></span><span>                           </span><span class="hs-comment">-- Unboxed tuples have RuntimeRep vars, which we</span><span>
</span><span id="line-312"></span><span>                           </span><span class="hs-comment">-- don't care about here</span><span>
</span><span id="line-313"></span><span>                           </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-314"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063314"><span class="annot"><span class="annottext">arg_tys' :: [Type]
</span><a href="#local-6989586621682063314"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682063302"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#drop/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063306"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063312"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-315"></span><span>                                       </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063312"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-316"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063318"><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621682063318"><span class="hs-identifier hs-var">tup_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; [Type] -&gt; TcM [HsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var">tcTupArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063301"><span class="hs-identifier hs-var">tup_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063314"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-317"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063311"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XExplicitTuple GhcTc -&gt; [HsTupArg GhcTc] -&gt; Boxity -&gt; HsExpr GhcTc
forall p. XExplicitTuple p -&gt; [HsTupArg p] -&gt; Boxity -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-var">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcRn
XExplicitTuple GhcTc
</span><a href="#local-6989586621682063300"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621682063318"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682063302"><span class="hs-identifier hs-var">boxity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The tup_args are a mixture of Present and Missing (for tuple sections)</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063320"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621682063320"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063301"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063321"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063321"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682063302"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Type]
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var">newFlexiTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063320"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-325"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcM Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Type]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#replicateM/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063320"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>       </span><span class="hs-comment">-- Handle tuple sections where</span><span>
</span><span id="line-328"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063325"><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621682063325"><span class="hs-identifier hs-var">tup_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; [Type] -&gt; TcM [HsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var">tcTupArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063301"><span class="hs-identifier hs-var">tup_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063321"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063326"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621682063326"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcTc -&gt; [HsTupArg GhcTc] -&gt; Boxity -&gt; HsExpr GhcTc
forall p. XExplicitTuple p -&gt; [HsTupArg p] -&gt; Boxity -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-var">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcRn
XExplicitTuple GhcTc
</span><a href="#local-6989586621682063300"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621682063325"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682063302"><span class="hs-identifier hs-var">boxity</span></a></span><span>
</span><span id="line-331"></span><span>             </span><span id="local-6989586621682063327"><span class="annot"><span class="annottext">missing_tys :: [Scaled Type]
</span><a href="#local-6989586621682063327"><span class="hs-identifier hs-var hs-var">missing_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063329"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063330"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682063329"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063329"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063330"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063330"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcTc] -&gt; [Type] -&gt; [(HsTupArg GhcTc, Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621682063325"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063321"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>             </span><span class="hs-comment">-- See Note [Typechecking data constructors] in GHC.Tc.Gen.Head</span><span>
</span><span id="line-334"></span><span>             </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-335"></span><span>             </span><span id="local-6989586621682063332"><span class="annot"><span class="annottext">act_res_ty :: Type
</span><a href="#local-6989586621682063332"><span class="hs-identifier hs-var hs-var">act_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Type -&gt; Type
(() :: Constraint) =&gt; [Scaled Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkScaledFunTys"><span class="hs-identifier hs-var">mkScaledFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063327"><span class="hs-identifier hs-var">missing_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; [Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkTupleTy1"><span class="hs-identifier hs-var">mkTupleTy1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682063302"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063321"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ExplicitTuple&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063332"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063303"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; Type -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063298"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063326"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063332"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063303"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitSum"><span class="hs-identifier hs-type">ExplicitSum</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitSum GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063338"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063338"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621682063339"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063339"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621682063340"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063340"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063341"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063341"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063342"><span class="annot"><span class="annottext">sum_tc :: TyCon
</span><a href="#local-6989586621682063342"><span class="hs-identifier hs-var hs-var">sum_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#sumTyCon"><span class="hs-identifier hs-var">sumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063339"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-343"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063344"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063344"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063341"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-344"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063345"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063345"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063346"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063346"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; TcM (TcCoercionR, [Type])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682063342"><span class="hs-identifier hs-var">sum_tc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063344"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Drop levity vars, we don't care about them here</span><span>
</span><span id="line-346"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063347"><span class="annot"><span class="annottext">arg_tys' :: [Type]
</span><a href="#local-6989586621682063347"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#drop/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063339"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063346"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-347"></span><span>             </span><span id="local-6989586621682063348"><span class="annot"><span class="annottext">arg_ty :: Type
</span><a href="#local-6989586621682063348"><span class="hs-identifier hs-var hs-var">arg_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063347"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Int -&gt; Type
forall a. Outputable a =&gt; [a] -&gt; Int -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063338"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063350"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063350"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063340"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063348"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-349"></span><span>       </span><span class="hs-comment">-- Check the whole res_ty, not just the arg_ty, to avoid #20277.</span><span>
</span><span id="line-350"></span><span>       </span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-351"></span><span>       </span><span class="hs-comment">--   a :: TYPE rep (representation-polymorphic)</span><span>
</span><span id="line-352"></span><span>       </span><span class="hs-comment">--   (# 17# | #) :: (# Int# | a #)</span><span>
</span><span id="line-353"></span><span>       </span><span class="hs-comment">-- This should cause an error, even though (17# :: Int#)</span><span>
</span><span id="line-354"></span><span>       </span><span class="hs-comment">-- is not representation-polymorphic: we don't know how</span><span>
</span><span id="line-355"></span><span>       </span><span class="hs-comment">-- wide the concrete representation of the sum type will be.</span><span>
</span><span id="line-356"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRUnboxedSum"><span class="hs-identifier hs-var">FRRUnboxedSum</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063344"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063345"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XExplicitSum GhcTc -&gt; Int -&gt; Int -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XExplicitSum p -&gt; Int -&gt; Int -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitSum"><span class="hs-identifier hs-var">ExplicitSum</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
XExplicitSum GhcTc
</span><a href="#local-6989586621682063347"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063338"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063339"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063350"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Let, case, if, do
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLet"><span class="hs-identifier hs-type">HsLet</span></a></span><span> </span><span id="local-6989586621682063353"><span class="annot"><span class="annottext">XLet GhcRn
</span><a href="#local-6989586621682063353"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063354"><span class="annot"><span class="annottext">LHsToken &quot;let&quot; GhcRn
</span><a href="#local-6989586621682063354"><span class="hs-identifier hs-var">tkLet</span></a></span></span><span> </span><span id="local-6989586621682063355"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621682063355"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621682063356"><span class="annot"><span class="annottext">LHsToken &quot;in&quot; GhcRn
</span><a href="#local-6989586621682063356"><span class="hs-identifier hs-var">tkIn</span></a></span></span><span> </span><span id="local-6989586621682063357"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063357"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063358"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063358"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063359"><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621682063359"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063360"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063360"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (HsLocalBinds GhcTc, LHsExpr GhcTc)
forall thing.
HsLocalBinds GhcRn -&gt; TcM thing -&gt; TcM (HsLocalBinds GhcTc, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621682063355"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (HsLocalBinds GhcTc, LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (HsLocalBinds GhcTc, LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-370"></span><span>                             </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063357"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063358"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLet GhcTc
-&gt; LHsToken &quot;let&quot; GhcTc
-&gt; HsLocalBinds GhcTc
-&gt; LHsToken &quot;in&quot; GhcTc
-&gt; LHsExpr GhcTc
-&gt; HsExpr GhcTc
forall p.
XLet p
-&gt; LHsToken &quot;let&quot; p
-&gt; HsLocalBinds p
-&gt; LHsToken &quot;in&quot; p
-&gt; LHsExpr p
-&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLet"><span class="hs-identifier hs-var">HsLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet GhcRn
XLet GhcTc
</span><a href="#local-6989586621682063353"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;let&quot; GhcRn
LHsToken &quot;let&quot; GhcTc
</span><a href="#local-6989586621682063354"><span class="hs-identifier hs-var">tkLet</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621682063359"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;in&quot; GhcRn
LHsToken &quot;in&quot; GhcTc
</span><a href="#local-6989586621682063356"><span class="hs-identifier hs-var">tkIn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063360"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-type">HsCase</span></a></span><span> </span><span id="local-6989586621682063362"><span class="annot"><span class="annottext">XCase GhcRn
</span><a href="#local-6989586621682063362"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063363"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063363"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621682063364"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682063364"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063365"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063365"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- We used to typecheck the case alternatives first.</span><span>
</span><span id="line-375"></span><span>           </span><span class="hs-comment">-- The case patterns tend to give good type info to use</span><span>
</span><span id="line-376"></span><span>           </span><span class="hs-comment">-- when typechecking the scrutinee.  For example</span><span>
</span><span id="line-377"></span><span>           </span><span class="hs-comment">--   case (map f) of</span><span>
</span><span id="line-378"></span><span>           </span><span class="hs-comment">--     (x:xs) -&gt; ...</span><span>
</span><span id="line-379"></span><span>           </span><span class="hs-comment">-- will report that map is applied to too few arguments</span><span>
</span><span id="line-380"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-381"></span><span>           </span><span class="hs-comment">-- But now, in the GADT world, we need to typecheck the scrutinee</span><span>
</span><span id="line-382"></span><span>           </span><span class="hs-comment">-- first, to get type info that may be refined in the case alternatives</span><span>
</span><span id="line-383"></span><span>          </span><span id="local-6989586621682063366"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063366"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>          </span><span class="hs-comment">-- Typecheck the scrutinee.  We use tcInferRho but tcInferSigma</span><span>
</span><span id="line-386"></span><span>          </span><span class="hs-comment">-- would also be possible (tcMatchesCase accepts sigma-types)</span><span>
</span><span id="line-387"></span><span>          </span><span class="hs-comment">-- Interesting litmus test: do these two behave the same?</span><span>
</span><span id="line-388"></span><span>          </span><span class="hs-comment">--     case id        of {..}</span><span>
</span><span id="line-389"></span><span>          </span><span class="hs-comment">--     case (\v -&gt; v) of {..}</span><span>
</span><span id="line-390"></span><span>          </span><span class="hs-comment">-- This design choice is discussed in #17790</span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063368"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063368"><span class="hs-identifier hs-var">scrut'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063369"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063369"><span class="hs-identifier hs-var">scrut_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063366"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063363"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HsCase&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063369"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRCase"><span class="hs-identifier hs-var">FRRCase</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063369"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063371"><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063371"><span class="hs-identifier hs-var">matches'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
-&gt; Scaled Type
-&gt; MatchGroup GhcRn (LocatedA (HsExpr GhcRn))
-&gt; ExpRhoType
-&gt; TcM (MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall (body :: * -&gt; *).
AnnoBody body =&gt;
TcMatchCtxt body
-&gt; Scaled Type
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (MatchGroup GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchesCase"><span class="hs-identifier hs-var">tcMatchesCase</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063373"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063366"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063369"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682063364"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063365"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCase GhcTc
-&gt; LHsExpr GhcTc
-&gt; MatchGroup GhcTc (LHsExpr GhcTc)
-&gt; HsExpr GhcTc
forall p.
XCase p -&gt; LHsExpr p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-var">HsCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCase GhcRn
XCase GhcTc
</span><a href="#local-6989586621682063362"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063368"><span class="hs-identifier hs-var">scrut'</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063371"><span class="hs-identifier hs-var">matches'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-397"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621682063373"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063373"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcTc
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcTc
forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-399"></span><span>                      </span><span class="annot"><span class="annottext">mc_body :: LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsIf"><span class="hs-identifier hs-type">HsIf</span></a></span><span> </span><span id="local-6989586621682063376"><span class="annot"><span class="annottext">XIf GhcRn
</span><a href="#local-6989586621682063376"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063377"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063377"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621682063378"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063378"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621682063379"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063379"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063380"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063380"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063381"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063381"><span class="hs-identifier hs-var">pred'</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063377"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063383"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621682063383"><span class="hs-identifier hs-var">u1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682063384"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063384"><span class="hs-identifier hs-var">b1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063378"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063380"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-404"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063386"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621682063386"><span class="hs-identifier hs-var">u2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682063387"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063387"><span class="hs-identifier hs-var">b2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063379"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063380"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-405"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UsageEnv -&gt; UsageEnv -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#supUE"><span class="hs-identifier hs-var">supUE</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621682063383"><span class="hs-identifier hs-var">u1</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621682063386"><span class="hs-identifier hs-var">u2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIf GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XIf p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsIf"><span class="hs-identifier hs-var">HsIf</span></a></span><span> </span><span class="annot"><span class="annottext">XIf GhcRn
XIf GhcTc
</span><a href="#local-6989586621682063376"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063381"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063384"><span class="hs-identifier hs-var">b1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063387"><span class="hs-identifier hs-var">b2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">{-
Note [MultiWayIf linearity checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we'd like to compute the usage environment for

if | b1 -&gt; e1
   | b2 -&gt; e2
   | otherwise -&gt; e3

and let u1, u2, v1, v2, v3 denote the usage env for b1, b2, e1, e2, e3
respectively.

Since a multi-way if is mere sugar for nested if expressions, the usage
environment should ideally be u1 + sup(v1, u2 + sup(v2, v3)).
However, currently we don't support linear guards (#19193). All variables
used in guards from u1 and u2 will have multiplicity Many.
But in that case, we have equality u1 + sup(x,y) = sup(u1 + x, y),
                      and likewise u2 + sup(x,y) = sup(u2 + x, y) for any x,y.
Using this identity, we can just compute sup(u1 + v1, u2 + v2, v3) instead.
This is simple to do, since we get u_i + v_i directly from tcGRHS.
If we add linear guards, this code will have to be revisited.
Not using 'sup' caused #23814.
-}</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMultiIf"><span class="hs-identifier hs-type">HsMultiIf</span></a></span><span> </span><span class="annot"><span class="annottext">XMultiIf GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063390"><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621682063390"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063391"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063391"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063392"><span class="annot"><span class="annottext">[UsageEnv]
</span><a href="#local-6989586621682063392"><span class="hs-identifier hs-var">ues</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063393"><span class="annot"><span class="annottext">[GenLocated
   (SrcAnn NoEpAnns)
   (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621682063393"><span class="hs-identifier hs-var">alts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   (SrcAnn NoEpAnns) (GRHS GhcRn (LocatedA (HsExpr GhcRn)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (UsageEnv,
       GenLocated
         (SrcAnn NoEpAnns)
         (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))))
-&gt; [GenLocated
      (SrcAnn NoEpAnns) (GRHS GhcRn (LocatedA (HsExpr GhcRn)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([UsageEnv],
      [GenLocated
         (SrcAnn NoEpAnns)
         (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#mapAndUnzipM/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682063395"><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (GRHS GhcRn (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682063395"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM
  (GenLocated
     (SrcAnn NoEpAnns)
     (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (UsageEnv,
      GenLocated
        (SrcAnn NoEpAnns)
        (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM
   (GenLocated
      (SrcAnn NoEpAnns)
      (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (UsageEnv,
       GenLocated
         (SrcAnn NoEpAnns)
         (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))))
-&gt; TcM
     (GenLocated
        (SrcAnn NoEpAnns)
        (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (UsageEnv,
      GenLocated
        (SrcAnn NoEpAnns)
        (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(GRHS GhcRn (LocatedA (HsExpr GhcRn))
 -&gt; TcM (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; GenLocated
     (SrcAnn NoEpAnns) (GRHS GhcRn (LocatedA (HsExpr GhcRn)))
-&gt; TcM
     (GenLocated
        (SrcAnn NoEpAnns)
        (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (SrcSpanAnn' ann) a
-&gt; TcRn (GenLocated (SrcSpanAnn' ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
-&gt; ExpRhoType
-&gt; GRHS GhcRn (LocatedA (HsExpr GhcRn))
-&gt; TcM (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall (body :: * -&gt; *).
TcMatchCtxt body
-&gt; ExpRhoType
-&gt; GRHS GhcRn (LocatedA (body GhcRn))
-&gt; TcM (GRHS GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHS"><span class="hs-identifier hs-var">tcGRHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063398"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063391"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (GRHS GhcRn (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682063395"><span class="hs-identifier hs-var">alt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsExpr GhcRn)]
[GenLocated
   (SrcAnn NoEpAnns) (GRHS GhcRn (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063390"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-434"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063399"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063399"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063391"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-435"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UsageEnv] -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#supUEs"><span class="hs-identifier hs-var">supUEs</span></a></span><span> </span><span class="annot"><span class="annottext">[UsageEnv]
</span><a href="#local-6989586621682063392"><span class="hs-identifier hs-var">ues</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See Note [MultiWayIf linearity checking]</span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XMultiIf GhcTc -&gt; [LGRHS GhcTc (LHsExpr GhcTc)] -&gt; HsExpr GhcTc
forall p. XMultiIf p -&gt; [LGRHS p (LHsExpr p)] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsMultiIf"><span class="hs-identifier hs-var">HsMultiIf</span></a></span><span> </span><span class="annot"><span class="annottext">XMultiIf GhcTc
Type
</span><a href="#local-6989586621682063399"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcTc (LHsExpr GhcTc)]
[GenLocated
   (SrcAnn NoEpAnns)
   (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621682063393"><span class="hs-identifier hs-var">alts'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682063398"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621682063398"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcTc
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcTc
forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#IfAlt"><span class="hs-identifier hs-var">IfAlt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
LocatedA (HsExpr GhcRn)
-&gt; ExpRhoType
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><span class="annottext">XDo GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063404"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621682063404"><span class="hs-identifier hs-var">do_or_lc</span></a></span></span><span> </span><span id="local-6989586621682063405"><span class="annot"><span class="annottext">XRec GhcRn [ExprLStmt GhcRn]
</span><a href="#local-6989586621682063405"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063406"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063406"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
-&gt; LocatedL [ExprLStmt GhcRn] -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var">tcDoStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621682063404"><span class="hs-identifier hs-var">do_or_lc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn [ExprLStmt GhcRn]
LocatedL [ExprLStmt GhcRn]
</span><a href="#local-6989586621682063405"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063406"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProc"><span class="hs-identifier hs-type">HsProc</span></a></span><span> </span><span id="local-6989586621682063409"><span class="annot"><span class="annottext">XProc GhcRn
</span><a href="#local-6989586621682063409"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063410"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682063410"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682063411"><span class="annot"><span class="annottext">LHsCmdTop GhcRn
</span><a href="#local-6989586621682063411"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063412"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063412"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063413"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621682063413"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063414"><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (HsCmdTop GhcTc)
</span><a href="#local-6989586621682063414"><span class="hs-identifier hs-var">cmd'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063415"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063415"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
-&gt; LHsCmdTop GhcRn
-&gt; ExpRhoType
-&gt; TcM (LPat GhcTc, LHsCmdTop GhcTc, TcCoercionR)
</span><a href="GHC.Tc.Gen.Arrow.html#tcProc"><span class="hs-identifier hs-var">tcProc</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682063410"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcRn
</span><a href="#local-6989586621682063411"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063412"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063415"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XProc GhcTc -&gt; LPat GhcTc -&gt; LHsCmdTop GhcTc -&gt; HsExpr GhcTc
forall p. XProc p -&gt; LPat p -&gt; LHsCmdTop p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsProc"><span class="hs-identifier hs-var">HsProc</span></a></span><span> </span><span class="annot"><span class="annottext">XProc GhcRn
XProc GhcTc
</span><a href="#local-6989586621682063409"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621682063413"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcTc
GenLocated (SrcAnn NoEpAnns) (HsCmdTop GhcTc)
</span><a href="#local-6989586621682063414"><span class="hs-identifier hs-var">cmd'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="hs-comment">-- Typechecks the static form and wraps it with a call to 'fromStaticPtr'.</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- See Note [Grand plan for static forms] in GHC.Iface.Tidy.StaticPtrTable for an overview.</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- To type check</span><span>
</span><span id="line-449"></span><span class="hs-comment">--      (static e) :: p a</span><span>
</span><span id="line-450"></span><span class="hs-comment">-- we want to check (e :: a),</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- and wrap (static e) in a call to</span><span>
</span><span id="line-452"></span><span class="hs-comment">--    fromStaticPtr :: IsStatic p =&gt; StaticPtr a -&gt; p a</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStatic"><span class="hs-identifier hs-type">HsStatic</span></a></span><span> </span><span id="local-6989586621682063418"><span class="annot"><span class="annottext">XStatic GhcRn
</span><a href="#local-6989586621682063418"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682063419"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063419"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063420"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063420"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063421"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063421"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063420"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063422"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063422"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063423"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063423"><span class="hs-identifier hs-var">p_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063424"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063424"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (TcCoercionR, (Type, Type))
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedAppTy"><span class="hs-identifier hs-var">matchExpectedAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063421"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063426"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063426"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063427"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682063427"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), WantedConstraints))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-458"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the body of a static form:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>                             </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063419"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>                       </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-461"></span><span>            </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063419"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063424"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>        </span><span class="hs-comment">-- Check that the free variables of the static form are closed.</span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here as the only side effects of</span><span>
</span><span id="line-465"></span><span>        </span><span class="hs-comment">-- checkClosedInStaticForm are error messages.</span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcRn ()) -&gt; [Name] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-var">checkClosedInStaticForm</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; TcRn ()) -&gt; [Name] -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name -&gt; [Name]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">XStatic GhcRn
UniqSet Name
</span><a href="#local-6989586621682063418"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-comment">-- Require the type of the argument to be Typeable.</span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063434"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682063434"><span class="hs-identifier hs-var">typeableClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeableClassName"><span class="hs-identifier hs-var">typeableClassName</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063436"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063436"><span class="hs-identifier hs-var">typeable_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; TcM TyCoVar
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#StaticOrigin"><span class="hs-identifier hs-var">StaticOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM TyCoVar) -&gt; Type -&gt; TcM TyCoVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-471"></span><span>                  </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682063434"><span class="hs-identifier hs-var">typeableClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063424"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-comment">-- Insert the constraints of the static form in a global list for later</span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-comment">-- validation.</span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier hs-var">emitStaticConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682063427"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>        </span><span class="hs-comment">-- Wrap the static form with the 'fromStaticPtr' call.</span><span>
</span><span id="line-479"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063440"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063440"><span class="hs-identifier hs-var">fromStaticPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [Type] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#StaticOrigin"><span class="hs-identifier hs-var">StaticOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fromStaticPtrName"><span class="hs-identifier hs-var">fromStaticPtrName</span></a></span><span>
</span><span id="line-480"></span><span>                                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063423"><span class="hs-identifier hs-var">p_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063443"><span class="annot"><span class="annottext">wrap :: HsWrapper
</span><a href="#local-6989586621682063443"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpEvVarApps"><span class="hs-identifier hs-var">mkWpEvVarApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063436"><span class="hs-identifier hs-var">typeable_ev</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063424"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-482"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063447"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682063447"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-483"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063449"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682063449"><span class="hs-identifier hs-var">static_ptr_ty_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#staticPtrTyConName"><span class="hs-identifier hs-var">staticPtrTyConName</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063422"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcTc
EpAnn NoEpAnns
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span>
</span><span id="line-485"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682063447"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063443"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063440"><span class="hs-identifier hs-var">fromStaticPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682063447"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XStatic GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XStatic p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsStatic"><span class="hs-identifier hs-var">HsStatic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XStatic GhcRn
UniqSet Name
</span><a href="#local-6989586621682063418"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682063449"><span class="hs-identifier hs-var">static_ptr_ty_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063424"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063426"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Record construction and update
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063454"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621682063454"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_con :: forall p. HsExpr p -&gt; XRec p (ConLikeP p)
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_con"><span class="hs-identifier hs-var">rcon_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063457"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682063457"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063458"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063458"><span class="hs-identifier hs-var">con_name</span></a></span></span><span>
</span><span id="line-498"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_flds :: forall p. HsExpr p -&gt; HsRecordBinds p
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682063460"><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621682063460"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063461"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063461"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063462"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063462"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM ConLike
</span><a href="GHC.Tc.Utils.Env.html#tcLookupConLike"><span class="hs-identifier hs-var">tcLookupConLike</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063458"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063464"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063464"><span class="hs-identifier hs-var">con_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063465"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063465"><span class="hs-identifier hs-var">con_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Head.html#tcInferId"><span class="hs-identifier hs-var">tcInferId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063458"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063467"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063467"><span class="hs-identifier hs-var">con_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063468"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063468"><span class="hs-identifier hs-var">con_tau</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; TcM (HsWrapper, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063470"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063465"><span class="hs-identifier hs-var">con_sigma</span></a></span><span>
</span><span id="line-503"></span><span>              </span><span class="hs-comment">-- a shallow instantiation should really be enough for</span><span>
</span><span id="line-504"></span><span>              </span><span class="hs-comment">-- a data constructor.</span><span>
</span><span id="line-505"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063471"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621682063471"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Int
</span><a href="GHC.Core.ConLike.html#conLikeArity"><span class="hs-identifier hs-var">conLikeArity</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063462"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-506"></span><span>              </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063473"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063473"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063474"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063474"><span class="hs-identifier hs-var">actual_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Either Int ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTysN"><span class="hs-identifier hs-var">tcSplitFunTysN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063471"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063468"><span class="hs-identifier hs-var">con_tau</span></a></span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Bool
</span><a href="GHC.Core.ConLike.html#conLikeHasBuilder"><span class="hs-identifier hs-var">conLikeHasBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063462"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-509"></span><span>          </span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Head.html#nonBidirectionalErr"><span class="hs-identifier hs-var">nonBidirectionalErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Name
</span><a href="GHC.Core.ConLike.html#conLikeName"><span class="hs-identifier hs-var">conLikeName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063462"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063480"><span class="annot"><span class="annottext">HsRecFields GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063480"><span class="hs-identifier hs-var">rbinds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [Type] -&gt; HsRecordBinds GhcRn -&gt; TcM (HsRecordBinds GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-var">tcRecordBinds</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063462"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063473"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621682063460"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-512"></span><span>                   </span><span class="hs-comment">-- It is currently not possible for a record to have</span><span>
</span><span id="line-513"></span><span>                   </span><span class="hs-comment">-- multiplicities. When they do, `tcRecordBinds` will take</span><span>
</span><span id="line-514"></span><span>                   </span><span class="hs-comment">-- scaled types instead. Meanwhile, it's safe to take</span><span>
</span><span id="line-515"></span><span>                   </span><span class="hs-comment">-- `scaledThing` above, as we know all the multiplicities are</span><span>
</span><span id="line-516"></span><span>                   </span><span class="hs-comment">-- Many.</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063483"><span class="annot"><span class="annottext">rcon_tc :: HsExpr GhcTc
</span><a href="#local-6989586621682063483"><span class="hs-identifier hs-var hs-var">rcon_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063467"><span class="hs-identifier hs-var">con_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063464"><span class="hs-identifier hs-var">con_expr</span></a></span><span>
</span><span id="line-519"></span><span>              </span><span id="local-6989586621682063484"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621682063484"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_ext :: XRecordCon GhcTc
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_ext"><span class="hs-identifier hs-var">rcon_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRecordCon GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621682063483"><span class="hs-identifier hs-var">rcon_tc</span></a></span><span>
</span><span id="line-520"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_con"><span class="hs-identifier hs-var">rcon_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; ConLike -&gt; GenLocated SrcSpanAnnN ConLike
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682063457"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063462"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-521"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_flds :: HsRecordBinds GhcTc
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcTc
HsRecFields GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682063480"><span class="hs-identifier hs-var">rbinds'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063486"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063486"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; Type -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063454"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063484"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063474"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063461"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>        </span><span class="hs-comment">-- Check for missing fields.  We do this after type-checking to get</span><span>
</span><span id="line-526"></span><span>        </span><span class="hs-comment">-- better types in error messages (cf #18869).  For example:</span><span>
</span><span id="line-527"></span><span>        </span><span class="hs-comment">--     data T a = MkT { x :: a, y :: a }</span><span>
</span><span id="line-528"></span><span>        </span><span class="hs-comment">--     r = MkT { y = True }</span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-comment">-- Then we'd like to warn about a missing field `x :: True`, rather than `x :: a0`.</span><span>
</span><span id="line-530"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-531"></span><span>        </span><span class="hs-comment">-- NB: to do this really properly we should delay reporting until typechecking is complete,</span><span>
</span><span id="line-532"></span><span>        </span><span class="hs-comment">-- via a new `HoleSort`.  But that seems too much work.</span><span>
</span><span id="line-533"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; HsRecordBinds GhcRn -&gt; [Scaled Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-var">checkMissingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063462"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621682063460"><span class="hs-identifier hs-var">rbinds</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063473"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063486"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-536"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-537"></span><span>    </span><span id="local-6989586621682063470"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621682063470"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063458"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-comment">-- Record updates via dot syntax are replaced by desugared expressions</span><span>
</span><span id="line-540"></span><span class="hs-comment">-- in the renamer. See Note [Overview of record dot syntax] in</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- GHC.Hs.Expr. This is why we match on 'rupd_flds = Left rbnds' here</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- and panic otherwise.</span><span>
</span><span id="line-543"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063489"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621682063489"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: forall p. HsExpr p -&gt; LHsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682063492"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063492"><span class="hs-identifier hs-var">record_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: forall p. HsExpr p -&gt; Either [LHsRecUpdField p] [LHsRecUpdProj p]
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682063494"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621682063494"><span class="hs-identifier hs-var">rbnds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063495"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063495"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
-&gt; Bool
forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063494"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Desugar the record update. See Note [Record Updates].</span><span>
</span><span id="line-546"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063498"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063498"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063499"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063499"><span class="hs-identifier hs-var">ds_res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063500"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682063500"><span class="hs-identifier hs-var">err_ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcRn, Type, SDoc)
</span><a href="GHC.Tc.Gen.Expr.html#desugarRecordUpd"><span class="hs-identifier hs-var">desugarRecordUpd</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063492"><span class="hs-identifier hs-var">record_expr</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621682063494"><span class="hs-identifier hs-var">rbnds</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063495"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>          </span><span class="hs-comment">-- Typecheck the desugared expression.</span><span>
</span><span id="line-549"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063502"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063502"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682063500"><span class="hs-identifier hs-var">err_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-550"></span><span>                   </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsExpr GhcRn -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Expr.html#mkExpandedExpr"><span class="hs-identifier hs-var">mkExpandedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063489"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063498"><span class="hs-identifier hs-var">ds_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063499"><span class="hs-identifier hs-var">ds_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>            </span><span class="hs-comment">-- NB: it's important to use ds_res_ty and not res_ty here.</span><span>
</span><span id="line-552"></span><span>            </span><span class="hs-comment">-- Test case: T18802b.</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682063500"><span class="hs-identifier hs-var">err_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; Type -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063489"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063502"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063499"><span class="hs-identifier hs-var">ds_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063495"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-555"></span><span>            </span><span class="hs-comment">-- We need to unify the result type of the desugared</span><span>
</span><span id="line-556"></span><span>            </span><span class="hs-comment">-- expression with the expected result type.</span><span>
</span><span id="line-557"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-558"></span><span>            </span><span class="hs-comment">-- See Note [Unifying result types in tcRecordUpd].</span><span>
</span><span id="line-559"></span><span>            </span><span class="hs-comment">-- Test case: T10808.</span><span>
</span><span id="line-560"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr: unexpected overloaded-dot RecordUpd&quot;</span></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Arithmetic sequences                    e.g. [a,b..]
        and their parallel-array counterparts   e.g. [: a,b.. :]

*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-type">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063506"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063506"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621682063507"><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063507"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063508"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063508"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ArithSeqInfo GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063506"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063507"><span class="hs-identifier hs-var">seq</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063508"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Record dot syntax
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="hs-comment">-- These terms have been replaced by desugaring in the renamer. See</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- Note [Overview of record dot syntax].</span><span>
</span><span id="line-587"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsGetField"><span class="hs-identifier hs-type">HsGetField</span></a></span><span> </span><span class="annot"><span class="annottext">XGetField GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (DotFieldOcc GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: tcExpr: HsGetField: Not implemented&quot;</span></span><span>
</span><span id="line-588"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProjection"><span class="hs-identifier hs-type">HsProjection</span></a></span><span> </span><span class="annot"><span class="annottext">XProjection GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (XRec GhcRn (DotFieldOcc GhcRn))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: tcExpr: HsProjection: Not implemented&quot;</span></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Template Haskell
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="hs-comment">-- Here we get rid of it and add the finalizers to the global environment.</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices] in GHC.Rename.Splice.</span><span>
</span><span id="line-600"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span> </span><span id="local-6989586621682063513"><span class="annot"><span class="annottext">XTypedSplice GhcRn
</span><a href="#local-6989586621682063513"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621682063514"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063514"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621682063515"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063515"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTypedSplice"><span class="hs-identifier hs-var">tcTypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XTypedSplice GhcRn
Name
</span><a href="#local-6989586621682063513"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063514"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063515"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-601"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063516"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063516"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedBracket"><span class="hs-identifier hs-type">HsTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">XTypedBracket GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063518"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063518"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621682063519"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063519"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-var">tcTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063516"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063518"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063519"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621682063520"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621682063520"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedBracket"><span class="hs-identifier hs-type">HsUntypedBracket</span></a></span><span> </span><span id="local-6989586621682063522"><span class="annot"><span class="annottext">XUntypedBracket GhcRn
</span><a href="#local-6989586621682063522"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682063523"><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682063523"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063524"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063524"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsQuote GhcRn
-&gt; [PendingRnSplice]
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier hs-var">tcUntypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063520"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsQuote GhcRn
</span><a href="#local-6989586621682063523"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
XUntypedBracket GhcRn
</span><a href="#local-6989586621682063522"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063524"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-604"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span id="local-6989586621682063526"><span class="annot"><span class="annottext">XUntypedSplice GhcRn
</span><a href="#local-6989586621682063526"><span class="hs-identifier hs-var">splice</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621682063527"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063527"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">XUntypedSplice GhcRn
</span><a href="#local-6989586621682063526"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-606"></span><span>      </span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceTop"><span class="hs-identifier hs-type">HsUntypedSpliceTop</span></a></span><span> </span><span id="local-6989586621682063529"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621682063529"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span id="local-6989586621682063530"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063530"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-607"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621682063529"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-608"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063530"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063527"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-609"></span><span>      </span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceNested"><span class="hs-identifier hs-type">HsUntypedSpliceNested</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr: invalid nested splice&quot;</span></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Catch-all
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLabel"><span class="hs-identifier hs-type">HsOverLabel</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span id="local-6989586621682063534"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063534"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:HsOverLabel&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063534"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionL"><span class="hs-identifier hs-type">SectionL</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span id="local-6989586621682063537"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063537"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:SectionL&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063537"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionR"><span class="hs-identifier hs-type">SectionR</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span id="local-6989586621682063539"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063539"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:SectionR&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063539"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Arithmetic sequences [a..b] etc
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-type">tcArithSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeqInfo"><span class="hs-identifier hs-type">ArithSeqInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-633"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span id="tcArithSeq"><span class="annot"><span class="annottext">tcArithSeq :: Maybe (SyntaxExpr GhcRn)
-&gt; ArithSeqInfo GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var hs-var">tcArithSeq</span></a></span></span><span> </span><span id="local-6989586621682063540"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063540"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621682063541"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063541"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#From"><span class="hs-identifier hs-type">From</span></a></span><span> </span><span id="local-6989586621682063543"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063543"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063544"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063544"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063545"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063545"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063546"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063546"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063547"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063547"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063548"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621682063548"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, Type, Type, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063540"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063544"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-637"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063550"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063550"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063546"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063543"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063547"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-638"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063551"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063551"><span class="hs-identifier hs-var">enum_from</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [Type] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063541"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromName"><span class="hs-identifier hs-var">enumFromName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063547"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-640"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063545"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-641"></span><span>         </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621682063551"><span class="hs-identifier hs-var">enum_from</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621682063548"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id. LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#From"><span class="hs-identifier hs-var">From</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063550"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621682063554"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063554"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621682063555"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063555"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThen"><span class="hs-identifier hs-type">FromThen</span></a></span><span> </span><span id="local-6989586621682063557"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063557"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621682063558"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063558"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063559"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063559"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063560"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063560"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063561"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063561"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063562"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063562"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063563"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621682063563"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, Type, Type, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063554"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063559"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-645"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063564"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063564"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063561"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063557"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063562"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-646"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063565"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063565"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063561"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063558"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063562"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-647"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063566"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063566"><span class="hs-identifier hs-var">enum_from_then</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [Type] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063555"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromThenName"><span class="hs-identifier hs-var">enumFromThenName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063562"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-649"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063560"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-650"></span><span>         </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621682063566"><span class="hs-identifier hs-var">enum_from_then</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621682063563"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id. LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#FromThen"><span class="hs-identifier hs-var">FromThen</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063564"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063565"><span class="hs-identifier hs-var">expr2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621682063568"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063568"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621682063569"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063569"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromTo"><span class="hs-identifier hs-type">FromTo</span></a></span><span> </span><span id="local-6989586621682063571"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063571"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621682063572"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063572"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063573"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063573"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063574"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063574"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063575"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063575"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063576"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063576"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063577"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621682063577"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, Type, Type, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063568"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063573"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-654"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063578"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063578"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063575"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063571"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063576"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-655"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063579"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063579"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063575"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063572"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063576"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-656"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063580"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063580"><span class="hs-identifier hs-var">enum_from_to</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [Type] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063569"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromToName"><span class="hs-identifier hs-var">enumFromToName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063576"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-658"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063574"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-659"></span><span>         </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621682063580"><span class="hs-identifier hs-var">enum_from_to</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621682063577"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id. LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#FromTo"><span class="hs-identifier hs-var">FromTo</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063578"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063579"><span class="hs-identifier hs-var">expr2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621682063582"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063582"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621682063583"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063583"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThenTo"><span class="hs-identifier hs-type">FromThenTo</span></a></span><span> </span><span id="local-6989586621682063585"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063585"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621682063586"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063586"><span class="hs-identifier hs-var">expr2</span></a></span></span><span> </span><span id="local-6989586621682063587"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063587"><span class="hs-identifier hs-var">expr3</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063588"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063588"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063589"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063589"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063590"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063590"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063591"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063591"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063592"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621682063592"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, Type, Type, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621682063582"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063588"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-663"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063593"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063593"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063590"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063585"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063591"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063594"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063594"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063590"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063586"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063591"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-665"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063595"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063595"><span class="hs-identifier hs-var">expr3'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063590"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063587"><span class="hs-identifier hs-var">expr3</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063591"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-666"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063596"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063596"><span class="hs-identifier hs-var">eft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [Type] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621682063583"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromThenToName"><span class="hs-identifier hs-var">enumFromThenToName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063591"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-668"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063589"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-669"></span><span>          </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621682063596"><span class="hs-identifier hs-var">eft</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621682063592"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id.
LHsExpr id -&gt; LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#FromThenTo"><span class="hs-identifier hs-var">FromThenTo</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063593"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063594"><span class="hs-identifier hs-var">expr2'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063595"><span class="hs-identifier hs-var">expr3'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-672"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-type">arithSeqEltType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-673"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span id="arithSeqEltType"><span class="annot"><span class="annottext">arithSeqEltType :: Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, Type, Type, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var hs-var">arithSeqEltType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621682063600"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063600"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063601"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063601"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063600"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-676"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063602"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063602"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063603"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063603"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (TcCoercionR, Type)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063601"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-677"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsWrapper, Type, Type, Maybe SyntaxExprTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (HsWrapper, Type, Type, Maybe SyntaxExprTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063602"><span class="hs-identifier hs-var">coi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#OneTy"><span class="hs-identifier hs-var">OneTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063603"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-678"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682063606"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682063606"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063607"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063607"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682063608"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063608"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063609"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063609"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063610"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621682063610"><span class="hs-identifier hs-var">fl'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Type] -&gt; [Type] -&gt; TcM (Type, Type))
-&gt; TcM ((Type, Type), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ListOrigin"><span class="hs-identifier hs-var">ListOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682063606"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063607"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM (Type, Type))
 -&gt; TcM ((Type, Type), SyntaxExprTc))
-&gt; ([Type] -&gt; [Type] -&gt; TcM (Type, Type))
-&gt; TcM ((Type, Type), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-681"></span><span>              </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682063613"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063613"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682063614"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063614"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TcM (Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063614"><span class="hs-identifier hs-var">elt_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063613"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsWrapper, Type, Type, Maybe SyntaxExprTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (HsWrapper, Type, Type, Maybe SyntaxExprTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063608"><span class="hs-identifier hs-var">elt_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063609"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc -&gt; Maybe SyntaxExprTc
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621682063610"><span class="hs-identifier hs-var">fl'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-685"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-type">tcTupArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTupArg"><span class="hs-identifier hs-type">HsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-686"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-687"></span><span>              </span><span class="hs-comment">-- ^ Argument types.</span><span>
</span><span id="line-688"></span><span>              </span><span class="hs-comment">-- This function ensures they all have</span><span>
</span><span id="line-689"></span><span>              </span><span class="hs-comment">-- a fixed runtime representation.</span><span>
</span><span id="line-690"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTupArg"><span class="hs-identifier hs-type">HsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-691"></span><span id="tcTupArgs"><span class="annot"><span class="annottext">tcTupArgs :: [HsTupArg GhcRn] -&gt; [Type] -&gt; TcM [HsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var hs-var">tcTupArgs</span></a></span></span><span> </span><span id="local-6989586621682063616"><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063616"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682063617"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063617"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063616"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063617"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>       </span><span class="annot"><span class="annottext">Int -&gt; TcRn ()
</span><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063616"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>       </span><span class="annot"><span class="annottext">(Int
 -&gt; HsTupArg GhcRn
 -&gt; Type
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcTc))
-&gt; [Int] -&gt; [HsTupArg GhcRn] -&gt; [Type] -&gt; TcM [HsTupArg GhcTc]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; HsTupArg GhcRn
-&gt; Type
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcTc)
</span><a href="#local-6989586621682063622"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621682063616"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063617"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><a href="#local-6989586621682063622"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTupArg"><span class="hs-identifier hs-type">HsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTupArg"><span class="hs-identifier hs-type">HsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>    </span><span id="local-6989586621682063622"><span class="annot"><span class="annottext">go :: Int
-&gt; HsTupArg GhcRn
-&gt; Type
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcTc)
</span><a href="#local-6989586621682063622"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682063623"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063623"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span id="local-6989586621682063624"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063624"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063625"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063625"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-699"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRTupleSection"><span class="hs-identifier hs-var">FRRTupleSection</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063623"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063624"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-700"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsTupArg GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XMissing GhcTc -&gt; HsTupArg GhcTc
forall id. XMissing id -&gt; HsTupArg id
</span><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063625"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063624"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-701"></span><span>    </span><span class="annot"><a href="#local-6989586621682063622"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682063627"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063627"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Present"><span class="hs-identifier hs-type">Present</span></a></span><span> </span><span id="local-6989586621682063629"><span class="annot"><span class="annottext">XPresent GhcRn
</span><a href="#local-6989586621682063629"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682063630"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063630"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063631"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063631"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span>
</span><span id="line-702"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063632"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063632"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063631"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-703"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRTupleArg"><span class="hs-identifier hs-var">FRRTupleArg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063627"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063631"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-704"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsTupArg GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPresent GhcTc -&gt; LHsExpr GhcTc -&gt; HsTupArg GhcTc
forall id. XPresent id -&gt; LHsExpr id -&gt; HsTupArg id
</span><a href="Language.Haskell.Syntax.Expr.html#Present"><span class="hs-identifier hs-var">Present</span></a></span><span> </span><span class="annot"><span class="annottext">XPresent GhcRn
XPresent GhcTc
</span><a href="#local-6989586621682063629"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682063632"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-707"></span><span class="hs-comment">-- See TcType.SyntaxOpType also for commentary</span><span>
</span><span id="line-708"></span><span id="local-6989586621682062340"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-709"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span>
</span><span id="line-710"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ shape of syntax operator arguments</span></span><span>
</span><span id="line-711"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ overall result type</span></span><span>
</span><span id="line-712"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682062340"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Type check any arguments,</span><span>
</span><span id="line-713"></span><span>                                                 </span><span class="hs-comment">-- takes a type per hole and a</span><span>
</span><span id="line-714"></span><span>                                                 </span><span class="hs-comment">-- multiplicity per arrow in</span><span>
</span><span id="line-715"></span><span>                                                 </span><span class="hs-comment">-- the shape.</span><span>
</span><span id="line-716"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682062340"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-717"></span><span class="hs-comment">-- ^ Typecheck a syntax operator</span><span>
</span><span id="line-718"></span><span class="hs-comment">-- The operator is a variable or a lambda at this stage (i.e. renamer</span><span>
</span><span id="line-719"></span><span class="hs-comment">-- output)t</span><span>
</span><span id="line-720"></span><span id="tcSyntaxOp"><span class="annot"><span class="annottext">tcSyntaxOp :: forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var hs-var">tcSyntaxOp</span></a></span></span><span> </span><span id="local-6989586621682063634"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063634"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682063635"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621682063635"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682063636"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063636"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621682063637"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063637"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063634"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621682063635"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063636"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063637"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="hs-comment">-- | Slightly more general version of 'tcSyntaxOp' that allows the caller</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- to specify the shape of the result of the syntax operator</span><span>
</span><span id="line-725"></span><span id="local-6989586621682062475"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-type">tcSyntaxOpGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-726"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span>
</span><span id="line-727"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-728"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>
</span><span id="line-729"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682062475"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682062475"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-731"></span><span id="tcSyntaxOpGen"><span class="annot"><span class="annottext">tcSyntaxOpGen :: forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var hs-var">tcSyntaxOpGen</span></a></span></span><span> </span><span id="local-6989586621682063664"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063664"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span> </span><span id="local-6989586621682063666"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063666"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063667"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063667"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621682063668"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063668"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682063669"><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063669"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063670"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063670"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063671"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063671"><span class="hs-identifier hs-var">sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
-&gt; [HsExprArg 'TcpRn] -&gt; TcM (HsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-var">tcInferAppHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063666"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Int -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063666"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-733"></span><span>             </span><span class="hs-comment">-- Ugh!! But all this code is scheduled for demolition anyway</span><span>
</span><span id="line-734"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063666"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063670"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063671"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063675"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063675"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063676"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063676"><span class="hs-identifier hs-var">expr_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063677"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682063677"><span class="hs-identifier hs-var">arg_wraps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063678"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063678"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
forall a.
CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var">tcSynArgA</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063664"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063666"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063671"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063667"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063668"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM a)
 -&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper))
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-737"></span><span>              </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063669"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-738"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063666"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063670"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063671"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, SyntaxExprTc) -&gt; TcM (a, SyntaxExprTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063675"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">syn_expr :: HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#syn_expr"><span class="hs-identifier hs-var">syn_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063676"><span class="hs-identifier hs-var">expr_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682063670"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-740"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_arg_wraps :: [HsWrapper]
</span><a href="GHC.Hs.Expr.html#syn_arg_wraps"><span class="hs-identifier hs-var">syn_arg_wraps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682063677"><span class="hs-identifier hs-var">arg_wraps</span></a></span><span>
</span><span id="line-741"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_res_wrap :: HsWrapper
</span><a href="GHC.Hs.Expr.html#syn_res_wrap"><span class="hs-identifier hs-var">syn_res_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063678"><span class="hs-identifier hs-var">res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-742"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#NoSyntaxExprRn"><span class="hs-identifier hs-var">NoSyntaxExprRn</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (a, SyntaxExprTc)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="hs-comment">{-
Note [tcSynArg]
~~~~~~~~~~~~~~~
Because of the rich structure of SyntaxOpType, we must do the
contra-/covariant thing when working down arrows, to get the
instantiation vs. skolemisation decisions correct (and, more
obviously, the orientation of the HsWrappers). We thus have
two tcSynArgs.
-}</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="hs-comment">-- works on &quot;expected&quot; types, skolemising where necessary</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- See Note [tcSynArg]</span><span>
</span><span id="line-756"></span><span id="local-6989586621682062482"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-type">tcSynArgE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-757"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the operator to check (for error messages only)</span></span><span>
</span><span id="line-758"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-759"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ shape it is expected to have</span></span><span>
</span><span id="line-760"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682062482"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ check the arguments</span></span><span>
</span><span id="line-761"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682062482"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-762"></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ returns a wrapper :: (type of right shape) &quot;-&gt;&quot; (type passed in)</span></span><span>
</span><span id="line-763"></span><span id="tcSynArgE"><span class="annot"><span class="annottext">tcSynArgE :: forall a.
CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var hs-var">tcSynArgE</span></a></span></span><span> </span><span id="local-6989586621682063712"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063712"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682063713"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063713"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682063714"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063714"><span class="hs-identifier hs-var">sigma_ty</span></a></span></span><span> </span><span id="local-6989586621682063715"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063715"><span class="hs-identifier hs-var">syn_ty</span></a></span></span><span> </span><span id="local-6989586621682063716"><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063716"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063717"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063717"><span class="hs-identifier hs-var">skol_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063718"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063718"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063719"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063719"><span class="hs-identifier hs-var">ty_wrapper</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; Type
-&gt; (Type -&gt; TcM (a, HsWrapper))
-&gt; TcM (HsWrapper, (a, HsWrapper))
forall result.
UserTypeCtxt
-&gt; Type -&gt; (Type -&gt; TcM result) -&gt; TcM (HsWrapper, result)
</span><a href="GHC.Tc.Utils.Unify.html#tcTopSkolemise"><span class="hs-identifier hs-var">tcTopSkolemise</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063714"><span class="hs-identifier hs-var">sigma_ty</span></a></span><span>
</span><span id="line-766"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063721"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063721"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SyntaxOpType -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621682063722"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063721"><span class="hs-identifier hs-var">rho_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063715"><span class="hs-identifier hs-var">syn_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063718"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063717"><span class="hs-identifier hs-var">skol_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063719"><span class="hs-identifier hs-var">ty_wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-769"></span><span>    </span><span id="local-6989586621682063722"><span class="annot"><span class="annottext">go :: Type -&gt; SyntaxOpType -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621682063722"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682063723"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063723"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span>
</span><span id="line-770"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063724"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063724"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063716"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063723"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-771"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063724"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span>    </span><span class="annot"><a href="#local-6989586621682063722"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682063725"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063725"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span>   </span><span class="hs-comment">-- same as SynAny, because we skolemise eagerly</span><span>
</span><span id="line-774"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063727"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063727"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063716"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063725"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-775"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063727"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><a href="#local-6989586621682063722"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682063728"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063728"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span>
</span><span id="line-778"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063729"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063729"><span class="hs-identifier hs-var">list_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063730"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063730"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (TcCoercionR, Type)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063728"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-779"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063731"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063731"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063716"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063730"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-780"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063731"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063729"><span class="hs-identifier hs-var">list_co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span>    </span><span class="annot"><a href="#local-6989586621682063722"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682063732"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063732"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span id="local-6989586621682063734"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063734"><span class="hs-identifier hs-var">arg_shape</span></a></span></span><span> </span><span id="local-6989586621682063735"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063735"><span class="hs-identifier hs-var">res_shape</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621682063736"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063736"><span class="hs-identifier hs-var">match_wrapper</span></a></span></span><span>                         </span><span class="hs-comment">-- :: (arg_ty -&gt; res_ty) &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-784"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063737"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063737"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063738"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063738"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063739"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063739"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063740"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063740"><span class="hs-identifier hs-var">op_mult</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063741"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063741"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span> </span><span class="hs-special">)</span><span>                     </span><span class="hs-comment">-- :: res_ty_out &quot;-&gt;&quot; res_ty</span><span>
</span><span id="line-786"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063742"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063742"><span class="hs-identifier hs-var">arg_wrapper1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063743"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063743"><span class="hs-identifier hs-var">arg_wrapper2</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- :: arg_ty &quot;-&gt;&quot; arg_ty_out</span><span>
</span><span id="line-787"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
-&gt; UserTypeCtxt
-&gt; Int
-&gt; ExpRhoType
-&gt; ([Scaled ExpRhoType]
    -&gt; ExpRhoType
    -&gt; TcM
         (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
          HsWrapper))
-&gt; TcM
     (HsWrapper,
      (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
       HsWrapper))
forall a.
ExpectedFunTyOrigin
-&gt; UserTypeCtxt
-&gt; Int
-&gt; ExpRhoType
-&gt; ([Scaled ExpRhoType] -&gt; ExpRhoType -&gt; TcM a)
-&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedFunTys"><span class="hs-identifier hs-var">matchExpectedFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
</span><a href="#local-6989586621682063745"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063732"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Scaled ExpRhoType]
  -&gt; ExpRhoType
  -&gt; TcM
       (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
        HsWrapper))
 -&gt; TcM
      (HsWrapper,
       (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
        HsWrapper)))
-&gt; ([Scaled ExpRhoType]
    -&gt; ExpRhoType
    -&gt; TcM
         (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
          HsWrapper))
-&gt; TcM
     (HsWrapper,
      (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
       HsWrapper))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-788"></span><span>                  </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682063746"><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621682063746"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621682063747"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063747"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-789"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063748"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063748"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpRhoType -&gt; ExpRhoType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621682063746"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>                     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063749"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063749"><span class="hs-identifier hs-var">res_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063747"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span>                         </span><span class="hs-comment">-- another nested arrow is too much for now,</span><span>
</span><span id="line-793"></span><span>                         </span><span class="hs-comment">-- but I bet we'll never need this</span><span>
</span><span id="line-794"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
forall (m :: * -&gt; *).
(HasCallStack, Applicative m) =&gt;
Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-var">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063734"><span class="hs-identifier hs-var">arg_shape</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-795"></span><span>                                   </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">;</span><span>
</span><span id="line-796"></span><span>                                   </span><span class="annot"><span class="annottext">SyntaxOpType
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Too many nested arrows in SyntaxOpType&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-798"></span><span>                                   </span><span class="annot"><span class="annottext">CtOrigin -&gt; SDoc
</span><a href="GHC.Tc.Types.Origin.html#pprCtOrigin"><span class="hs-identifier hs-var">pprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063712"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063752"><span class="annot"><span class="annottext">arg_mult :: Type
</span><a href="#local-6989586621682063752"><span class="hs-identifier hs-var hs-var">arg_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621682063746"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-801"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM ((a, Type, Type, Type), HsWrapper))
-&gt; TcM
     (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
      HsWrapper)
forall a.
CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var">tcSynArgA</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063712"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063713"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063748"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063734"><span class="hs-identifier hs-var">arg_shape</span></a></span><span> </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM ((a, Type, Type, Type), HsWrapper))
 -&gt; TcM
      (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
       HsWrapper))
-&gt; ([Type] -&gt; [Type] -&gt; TcM ((a, Type, Type, Type), HsWrapper))
-&gt; TcM
     (((a, Type, Type, Type), HsWrapper), HsWrapper, [HsWrapper],
      HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-802"></span><span>                       </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063754"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063754"><span class="hs-identifier hs-var">arg_results</span></a></span></span><span> </span><span id="local-6989586621682063755"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063755"><span class="hs-identifier hs-var">arg_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-803"></span><span>                       </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM (a, Type, Type, Type))
-&gt; TcM ((a, Type, Type, Type), HsWrapper)
forall a.
CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var">tcSynArgE</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063712"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063713"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063749"><span class="hs-identifier hs-var">res_tc_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063735"><span class="hs-identifier hs-var">res_shape</span></a></span><span> </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM (a, Type, Type, Type))
 -&gt; TcM ((a, Type, Type, Type), HsWrapper))
-&gt; ([Type] -&gt; [Type] -&gt; TcM (a, Type, Type, Type))
-&gt; TcM ((a, Type, Type, Type), HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-804"></span><span>                       </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063756"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063756"><span class="hs-identifier hs-var">res_results</span></a></span></span><span> </span><span id="local-6989586621682063757"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063757"><span class="hs-identifier hs-var">res_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-805"></span><span>                       </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063758"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063758"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063716"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063754"><span class="hs-identifier hs-var">arg_results</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063756"><span class="hs-identifier hs-var">res_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063752"><span class="hs-identifier hs-var">arg_mult</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063755"><span class="hs-identifier hs-var">arg_res_mults</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063757"><span class="hs-identifier hs-var">res_res_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-806"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, Type, Type, Type) -&gt; TcM (a, Type, Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063758"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063748"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063749"><span class="hs-identifier hs-var">res_tc_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063752"><span class="hs-identifier hs-var">arg_mult</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063759"><span class="annot"><span class="annottext">fun_wrap :: HsWrapper
</span><a href="#local-6989586621682063759"><span class="hs-identifier hs-var hs-var">fun_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; Scaled Type -&gt; Type -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpFun"><span class="hs-identifier hs-var">mkWpFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063743"><span class="hs-identifier hs-var">arg_wrapper2</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063742"><span class="hs-identifier hs-var">arg_wrapper1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063741"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span>
</span><span id="line-809"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063740"><span class="hs-identifier hs-var">op_mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063738"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063739"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-810"></span><span>               </span><span class="hs-comment">-- NB: arg_ty comes from matchExpectedFunTys, so it has a</span><span>
</span><span id="line-811"></span><span>               </span><span class="hs-comment">-- fixed RuntimeRep, as needed to call mkWpFun.</span><span>
</span><span id="line-812"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063737"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063736"><span class="hs-identifier hs-var">match_wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063759"><span class="hs-identifier hs-var">fun_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-813"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-814"></span><span>        </span><span id="local-6989586621682063745"><span class="annot"><span class="annottext">herald :: ExpectedFunTyOrigin
</span><a href="#local-6989586621682063745"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; HsExpr GhcRn -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTySyntaxOp"><span class="hs-identifier hs-var">ExpectedFunTySyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063712"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063713"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span>    </span><span class="annot"><a href="#local-6989586621682063722"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682063762"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063762"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span id="local-6989586621682063763"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063763"><span class="hs-identifier hs-var">the_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063764"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063764"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; ExpRhoType -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063712"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063763"><span class="hs-identifier hs-var">the_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063762"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-818"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063766"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063766"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063716"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-819"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063766"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063764"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span class="hs-comment">-- works on &quot;actual&quot; types, instantiating where necessary</span><span>
</span><span id="line-822"></span><span class="hs-comment">-- See Note [tcSynArg]</span><span>
</span><span id="line-823"></span><span id="local-6989586621682062481"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-type">tcSynArgA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-824"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the operator we are checking (for error messages)</span></span><span>
</span><span id="line-825"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-826"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>              </span><span class="annot"><span class="hs-comment">-- ^ argument shapes</span></span><span>
</span><span id="line-827"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ result shape</span></span><span>
</span><span id="line-828"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682062481"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ check the arguments</span></span><span>
</span><span id="line-829"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682062481"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-830"></span><span>            </span><span class="hs-comment">-- ^ returns a wrapper to be applied to the original function,</span><span>
</span><span id="line-831"></span><span>            </span><span class="hs-comment">-- wrappers to be applied to arguments</span><span>
</span><span id="line-832"></span><span>            </span><span class="hs-comment">-- and a wrapper to be applied to the overall expression</span><span>
</span><span id="line-833"></span><span id="tcSynArgA"><span class="annot"><span class="annottext">tcSynArgA :: forall a.
CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var hs-var">tcSynArgA</span></a></span></span><span> </span><span id="local-6989586621682063771"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682063772"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063772"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682063773"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063773"><span class="hs-identifier hs-var">sigma_ty</span></a></span></span><span> </span><span id="local-6989586621682063774"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063774"><span class="hs-identifier hs-var">arg_shapes</span></a></span></span><span> </span><span id="local-6989586621682063775"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063775"><span class="hs-identifier hs-var">res_shape</span></a></span></span><span> </span><span id="local-6989586621682063776"><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063776"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063777"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063777"><span class="hs-identifier hs-var">match_wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063778"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063778"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063779"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063779"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
-&gt; CtOrigin
-&gt; Maybe TypedThing
-&gt; Int
-&gt; Type
-&gt; TcM (HsWrapper, [Scaled Type], Type)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTysRho"><span class="hs-identifier hs-var">matchActualFunTysRho</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectedFunTyOrigin
</span><a href="#local-6989586621682063781"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-836"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SyntaxOpType] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063774"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063773"><span class="hs-identifier hs-var">sigma_ty</span></a></span><span>
</span><span id="line-837"></span><span>              </span><span class="hs-comment">-- match_wrapper :: sigma_ty &quot;-&gt;&quot; (arg_tys -&gt; res_ty)</span><span>
</span><span id="line-838"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682063782"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063782"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063783"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063783"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063784"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682063784"><span class="hs-identifier hs-var">arg_wrappers</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-839"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; [SyntaxOpType]
-&gt; ([Type] -&gt; [Type] -&gt; TcM (a, HsWrapper))
-&gt; TcM ((a, HsWrapper), [HsWrapper])
forall a.
[Type]
-&gt; [SyntaxOpType]
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621682063785"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063778"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063774"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span> </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM (a, HsWrapper))
 -&gt; TcM ((a, HsWrapper), [HsWrapper]))
-&gt; ([Type] -&gt; [Type] -&gt; TcM (a, HsWrapper))
-&gt; TcM ((a, HsWrapper), [HsWrapper])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063786"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063786"><span class="hs-identifier hs-var">arg_results</span></a></span></span><span> </span><span id="local-6989586621682063787"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063787"><span class="hs-identifier hs-var">arg_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-840"></span><span>              </span><span class="annot"><span class="annottext">Type -&gt; SyntaxOpType -&gt; ([Type] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
forall a.
Type -&gt; SyntaxOpType -&gt; ([Type] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621682063788"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span>    </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063779"><span class="hs-identifier hs-var">res_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063775"><span class="hs-identifier hs-var">res_shape</span></a></span><span>  </span><span class="annot"><span class="annottext">(([Type] -&gt; TcM a) -&gt; TcM (a, HsWrapper))
-&gt; ([Type] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063789"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063789"><span class="hs-identifier hs-var">res_results</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-841"></span><span>              </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063776"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063786"><span class="hs-identifier hs-var">arg_results</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063789"><span class="hs-identifier hs-var">res_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063778"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063787"><span class="hs-identifier hs-var">arg_res_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper, [HsWrapper], HsWrapper)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063782"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063777"><span class="hs-identifier hs-var">match_wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682063784"><span class="hs-identifier hs-var">arg_wrappers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063783"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-844"></span><span>    </span><span id="local-6989586621682063781"><span class="annot"><span class="annottext">herald :: ExpectedFunTyOrigin
</span><a href="#local-6989586621682063781"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; HsExpr GhcRn -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTySyntaxOp"><span class="hs-identifier hs-var">ExpectedFunTySyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063772"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>    </span><span id="local-6989586621682062492"><span class="annot"><a href="#local-6989586621682063785"><span class="hs-identifier hs-type">tc_syn_args_e</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-847"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682062492"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682062492"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-849"></span><span>                    </span><span class="hs-comment">-- the wrappers are for arguments</span><span>
</span><span id="line-850"></span><span>    </span><span id="local-6989586621682063785"><span class="annot"><span class="annottext">tc_syn_args_e :: forall a.
[Type]
-&gt; [SyntaxOpType]
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621682063785"><span class="hs-identifier hs-var hs-var">tc_syn_args_e</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063793"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063793"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682063794"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063794"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063795"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063795"><span class="hs-identifier hs-var">arg_shape</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682063796"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063796"><span class="hs-identifier hs-var">arg_shapes</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063797"><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063797"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-851"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682063798"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063798"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063799"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682063799"><span class="hs-identifier hs-var">arg_wraps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063800"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063800"><span class="hs-identifier hs-var">arg_wrap</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM (a, [HsWrapper]))
-&gt; TcM ((a, [HsWrapper]), HsWrapper)
forall a.
CtOrigin
-&gt; HsExpr GhcRn
-&gt; Type
-&gt; SyntaxOpType
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var">tcSynArgE</span></a></span><span>     </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span><span>  </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063772"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063793"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621682063795"><span class="hs-identifier hs-var">arg_shape</span></a></span><span>  </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM (a, [HsWrapper]))
 -&gt; TcM ((a, [HsWrapper]), HsWrapper))
-&gt; ([Type] -&gt; [Type] -&gt; TcM (a, [HsWrapper]))
-&gt; TcM ((a, [HsWrapper]), HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063801"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063801"><span class="hs-identifier hs-var">arg1_results</span></a></span></span><span> </span><span id="local-6989586621682063802"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063802"><span class="hs-identifier hs-var">arg1_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-853"></span><span>                  </span><span class="annot"><span class="annottext">[Type]
-&gt; [SyntaxOpType]
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
forall a.
[Type]
-&gt; [SyntaxOpType]
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621682063785"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span>          </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063794"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621682063796"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span> </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM a) -&gt; TcM (a, [HsWrapper]))
-&gt; ([Type] -&gt; [Type] -&gt; TcM a) -&gt; TcM (a, [HsWrapper])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063803"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063803"><span class="hs-identifier hs-var">args_results</span></a></span></span><span> </span><span id="local-6989586621682063804"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063804"><span class="hs-identifier hs-var">args_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-854"></span><span>                  </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063797"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063801"><span class="hs-identifier hs-var">arg1_results</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063803"><span class="hs-identifier hs-var">args_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063802"><span class="hs-identifier hs-var">arg1_mults</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063804"><span class="hs-identifier hs-var">args_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, [HsWrapper]) -&gt; TcM (a, [HsWrapper])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063798"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063800"><span class="hs-identifier hs-var">arg_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [HsWrapper] -&gt; [HsWrapper]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682063799"><span class="hs-identifier hs-var">arg_wraps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-856"></span><span>    </span><span class="annot"><a href="#local-6989586621682063785"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063805"><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063805"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, [HsWrapper])) -&gt; TcM a -&gt; TcM (a, [HsWrapper])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; TcM a
</span><a href="#local-6989586621682063805"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span>    </span><span id="local-6989586621682062493"><span class="annot"><a href="#local-6989586621682063788"><span class="hs-identifier hs-type">tc_syn_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>
</span><span id="line-859"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682062493"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682062493"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-861"></span><span>                  </span><span class="hs-comment">-- the wrapper applies to the overall result</span><span>
</span><span id="line-862"></span><span>    </span><span id="local-6989586621682063788"><span class="annot"><span class="annottext">tc_syn_arg :: forall a.
Type -&gt; SyntaxOpType -&gt; ([Type] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621682063788"><span class="hs-identifier hs-var hs-var">tc_syn_arg</span></a></span></span><span> </span><span id="local-6989586621682063823"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063823"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span> </span><span id="local-6989586621682063824"><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063824"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-863"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063825"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063825"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063824"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063823"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-864"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063825"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-865"></span><span>    </span><span class="annot"><a href="#local-6989586621682063788"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621682063826"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063826"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span> </span><span id="local-6989586621682063827"><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063827"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-866"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063828"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063828"><span class="hs-identifier hs-var">inst_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063829"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063829"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; TcM (HsWrapper, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063826"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-867"></span><span>               </span><span class="hs-comment">-- inst_wrap :: res_ty &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-868"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063830"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063830"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063827"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063829"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-869"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063830"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063828"><span class="hs-identifier hs-var">inst_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-870"></span><span>    </span><span class="annot"><a href="#local-6989586621682063788"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621682063831"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063831"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span> </span><span id="local-6989586621682063832"><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063832"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063833"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063833"><span class="hs-identifier hs-var">inst_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063834"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063834"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; TcM (HsWrapper, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063831"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-872"></span><span>               </span><span class="hs-comment">-- inst_wrap :: res_ty &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-873"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063835"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063835"><span class="hs-identifier hs-var">list_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063836"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063836"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (TcCoercionR, Type)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063834"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-874"></span><span>               </span><span class="hs-comment">-- list_co :: [elt_ty] ~N rho_ty</span><span>
</span><span id="line-875"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063837"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063837"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063832"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063836"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-876"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063837"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; TcCoercionR
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063835"><span class="hs-identifier hs-var">list_co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063833"><span class="hs-identifier hs-var">inst_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-877"></span><span>    </span><span class="annot"><a href="#local-6989586621682063788"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-878"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (a, HsWrapper)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSynArgA hits a SynFun&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>    </span><span class="annot"><a href="#local-6989586621682063788"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621682063838"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063838"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span id="local-6989586621682063839"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063839"><span class="hs-identifier hs-var">the_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682063840"><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063840"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-880"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682063841"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063841"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; Type -&gt; ExpRhoType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubType"><span class="hs-identifier hs-var">tcSubType</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682063771"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063838"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063839"><span class="hs-identifier hs-var">the_ty</span></a></span><span>
</span><span id="line-881"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063843"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063843"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM a
</span><a href="#local-6989586621682063840"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-882"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682063843"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682063841"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span class="hs-comment">{-
Note [Push result type in]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Unify with expected result before type-checking the args so that the
info from res_ty percolates to args.  This is when we might detect a
too-few args situation.  (One can think of cases when the opposite
order would give a better error message.)
experimenting with putting this first.

Here's an example where it actually makes a real difference

   class C t a b | t a -&gt; b
   instance C Char a Bool

   data P t a = forall b. (C t a b) =&gt; MkP b
   data Q t   = MkQ (forall a. P t a)

   f1, f2 :: Q Char;
   f1 = MkQ (MkP True)
   f2 = MkQ (MkP True :: forall a. P Char a)

With the change, f1 will type-check, because the 'Char' info from
the signature is propagated into MkQ's argument. With the check
in the other order, the extra signature in f2 is reqd.
-}</span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Desugaring record update
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span class="hs-comment">{-
Note [Type of a record update]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The main complication with RecordUpd is that we need to explicitly
handle the *non-updated* fields.  Consider:

        data T a b c = MkT1 { fa :: a, fb :: (b,c) }
                     | MkT2 { fa :: a, fb :: (b,c), fc :: c -&gt; c }
                     | MkT3 { fd :: a }

        upd :: T a b c -&gt; (b',c) -&gt; T a b' c
        upd t x = t { fb = x}

The result type should be (T a b' c)
not (T a b c),   because 'b' *is not* mentioned in a non-updated field
not (T a b' c'), because 'c' *is*     mentioned in a non-updated field
NB that it's not good enough to look at just one constructor; we must
look at them all; cf #3219

After all, upd should be equivalent to:
        upd t x = case t of
                        MkT1 p q -&gt; MkT1 p x
                        MkT2 a b -&gt; MkT2 p b
                        MkT3 d   -&gt; error ...

So we need to give a completely fresh type to the result record,
and then constrain it by the fields that are *not* updated (&quot;p&quot; above).
We call these the &quot;fixed&quot; type variables, and compute them in getFixedTyVars.

Note that because MkT3 doesn't contain all the fields being updated,
its RHS is simply an error, so it doesn't impose any type constraints.
Hence the use of 'relevant_cont'.

Note [Implicit type sharing]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
We also take into account any &quot;implicit&quot; non-update fields.  For example
        data T a b where { MkT { f::a } :: T a a; ... }
So the &quot;real&quot; type of MkT is: forall ab. (a~b) =&gt; a -&gt; T a b

Then consider
        upd t x = t { f=x }
We infer the type
        upd :: T a b -&gt; a -&gt; T a b
        upd (t::T a b) (x::a)
           = case t of { MkT (co:a~b) (_:a) -&gt; MkT co x }
We can't give it the more general type
        upd :: T a b -&gt; c -&gt; T c b

Note [Criteria for update]
~~~~~~~~~~~~~~~~~~~~~~~~~~
We want to allow update for existentials etc, provided the updated
field isn't part of the existential. For example, this should be ok.
  data T a where { MkT { f1::a, f2::b-&gt;b } :: T a }
  f :: T a -&gt; b -&gt; T b
  f t b = t { f1=b }

The criterion we use is this:

  The types of the updated fields
  mention only the universally-quantified type variables
  of the data constructor

NB: this is not (quite) the same as being a &quot;naughty&quot; record selector
(See Note [Naughty record selectors]) in GHC.Tc.TyCl), at least
in the case of GADTs. Consider
   data T a where { MkT :: { f :: a } :: T [a] }
Then f is not &quot;naughty&quot; because it has a well-typed record selector.
But we don't allow updates for 'f'.  (One could consider trying to
allow this, but it makes my head hurt.  Badly.  And no one has asked
for it.)

In principle one could go further, and allow
  g :: T a -&gt; T a
  g t = t { f2 = \x -&gt; x }
because the expression is polymorphic...but that seems a bridge too far.

Note [Data family example]
~~~~~~~~~~~~~~~~~~~~~~~~~~
    data instance T (a,b) = MkT { x::a, y::b }
  ---&gt;
    data :TP a b = MkT { a::a, y::b }
    coTP a b :: T (a,b) ~ :TP a b

Suppose r :: T (t1,t2), e :: t3
Then  r { x=e } :: T (t3,t1)
  ---&gt;
      case r |&gt; co1 of
        MkT x y -&gt; MkT e y |&gt; co2
      where co1 :: T (t1,t2) ~ :TP t1 t2
            co2 :: :TP t3 t2 ~ T (t3,t2)
The wrapping with co2 is done by the constructor wrapper for MkT

Outgoing invariants
~~~~~~~~~~~~~~~~~~~
In the outgoing (HsRecordUpd scrut binds cons in_inst_tys out_inst_tys):

  * cons are the data constructors to be updated

  * in_inst_tys, out_inst_tys have same length, and instantiate the
        *representation* tycon of the data cons.  In Note [Data
        family example], in_inst_tys = [t1,t2], out_inst_tys = [t3,t2]

Note [Mixed Record Field Updates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the following pattern synonym.

  data MyRec = MyRec { foo :: Int, qux :: String }

  pattern HisRec{f1, f2} = MyRec{foo = f1, qux=f2}

This allows updates such as the following

  updater :: MyRec -&gt; MyRec
  updater a = a {f1 = 1 }

It would also make sense to allow the following update (which we reject).

  updater a = a {f1 = 1, qux = &quot;two&quot; } ==? MyRec 1 &quot;two&quot;

This leads to confusing behaviour when the selectors in fact refer the same
field.

  updater a = a {f1 = 1, foo = 2} ==? ???

For this reason, we reject a mixture of pattern synonym and normal record
selectors in the same update block. Although of course we still allow the
following.

  updater a = (a {f1 = 1}) {foo = 2}

  &gt; updater (MyRec 0 &quot;str&quot;)
  MyRec 2 &quot;str&quot;

Note [Record Updates]
~~~~~~~~~~~~~~~~~~~~~
To typecheck a record update, we desugar it first.  Suppose we have
    data T p q = T1 { x :: Int, y :: Bool, z :: Char }
               | T2 { v :: Char }
               | T3 { x :: Int }
               | T4 { p :: Float, y :: Bool, x :: Int }
               | T5
Then the record update `e { x=e1, y=e2 }` desugars as follows

       e { x=e1, y=e2 }
    ===&gt;
       let { x' = e1; y' = e2 } in
       case e of
          T1 _ _ z -&gt; T1 x' y' z
          T4 p _ _ -&gt; T4 p y' x'
T2, T3 and T5 should not occur, so we omit them from the match.
The critical part of desugaring is to identify T and then T1/T4.

Wrinkle [Disambiguating fields]
As outlined above, to typecheck a record update via desugaring, we first need
to identify the parent record `TyCon` (`T` above). This can be tricky when several
record types share the same field (with `-XDuplicateRecordFields`).

Currently, we use the inferred type of the record to help disambiguate the record
fields. For example, in

  ( mempty :: T a b ) { x = 3 }

the type signature on `mempty` allows us to disambiguate the record `TyCon` to `T`,
when there might be other datatypes with field `x :: Int`.
This complexity is scheduled for removal via the implementation of GHC proposal #366
https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0366-no-ambiguous-field-access.rst

However, for the time being, we still need to disambiguate record fields using the
inferred types. This means that, when typechecking a record update via desugaring,
we need to do the following:

  D1. Perform a first typechecking pass on the record expression (`e` in the example above),
      to infer the type of the record being updated.
  D2. Desugar the record update as described above, using an HsExpansion.
  D3. Typecheck the desugared code.

In (D1), we call inferRho to infer the type of the record being updated. This returns the
inferred type of the record, together with a typechecked expression (of type HsExpr GhcTc)
and a collection of residual constraints.
We have no need for the latter two, because we will typecheck again in (D3). So, for
the time being (and until GHC proposal #366 is implemented), we simply drop them.

Wrinkle [Using IdSig]
As noted above, we want to let-bind the updated fields to avoid code duplication:

  let { x' = e1; y' = e2 } in
  case e of
     T1 _ _ z -&gt; T1 x' y' z
     T4 p _ _ -&gt; T4 p y' x'

However, doing so in a naive way would cause difficulties for type inference.
For example:

  data R b = MkR { f :: (forall a. a -&gt; a) -&gt; (Int,b), c :: Int }
  foo r = r { f = \ k -&gt; (k 3, k 'x') }

If we desugar to:

  ds_foo r =
    let f' = \ k -&gt; (k 3, k 'x')
    in case r of
      MkR _ b -&gt; MkR f' b

then we are unable to infer an appropriately polymorphic type for f', because we
never infer higher-rank types. To circumvent this problem, we proceed as follows:

  1. Obtain general field types by instantiating any of the constructors
     that contain all the necessary fields. (Note that the field type must be
     identical across different constructors of a given data constructor).
  2. Let-bind an 'IdSig' with this type. This amounts to giving the let-bound
     'Id's a partial type signature.

In the above example, it's as if we wrote:

  ds_foo r =
    let f' :: (forall a. a -&gt; a) -&gt; (Int, _b)
        f' = \ k -&gt; (k 3, k 'x')
    in case r of
      MkR _ b -&gt; MkR f' b

This allows us to compute the right type for f', and thus accept this record update.

Note [Unifying result types in tcRecordUpd]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
After desugaring and typechecking a record update in the way described in
Note [Record Updates], we must take care to unify the result types.

Example:

  type family F (a :: Type) :: Type where {}
  data D a = MkD { fld :: F a }

  f :: F Int -&gt; D Bool -&gt; D Int
  f i r = r { fld = i }

This record update desugars to:

  let x :: F alpha -- metavariable
      x = i
  in case r of
    MkD _ -&gt; MkD x

Because the type family F is not injective, our only hope for unifying the
metavariable alpha is through the result type of the record update, which tells
us that we should unify alpha := Int.

Test case: T10808.

Wrinkle [GADT result type in tcRecordUpd]

  When dealing with a GADT, we want to be careful about which result type we use.

  Example:

    data G a b where
      MkG :: { bar :: F a } -&gt; G a Int

    g :: F Int -&gt; G Float b -&gt; G Int b
    g i r = r { bar = i }

    We **do not** want to use the result type from the constructor MkG, which would
    leave us with a result type &quot;G alpha Int&quot;. Instead, we should use the result type
    from the GADT header, instantiating as above, to get &quot;G alpha beta&quot; which will get
    unified withy &quot;G Int b&quot;.

    Test cases: T18809, HardRecordUpdate.

-}</span><span>
</span><span id="line-1184"></span><span>
</span><span id="line-1185"></span><span class="hs-comment">-- | Desugars a record update @record_expr { fld1 = e1, fld2 = e2 }@ into a case expression</span><span>
</span><span id="line-1186"></span><span class="hs-comment">-- that matches on the constructors of the record @r@, as described in</span><span>
</span><span id="line-1187"></span><span class="hs-comment">-- Note [Record Updates].</span><span>
</span><span id="line-1188"></span><span class="hs-comment">--</span><span>
</span><span id="line-1189"></span><span class="hs-comment">-- Returns a renamed but not-yet-typechecked expression, together with the</span><span>
</span><span id="line-1190"></span><span class="hs-comment">-- result type of this desugared record update.</span><span>
</span><span id="line-1191"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#desugarRecordUpd"><span class="hs-identifier hs-type">desugarRecordUpd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1192"></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ @record_expr@: expression to which the record update is applied</span></span><span>
</span><span id="line-1193"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1194"></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ the record update fields</span></span><span>
</span><span id="line-1195"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-1196"></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ the expected result type of the record update</span></span><span>
</span><span id="line-1197"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1198"></span><span>                           </span><span class="hs-comment">-- desugared record update expression</span><span>
</span><span id="line-1199"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1200"></span><span>                           </span><span class="hs-comment">-- result type of desugared record update</span><span>
</span><span id="line-1201"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1202"></span><span>                           </span><span class="hs-comment">-- error context to push when typechecking</span><span>
</span><span id="line-1203"></span><span>                           </span><span class="hs-comment">-- the desugared code</span><span>
</span><span id="line-1204"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span id="desugarRecordUpd"><span class="annot"><span class="annottext">desugarRecordUpd :: LHsExpr GhcRn
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcRn, Type, SDoc)
</span><a href="GHC.Tc.Gen.Expr.html#desugarRecordUpd"><span class="hs-identifier hs-var hs-var">desugarRecordUpd</span></a></span></span><span> </span><span id="local-6989586621682063844"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063844"><span class="hs-identifier hs-var">record_expr</span></a></span></span><span> </span><span id="local-6989586621682063845"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621682063845"><span class="hs-identifier hs-var">rbnds</span></a></span></span><span> </span><span id="local-6989586621682063846"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063846"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1206"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- STEP -2: typecheck the record_expr, the record to be updated</span><span>
</span><span id="line-1207"></span><span>          </span><span class="hs-comment">-- Until GHC proposal #366 is implemented, we still use the type of</span><span>
</span><span id="line-1208"></span><span>          </span><span class="hs-comment">-- the record to disambiguate its fields, so we must infer the record</span><span>
</span><span id="line-1209"></span><span>          </span><span class="hs-comment">-- type here before we can desugar. See Wrinkle [Disambiguating fields]</span><span>
</span><span id="line-1210"></span><span>          </span><span class="hs-comment">-- in Note [Record Updates].</span><span>
</span><span id="line-1211"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063847"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063847"><span class="hs-identifier hs-var">record_rho</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063848"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682063848"><span class="hs-identifier hs-var">_lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Type), WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span>    </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
 -&gt; TcM
      ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Type), WantedConstraints))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcTc), Type)
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Type), WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- see (1) below</span><span>
</span><span id="line-1212"></span><span>                                    </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- see (2) below</span><span>
</span><span id="line-1213"></span><span>                                    </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063844"><span class="hs-identifier hs-var">record_expr</span></a></span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span>            </span><span class="hs-comment">-- (1)</span><span>
</span><span id="line-1216"></span><span>            </span><span class="hs-comment">-- Note that we capture, and then discard, the constraints.</span><span>
</span><span id="line-1217"></span><span>            </span><span class="hs-comment">-- This `tcInferRho` is used *only* to identify the data type,</span><span>
</span><span id="line-1218"></span><span>            </span><span class="hs-comment">-- so we can deal with field disambiguation.</span><span>
</span><span id="line-1219"></span><span>            </span><span class="hs-comment">-- Then we are going to generate a desugared record update, including `record_expr`,</span><span>
</span><span id="line-1220"></span><span>            </span><span class="hs-comment">-- and typecheck it from scratch.  We don't want to generate the constraints twice!</span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span>            </span><span class="hs-comment">-- (2)</span><span>
</span><span id="line-1223"></span><span>            </span><span class="hs-comment">-- Record update drops some of the content of the record (namely the</span><span>
</span><span id="line-1224"></span><span>            </span><span class="hs-comment">-- content of the field being updated). As a consequence, unless the</span><span>
</span><span id="line-1225"></span><span>            </span><span class="hs-comment">-- field being updated is unrestricted in the record, we need an</span><span>
</span><span id="line-1226"></span><span>            </span><span class="hs-comment">-- unrestricted record. Currently, we simply always require an</span><span>
</span><span id="line-1227"></span><span>            </span><span class="hs-comment">-- unrestricted record.</span><span>
</span><span id="line-1228"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-1229"></span><span>            </span><span class="hs-comment">-- Consider the following example:</span><span>
</span><span id="line-1230"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-1231"></span><span>            </span><span class="hs-comment">-- data R a = R { self :: a }</span><span>
</span><span id="line-1232"></span><span>            </span><span class="hs-comment">-- bad :: a &#8888; ()</span><span>
</span><span id="line-1233"></span><span>            </span><span class="hs-comment">-- bad x = let r = R x in case r { self = () } of { R x' -&gt; x' }</span><span>
</span><span id="line-1234"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-1235"></span><span>            </span><span class="hs-comment">-- This should definitely *not* typecheck.</span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span>       </span><span class="hs-comment">-- STEP -1  See Note [Disambiguating record fields] in GHC.Tc.Gen.Head</span><span>
</span><span id="line-1238"></span><span>       </span><span class="hs-comment">-- After this we know that rbinds is unambiguous</span><span>
</span><span id="line-1239"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063850"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063850"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; Type
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM
     [LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-var">disambiguateRecordBinds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063844"><span class="hs-identifier hs-var">record_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063847"><span class="hs-identifier hs-var">record_rho</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621682063845"><span class="hs-identifier hs-var">rbnds</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063846"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1240"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063852"><span class="annot"><span class="annottext">upd_flds :: [AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621682063852"><span class="hs-identifier hs-var hs-var">upd_flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))
 -&gt; AmbiguousFieldOcc GhcTc)
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))]
-&gt; [AmbiguousFieldOcc GhcTc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
-&gt; AmbiguousFieldOcc GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
 -&gt; AmbiguousFieldOcc GhcTc)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; AmbiguousFieldOcc GhcTc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
  (LocatedA (HsExpr GhcRn))
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="annot"><span class="annottext">(HsFieldBind
   (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
   (LocatedA (HsExpr GhcRn))
 -&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn)))
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063850"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1241"></span><span>             </span><span id="local-6989586621682063856"><span class="annot"><span class="annottext">upd_fld_occs :: [FieldLabelString]
</span><a href="#local-6989586621682063856"><span class="hs-identifier hs-var hs-var">upd_fld_occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AmbiguousFieldOcc GhcTc -&gt; FieldLabelString)
-&gt; [AmbiguousFieldOcc GhcTc] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-var">FieldLabelString</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; FieldLabelString)
-&gt; (AmbiguousFieldOcc GhcTc -&gt; FastString)
-&gt; AmbiguousFieldOcc GhcTc
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString)
-&gt; (AmbiguousFieldOcc GhcTc -&gt; OccName)
-&gt; AmbiguousFieldOcc GhcTc
-&gt; FastString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName)
-&gt; (AmbiguousFieldOcc GhcTc -&gt; RdrName)
-&gt; AmbiguousFieldOcc GhcTc
-&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; RdrName
forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621682063852"><span class="hs-identifier hs-var">upd_flds</span></a></span><span>
</span><span id="line-1242"></span><span>             </span><span id="local-6989586621682063861"><span class="annot"><span class="annottext">sel_ids :: [TyCoVar]
</span><a href="#local-6989586621682063861"><span class="hs-identifier hs-var hs-var">sel_ids</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AmbiguousFieldOcc GhcTc -&gt; TyCoVar)
-&gt; [AmbiguousFieldOcc GhcTc] -&gt; [TyCoVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; TyCoVar
</span><a href="GHC.Hs.Type.html#selectorAmbiguousFieldOcc"><span class="hs-identifier hs-var">selectorAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">[AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621682063852"><span class="hs-identifier hs-var">upd_flds</span></a></span><span>
</span><span id="line-1243"></span><span>             </span><span id="local-6989586621682063863"><span class="annot"><span class="annottext">upd_fld_names :: [Name]
</span><a href="#local-6989586621682063863"><span class="hs-identifier hs-var hs-var">upd_fld_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; Name) -&gt; [TyCoVar] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063861"><span class="hs-identifier hs-var">sel_ids</span></a></span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span>       </span><span class="hs-comment">-- STEP 0</span><span>
</span><span id="line-1246"></span><span>       </span><span class="hs-comment">-- Check that the field names are really field names</span><span>
</span><span id="line-1247"></span><span>       </span><span class="hs-comment">-- and they are all field names for proper records or</span><span>
</span><span id="line-1248"></span><span>       </span><span class="hs-comment">-- all field names for pattern synonyms.</span><span>
</span><span id="line-1249"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063865"><span class="annot"><span class="annottext">bad_guys :: [TcRn ()]
</span><a href="#local-6989586621682063865"><span class="hs-identifier hs-var hs-var">bad_guys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682063867"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Head.html#notSelector"><span class="hs-identifier hs-var">notSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063870"><span class="hs-identifier hs-var">fld_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1250"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682063871"><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682063871"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063850"><span class="hs-identifier hs-var">rbinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1251"></span><span>                          </span><span class="hs-comment">-- Excludes class ops</span><span>
</span><span id="line-1252"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682063867"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682063867"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682063872"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063872"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind (LAmbiguousFieldOcc GhcTc) (LocatedA (HsExpr GhcRn))
-&gt; GenLocated SrcSpan TyCoVar
forall arg.
HsFieldBind (LAmbiguousFieldOcc GhcTc) arg
-&gt; GenLocated SrcSpan TyCoVar
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldId"><span class="hs-identifier hs-var">hsRecUpdFieldId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn)))
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682063871"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1253"></span><span>                          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Bool
</span><a href="GHC.Types.Id.html#isRecordSelector"><span class="hs-identifier hs-var">isRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063872"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1254"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063870"><span class="annot"><span class="annottext">fld_name :: Name
</span><a href="#local-6989586621682063870"><span class="hs-identifier hs-var hs-var">fld_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063872"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1255"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#unless/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcRn ()] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcRn ()]
</span><a href="#local-6989586621682063865"><span class="hs-identifier hs-var">bad_guys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcRn ()] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#sequence/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="annot"><span class="annottext">[TcRn ()]
</span><a href="#local-6989586621682063865"><span class="hs-identifier hs-var">bad_guys</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) [()] -&gt; TcRn () -&gt; TcRn ()
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span>       </span><span class="hs-comment">-- See Note [Mixed Record Field Updates]</span><span>
</span><span id="line-1257"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063880"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063880"><span class="hs-identifier hs-var">data_sels</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063881"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063881"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1258"></span><span>               </span><span class="annot"><span class="annottext">(TyCoVar -&gt; Bool) -&gt; [TyCoVar] -&gt; ([TyCoVar], [TyCoVar])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#partition/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Bool
</span><a href="GHC.Types.Id.html#isDataConRecordSelector"><span class="hs-identifier hs-var">isDataConRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063861"><span class="hs-identifier hs-var">sel_ids</span></a></span><span>
</span><span id="line-1259"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCoVar -&gt; Bool) -&gt; [TyCoVar] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Bool
</span><a href="GHC.Types.Id.html#isPatSynRecordSelector"><span class="hs-identifier hs-var">isPatSynRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063881"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063880"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063881"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span>                 </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [TyCoVar] -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var">mixedSelectors</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063880"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063881"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1262"></span><span>
</span><span id="line-1263"></span><span>       </span><span class="hs-comment">-- STEP 1</span><span>
</span><span id="line-1264"></span><span>       </span><span class="hs-comment">-- Figure out the tycon and data cons from the first field name</span><span>
</span><span id="line-1265"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>   </span><span class="hs-comment">-- It's OK to use the non-tc splitters here (for a selector)</span><span>
</span><span id="line-1266"></span><span>             </span><span id="local-6989586621682063886"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063886"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063861"><span class="hs-identifier hs-var">sel_ids</span></a></span><span>
</span><span id="line-1267"></span><span>             </span><span class="annot"><a href="#local-6989586621682063887"><span class="hs-identifier hs-type">con_likes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1268"></span><span>             </span><span id="local-6989586621682063887"><span class="annot"><span class="annottext">con_likes :: [ConLike]
</span><a href="#local-6989586621682063887"><span class="hs-identifier hs-var hs-var">con_likes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063886"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1269"></span><span>                            </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621682063891"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682063891"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1270"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; ConLike) -&gt; [DataCon] -&gt; [ConLike]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682063891"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span><span>                            </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelPatSyn"><span class="hs-identifier hs-type">RecSelPatSyn</span></a></span><span> </span><span id="local-6989586621682063895"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682063895"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1272"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682063895"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1273"></span><span>                            </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [ConLike]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordUpd&quot;</span></span><span>
</span><span id="line-1274"></span><span>               </span><span class="hs-comment">-- NB: for a data type family, the tycon is the instance tycon</span><span>
</span><span id="line-1275"></span><span>             </span><span id="local-6989586621682063897"><span class="annot"><span class="annottext">relevant_cons :: [ConLike]
</span><a href="#local-6989586621682063897"><span class="hs-identifier hs-var hs-var">relevant_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConLike] -&gt; [FieldLabelString] -&gt; [ConLike]
</span><a href="GHC.Core.ConLike.html#conLikesWithFields"><span class="hs-identifier hs-var">conLikesWithFields</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682063887"><span class="hs-identifier hs-var">con_likes</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621682063856"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span>
</span><span id="line-1276"></span><span>               </span><span class="hs-comment">-- A constructor is only relevant to this process if</span><span>
</span><span id="line-1277"></span><span>               </span><span class="hs-comment">-- it contains *all* the fields that are being updated</span><span>
</span><span id="line-1278"></span><span>               </span><span class="hs-comment">-- Other ones will cause a runtime error if they occur</span><span>
</span><span id="line-1279"></span><span>
</span><span id="line-1280"></span><span>       </span><span class="hs-comment">-- STEP 2</span><span>
</span><span id="line-1281"></span><span>       </span><span class="hs-comment">-- Check that at least one constructor has all the named fields</span><span>
</span><span id="line-1282"></span><span>       </span><span class="hs-comment">-- i.e. has an empty set of bad fields returned by badFields</span><span>
</span><span id="line-1283"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682063897"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1284"></span><span>         </span><span class="hs-special">{</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (HsExpr GhcRn, Type, SDoc)
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [ConLike] -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-var">badFieldsUpd</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063850"><span class="hs-identifier hs-var">rbinds</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682063887"><span class="hs-identifier hs-var">con_likes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063901"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063901"><span class="hs-identifier hs-var">relevant_con</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span>      </span><span class="hs-comment">-- STEP 3</span><span>
</span><span id="line-1288"></span><span>      </span><span class="hs-comment">-- Create new variables for the fields we are updating,</span><span>
</span><span id="line-1289"></span><span>      </span><span class="hs-comment">-- so that we can share them across constructors.</span><span>
</span><span id="line-1290"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1291"></span><span>      </span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-1292"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1293"></span><span>      </span><span class="hs-comment">--   e { x=e1, y=e2 }</span><span>
</span><span id="line-1294"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1295"></span><span>      </span><span class="hs-comment">-- We want to let-bind variables to `e1` and `e2`:</span><span>
</span><span id="line-1296"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1297"></span><span>      </span><span class="hs-comment">--   let x' :: Int</span><span>
</span><span id="line-1298"></span><span>      </span><span class="hs-comment">--       x' = e1</span><span>
</span><span id="line-1299"></span><span>      </span><span class="hs-comment">--       y' :: Bool</span><span>
</span><span id="line-1300"></span><span>      </span><span class="hs-comment">--       y' = e2</span><span>
</span><span id="line-1301"></span><span>      </span><span class="hs-comment">--   in ...</span><span>
</span><span id="line-1302"></span><span>
</span><span id="line-1303"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Instantiate the type variables of any relevant constuctor</span><span>
</span><span id="line-1304"></span><span>         </span><span class="hs-comment">-- with metavariables to obtain a type for each 'Id'.</span><span>
</span><span id="line-1305"></span><span>         </span><span class="hs-comment">-- This will allow us to have 'Id's with polymorphic types</span><span>
</span><span id="line-1306"></span><span>         </span><span class="hs-comment">-- by using 'IdSig'. See Wrinkle [Using IdSig] in Note [Record Updates].</span><span>
</span><span id="line-1307"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063902"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063902"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063903"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063903"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063904"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682063904"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063905"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063905"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063906"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063906"><span class="hs-identifier hs-var">con_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; ([TyCoVar], [TyCoVar], [EqSpec], [Type], [Type], [Scaled Type],
    Type)
</span><a href="GHC.Core.ConLike.html#conLikeFullSig"><span class="hs-identifier hs-var">conLikeFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063901"><span class="hs-identifier hs-var">relevant_con</span></a></span><span>
</span><span id="line-1308"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063908"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682063908"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063909"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063909"><span class="hs-identifier hs-var">tc_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; TcM (Subst, [TyCoVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063902"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [TyCoVar] -&gt; [TyCoVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063903"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063911"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063911"><span class="hs-identifier hs-var">actual_univ_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063912"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063912"><span class="hs-identifier hs-var">_actual_ex_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [Type] -&gt; ([Type], [Type])
forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063902"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; ([Type], [Type])) -&gt; [Type] -&gt; ([Type], [Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; Type) -&gt; [TyCoVar] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063909"><span class="hs-identifier hs-var">tc_tvs</span></a></span><span>
</span><span id="line-1310"></span><span>
</span><span id="line-1311"></span><span>             </span><span class="hs-comment">-- See Wrinkle [GADT result type in tcRecordUpd]</span><span>
</span><span id="line-1312"></span><span>             </span><span class="hs-comment">-- for an explanation of the following.</span><span>
</span><span id="line-1313"></span><span>             </span><span id="local-6989586621682063915"><span class="annot"><span class="annottext">ds_res_ty :: Type
</span><a href="#local-6989586621682063915"><span class="hs-identifier hs-var hs-var">ds_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063901"><span class="hs-identifier hs-var">relevant_con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1314"></span><span>               </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621682063916"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682063916"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-1315"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqSpec] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682063904"><span class="hs-identifier hs-var">eq_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- We only need to do this if we have actual GADT equalities.</span><span>
</span><span id="line-1316"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkFamilyTyConApp"><span class="hs-identifier hs-var">mkFamilyTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682063916"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682063911"><span class="hs-identifier hs-var">actual_univ_tys</span></a></span><span>
</span><span id="line-1317"></span><span>               </span><span class="annot"><span class="annottext">ConLike
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682063908"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063906"><span class="hs-identifier hs-var">con_res_ty</span></a></span><span>
</span><span id="line-1318"></span><span>
</span><span id="line-1319"></span><span>       </span><span class="hs-comment">-- Gather pairs of let-bound Ids and their right-hand sides,</span><span>
</span><span id="line-1320"></span><span>       </span><span class="hs-comment">-- e.g. (x', e1), (y', e2), ...</span><span>
</span><span id="line-1321"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682062529"><span class="annot"><a href="#local-6989586621682063920"><span class="hs-identifier hs-type">mk_upd_id</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsFieldBind"><span class="hs-identifier hs-type">LHsFieldBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682062529"><span class="hs-identifier hs-type">fld</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1322"></span><span>             </span><span id="local-6989586621682063920"><span class="annot"><span class="annottext">mk_upd_id :: forall fld.
Name
-&gt; LHsFieldBind GhcTc fld (LHsExpr GhcRn)
-&gt; TcM (Name, (TyCoVar, LHsExpr GhcRn))
</span><a href="#local-6989586621682063920"><span class="hs-identifier hs-var hs-var">mk_upd_id</span></a></span></span><span> </span><span id="local-6989586621682063928"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063928"><span class="hs-identifier hs-var">fld_nm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682063929"><span class="annot"><span class="annottext">HsFieldBind fld (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682063929"><span class="hs-identifier hs-var">rbind</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1323"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682063930"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063930"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682063931"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063931"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv (Scaled Type) -&gt; Name -&gt; Scaled Type
forall a. NameEnv a -&gt; Name -&gt; a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv_NF"><span class="hs-identifier hs-var">lookupNameEnv_NF</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv (Scaled Type)
</span><a href="#local-6989586621682063933"><span class="hs-identifier hs-var">arg_ty_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063928"><span class="hs-identifier hs-var">fld_nm</span></a></span><span>
</span><span id="line-1324"></span><span>                          </span><span id="local-6989586621682063934"><span class="annot"><span class="annottext">nm_occ :: OccName
</span><a href="#local-6989586621682063934"><span class="hs-identifier hs-var hs-var">nm_occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName) -&gt; (Name -&gt; RdrName) -&gt; Name -&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; Name -&gt; OccName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063928"><span class="hs-identifier hs-var">fld_nm</span></a></span><span>
</span><span id="line-1325"></span><span>                          </span><span id="local-6989586621682063936"><span class="annot"><span class="annottext">actual_arg_ty :: Type
</span><a href="#local-6989586621682063936"><span class="hs-identifier hs-var hs-var">actual_arg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682063908"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063931"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1326"></span><span>                          </span><span id="local-6989586621682063937"><span class="annot"><span class="annottext">rhs :: LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063937"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind fld (LocatedA (HsExpr GhcRn))
-&gt; LocatedA (HsExpr GhcRn)
forall lhs rhs. HsFieldBind lhs rhs -&gt; rhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind fld (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682063929"><span class="hs-identifier hs-var">rbind</span></a></span><span>
</span><span id="line-1327"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063939"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621682063939"><span class="hs-identifier hs-var">_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063940"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063940"><span class="hs-identifier hs-var">actual_arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt;
FixedRuntimeRepContext -&gt; Type -&gt; TcM (TcCoercionR, Type)
FixedRuntimeRepContext -&gt; Type -&gt; TcM (TcCoercionR, Type)
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep"><span class="hs-identifier hs-var">hasFixedRuntimeRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HsExpr GhcRn -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRRecordUpdate"><span class="hs-identifier hs-var">FRRRecordUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063928"><span class="hs-identifier hs-var">fld_nm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn) -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063937"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063936"><span class="hs-identifier hs-var">actual_arg_ty</span></a></span><span>
</span><span id="line-1328"></span><span>                      </span><span class="hs-comment">-- We get a better error message by doing a (redundant) representation-polymorphism check here,</span><span>
</span><span id="line-1329"></span><span>                      </span><span class="hs-comment">-- rather than delaying until the typechecker typechecks the let-bindings,</span><span>
</span><span id="line-1330"></span><span>                      </span><span class="hs-comment">-- because the let-bound Ids have internal names.</span><span>
</span><span id="line-1331"></span><span>                      </span><span class="hs-comment">-- (As we will typecheck the let-bindings later, we can drop this coercion here.)</span><span>
</span><span id="line-1332"></span><span>                      </span><span class="hs-comment">-- See RepPolyRecordUpdate test.</span><span>
</span><span id="line-1333"></span><span>                    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063942"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063942"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; SrcSpan -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-var">newNameAt</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682063934"><span class="hs-identifier hs-var">nm_occ</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span>
</span><span id="line-1334"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063945"><span class="annot"><span class="annottext">id :: TyCoVar
</span><a href="#local-6989586621682063945"><span class="hs-identifier hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Name -&gt; Type -&gt; Type -&gt; TyCoVar
Name -&gt; Type -&gt; Type -&gt; TyCoVar
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063942"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063930"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063940"><span class="hs-identifier hs-var">actual_arg_ty</span></a></span><span>
</span><span id="line-1335"></span><span>                      </span><span class="hs-comment">-- NB: create fresh names to avoid any accidental shadowing</span><span>
</span><span id="line-1336"></span><span>                      </span><span class="hs-comment">-- occurring in the RHS expressions when creating the let bindings:</span><span>
</span><span id="line-1337"></span><span>                      </span><span class="hs-comment">--</span><span>
</span><span id="line-1338"></span><span>                      </span><span class="hs-comment">--  let x1 = e1; x2 = e2; ...</span><span>
</span><span id="line-1339"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Name, (TyCoVar, LocatedA (HsExpr GhcRn)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063928"><span class="hs-identifier hs-var">fld_nm</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063945"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063937"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1341"></span><span>             </span><span id="local-6989586621682063933"><span class="annot"><span class="annottext">arg_ty_env :: NameEnv (Scaled Type)
</span><a href="#local-6989586621682063933"><span class="hs-identifier hs-var hs-var">arg_ty_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Scaled Type)] -&gt; NameEnv (Scaled Type)
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span>
</span><span id="line-1342"></span><span>                        </span><span class="annot"><span class="annottext">([(Name, Scaled Type)] -&gt; NameEnv (Scaled Type))
-&gt; [(Name, Scaled Type)] -&gt; NameEnv (Scaled Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Scaled Type -&gt; (Name, Scaled Type))
-&gt; [FieldLabel] -&gt; [Scaled Type] -&gt; [(Name, Scaled Type)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682063949"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682063949"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682063950"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682063950"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682063949"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682063950"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063901"><span class="hs-identifier hs-var">relevant_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1344"></span><span>                            </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682063905"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1345"></span><span>
</span><span id="line-1346"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682063953"><span class="annot"><span class="annottext">[(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063953"><span class="hs-identifier hs-var">upd_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name
 -&gt; GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (Name, (TyCoVar, LocatedA (HsExpr GhcRn))))
-&gt; [Name]
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#zipWithM/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; LHsFieldBind
     GhcTc
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LHsExpr GhcRn)
-&gt; TcM (Name, (TyCoVar, LHsExpr GhcRn))
Name
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Name, (TyCoVar, LocatedA (HsExpr GhcRn)))
forall fld.
Name
-&gt; LHsFieldBind GhcTc fld (LHsExpr GhcRn)
-&gt; TcM (Name, (TyCoVar, LHsExpr GhcRn))
</span><a href="#local-6989586621682063920"><span class="hs-identifier hs-var">mk_upd_id</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682063863"><span class="hs-identifier hs-var">upd_fld_names</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063850"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1347"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682063955"><span class="hs-identifier hs-type">updEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html#UniqMap"><span class="hs-identifier hs-type">UniqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1348"></span><span>             </span><span id="local-6989586621682063955"><span class="annot"><span class="annottext">updEnv :: UniqMap Name (TyCoVar, LHsExpr GhcRn)
</span><a href="#local-6989586621682063955"><span class="hs-identifier hs-var hs-var">updEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, (TyCoVar, LHsExpr GhcRn))]
-&gt; UniqMap Name (TyCoVar, LHsExpr GhcRn)
forall k a. Uniquable k =&gt; [(k, a)] -&gt; UniqMap k a
</span><a href="GHC.Types.Unique.Map.html#listToUniqMap"><span class="hs-identifier hs-var">listToUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, (TyCoVar, LHsExpr GhcRn))]
 -&gt; UniqMap Name (TyCoVar, LHsExpr GhcRn))
-&gt; [(Name, (TyCoVar, LHsExpr GhcRn))]
-&gt; UniqMap Name (TyCoVar, LHsExpr GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, (TyCoVar, LHsExpr GhcRn))]
[(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063953"><span class="hs-identifier hs-var">upd_ids</span></a></span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span>             </span><span class="annot"><a href="#local-6989586621682063957"><span class="hs-identifier hs-type">make_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1351"></span><span>             </span><span class="hs-comment">-- As explained in Note [Record Updates], to desugar</span><span>
</span><span id="line-1352"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-1353"></span><span>             </span><span class="hs-comment">--   e { x=e1, y=e2 }</span><span>
</span><span id="line-1354"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-1355"></span><span>             </span><span class="hs-comment">-- we generate a case statement, with an equation for</span><span>
</span><span id="line-1356"></span><span>             </span><span class="hs-comment">-- each constructor of the record. For example, for</span><span>
</span><span id="line-1357"></span><span>             </span><span class="hs-comment">-- the constructor</span><span>
</span><span id="line-1358"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-1359"></span><span>             </span><span class="hs-comment">--   T1 :: { x :: Int, y :: Bool, z :: Char } -&gt; T p q</span><span>
</span><span id="line-1360"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-1361"></span><span>             </span><span class="hs-comment">-- we let-bind x' = e1, y' = e2 and generate the equation:</span><span>
</span><span id="line-1362"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-1363"></span><span>             </span><span class="hs-comment">--   T1 _ _ z -&gt; T1 x' y' z</span><span>
</span><span id="line-1364"></span><span>             </span><span id="local-6989586621682063957"><span class="annot"><span class="annottext">make_pat :: ConLike -&gt; LMatch GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682063957"><span class="hs-identifier hs-var hs-var">make_pat</span></a></span></span><span> </span><span id="local-6989586621682063958"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063958"><span class="hs-identifier hs-var">conLike</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
-&gt; [LPat GhcRn]
-&gt; LocatedA (HsExpr GhcRn)
-&gt; LMatch GhcRn (LocatedA (HsExpr GhcRn))
forall (p :: Pass) (body :: * -&gt; *).
(Anno (Match (GhcPass p) (LocatedA (body (GhcPass p))))
 ~ SrcSpanAnnA,
 Anno (GRHS (GhcPass p) (LocatedA (body (GhcPass p))))
 ~ SrcAnn NoEpAnns) =&gt;
HsMatchContext (GhcPass p)
-&gt; [LPat (GhcPass p)]
-&gt; LocatedA (body (GhcPass p))
-&gt; LMatch (GhcPass p) (LocatedA (body (GhcPass p)))
</span><a href="GHC.Hs.Utils.html#mkSimpleMatch"><span class="hs-identifier hs-var">mkSimpleMatch</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682063960"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063961"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1365"></span><span>               </span><span class="hs-keyword">where</span><span>
</span><span id="line-1366"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621682063962"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat GhcRn)]
</span><a href="#local-6989586621682063962"><span class="hs-identifier hs-var">lhs_con_pats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063963"><span class="annot"><span class="annottext">[LocatedA (HsExpr GhcRn)]
</span><a href="#local-6989586621682063963"><span class="hs-identifier hs-var">rhs_con_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1367"></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; FieldLabel
 -&gt; (GenLocated SrcSpanAnnA (Pat GhcRn), LocatedA (HsExpr GhcRn)))
-&gt; [Int]
-&gt; [FieldLabel]
-&gt; ([GenLocated SrcSpanAnnA (Pat GhcRn)],
    [LocatedA (HsExpr GhcRn)])
forall a b c d. (a -&gt; b -&gt; (c, d)) -&gt; [a] -&gt; [b] -&gt; ([c], [d])
</span><a href="GHC.Utils.Misc.html#zipWithAndUnzip"><span class="hs-identifier hs-var">zipWithAndUnzip</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; FieldLabel -&gt; (LPat GhcRn, LHsExpr GhcRn)
Int
-&gt; FieldLabel
-&gt; (GenLocated SrcSpanAnnA (Pat GhcRn), LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682063965"><span class="hs-identifier hs-var">mk_con_arg</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682063966"><span class="hs-identifier hs-var">con_fields</span></a></span><span>
</span><span id="line-1368"></span><span>                 </span><span id="local-6989586621682063960"><span class="annot"><span class="annottext">pat :: LPat GhcRn
</span><a href="#local-6989586621682063960"><span class="hs-identifier hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [LPat GhcRn] -&gt; LPat GhcRn
</span><a href="GHC.Rename.Utils.html#genSimpleConPat"><span class="hs-identifier hs-var">genSimpleConPat</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063968"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
[GenLocated SrcSpanAnnA (Pat GhcRn)]
</span><a href="#local-6989586621682063962"><span class="hs-identifier hs-var">lhs_con_pats</span></a></span><span>
</span><span id="line-1369"></span><span>                 </span><span id="local-6989586621682063961"><span class="annot"><span class="annottext">rhs :: LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063961"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; LocatedA (HsExpr GhcRn)
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn -&gt; LocatedA (HsExpr GhcRn))
-&gt; HsExpr GhcRn -&gt; LocatedA (HsExpr GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [LHsExpr GhcRn] -&gt; HsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genHsApps"><span class="hs-identifier hs-var">genHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063968"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcRn]
[LocatedA (HsExpr GhcRn)]
</span><a href="#local-6989586621682063963"><span class="hs-identifier hs-var">rhs_con_args</span></a></span><span>
</span><span id="line-1370"></span><span>                 </span><span id="local-6989586621682063968"><span class="annot"><span class="annottext">con :: Name
</span><a href="#local-6989586621682063968"><span class="hs-identifier hs-var hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Name
</span><a href="GHC.Core.ConLike.html#conLikeName"><span class="hs-identifier hs-var">conLikeName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063958"><span class="hs-identifier hs-var">conLike</span></a></span><span>
</span><span id="line-1371"></span><span>                 </span><span id="local-6989586621682063966"><span class="annot"><span class="annottext">con_fields :: [FieldLabel]
</span><a href="#local-6989586621682063966"><span class="hs-identifier hs-var hs-var">con_fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063958"><span class="hs-identifier hs-var">conLike</span></a></span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span>             </span><span class="annot"><a href="#local-6989586621682063965"><span class="hs-identifier hs-type">mk_con_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1374"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span>
</span><span id="line-1375"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1376"></span><span>                              </span><span class="hs-comment">-- LHS constructor pattern argument</span><span>
</span><span id="line-1377"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1378"></span><span>                              </span><span class="hs-comment">-- RHS constructor argument</span><span>
</span><span id="line-1379"></span><span>             </span><span id="local-6989586621682063965"><span class="annot"><span class="annottext">mk_con_arg :: Int -&gt; FieldLabel -&gt; (LPat GhcRn, LHsExpr GhcRn)
</span><a href="#local-6989586621682063965"><span class="hs-identifier hs-var hs-var">mk_con_arg</span></a></span></span><span> </span><span id="local-6989586621682063971"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063971"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682063972"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682063972"><span class="hs-identifier hs-var">fld_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1380"></span><span>               </span><span class="hs-comment">-- The following generates the pattern matches of the desugared `case` expression.</span><span>
</span><span id="line-1381"></span><span>               </span><span class="hs-comment">-- For fields being updated (for example `x`, `y` in T1 and T4 in Note [Record Updates]),</span><span>
</span><span id="line-1382"></span><span>               </span><span class="hs-comment">-- wildcards are used to avoid creating unused variables.</span><span>
</span><span id="line-1383"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqMap Name (TyCoVar, LocatedA (HsExpr GhcRn))
-&gt; Name -&gt; Maybe (TyCoVar, LocatedA (HsExpr GhcRn))
forall k a. Uniquable k =&gt; UniqMap k a -&gt; k -&gt; Maybe a
</span><a href="GHC.Types.Unique.Map.html#lookupUniqMap"><span class="hs-identifier hs-var">lookupUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap Name (TyCoVar, LHsExpr GhcRn)
UniqMap Name (TyCoVar, LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682063955"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe (TyCoVar, LocatedA (HsExpr GhcRn)))
-&gt; Name -&gt; Maybe (TyCoVar, LocatedA (HsExpr GhcRn))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682063972"><span class="hs-identifier hs-var">fld_lbl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1384"></span><span>                 </span><span class="hs-comment">-- Field is being updated: LHS = wildcard pattern, RHS = appropriate let-bound Id.</span><span>
</span><span id="line-1385"></span><span>                 </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063973"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063973"><span class="hs-identifier hs-var">upd_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="GHC.Rename.Utils.html#genWildPat"><span class="hs-identifier hs-var">genWildPat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genLHsVar"><span class="hs-identifier hs-var">genLHsVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063973"><span class="hs-identifier hs-var">upd_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>                 </span><span class="hs-comment">-- Field is not being updated: LHS = variable pattern, RHS = that same variable.</span><span>
</span><span id="line-1387"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (TyCoVar, LocatedA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682063976"><span class="annot"><span class="annottext">fld_nm :: Name
</span><a href="#local-6989586621682063976"><span class="hs-identifier hs-var hs-var">fld_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Unique
</span><a href="GHC.Builtin.Uniques.html#mkBuiltinUnique"><span class="hs-identifier hs-var">mkBuiltinUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682063971"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; FastString
</span><a href="Language.Haskell.Syntax.Basic.html#field_label"><span class="hs-identifier hs-var">field_label</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; FastString) -&gt; FieldLabelString -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682063972"><span class="hs-identifier hs-var">fld_lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1389"></span><span>                                      </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span>
</span><span id="line-1390"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LPat GhcRn
</span><a href="GHC.Rename.Utils.html#genVarPat"><span class="hs-identifier hs-var">genVarPat</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063976"><span class="hs-identifier hs-var">fld_nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcRn
</span><a href="GHC.Rename.Utils.html#genLHsVar"><span class="hs-identifier hs-var">genLHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682063976"><span class="hs-identifier hs-var">fld_nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span>       </span><span class="hs-comment">-- STEP 4</span><span>
</span><span id="line-1393"></span><span>       </span><span class="hs-comment">-- Desugar to HsCase, as per note [Record Updates]</span><span>
</span><span id="line-1394"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682063982"><span class="hs-identifier hs-type">ds_expr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1395"></span><span>             </span><span id="local-6989586621682063982"><span class="annot"><span class="annottext">ds_expr :: HsExpr GhcRn
</span><a href="#local-6989586621682063982"><span class="hs-identifier hs-var hs-var">ds_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XLet GhcRn
-&gt; LHsToken &quot;let&quot; GhcRn
-&gt; HsLocalBinds GhcRn
-&gt; LHsToken &quot;in&quot; GhcRn
-&gt; LHsExpr GhcRn
-&gt; HsExpr GhcRn
forall p.
XLet p
-&gt; LHsToken &quot;let&quot; p
-&gt; HsLocalBinds p
-&gt; LHsToken &quot;in&quot; p
-&gt; LHsExpr p
-&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLet"><span class="hs-identifier hs-var">HsLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;let&quot; GhcRn
GenLocated TokenLocation (HsToken &quot;let&quot;)
forall (tok :: Symbol). GenLocated TokenLocation (HsToken tok)
</span><a href="GHC.Hs.Extension.html#noHsTok"><span class="hs-identifier hs-var">noHsTok</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621682063984"><span class="hs-identifier hs-var">let_binds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;in&quot; GhcRn
GenLocated TokenLocation (HsToken &quot;in&quot;)
forall (tok :: Symbol). GenLocated TokenLocation (HsToken tok)
</span><a href="GHC.Hs.Extension.html#noHsTok"><span class="hs-identifier hs-var">noHsTok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; HsExpr GhcRn -&gt; LocatedA (HsExpr GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
forall {ann}. SrcAnn ann
</span><a href="#local-6989586621682063985"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063986"><span class="hs-identifier hs-var">case_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1396"></span><span>
</span><span id="line-1397"></span><span>             </span><span class="annot"><a href="#local-6989586621682063986"><span class="hs-identifier hs-type">case_expr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1398"></span><span>             </span><span id="local-6989586621682063986"><span class="annot"><span class="annottext">case_expr :: HsExpr GhcRn
</span><a href="#local-6989586621682063986"><span class="hs-identifier hs-var hs-var">case_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XCase GhcRn
-&gt; LHsExpr GhcRn
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; HsExpr GhcRn
forall p.
XCase p -&gt; LHsExpr p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-var">HsCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCase GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682063844"><span class="hs-identifier hs-var">record_expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin
-&gt; LocatedL [LocatedA (Match GhcRn (LocatedA (HsExpr GhcRn)))]
-&gt; MatchGroup GhcRn (LocatedA (HsExpr GhcRn))
forall (p :: Pass) (body :: * -&gt; *).
AnnoBody p body =&gt;
Origin
-&gt; LocatedL
     [LocatedA (Match (GhcPass p) (LocatedA (body (GhcPass p))))]
-&gt; MatchGroup (GhcPass p) (LocatedA (body (GhcPass p)))
</span><a href="GHC.Hs.Utils.html#mkMatchGroup"><span class="hs-identifier hs-var">mkMatchGroup</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#Generated"><span class="hs-identifier hs-var">Generated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (HsExpr GhcRn)))]
-&gt; LocatedL [LocatedA (Match GhcRn (LocatedA (HsExpr GhcRn)))]
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Rename.Utils.html#wrapGenSpan"><span class="hs-identifier hs-var">wrapGenSpan</span></a></span><span> </span><span class="annot"><span class="annottext">[LMatch GhcRn (LHsExpr GhcRn)]
[LocatedA (Match GhcRn (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063989"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>             </span><span class="annot"><a href="#local-6989586621682063989"><span class="hs-identifier hs-type">matches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1400"></span><span>             </span><span id="local-6989586621682063989"><span class="annot"><span class="annottext">matches :: [LMatch GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621682063989"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConLike -&gt; LocatedA (Match GhcRn (LocatedA (HsExpr GhcRn))))
-&gt; [ConLike] -&gt; [LocatedA (Match GhcRn (LocatedA (HsExpr GhcRn)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; LMatch GhcRn (LHsExpr GhcRn)
ConLike -&gt; LocatedA (Match GhcRn (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682063957"><span class="hs-identifier hs-var">make_pat</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682063897"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span>             </span><span class="annot"><a href="#local-6989586621682063984"><span class="hs-identifier hs-type">let_binds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsLocalBindsLR"><span class="hs-identifier hs-type">HsLocalBindsLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1403"></span><span>             </span><span id="local-6989586621682063984"><span class="annot"><span class="annottext">let_binds :: HsLocalBinds GhcRn
</span><a href="#local-6989586621682063984"><span class="hs-identifier hs-var hs-var">let_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XHsValBinds GhcRn GhcRn
-&gt; HsValBindsLR GhcRn GhcRn -&gt; HsLocalBinds GhcRn
forall idL idR.
XHsValBinds idL idR
-&gt; HsValBindsLR idL idR -&gt; HsLocalBindsLR idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-var">HsValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XHsValBinds GhcRn GhcRn
EpAnn AnnList
forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(HsValBindsLR GhcRn GhcRn -&gt; HsLocalBinds GhcRn)
-&gt; HsValBindsLR GhcRn GhcRn -&gt; HsLocalBinds GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XXValBindsLR GhcRn GhcRn -&gt; HsValBindsLR GhcRn GhcRn
forall idL idR. XXValBindsLR idL idR -&gt; HsValBindsLR idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-var">XValBindsLR</span></a></span><span>
</span><span id="line-1404"></span><span>                       </span><span class="annot"><span class="annottext">(XXValBindsLR GhcRn GhcRn -&gt; HsValBindsLR GhcRn GhcRn)
-&gt; XXValBindsLR GhcRn GhcRn -&gt; HsValBindsLR GhcRn GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)] -&gt; [LSig GhcRn] -&gt; NHsValBindsLR GhcRn
forall idL.
[(RecFlag, LHsBinds idL)] -&gt; [LSig GhcRn] -&gt; NHsValBindsLR idL
</span><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-var">NValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621682063993"><span class="hs-identifier hs-var">upd_ids_lhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, (TyCoVar, LocatedA (HsExpr GhcRn)))
 -&gt; GenLocated SrcSpanAnnA (Sig GhcRn))
-&gt; [(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))]
-&gt; [GenLocated SrcSpanAnnA (Sig GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, (TyCoVar, LHsExpr GhcRn)) -&gt; LSig GhcRn
(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))
-&gt; GenLocated SrcSpanAnnA (Sig GhcRn)
</span><a href="#local-6989586621682063994"><span class="hs-identifier hs-var">mk_idSig</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063953"><span class="hs-identifier hs-var">upd_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1405"></span><span>             </span><span class="annot"><a href="#local-6989586621682063993"><span class="hs-identifier hs-type">upd_ids_lhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBindsLR"><span class="hs-identifier hs-type">LHsBindsLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1406"></span><span>             </span><span id="local-6989586621682063993"><span class="annot"><span class="annottext">upd_ids_lhs :: [(RecFlag, LHsBinds GhcRn)]
</span><a href="#local-6989586621682063993"><span class="hs-identifier hs-var hs-var">upd_ids_lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LHsBind GhcRn -&gt; LHsBinds GhcRn
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsBind GhcRn -&gt; LHsBinds GhcRn)
-&gt; LHsBind GhcRn -&gt; LHsBinds GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [LPat GhcRn] -&gt; LHsExpr GhcRn -&gt; LHsBind GhcRn
</span><a href="GHC.Rename.Utils.html#genSimpleFunBind"><span class="hs-identifier hs-var">genSimpleFunBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063998"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063999"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1407"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682063998"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682063998"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682063999"><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682063999"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, (TyCoVar, LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682063953"><span class="hs-identifier hs-var">upd_ids</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1408"></span><span>             </span><span class="annot"><a href="#local-6989586621682063994"><span class="hs-identifier hs-type">mk_idSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1409"></span><span>             </span><span id="local-6989586621682063994"><span class="annot"><span class="annottext">mk_idSig :: (Name, (TyCoVar, LHsExpr GhcRn)) -&gt; LSig GhcRn
</span><a href="#local-6989586621682063994"><span class="hs-identifier hs-var hs-var">mk_idSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682064000"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064000"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; Sig GhcRn -&gt; GenLocated SrcSpanAnnA (Sig GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
forall {ann}. SrcAnn ann
</span><a href="#local-6989586621682063985"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="annot"><span class="annottext">(Sig GhcRn -&gt; GenLocated SrcSpanAnnA (Sig GhcRn))
-&gt; Sig GhcRn -&gt; GenLocated SrcSpanAnnA (Sig GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XXSig GhcRn -&gt; Sig GhcRn
forall pass. XXSig pass -&gt; Sig pass
</span><a href="Language.Haskell.Syntax.Binds.html#XSig"><span class="hs-identifier hs-var">XSig</span></a></span><span> </span><span class="annot"><span class="annottext">(XXSig GhcRn -&gt; Sig GhcRn) -&gt; XXSig GhcRn -&gt; Sig GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; IdSig
</span><a href="GHC.Hs.Binds.html#IdSig"><span class="hs-identifier hs-var">IdSig</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064000"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1410"></span><span>               </span><span class="hs-comment">-- We let-bind variables using 'IdSig' in order to accept</span><span>
</span><span id="line-1411"></span><span>               </span><span class="hs-comment">-- record updates involving higher-rank types.</span><span>
</span><span id="line-1412"></span><span>               </span><span class="hs-comment">-- See Wrinkle [Using IdSig] in Note [Record Updates].</span><span>
</span><span id="line-1413"></span><span>             </span><span id="local-6989586621682063985"><span class="annot"><span class="annottext">gen :: SrcAnn ann
</span><a href="#local-6989586621682063985"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcAnn ann
forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span>
</span><span id="line-1414"></span><span>
</span><span id="line-1415"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;desugarRecordUpd&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1416"></span><span>            </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;relevant_con:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063901"><span class="hs-identifier hs-var">relevant_con</span></a></span><span>
</span><span id="line-1417"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;res_ty:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682063846"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1418"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_res_ty:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063915"><span class="hs-identifier hs-var">ds_res_ty</span></a></span><span>
</span><span id="line-1419"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-1420"></span><span>
</span><span id="line-1421"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682064005"><span class="annot"><span class="annottext">cons :: SDoc
</span><a href="#local-6989586621682064005"><span class="hs-identifier hs-var hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConLike] -&gt; SDoc
forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682063897"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span>
</span><span id="line-1422"></span><span>              </span><span id="local-6989586621682064007"><span class="annot"><span class="annottext">err_lines :: [SDoc]
</span><a href="#local-6989586621682064007"><span class="hs-identifier hs-var hs-var">err_lines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1423"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In a record update at field&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682063863"><span class="hs-identifier hs-var">upd_fld_names</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682063863"><span class="hs-identifier hs-var">upd_fld_names</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-1424"></span><span>                </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682063901"><span class="hs-identifier hs-var">relevant_con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1425"></span><span>                     </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621682064010"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682064010"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1426"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with type constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682064010"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1427"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;data constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike] -&gt; SDoc
forall a. [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682063897"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064005"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1428"></span><span>                     </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1429"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with pattern synonym&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike] -&gt; SDoc
forall a. [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682063897"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064005"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1430"></span><span>                </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063903"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-1431"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1432"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;existential variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; SDoc
forall a. [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063903"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; SDoc
forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682063903"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1433"></span><span>              </span><span id="local-6989586621682064012"><span class="annot"><span class="annottext">err_ctxt :: SDoc
</span><a href="#local-6989586621682064012"><span class="hs-identifier hs-var hs-var">err_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#make_lines_msg"><span class="hs-identifier hs-var">make_lines_msg</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682064007"><span class="hs-identifier hs-var">err_lines</span></a></span><span>
</span><span id="line-1434"></span><span>
</span><span id="line-1435"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, Type, SDoc) -&gt; TcM (HsExpr GhcRn, Type, SDoc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682063982"><span class="hs-identifier hs-var">ds_expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682063915"><span class="hs-identifier hs-var">ds_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064012"><span class="hs-identifier hs-var">err_ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- | Pretty-print a collection of lines, adding commas at the end of each line,</span><span>
</span><span id="line-1438"></span><span class="hs-comment">-- and adding &quot;and&quot; to the start of the last line.</span><span>
</span><span id="line-1439"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#make_lines_msg"><span class="hs-identifier hs-type">make_lines_msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1440"></span><span id="make_lines_msg"><span class="annot"><span class="annottext">make_lines_msg :: [SDoc] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#make_lines_msg"><span class="hs-identifier hs-var hs-var">make_lines_msg</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1441"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#make_lines_msg"><span class="hs-identifier hs-var">make_lines_msg</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682064015"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064015"><span class="hs-identifier hs-var">last</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064015"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#dot"><span class="hs-identifier hs-var">dot</span></a></span><span>
</span><span id="line-1442"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#make_lines_msg"><span class="hs-identifier hs-var">make_lines_msg</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682064017"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064017"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682064018"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064018"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064017"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064018"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#dot"><span class="hs-identifier hs-var">dot</span></a></span><span>
</span><span id="line-1443"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#make_lines_msg"><span class="hs-identifier hs-var">make_lines_msg</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682064019"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064019"><span class="hs-identifier hs-var">l</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682064020"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682064020"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682064019"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#make_lines_msg"><span class="hs-identifier hs-var">make_lines_msg</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682064020"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Record bindings
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1450"></span><span>
</span><span id="line-1451"></span><span class="hs-comment">-- Disambiguate the fields in a record update.</span><span>
</span><span id="line-1452"></span><span class="hs-comment">-- See Note [Disambiguating record fields] in GHC.Tc.Gen.Head</span><span>
</span><span id="line-1453"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-type">disambiguateRecordBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-1454"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-1455"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsFieldBind"><span class="hs-identifier hs-type">LHsFieldBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LAmbiguousFieldOcc"><span class="hs-identifier hs-type">LAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1456"></span><span id="disambiguateRecordBinds"><span class="annot"><span class="annottext">disambiguateRecordBinds :: LHsExpr GhcRn
-&gt; Type
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM
     [LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-var hs-var">disambiguateRecordBinds</span></a></span></span><span> </span><span id="local-6989586621682064022"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682064022"><span class="hs-identifier hs-var">record_expr</span></a></span></span><span> </span><span id="local-6989586621682064023"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064023"><span class="hs-identifier hs-var">record_rho</span></a></span></span><span> </span><span id="local-6989586621682064024"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span></span><span> </span><span id="local-6989586621682064025"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682064025"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1457"></span><span>    </span><span class="hs-comment">-- Are all the fields unambiguous?</span><span>
</span><span id="line-1458"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))
 -&gt; Maybe
      (GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
            (LocatedA (HsExpr GhcRn))),
       Name))
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn)))]
-&gt; Maybe
     [(GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
            (LocatedA (HsExpr GhcRn))),
       Name)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn -&gt; Maybe (LHsRecUpdField GhcRn, Name)
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
-&gt; Maybe
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
           (LocatedA (HsExpr GhcRn))),
      Name)
</span><a href="#local-6989586621682064026"><span class="hs-identifier hs-var">isUnambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1459"></span><span>                     </span><span class="hs-comment">-- If so, just skip to looking up the Ids</span><span>
</span><span id="line-1460"></span><span>                     </span><span class="hs-comment">-- Always the case if DuplicateRecordFields is off</span><span>
</span><span id="line-1461"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682064027"><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  Name)]
</span><a href="#local-6989586621682064027"><span class="hs-identifier hs-var">rbnds'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  Name)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
            (LocatedA (HsExpr GhcRn)))))
-&gt; [(GenLocated
       SrcSpanAnnA
       (HsFieldBind
          (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
          (LocatedA (HsExpr GhcRn))),
     Name)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn)))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsFieldBind GhcRn (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn))),
 Name)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn))))
</span><a href="#local-6989586621682064028"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  Name)]
</span><a href="#local-6989586621682064027"><span class="hs-identifier hs-var">rbnds'</span></a></span><span>
</span><span id="line-1462"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  [(GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn))),
    Name)]
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- If not, try to identify a single parent</span><span>
</span><span id="line-1463"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682064029"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682064029"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1464"></span><span>             </span><span class="hs-comment">-- Look up the possible parents for each field</span><span>
</span><span id="line-1465"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682064030"><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621682064030"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
IOEnv
  (Env TcGblEnv TcLclEnv)
  [(GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn))),
    [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621682064031"><span class="hs-identifier hs-var">getUpdFieldsParents</span></a></span><span>
</span><span id="line-1466"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682064032"><span class="annot"><span class="annottext">possible_parents :: [[RecSelParent]]
</span><a href="#local-6989586621682064032"><span class="hs-identifier hs-var hs-var">possible_parents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])
 -&gt; [RecSelParent])
-&gt; [(GenLocated
       SrcSpanAnnA
       (HsFieldBind
          (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
          (LocatedA (HsExpr GhcRn))),
     [(RecSelParent, GlobalRdrElt)])]
-&gt; [[RecSelParent]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RecSelParent, GlobalRdrElt) -&gt; RecSelParent)
-&gt; [(RecSelParent, GlobalRdrElt)] -&gt; [RecSelParent]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(RecSelParent, GlobalRdrElt) -&gt; RecSelParent
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(RecSelParent, GlobalRdrElt)] -&gt; [RecSelParent])
-&gt; ((GenLocated
       SrcSpanAnnA
       (HsFieldBind
          (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
          (LocatedA (HsExpr GhcRn))),
     [(RecSelParent, GlobalRdrElt)])
    -&gt; [(RecSelParent, GlobalRdrElt)])
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn))),
    [(RecSelParent, GlobalRdrElt)])
-&gt; [RecSelParent]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn))),
 [(RecSelParent, GlobalRdrElt)])
-&gt; [(RecSelParent, GlobalRdrElt)]
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621682064030"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span><span>
</span><span id="line-1467"></span><span>             </span><span class="hs-comment">-- Identify a single parent</span><span>
</span><span id="line-1468"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682064035"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621682064035"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; [[RecSelParent]] -&gt; TcM RecSelParent
</span><a href="#local-6989586621682064036"><span class="hs-identifier hs-var">identifyParent</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682064029"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621682064032"><span class="hs-identifier hs-var">possible_parents</span></a></span><span>
</span><span id="line-1469"></span><span>             </span><span class="hs-comment">-- Pick the right selector with that parent for each field</span><span>
</span><span id="line-1470"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  [GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn)))]
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))]
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      [GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
            (LocatedA (HsExpr GhcRn)))])
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn)))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
            (LocatedA (HsExpr GhcRn)))))
-&gt; [(GenLocated
       SrcSpanAnnA
       (HsFieldBind
          (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
          (LocatedA (HsExpr GhcRn))),
     [(RecSelParent, GlobalRdrElt)])]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn)))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent
-&gt; (LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; TcM
     (LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621682064038"><span class="hs-identifier hs-var">pickParent</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621682064035"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsFieldBind
       (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
       (LocatedA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621682064030"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1471"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1472"></span><span>    </span><span class="hs-comment">-- Extract the selector name of a field update if it is unambiguous</span><span>
</span><span id="line-1473"></span><span>    </span><span class="annot"><a href="#local-6989586621682064026"><span class="hs-identifier hs-type">isUnambiguous</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1474"></span><span>    </span><span id="local-6989586621682064026"><span class="annot"><span class="annottext">isUnambiguous :: LHsRecUpdField GhcRn -&gt; Maybe (LHsRecUpdField GhcRn, Name)
</span><a href="#local-6989586621682064026"><span class="hs-identifier hs-var hs-var">isUnambiguous</span></a></span></span><span> </span><span id="local-6989586621682064039"><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621682064039"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn)
-&gt; AmbiguousFieldOcc GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn)
forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682064039"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1475"></span><span>                        </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#Unambiguous"><span class="hs-identifier hs-type">Unambiguous</span></a></span><span> </span><span id="local-6989586621682064041"><span class="annot"><span class="annottext">XUnambiguous GhcRn
</span><a href="#local-6989586621682064041"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn RdrName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn))),
 Name)
-&gt; Maybe
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
           (LocatedA (HsExpr GhcRn))),
      Name)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682064039"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XUnambiguous GhcRn
Name
</span><a href="#local-6989586621682064041"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>                        </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#Ambiguous"><span class="hs-identifier hs-type">Ambiguous</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsRecUpdField GhcRn, Name)
Maybe
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
        (LocatedA (HsExpr GhcRn))),
   Name)
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span>    </span><span class="hs-comment">-- Look up the possible parents and selector GREs for each field</span><span>
</span><span id="line-1479"></span><span>    </span><span class="annot"><a href="#local-6989586621682064031"><span class="hs-identifier hs-type">getUpdFieldsParents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1480"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1481"></span><span>    </span><span id="local-6989586621682064031"><span class="annot"><span class="annottext">getUpdFieldsParents :: TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621682064031"><span class="hs-identifier hs-var hs-var">getUpdFieldsParents</span></a></span></span><span>
</span><span id="line-1482"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([[(RecSelParent, GlobalRdrElt)]]
 -&gt; [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
-&gt; TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
-&gt; [[(RecSelParent, GlobalRdrElt)]]
-&gt; [(GenLocated
       SrcSpanAnnA
       (HsFieldBind
          (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
          (LocatedA (HsExpr GhcRn))),
     [(RecSelParent, GlobalRdrElt)])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
 -&gt; TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
-&gt; TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(RecSelParent, GlobalRdrElt)])
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn)))]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span>
</span><span id="line-1483"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
-&gt; RdrName
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(RecSelParent, GlobalRdrElt)]
</span><a href="GHC.Tc.Gen.Head.html#lookupParents"><span class="hs-identifier hs-var">lookupParents</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(RdrName
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(RecSelParent, GlobalRdrElt)])
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn)))
    -&gt; RdrName)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
        (LocatedA (HsExpr GhcRn)))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(RecSelParent, GlobalRdrElt)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan RdrName -&gt; RdrName)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn)))
    -&gt; GenLocated SrcSpan RdrName)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
        (LocatedA (HsExpr GhcRn)))
-&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecUpdField GhcRn -&gt; GenLocated SrcSpan RdrName
HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; GenLocated SrcSpan RdrName
forall (p :: Pass).
HsRecUpdField (GhcPass p) -&gt; GenLocated SrcSpan RdrName
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldRdr"><span class="hs-identifier hs-var">hsRecUpdFieldRdr</span></a></span><span> </span><span class="annot"><span class="annottext">(HsFieldBind
   (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
   (LocatedA (HsExpr GhcRn))
 -&gt; GenLocated SrcSpan RdrName)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn)))
    -&gt; HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn)))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
        (LocatedA (HsExpr GhcRn)))
-&gt; GenLocated SrcSpan RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1484"></span><span>          </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span><span>
</span><span id="line-1485"></span><span>
</span><span id="line-1486"></span><span>    </span><span class="hs-comment">-- Given a the lists of possible parents for each field,</span><span>
</span><span id="line-1487"></span><span>    </span><span class="hs-comment">-- identify a single parent</span><span>
</span><span id="line-1488"></span><span>    </span><span class="annot"><a href="#local-6989586621682064036"><span class="hs-identifier hs-type">identifyParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span>
</span><span id="line-1489"></span><span>    </span><span id="local-6989586621682064036"><span class="annot"><span class="annottext">identifyParent :: FamInstEnvs -&gt; [[RecSelParent]] -&gt; TcM RecSelParent
</span><a href="#local-6989586621682064036"><span class="hs-identifier hs-var hs-var">identifyParent</span></a></span></span><span> </span><span id="local-6989586621682064045"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682064045"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span id="local-6989586621682064046"><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621682064046"><span class="hs-identifier hs-var">possible_parents</span></a></span></span><span>
</span><span id="line-1490"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([RecSelParent] -&gt; [RecSelParent] -&gt; [RecSelParent])
-&gt; [[RecSelParent]] -&gt; [RecSelParent]
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldr1/Data.Foldable.html#foldr1"><span class="hs-identifier hs-var">foldr1</span></a></span><span> </span><span class="annot"><span class="annottext">[RecSelParent] -&gt; [RecSelParent] -&gt; [RecSelParent]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#intersect/Data.OldList.html#intersect"><span class="hs-identifier hs-var">intersect</span></a></span><span> </span><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621682064046"><span class="hs-identifier hs-var">possible_parents</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1491"></span><span>        </span><span class="hs-comment">-- No parents for all fields: record update is ill-typed</span><span>
</span><span id="line-1492"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM RecSelParent
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnNoPossibleParentForFields"><span class="hs-identifier hs-var">TcRnNoPossibleParentForFields</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span>
</span><span id="line-1494"></span><span>        </span><span class="hs-comment">-- Exactly one datatype with all the fields: use that</span><span>
</span><span id="line-1495"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621682064049"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621682064049"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecSelParent -&gt; TcM RecSelParent
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621682064049"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1496"></span><span>
</span><span id="line-1497"></span><span>        </span><span class="hs-comment">-- Multiple possible parents: try harder to disambiguate</span><span>
</span><span id="line-1498"></span><span>        </span><span class="hs-comment">-- Can we get a parent TyCon from the pushed-in type?</span><span>
</span><span id="line-1499"></span><span>        </span><span class="annot"><span class="annottext">RecSelParent
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[RecSelParent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682064050"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064050"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; ExpRhoType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Head.html#tyConOfET"><span class="hs-identifier hs-var">tyConOfET</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682064045"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682064025"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1500"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn ()
</span><a href="#local-6989586621682064052"><span class="hs-identifier hs-var">reportAmbiguousField</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064050"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1501"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">RecSelParent -&gt; TcM RecSelParent
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064050"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1502"></span><span>
</span><span id="line-1503"></span><span>        </span><span class="hs-comment">-- Does the expression being updated have a type signature?</span><span>
</span><span id="line-1504"></span><span>        </span><span class="hs-comment">-- If so, try to extract a parent TyCon from it</span><span>
</span><span id="line-1505"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
</span><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn) -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682064022"><span class="hs-identifier hs-var">record_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1506"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682064054"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064054"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Type -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Head.html#tyConOf"><span class="hs-identifier hs-var">tyConOf</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682064045"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064023"><span class="hs-identifier hs-var">record_rho</span></a></span><span>
</span><span id="line-1507"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn ()
</span><a href="#local-6989586621682064052"><span class="hs-identifier hs-var">reportAmbiguousField</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064054"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1508"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">RecSelParent -&gt; TcM RecSelParent
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064054"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1509"></span><span>
</span><span id="line-1510"></span><span>        </span><span class="hs-comment">-- Nothing else we can try...</span><span>
</span><span id="line-1511"></span><span>        </span><span class="annot"><span class="annottext">[RecSelParent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM RecSelParent
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnBadOverloadedRecordUpdate"><span class="hs-identifier hs-var">TcRnBadOverloadedRecordUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1512"></span><span>
</span><span id="line-1513"></span><span>    </span><span class="hs-comment">-- Make a field unambiguous by choosing the given parent.</span><span>
</span><span id="line-1514"></span><span>    </span><span class="hs-comment">-- Emits an error if the field cannot have that parent,</span><span>
</span><span id="line-1515"></span><span>    </span><span class="hs-comment">-- e.g. if the user writes</span><span>
</span><span id="line-1516"></span><span>    </span><span class="hs-comment">--     r { x = e } :: T</span><span>
</span><span id="line-1517"></span><span>    </span><span class="hs-comment">-- where T does not have field x.</span><span>
</span><span id="line-1518"></span><span>    </span><span class="annot"><a href="#local-6989586621682064038"><span class="hs-identifier hs-type">pickParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span>
</span><span id="line-1519"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1520"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsFieldBind"><span class="hs-identifier hs-type">LHsFieldBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LAmbiguousFieldOcc"><span class="hs-identifier hs-type">LAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1521"></span><span>    </span><span id="local-6989586621682064038"><span class="annot"><span class="annottext">pickParent :: RecSelParent
-&gt; (LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; TcM
     (LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621682064038"><span class="hs-identifier hs-var hs-var">pickParent</span></a></span></span><span> </span><span id="local-6989586621682064057"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621682064057"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682064058"><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621682064058"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682064059"><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621682064059"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1522"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecSelParent
-&gt; [(RecSelParent, GlobalRdrElt)] -&gt; Maybe GlobalRdrElt
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.18.3.0/src/GHC.List.html#lookup/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621682064057"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621682064059"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1523"></span><span>                      </span><span class="hs-comment">-- Phew! The parent is valid for this field.</span><span>
</span><span id="line-1524"></span><span>                      </span><span class="hs-comment">-- Previously ambiguous fields must be marked as</span><span>
</span><span id="line-1525"></span><span>                      </span><span class="hs-comment">-- used now that we know which one is meant, but</span><span>
</span><span id="line-1526"></span><span>                      </span><span class="hs-comment">-- unambiguous ones shouldn't be recorded again</span><span>
</span><span id="line-1527"></span><span>                      </span><span class="hs-comment">-- (giving duplicate deprecation warnings).</span><span>
</span><span id="line-1528"></span><span>          </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682064061"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621682064061"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#unless/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)] -&gt; [(RecSelParent, GlobalRdrElt)]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#tail/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621682064059"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1529"></span><span>                             </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682064063"><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064063"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn)
forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682064058"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1530"></span><span>                             </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns -&gt; TcRn () -&gt; TcRn ()
forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064063"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GlobalRdrElt -&gt; TcRn ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var">addUsedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621682064061"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1531"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsFieldBind GhcRn (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621682064028"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621682064058"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greMangledName"><span class="hs-identifier hs-var">greMangledName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621682064061"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1532"></span><span>                      </span><span class="hs-comment">-- The field doesn't belong to this parent, so report</span><span>
</span><span id="line-1533"></span><span>                      </span><span class="hs-comment">-- an error but keep going through all the fields</span><span>
</span><span id="line-1534"></span><span>          </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent -&gt; RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Head.html#fieldNotInType"><span class="hs-identifier hs-var">fieldNotInType</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621682064057"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1535"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpan RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecUpdField GhcRn -&gt; GenLocated SrcSpan RdrName
forall (p :: Pass).
HsRecUpdField (GhcPass p) -&gt; GenLocated SrcSpan RdrName
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldRdr"><span class="hs-identifier hs-var">hsRecUpdFieldRdr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
</span><a href="#local-6989586621682064058"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1536"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsFieldBind GhcRn (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621682064028"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621682064058"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greMangledName"><span class="hs-identifier hs-var">greMangledName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RecSelParent, GlobalRdrElt) -&gt; GlobalRdrElt
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)] -&gt; (RecSelParent, GlobalRdrElt)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621682064059"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1537"></span><span>
</span><span id="line-1538"></span><span>    </span><span class="hs-comment">-- Given a (field update, selector name) pair, look up the</span><span>
</span><span id="line-1539"></span><span>    </span><span class="hs-comment">-- selector to give a field update with an unambiguous Id</span><span>
</span><span id="line-1540"></span><span>    </span><span class="annot"><a href="#local-6989586621682064028"><span class="hs-identifier hs-type">lookupSelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1541"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsFieldBind"><span class="hs-identifier hs-type">LHsFieldBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LAmbiguousFieldOcc"><span class="hs-identifier hs-type">LAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1542"></span><span>    </span><span id="local-6989586621682064028"><span class="annot"><span class="annottext">lookupSelector :: (LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsFieldBind GhcRn (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621682064028"><span class="hs-identifier hs-var hs-var">lookupSelector</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682064067"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682064067"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682064068"><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064068"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682064069"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064069"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1543"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682064070"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064070"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCoVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064069"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1544"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682064072"><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064072"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682064073"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621682064073"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn)
forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064068"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1545"></span><span>                 </span><span id="local-6989586621682064074"><span class="annot"><span class="annottext">lbl :: RdrName
</span><a href="#local-6989586621682064074"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn -&gt; RdrName
forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621682064073"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-1546"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated
         SrcSpanAnnA
         (HsFieldBind
            (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
            (LocatedA (HsExpr GhcRn)))))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
           (LocatedA (HsExpr GhcRn))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682064067"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span>
</span><span id="line-1547"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hfbAnn :: XHsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
</span><a href="Language.Haskell.Syntax.Pat.html#hfbAnn"><span class="hs-identifier hs-var">hfbAnn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; XHsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
forall lhs rhs. HsFieldBind lhs rhs -&gt; XHsFieldBind lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbAnn"><span class="hs-identifier hs-var">hfbAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064068"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1548"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbLHS :: GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span>
</span><span id="line-1549"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
-&gt; AmbiguousFieldOcc GhcTc
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcAnn NoEpAnns -&gt; SrcAnn NoEpAnns
forall a ann. SrcSpanAnn' a -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064072"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnambiguous GhcTc -&gt; XRec GhcTc RdrName -&gt; AmbiguousFieldOcc GhcTc
forall pass.
XUnambiguous pass -&gt; XRec pass RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">XUnambiguous GhcTc
TyCoVar
</span><a href="#local-6989586621682064070"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; RdrName -&gt; GenLocated SrcSpanAnnN RdrName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcAnn NoEpAnns -&gt; SrcSpanAnnN
forall a ann. SrcSpanAnn' a -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064072"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682064074"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbRHS :: LocatedA (HsExpr GhcRn)
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; LocatedA (HsExpr GhcRn)
forall lhs rhs. HsFieldBind lhs rhs -&gt; rhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064068"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1551"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbPun :: Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hfbPun"><span class="hs-identifier hs-var">hfbPun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; Bool
forall lhs rhs. HsFieldBind lhs rhs -&gt; Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hfbPun"><span class="hs-identifier hs-var">hfbPun</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064068"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1552"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-1553"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1554"></span><span>
</span><span id="line-1555"></span><span>    </span><span class="hs-comment">-- See Note [Deprecating ambiguous fields] in GHC.Tc.Gen.Head</span><span>
</span><span id="line-1556"></span><span>    </span><span class="annot"><a href="#local-6989586621682064052"><span class="hs-identifier hs-type">reportAmbiguousField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1557"></span><span>    </span><span id="local-6989586621682064052"><span class="annot"><span class="annottext">reportAmbiguousField :: TyCon -&gt; TcRn ()
</span><a href="#local-6989586621682064052"><span class="hs-identifier hs-var hs-var">reportAmbiguousField</span></a></span></span><span> </span><span id="local-6989586621682064079"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064079"><span class="hs-identifier hs-var">parent_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1558"></span><span>        </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682064080"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">addDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TyCon -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnAmbiguousField"><span class="hs-identifier hs-var">TcRnAmbiguousField</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682064083"><span class="hs-identifier hs-var">rupd</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064079"><span class="hs-identifier hs-var">parent_type</span></a></span><span>
</span><span id="line-1559"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1560"></span><span>        </span><span id="local-6989586621682064083"><span class="annot"><span class="annottext">rupd :: HsExpr GhcRn
</span><a href="#local-6989586621682064083"><span class="hs-identifier hs-var hs-var">rupd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: LHsExpr GhcRn
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682064022"><span class="hs-identifier hs-var">record_expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: Either [LHsRecUpdField GhcRn] [LHsRecUpdProj GhcRn]
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
-&gt; Either
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
           (LocatedA (HsExpr GhcRn)))]
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (FieldLabelStrings GhcRn))
           (LocatedA (HsExpr GhcRn)))]
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_ext :: XRecordUpd GhcRn
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_ext"><span class="hs-identifier hs-var">rupd_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRecordUpd GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1561"></span><span>        </span><span id="local-6989586621682064080"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621682064080"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
-&gt; SrcSpan
forall a e. GenLocated (SrcSpanAnn' a) e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
        (LocatedA (HsExpr GhcRn)))
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682064024"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1562"></span><span>
</span><span id="line-1563"></span><span class="hs-comment">{-
Game plan for record bindings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Find the TyCon for the bindings, from the first field label.

2. Instantiate its tyvars and unify (T a1 .. an) with expected_ty.

For each binding field = value

3. Instantiate the field type (from the field label) using the type
   envt from step 2.

4  Type check the value using tcCheckPolyExprNC (in tcRecordField),
   passing the field type as the expected argument type.

This extends OK when the field types are universally quantified.
-}</span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-type">tcRecordBinds</span></a></span><span>
</span><span id="line-1582"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1583"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Expected type for each field</span><span>
</span><span id="line-1584"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1585"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1586"></span><span>
</span><span id="line-1587"></span><span id="tcRecordBinds"><span class="annot"><span class="annottext">tcRecordBinds :: ConLike
-&gt; [Type] -&gt; HsRecordBinds GhcRn -&gt; TcM (HsRecordBinds GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-var hs-var">tcRecordBinds</span></a></span></span><span> </span><span id="local-6989586621682064086"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064086"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621682064087"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682064087"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span id="local-6989586621682064089"><span class="annot"><span class="annottext">[LHsRecField GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621682064089"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621682064090"><span class="annot"><span class="annottext">Maybe (XRec GhcRn RecFieldsDotDot)
</span><a href="#local-6989586621682064090"><span class="hs-identifier hs-var">dd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682064091"><span class="annot"><span class="annottext">[Maybe
   (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
         (GenLocated SrcSpanAnnA (HsExpr GhcTc))))]
</span><a href="#local-6989586621682064091"><span class="hs-identifier hs-var">mb_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Maybe
         (GenLocated
            SrcSpanAnnA
            (HsFieldBind
               (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
               (GenLocated SrcSpanAnnA (HsExpr GhcTc))))))
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
         (LocatedA (HsExpr GhcRn)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [Maybe
        (GenLocated
           SrcSpanAnnA
           (HsFieldBind
              (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
              (GenLocated SrcSpanAnnA (HsExpr GhcTc))))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField GhcRn (LHsExpr GhcRn)
-&gt; TcM (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
     (LocatedA (HsExpr GhcRn)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe
        (GenLocated
           SrcSpanAnnA
           (HsFieldBind
              (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
              (GenLocated SrcSpanAnnA (HsExpr GhcTc)))))
</span><a href="#local-6989586621682064092"><span class="hs-identifier hs-var">do_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField GhcRn (LHsExpr GhcRn)]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682064089"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1589"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsRecFields GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsRecFields GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecField GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))]
-&gt; Maybe (XRec GhcTc RecFieldsDotDot)
-&gt; HsRecFields GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall p arg.
[LHsRecField p arg]
-&gt; Maybe (XRec p RecFieldsDotDot) -&gt; HsRecFields p arg
</span><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-var">HsRecFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe
   (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
         (GenLocated SrcSpanAnnA (HsExpr GhcTc))))]
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
         (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#catMaybes/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe
   (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
         (GenLocated SrcSpanAnnA (HsExpr GhcTc))))]
</span><a href="#local-6989586621682064091"><span class="hs-identifier hs-var">mb_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (XRec GhcRn RecFieldsDotDot)
Maybe (XRec GhcTc RecFieldsDotDot)
</span><a href="#local-6989586621682064090"><span class="hs-identifier hs-var">dd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1590"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1591"></span><span>    </span><span id="local-6989586621682064094"><span class="annot"><span class="annottext">fields :: [Name]
</span><a href="#local-6989586621682064094"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLabel] -&gt; [Name]) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064086"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1592"></span><span>    </span><span id="local-6989586621682064095"><span class="annot"><span class="annottext">flds_w_tys :: [(Name, Type)]
</span><a href="#local-6989586621682064095"><span class="hs-identifier hs-var hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Name] -&gt; [Type] -&gt; [(Name, Type)]
forall a b. (() :: Constraint) =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordBinds&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682064094"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682064087"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1593"></span><span>
</span><span id="line-1594"></span><span>    </span><span class="annot"><a href="#local-6989586621682064092"><span class="hs-identifier hs-type">do_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1595"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span>    </span><span id="local-6989586621682064092"><span class="annot"><span class="annottext">do_bind :: LHsRecField GhcRn (LHsExpr GhcRn)
-&gt; TcM (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
</span><a href="#local-6989586621682064092"><span class="hs-identifier hs-var hs-var">do_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682064097"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682064097"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682064098"><span class="annot"><span class="annottext">fld :: HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064098"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hfbLHS :: forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682064099"><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn)
</span><a href="#local-6989586621682064099"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-1597"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbRHS :: forall lhs rhs. HsFieldBind lhs rhs -&gt; rhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682064100"><span class="annot"><span class="annottext">LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682064100"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1598"></span><span>
</span><span id="line-1599"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682064101"><span class="annot"><span class="annottext">Maybe
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
   GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682064101"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [(Name, Type)]
-&gt; LFieldOcc GhcRn
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var">tcRecordField</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064086"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621682064095"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">LFieldOcc GhcRn
GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn)
</span><a href="#local-6989586621682064099"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
LocatedA (HsExpr GhcRn)
</span><a href="#local-6989586621682064100"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1600"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
   GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682064101"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1601"></span><span>               </span><span class="annot"><span class="annottext">Maybe
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
   GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
        (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe
        (GenLocated
           SrcSpanAnnA
           (HsFieldBind
              (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
              (GenLocated SrcSpanAnnA (HsExpr GhcTc)))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
        (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1602"></span><span>               </span><span class="hs-comment">-- Just (f', rhs') -&gt; return (Just (L l (fld { hfbLHS = f'</span><span>
</span><span id="line-1603"></span><span>               </span><span class="hs-comment">--                                            , hfbRHS = rhs' }))) }</span><span>
</span><span id="line-1604"></span><span>               </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682064103"><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc)
</span><a href="#local-6989586621682064103"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682064104"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682064104"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
        (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe
        (GenLocated
           SrcSpanAnnA
           (HsFieldBind
              (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
              (GenLocated SrcSpanAnnA (HsExpr GhcTc)))))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
     (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; Maybe
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
           (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
     (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
        (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682064097"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span>
</span><span id="line-1605"></span><span>                                                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hfbAnn :: XHsFieldBind (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc))
</span><a href="Language.Haskell.Syntax.Pat.html#hfbAnn"><span class="hs-identifier hs-var">hfbAnn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; XHsFieldBind (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
forall lhs rhs. HsFieldBind lhs rhs -&gt; XHsFieldBind lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbAnn"><span class="hs-identifier hs-var">hfbAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064098"><span class="hs-identifier hs-var">fld</span></a></span><span>
</span><span id="line-1606"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbLHS :: GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc)
</span><a href="#local-6989586621682064103"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-1607"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbRHS :: GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682064104"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-1608"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbPun :: Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hfbPun"><span class="hs-identifier hs-var">hfbPun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
-&gt; Bool
forall lhs rhs. HsFieldBind lhs rhs -&gt; Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hfbPun"><span class="hs-identifier hs-var">hfbPun</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcRn))
  (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064098"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1609"></span><span>
</span><span id="line-1610"></span><span>
</span><span id="line-1611"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-type">tcRecordField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#Assoc"><span class="hs-identifier hs-type">Assoc</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1612"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1613"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1614"></span><span id="tcRecordField"><span class="annot"><span class="annottext">tcRecordField :: ConLike
-&gt; [(Name, Type)]
-&gt; LFieldOcc GhcRn
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var hs-var">tcRecordField</span></a></span></span><span> </span><span id="local-6989586621682064105"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064105"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621682064106"><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621682064106"><span class="hs-identifier hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682064107"><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064107"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span id="local-6989586621682064109"><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621682064109"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span id="local-6989586621682064110"><span class="annot"><span class="annottext">XRec GhcRn RdrName
</span><a href="#local-6989586621682064110"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682064111"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682064111"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-1615"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682064112"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064112"><span class="hs-identifier hs-var">field_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, Type)] -&gt; Name -&gt; Maybe Type
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621682064106"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
Name
</span><a href="#local-6989586621682064109"><span class="hs-identifier hs-var">sel_name</span></a></span><span>
</span><span id="line-1616"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-var">fieldCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064115"><span class="hs-identifier hs-var">field_lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
 -&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)))
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1617"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682064116"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682064116"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682064111"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064112"><span class="hs-identifier hs-var">field_ty</span></a></span><span>
</span><span id="line-1618"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; HsExpr GhcTc -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRRecordCon"><span class="hs-identifier hs-var">FRRRecordCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn RdrName
GenLocated SrcSpanAnnN RdrName
</span><a href="#local-6989586621682064110"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682064116"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1619"></span><span>                </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064112"><span class="hs-identifier hs-var">field_ty</span></a></span><span>
</span><span id="line-1620"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682064118"><span class="annot"><span class="annottext">field_id :: TyCoVar
</span><a href="#local-6989586621682064118"><span class="hs-identifier hs-var hs-var">field_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Unique -&gt; Type -&gt; Type -&gt; SrcSpan -&gt; TyCoVar
</span><a href="GHC.Types.Id.html#mkUserLocal"><span class="hs-identifier hs-var">mkUserLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
Name
</span><a href="#local-6989586621682064109"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1621"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
</span><a href="GHC.Types.Name.html#nameUnique"><span class="hs-identifier hs-var">nameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
Name
</span><a href="#local-6989586621682064109"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span>                                        </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064112"><span class="hs-identifier hs-var">field_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcAnn NoEpAnns -&gt; SrcSpan
forall a. SrcSpanAnn' a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064107"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1623"></span><span>                </span><span class="hs-comment">-- Yuk: the field_id has the *unique* of the selector Id</span><span>
</span><span id="line-1624"></span><span>                </span><span class="hs-comment">--          (so we can find it easily)</span><span>
</span><span id="line-1625"></span><span>                </span><span class="hs-comment">--      but is a LocalId with the appropriate type of the RHS</span><span>
</span><span id="line-1626"></span><span>                </span><span class="hs-comment">--          (so the desugarer knows the type of local binder to make)</span><span>
</span><span id="line-1627"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
   GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe
        (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
         GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
 GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; Maybe
     (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
      GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
-&gt; FieldOcc GhcTc -&gt; GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><a href="#local-6989586621682064107"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCFieldOcc GhcTc -&gt; XRec GhcTc RdrName -&gt; FieldOcc GhcTc
forall pass. XCFieldOcc pass -&gt; XRec pass RdrName -&gt; FieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcTc
TyCoVar
</span><a href="#local-6989586621682064118"><span class="hs-identifier hs-var">field_id</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn RdrName
XRec GhcTc RdrName
</span><a href="#local-6989586621682064110"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682064116"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1628"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1629"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FieldLabelString -&gt; TcRnMessage
</span><a href="GHC.Rename.Utils.html#badFieldConErr"><span class="hs-identifier hs-var">badFieldConErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064105"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064115"><span class="hs-identifier hs-var">field_lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1630"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
   GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe
        (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
         GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (GenLocated (SrcAnn NoEpAnns) (FieldOcc GhcTc),
   GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1631"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1632"></span><span>        </span><span id="local-6989586621682064115"><span class="annot"><span class="annottext">field_lbl :: FieldLabelString
</span><a href="#local-6989586621682064115"><span class="hs-identifier hs-var hs-var">field_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-var">FieldLabelString</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; FieldLabelString) -&gt; FastString -&gt; FieldLabelString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString) -&gt; OccName -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn RdrName
GenLocated SrcSpanAnnN RdrName
</span><a href="#local-6989586621682064110"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1633"></span><span>
</span><span id="line-1634"></span><span>
</span><span id="line-1635"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-type">checkMissingFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1636"></span><span id="checkMissingFields"><span class="annot"><span class="annottext">checkMissingFields :: ConLike -&gt; HsRecordBinds GhcRn -&gt; [Scaled Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-var hs-var">checkMissingFields</span></a></span></span><span> </span><span id="local-6989586621682064125"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064125"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621682064126"><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621682064126"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621682064127"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682064127"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>
</span><span id="line-1637"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[FieldLabel] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682064128"><span class="hs-identifier hs-var">field_labels</span></a></span><span>   </span><span class="hs-comment">-- Not declared as a record;</span><span>
</span><span id="line-1638"></span><span>                        </span><span class="hs-comment">-- But C{} is still valid if no strict fields</span><span>
</span><span id="line-1639"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(HsImplBang -&gt; Bool) -&gt; [HsImplBang] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621682064131"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-comment">-- Illegal if any arg is strict</span><span>
</span><span id="line-1641"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, Type)] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingStrictFields"><span class="hs-identifier hs-var">TcRnMissingStrictFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064125"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1642"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1643"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsImplBang] -&gt; Bool
forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621682064131"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[FieldLabel] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682064128"><span class="hs-identifier hs-var">field_labels</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1644"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682064135"><span class="annot"><span class="annottext">msg :: TcRnMessage
</span><a href="#local-6989586621682064135"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, Type)] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingFields"><span class="hs-identifier hs-var">TcRnMissingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064125"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1645"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#diagnosticTc"><span class="hs-identifier hs-var">diagnosticTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682064135"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>              </span><span class="hs-comment">-- A record</span><span>
</span><span id="line-1648"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#unless/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, Type)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064138"><span class="hs-identifier hs-var">missing_s_fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1649"></span><span>        </span><span id="local-6989586621682064139"><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064139"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(FieldLabelString, Type)]
forall {t :: * -&gt; *} {a}.
Traversable t =&gt;
t (a, Type) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, Type))
</span><a href="#local-6989586621682064140"><span class="hs-identifier hs-var">zonk_fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064138"><span class="hs-identifier hs-var">missing_s_fields</span></a></span><span>
</span><span id="line-1650"></span><span>        </span><span class="hs-comment">-- It is an error to omit a strict field, because</span><span>
</span><span id="line-1651"></span><span>        </span><span class="hs-comment">-- we can't substitute it with (error &quot;Missing field f&quot;)</span><span>
</span><span id="line-1652"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, Type)] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingStrictFields"><span class="hs-identifier hs-var">TcRnMissingStrictFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064125"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064139"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1653"></span><span>
</span><span id="line-1654"></span><span>    </span><span id="local-6989586621682064141"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682064141"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span>
</span><span id="line-1655"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682064141"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)] -&gt; Bool
forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064144"><span class="hs-identifier hs-var">missing_ns_fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1656"></span><span>        </span><span id="local-6989586621682064145"><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064145"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(FieldLabelString, Type)]
forall {t :: * -&gt; *} {a}.
Traversable t =&gt;
t (a, Type) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, Type))
</span><a href="#local-6989586621682064140"><span class="hs-identifier hs-var">zonk_fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064144"><span class="hs-identifier hs-var">missing_ns_fields</span></a></span><span>
</span><span id="line-1657"></span><span>        </span><span class="hs-comment">-- It is not an error (though we may want) to omit a</span><span>
</span><span id="line-1658"></span><span>        </span><span class="hs-comment">-- lazy field, because we can always use</span><span>
</span><span id="line-1659"></span><span>        </span><span class="hs-comment">-- (error &quot;Missing field f&quot;) instead.</span><span>
</span><span id="line-1660"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682064146"><span class="annot"><span class="annottext">msg :: TcRnMessage
</span><a href="#local-6989586621682064146"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, Type)] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingFields"><span class="hs-identifier hs-var">TcRnMissingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064125"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, Type)]
</span><a href="#local-6989586621682064145"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1661"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#diagnosticTc"><span class="hs-identifier hs-var">diagnosticTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682064146"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1662"></span><span>
</span><span id="line-1663"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1664"></span><span>    </span><span class="hs-comment">-- we zonk the fields to get better types in error messages (#18869)</span><span>
</span><span id="line-1665"></span><span>    </span><span id="local-6989586621682064140"><span class="annot"><span class="annottext">zonk_fields :: t (a, Type) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, Type))
</span><a href="#local-6989586621682064140"><span class="hs-identifier hs-var hs-var">zonk_fields</span></a></span></span><span> </span><span id="local-6989586621682064158"><span class="annot"><span class="annottext">t (a, Type)
</span><a href="#local-6989586621682064158"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t (a, Type)
-&gt; ((a, Type) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, Type))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, Type))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#forM/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">t (a, Type)
</span><a href="#local-6989586621682064158"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">(((a, Type) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, Type))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, Type)))
-&gt; ((a, Type) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, Type))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682064160"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682064160"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682064161"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064161"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1666"></span><span>        </span><span id="local-6989586621682064162"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064162"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064161"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1667"></span><span>        </span><span class="annot"><span class="annottext">(a, Type) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682064160"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682064162"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1668"></span><span>    </span><span id="local-6989586621682064138"><span class="annot"><span class="annottext">missing_s_fields :: [(FieldLabelString, Type)]
</span><a href="#local-6989586621682064138"><span class="hs-identifier hs-var hs-var">missing_s_fields</span></a></span></span><span>
</span><span id="line-1669"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064164"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682064165"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682064164"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064164"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682064166"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621682064166"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682064165"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682064165"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabel, HsImplBang, Scaled Type)]
</span><a href="#local-6989586621682064167"><span class="hs-identifier hs-var">field_info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1670"></span><span>                 </span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621682064166"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1671"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064164"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; [Name] -&gt; Bool
forall {t :: * -&gt; *}. Foldable t =&gt; FieldLabel -&gt; t Name -&gt; Bool
</span><a href="#local-6989586621682064168"><span class="hs-operator hs-var">`elemField`</span></a></span><span> </span><span class="annot"><span class="annottext">[XCFieldOcc GhcRn]
[Name]
</span><a href="#local-6989586621682064169"><span class="hs-identifier hs-var">field_names_used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1672"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1673"></span><span>    </span><span id="local-6989586621682064144"><span class="annot"><span class="annottext">missing_ns_fields :: [(FieldLabelString, Type)]
</span><a href="#local-6989586621682064144"><span class="hs-identifier hs-var hs-var">missing_ns_fields</span></a></span></span><span>
</span><span id="line-1674"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064170"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682064171"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682064170"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064170"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682064172"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621682064172"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682064171"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682064171"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabel, HsImplBang, Scaled Type)]
</span><a href="#local-6989586621682064167"><span class="hs-identifier hs-var">field_info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1675"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621682064172"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1676"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064170"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; [Name] -&gt; Bool
forall {t :: * -&gt; *}. Foldable t =&gt; FieldLabel -&gt; t Name -&gt; Bool
</span><a href="#local-6989586621682064168"><span class="hs-operator hs-var">`elemField`</span></a></span><span> </span><span class="annot"><span class="annottext">[XCFieldOcc GhcRn]
[Name]
</span><a href="#local-6989586621682064169"><span class="hs-identifier hs-var">field_names_used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span>    </span><span id="local-6989586621682064169"><span class="annot"><span class="annottext">field_names_used :: [XCFieldOcc GhcRn]
</span><a href="#local-6989586621682064169"><span class="hs-identifier hs-var hs-var">field_names_used</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecFields GhcRn (LocatedA (HsExpr GhcRn)) -&gt; [XCFieldOcc GhcRn]
forall p arg. UnXRec p =&gt; HsRecFields p arg -&gt; [XCFieldOcc p]
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFields"><span class="hs-identifier hs-var">hsRecFields</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
HsRecFields GhcRn (LocatedA (HsExpr GhcRn))
</span><a href="#local-6989586621682064126"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1680"></span><span>    </span><span id="local-6989586621682064128"><span class="annot"><span class="annottext">field_labels :: [FieldLabel]
</span><a href="#local-6989586621682064128"><span class="hs-identifier hs-var hs-var">field_labels</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064125"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1681"></span><span>
</span><span id="line-1682"></span><span>    </span><span id="local-6989586621682064167"><span class="annot"><span class="annottext">field_info :: [(FieldLabel, HsImplBang, Scaled Type)]
</span><a href="#local-6989586621682064167"><span class="hs-identifier hs-var hs-var">field_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
-&gt; [HsImplBang]
-&gt; [Scaled Type]
-&gt; [(FieldLabel, HsImplBang, Scaled Type)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip3/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682064128"><span class="hs-identifier hs-var">field_labels</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621682064131"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682064127"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1683"></span><span>
</span><span id="line-1684"></span><span>    </span><span id="local-6989586621682064131"><span class="annot"><span class="annottext">field_strs :: [HsImplBang]
</span><a href="#local-6989586621682064131"><span class="hs-identifier hs-var hs-var">field_strs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [HsImplBang]
</span><a href="GHC.Core.ConLike.html#conLikeImplBangs"><span class="hs-identifier hs-var">conLikeImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682064125"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1685"></span><span>
</span><span id="line-1686"></span><span>    </span><span id="local-6989586621682064179"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064179"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span id="local-6989586621682064168"><span class="annot"><span class="annottext">elemField :: FieldLabel -&gt; t Name -&gt; Bool
</span><a href="#local-6989586621682064168"><span class="hs-operator hs-var hs-var">`elemField`</span></a></span></span><span> </span><span id="local-6989586621682064180"><span class="annot"><span class="annottext">t Name
</span><a href="#local-6989586621682064180"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; t Name -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682064181"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064181"><span class="hs-identifier hs-var">fl'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682064179"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064181"><span class="hs-identifier hs-var">fl'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t Name
</span><a href="#local-6989586621682064180"><span class="hs-identifier hs-var">flds</span></a></span><span>
</span><span id="line-1687"></span><span>
</span><span id="line-1688"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Errors and contexts}
*                                                                      *
************************************************************************

Boring and alphabetical:
-}</span><span>
</span><span id="line-1697"></span><span>
</span><span id="line-1698"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-type">fieldCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1699"></span><span id="fieldCtxt"><span class="annot"><span class="annottext">fieldCtxt :: FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-var hs-var">fieldCtxt</span></a></span></span><span> </span><span id="local-6989586621682064182"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064182"><span class="hs-identifier hs-var">field_name</span></a></span></span><span>
</span><span id="line-1700"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064182"><span class="hs-identifier hs-var">field_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;field of a record&quot;</span></span><span>
</span><span id="line-1701"></span><span>
</span><span id="line-1702"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-type">badFieldsUpd</span></a></span><span>
</span><span id="line-1703"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsFieldBind"><span class="hs-identifier hs-type">LHsFieldBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LAmbiguousFieldOcc"><span class="hs-identifier hs-type">LAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1704"></span><span>               </span><span class="hs-comment">-- Field names that don't belong to a single datacon</span><span>
</span><span id="line-1705"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Data cons of the type which the first field name belongs to</span><span>
</span><span id="line-1706"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-1707"></span><span id="badFieldsUpd"><span class="annot"><span class="annottext">badFieldsUpd :: [LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [ConLike] -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-var hs-var">badFieldsUpd</span></a></span></span><span> </span><span id="local-6989586621682064183"><span class="annot"><span class="annottext">[LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621682064183"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621682064184"><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682064184"><span class="hs-identifier hs-var">data_cons</span></a></span></span><span>
</span><span id="line-1708"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnNoConstructorHasAllFields"><span class="hs-identifier hs-var">TcRnNoConstructorHasAllFields</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621682064186"><span class="hs-identifier hs-var">conflictingFields</span></a></span><span>
</span><span id="line-1709"></span><span>          </span><span class="hs-comment">-- See Note [Finding the conflicting fields]</span><span>
</span><span id="line-1710"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1711"></span><span>    </span><span class="hs-comment">-- A (preferably small) set of fields such that no constructor contains</span><span>
</span><span id="line-1712"></span><span>    </span><span class="hs-comment">-- all of them.  See Note [Finding the conflicting fields]</span><span>
</span><span id="line-1713"></span><span>    </span><span id="local-6989586621682064186"><span class="annot"><span class="annottext">conflictingFields :: [FieldLabelString]
</span><a href="#local-6989586621682064186"><span class="hs-identifier hs-var hs-var">conflictingFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064192"><span class="hs-identifier hs-var">nonMembers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1714"></span><span>        </span><span class="hs-comment">-- nonMember belongs to a different type.</span><span>
</span><span id="line-1715"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682064193"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064193"><span class="hs-identifier hs-var">nonMember</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064194"><span class="hs-identifier hs-var">aMember</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064193"><span class="hs-identifier hs-var">nonMember</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1716"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1717"></span><span>            </span><span class="hs-comment">-- All of rbinds belong to one type. In this case, repeatedly add</span><span>
</span><span id="line-1718"></span><span>            </span><span class="hs-comment">-- a field to the set until no constructor contains the set.</span><span>
</span><span id="line-1719"></span><span>
</span><span id="line-1720"></span><span>            </span><span class="hs-comment">-- Each field, together with a list indicating which constructors</span><span>
</span><span id="line-1721"></span><span>            </span><span class="hs-comment">-- have all the fields so far.</span><span>
</span><span id="line-1722"></span><span>            </span><span class="annot"><a href="#local-6989586621682064195"><span class="hs-identifier hs-type">growingSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1723"></span><span>            </span><span id="local-6989586621682064195"><span class="annot"><span class="annottext">growingSets :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064195"><span class="hs-identifier hs-var hs-var">growingSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool])
 -&gt; (FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool]))
-&gt; [(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#scanl1/GHC.List.html#scanl1"><span class="hs-identifier hs-var">scanl1</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool])
-&gt; (FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool])
forall {a} {a}. (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621682064197"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064198"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-1724"></span><span>            </span><span id="local-6989586621682064197"><span class="annot"><span class="annottext">combine :: (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621682064197"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682064199"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682064199"><span class="hs-identifier hs-var">setMem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682064200"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682064200"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682064201"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682064201"><span class="hs-identifier hs-var">fldMem</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1725"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682064200"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; [Bool] -&gt; [Bool] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(&amp;&amp;)</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682064199"><span class="hs-identifier hs-var">setMem</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682064201"><span class="hs-identifier hs-var">fldMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1726"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-1727"></span><span>            </span><span class="hs-comment">-- Fields that don't change the membership status of the set</span><span>
</span><span id="line-1728"></span><span>            </span><span class="hs-comment">-- are redundant and can be dropped.</span><span>
</span><span id="line-1729"></span><span>            </span><span class="annot"><span class="annottext">(NonEmpty (FieldLabelString, [Bool]) -&gt; FieldLabelString)
-&gt; [NonEmpty (FieldLabelString, [Bool])] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; FieldLabelString
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; FieldLabelString)
-&gt; (NonEmpty (FieldLabelString, [Bool])
    -&gt; (FieldLabelString, [Bool]))
-&gt; NonEmpty (FieldLabelString, [Bool])
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool])
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.List.NonEmpty.html#head/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-var">NE.head</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NonEmpty (FieldLabelString, [Bool])] -&gt; [FieldLabelString])
-&gt; [NonEmpty (FieldLabelString, [Bool])] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; [Bool])
-&gt; [(FieldLabelString, [Bool])]
-&gt; [NonEmpty (FieldLabelString, [Bool])]
forall (f :: * -&gt; *) b a.
(Foldable f, Eq b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [NonEmpty a]
</span><a href="../../base-4.18.3.0/src/Data.List.NonEmpty.html#groupWith/Data.List.NonEmpty.html#groupWith"><span class="hs-identifier hs-var">NE.groupWith</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; [Bool]
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064195"><span class="hs-identifier hs-var">growingSets</span></a></span><span>
</span><span id="line-1730"></span><span>
</span><span id="line-1731"></span><span>    </span><span id="local-6989586621682064194"><span class="annot"><span class="annottext">aMember :: FieldLabelString
</span><a href="#local-6989586621682064194"><span class="hs-identifier hs-var hs-var">aMember</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ((FieldLabelString, [Bool]) -&gt; FieldLabelString)
-&gt; (FieldLabelString, [Bool])
-&gt; FieldLabelString
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064209"><span class="hs-identifier hs-var">members</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; FieldLabelString
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; (FieldLabelString, [Bool])
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064209"><span class="hs-identifier hs-var">members</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682064209"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064209"><span class="hs-identifier hs-var">members</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682064192"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064192"><span class="hs-identifier hs-var">nonMembers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; Bool)
-&gt; [(FieldLabelString, [Bool])]
-&gt; ([(FieldLabelString, [Bool])], [(FieldLabelString, [Bool])])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#partition/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#or/Data.Foldable.html#or"><span class="hs-identifier hs-var">or</span></a></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool)
-&gt; ((FieldLabelString, [Bool]) -&gt; [Bool])
-&gt; (FieldLabelString, [Bool])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; [Bool]
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064198"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-1733"></span><span>
</span><span id="line-1734"></span><span>    </span><span class="hs-comment">-- For each field, which constructors contain the field?</span><span>
</span><span id="line-1735"></span><span>    </span><span class="annot"><a href="#local-6989586621682064198"><span class="hs-identifier hs-type">membership</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1736"></span><span>    </span><span id="local-6989586621682064198"><span class="annot"><span class="annottext">membership :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621682064198"><span class="hs-identifier hs-var hs-var">membership</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall {a}. [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621682064212"><span class="hs-identifier hs-var">sortMembership</span></a></span><span> </span><span class="annot"><span class="annottext">([(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])])
-&gt; [(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1737"></span><span>        </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; (FieldLabelString, [Bool]))
-&gt; [FieldLabelString] -&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682064213"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064213"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064213"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(UniqSet FieldLabelString -&gt; Bool)
-&gt; [UniqSet FieldLabelString] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621682064213"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; UniqSet FieldLabelString -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UniqSet FieldLabelString]
</span><a href="#local-6989586621682064214"><span class="hs-identifier hs-var">fieldLabelSets</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FieldLabelString] -&gt; [(FieldLabelString, [Bool])])
-&gt; [FieldLabelString] -&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1738"></span><span>          </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))
 -&gt; FieldLabelString)
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))]
-&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-var">FieldLabelString</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; FieldLabelString)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; FastString)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; OccName)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; FastString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; RdrName)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; RdrName
forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(AmbiguousFieldOcc GhcTc -&gt; RdrName)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; AmbiguousFieldOcc GhcTc)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
-&gt; AmbiguousFieldOcc GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
 -&gt; AmbiguousFieldOcc GhcTc)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; AmbiguousFieldOcc GhcTc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
  (LocatedA (HsExpr GhcRn))
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="annot"><span class="annottext">(HsFieldBind
   (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
   (LocatedA (HsExpr GhcRn))
 -&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
    -&gt; HsFieldBind
         (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
         (LocatedA (HsExpr GhcRn)))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
        (LocatedA (HsExpr GhcRn)))
-&gt; GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn)))
-&gt; HsFieldBind
     (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
     (LocatedA (HsExpr GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsFieldBind GhcTc (LAmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated (SrcAnn NoEpAnns) (AmbiguousFieldOcc GhcTc))
      (LocatedA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682064183"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span>    </span><span class="annot"><a href="#local-6989586621682064214"><span class="hs-identifier hs-type">fieldLabelSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1741"></span><span>    </span><span id="local-6989586621682064214"><span class="annot"><span class="annottext">fieldLabelSets :: [UniqSet FieldLabelString]
</span><a href="#local-6989586621682064214"><span class="hs-identifier hs-var hs-var">fieldLabelSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConLike -&gt; UniqSet FieldLabelString)
-&gt; [ConLike] -&gt; [UniqSet FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; UniqSet FieldLabelString
forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLabelString] -&gt; UniqSet FieldLabelString)
-&gt; (ConLike -&gt; [FieldLabelString])
-&gt; ConLike
-&gt; UniqSet FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; FieldLabelString)
-&gt; [FieldLabel] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLabel] -&gt; [FieldLabelString])
-&gt; (ConLike -&gt; [FieldLabel]) -&gt; ConLike -&gt; [FieldLabelString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621682064184"><span class="hs-identifier hs-var">data_cons</span></a></span><span>
</span><span id="line-1742"></span><span>
</span><span id="line-1743"></span><span>    </span><span class="hs-comment">-- Sort in order of increasing number of True, so that a smaller</span><span>
</span><span id="line-1744"></span><span>    </span><span class="hs-comment">-- conflicting set can be found.</span><span>
</span><span id="line-1745"></span><span>    </span><span id="local-6989586621682064212"><span class="annot"><span class="annottext">sortMembership :: [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621682064212"><span class="hs-identifier hs-var hs-var">sortMembership</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1746"></span><span>      </span><span class="annot"><span class="annottext">((Int, (a, [Bool])) -&gt; (a, [Bool]))
-&gt; [(Int, (a, [Bool]))] -&gt; [(a, [Bool])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, (a, [Bool])) -&gt; (a, [Bool])
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, (a, [Bool]))] -&gt; [(a, [Bool])])
-&gt; ([(a, [Bool])] -&gt; [(Int, (a, [Bool]))])
-&gt; [(a, [Bool])]
-&gt; [(a, [Bool])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-1747"></span><span>      </span><span class="annot"><span class="annottext">((Int, (a, [Bool])) -&gt; (Int, (a, [Bool])) -&gt; Ordering)
-&gt; [(Int, (a, [Bool]))] -&gt; [(Int, (a, [Bool]))]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#sortBy/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Ordering)
-&gt; ((Int, (a, [Bool])) -&gt; Int)
-&gt; (Int, (a, [Bool]))
-&gt; (Int, (a, [Bool]))
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/Data.Function.html#on/Data.Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, (a, [Bool])) -&gt; Int
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, (a, [Bool]))] -&gt; [(Int, (a, [Bool]))])
-&gt; ([(a, [Bool])] -&gt; [(Int, (a, [Bool]))])
-&gt; [(a, [Bool])]
-&gt; [(Int, (a, [Bool]))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-1748"></span><span>      </span><span class="annot"><span class="annottext">((a, [Bool]) -&gt; (Int, (a, [Bool])))
-&gt; [(a, [Bool])] -&gt; [(Int, (a, [Bool]))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682064219"><span class="annot"><span class="annottext">item :: (a, [Bool])
</span><a href="#local-6989586621682064219"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682064220"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682064220"><span class="hs-identifier hs-var">membershipRow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Int
</span><a href="#local-6989586621682064221"><span class="hs-identifier hs-var">countTrue</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682064220"><span class="hs-identifier hs-var">membershipRow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, [Bool])
</span><a href="#local-6989586621682064219"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1749"></span><span>
</span><span id="line-1750"></span><span>    </span><span id="local-6989586621682064221"><span class="annot"><span class="annottext">countTrue :: [Bool] -&gt; Int
</span><a href="#local-6989586621682064221"><span class="hs-identifier hs-var hs-var">countTrue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Int
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
forall a. a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#id/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1751"></span><span>
</span><span id="line-1752"></span><span class="hs-comment">{-
Note [Finding the conflicting fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  data A = A {a0, a1 :: Int}
         | B {b0, b1 :: Int}
and we see a record update
  x { a0 = 3, a1 = 2, b0 = 4, b1 = 5 }
Then we'd like to find the smallest subset of fields that no
constructor has all of.  Here, say, {a0,b0}, or {a0,b1}, etc.
We don't really want to report that no constructor has all of
{a0,a1,b0,b1}, because when there are hundreds of fields it's
hard to see what was really wrong.

We may need more than two fields, though; eg
  data T = A { x,y :: Int, v::Int }
          | B { y,z :: Int, v::Int }
          | C { z,x :: Int, v::Int }
with update
   r { x=e1, y=e2, z=e3 }, we

Finding the smallest subset is hard, so the code here makes
a decent stab, no more.  See #7989.
-}</span><span>
</span><span id="line-1776"></span><span>
</span><span id="line-1777"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-type">mixedSelectors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-1778"></span><span id="mixedSelectors"><span class="annot"><span class="annottext">mixedSelectors :: [TyCoVar] -&gt; [TyCoVar] -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var hs-var">mixedSelectors</span></a></span></span><span> </span><span id="local-6989586621682064224"><span class="annot"><span class="annottext">data_sels :: [TyCoVar]
</span><a href="#local-6989586621682064224"><span class="hs-identifier hs-var">data_sels</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682064225"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064225"><span class="hs-identifier hs-var">dc_rep_id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TyCoVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682064226"><span class="annot"><span class="annottext">pat_syn_sels :: [TyCoVar]
</span><a href="#local-6989586621682064226"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682064227"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064227"><span class="hs-identifier hs-var">ps_rep_id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[TyCoVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1779"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [TyCoVar] -&gt; Name -&gt; [TyCoVar] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMixedSelectors"><span class="hs-identifier hs-var">TcRnMixedSelectors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064230"><span class="hs-identifier hs-var">rep_dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682064224"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn -&gt; Name
</span><a href="GHC.Core.PatSyn.html#patSynName"><span class="hs-identifier hs-var">patSynName</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682064232"><span class="hs-identifier hs-var">rep_ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682064226"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span>
</span><span id="line-1780"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1781"></span><span>    </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelPatSyn"><span class="hs-identifier hs-type">RecSelPatSyn</span></a></span><span> </span><span id="local-6989586621682064232"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682064232"><span class="hs-identifier hs-var">rep_ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; RecSelParent
</span><a href="GHC.Types.Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064227"><span class="hs-identifier hs-var">ps_rep_id</span></a></span><span>
</span><span id="line-1782"></span><span>    </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621682064230"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682064230"><span class="hs-identifier hs-var">rep_dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; RecSelParent
</span><a href="GHC.Types.Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064225"><span class="hs-identifier hs-var">dc_rep_id</span></a></span><span>
</span><span id="line-1783"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var">mixedSelectors</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRnMessage
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: mixedSelectors emptylists&quot;</span></span><span>
</span><span id="line-1784"></span><span>
</span><span id="line-1785"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Static Pointers}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1792"></span><span>
</span><span id="line-1793"></span><span class="hs-comment">-- | Checks if the given name is closed and emits an error if not.</span><span>
</span><span id="line-1794"></span><span class="hs-comment">--</span><span>
</span><span id="line-1795"></span><span class="hs-comment">-- See Note [Not-closed error messages].</span><span>
</span><span id="line-1796"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-type">checkClosedInStaticForm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1797"></span><span id="checkClosedInStaticForm"><span class="annot"><span class="annottext">checkClosedInStaticForm :: Name -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-var hs-var">checkClosedInStaticForm</span></a></span></span><span> </span><span id="local-6989586621682064234"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064234"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1798"></span><span>    </span><span id="local-6989586621682064235"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621682064235"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcTypeEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var">getLclTypeEnv</span></a></span><span>
</span><span id="line-1799"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621682064237"><span class="hs-identifier hs-var">checkClosed</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621682064235"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064234"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1800"></span><span>      </span><span class="annot"><span class="annottext">Maybe NotClosedReason
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1801"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682064238"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621682064238"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn ()) -&gt; TcRnMessage -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NotClosedReason -&gt; TcRnMessage
</span><a href="#local-6989586621682064239"><span class="hs-identifier hs-var">explain</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064234"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621682064238"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1802"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1803"></span><span>    </span><span class="hs-comment">-- See Note [Checking closedness].</span><span>
</span><span id="line-1804"></span><span>    </span><span class="annot"><a href="#local-6989586621682064237"><span class="hs-identifier hs-type">checkClosed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-1805"></span><span>    </span><span id="local-6989586621682064237"><span class="annot"><span class="annottext">checkClosed :: TcTypeEnv -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621682064237"><span class="hs-identifier hs-var hs-var">checkClosed</span></a></span></span><span> </span><span id="local-6989586621682064240"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621682064240"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621682064241"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064241"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; UniqSet Name -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621682064242"><span class="hs-identifier hs-var">checkLoop</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621682064240"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UniqSet Name
</span><a href="GHC.Types.Name.Set.html#unitNameSet"><span class="hs-identifier hs-var">unitNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064241"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064241"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1806"></span><span>
</span><span id="line-1807"></span><span>    </span><span class="annot"><a href="#local-6989586621682064242"><span class="hs-identifier hs-type">checkLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-1808"></span><span>    </span><span id="local-6989586621682064242"><span class="annot"><span class="annottext">checkLoop :: TcTypeEnv -&gt; UniqSet Name -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621682064242"><span class="hs-identifier hs-var hs-var">checkLoop</span></a></span></span><span> </span><span id="local-6989586621682064245"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621682064245"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621682064246"><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621682064246"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span id="local-6989586621682064247"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064247"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1809"></span><span>      </span><span class="hs-comment">-- The @visited@ set is an accumulating parameter that contains the set of</span><span>
</span><span id="line-1810"></span><span>      </span><span class="hs-comment">-- visited nodes, so we avoid repeating cycles in the traversal.</span><span>
</span><span id="line-1811"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621682064245"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064247"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1812"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; TyCoVar
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682064251"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064251"><span class="hs-identifier hs-var">tcid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tct_info :: TcTyThing -&gt; IdBindingInfo
</span><a href="GHC.Tc.Types.html#tct_info"><span class="hs-identifier hs-var">tct_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682064253"><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="#local-6989586621682064253"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="#local-6989586621682064253"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1813"></span><span>          </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.html#ClosedLet"><span class="hs-identifier hs-var">ClosedLet</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe NotClosedReason
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1814"></span><span>          </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.html#NotLetBound"><span class="hs-identifier hs-var">NotLetBound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotClosedReason -&gt; Maybe NotClosedReason
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="GHC.Tc.Errors.Types.html#NotLetBoundReason"><span class="hs-identifier hs-var">NotLetBoundReason</span></a></span><span>
</span><span id="line-1815"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#NonClosedLet"><span class="hs-identifier hs-type">NonClosedLet</span></a></span><span> </span><span id="local-6989586621682064258"><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621682064258"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682064259"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682064259"><span class="hs-identifier hs-var">type_closed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[NotClosedReason] -&gt; Maybe NotClosedReason
forall a. [a] -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#listToMaybe/Data.Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([NotClosedReason] -&gt; Maybe NotClosedReason)
-&gt; [NotClosedReason] -&gt; Maybe NotClosedReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1816"></span><span>            </span><span class="hs-comment">-- Look for a non-closed variable in fvs</span><span>
</span><span id="line-1817"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NotClosedReason -&gt; NotClosedReason
</span><a href="GHC.Tc.Errors.Types.html#NotClosed"><span class="hs-identifier hs-var">NotClosed</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064262"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621682064263"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1818"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682064262"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064262"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqSet Name -&gt; [Name]
</span><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621682064258"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-1819"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UniqSet Name -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064262"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621682064246"><span class="hs-identifier hs-var">visited</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1820"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682064263"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621682064263"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTypeEnv -&gt; UniqSet Name -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621682064242"><span class="hs-identifier hs-var">checkLoop</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621682064245"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSet Name -&gt; Name -&gt; UniqSet Name
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621682064246"><span class="hs-identifier hs-var">visited</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064262"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682064262"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1821"></span><span>            </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[NotClosedReason] -&gt; [NotClosedReason] -&gt; [NotClosedReason]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1822"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682064259"><span class="hs-identifier hs-var">type_closed</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1823"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1824"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-1825"></span><span>              </span><span class="hs-comment">-- We consider non-let-bound variables easier to figure out than</span><span>
</span><span id="line-1826"></span><span>              </span><span class="hs-comment">-- non-closed types, so we report non-closed types to the user</span><span>
</span><span id="line-1827"></span><span>              </span><span class="hs-comment">-- only if we cannot spot the former.</span><span>
</span><span id="line-1828"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; NotClosedReason
</span><a href="GHC.Tc.Errors.Types.html#NotTypeClosed"><span class="hs-identifier hs-var">NotTypeClosed</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; NotClosedReason) -&gt; VarSet -&gt; NotClosedReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682064251"><span class="hs-identifier hs-var">tcid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1829"></span><span>        </span><span class="hs-comment">-- The binding is closed.</span><span>
</span><span id="line-1830"></span><span>        </span><span class="annot"><span class="annottext">Maybe TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe NotClosedReason
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1831"></span><span>
</span><span id="line-1832"></span><span>    </span><span class="hs-comment">-- Converts a reason into a human-readable sentence.</span><span>
</span><span id="line-1833"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1834"></span><span>    </span><span class="hs-comment">-- @explain name reason@ starts with</span><span>
</span><span id="line-1835"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1836"></span><span>    </span><span class="hs-comment">-- &quot;&lt;name&gt; is used in a static form but it is not closed because it&quot;</span><span>
</span><span id="line-1837"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1838"></span><span>    </span><span class="hs-comment">-- and then follows a list of causes. For each id in the path, the text</span><span>
</span><span id="line-1839"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1840"></span><span>    </span><span class="hs-comment">-- &quot;uses &lt;id&gt; which&quot;</span><span>
</span><span id="line-1841"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1842"></span><span>    </span><span class="hs-comment">-- is appended, yielding something like</span><span>
</span><span id="line-1843"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1844"></span><span>    </span><span class="hs-comment">-- &quot;uses &lt;id&gt; which uses &lt;id1&gt; which uses &lt;id2&gt; which&quot;</span><span>
</span><span id="line-1845"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1846"></span><span>    </span><span class="hs-comment">-- until the end of the path is reached, which is reported as either</span><span>
</span><span id="line-1847"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1848"></span><span>    </span><span class="hs-comment">-- &quot;is not let-bound&quot;</span><span>
</span><span id="line-1849"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1850"></span><span>    </span><span class="hs-comment">-- when the final node is not let-bound, or</span><span>
</span><span id="line-1851"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1852"></span><span>    </span><span class="hs-comment">-- &quot;has a non-closed type because it contains the type variables:</span><span>
</span><span id="line-1853"></span><span>    </span><span class="hs-comment">-- v1, v2, v3&quot;</span><span>
</span><span id="line-1854"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1855"></span><span>    </span><span class="hs-comment">-- when the final node has a non-closed type.</span><span>
</span><span id="line-1856"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1857"></span><span>    </span><span class="annot"><a href="#local-6989586621682064239"><span class="hs-identifier hs-type">explain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-1858"></span><span>    </span><span id="local-6989586621682064239"><span class="annot"><span class="annottext">explain :: Name -&gt; NotClosedReason -&gt; TcRnMessage
</span><a href="#local-6989586621682064239"><span class="hs-identifier hs-var hs-var">explain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NotClosedReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnStaticFormNotClosed"><span class="hs-identifier hs-var">TcRnStaticFormNotClosed</span></a></span><span>
</span><span id="line-1859"></span><span>
</span><span id="line-1860"></span><span class="hs-comment">-- Note [Not-closed error messages]</span><span>
</span><span id="line-1861"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1862"></span><span class="hs-comment">--</span><span>
</span><span id="line-1863"></span><span class="hs-comment">-- When variables in a static form are not closed, we go through the trouble</span><span>
</span><span id="line-1864"></span><span class="hs-comment">-- of explaining why they aren't.</span><span>
</span><span id="line-1865"></span><span class="hs-comment">--</span><span>
</span><span id="line-1866"></span><span class="hs-comment">-- Thus, the following program</span><span>
</span><span id="line-1867"></span><span class="hs-comment">--</span><span>
</span><span id="line-1868"></span><span class="hs-comment">-- &gt; {-# LANGUAGE StaticPointers #-}</span><span>
</span><span id="line-1869"></span><span class="hs-comment">-- &gt; module M where</span><span>
</span><span id="line-1870"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-1871"></span><span class="hs-comment">-- &gt; f x = static g</span><span>
</span><span id="line-1872"></span><span class="hs-comment">-- &gt;   where</span><span>
</span><span id="line-1873"></span><span class="hs-comment">-- &gt;     g = h</span><span>
</span><span id="line-1874"></span><span class="hs-comment">-- &gt;     h = x</span><span>
</span><span id="line-1875"></span><span class="hs-comment">--</span><span>
</span><span id="line-1876"></span><span class="hs-comment">-- produces the error</span><span>
</span><span id="line-1877"></span><span class="hs-comment">--</span><span>
</span><span id="line-1878"></span><span class="hs-comment">--    'g' is used in a static form but it is not closed because it</span><span>
</span><span id="line-1879"></span><span class="hs-comment">--    uses 'h' which uses 'x' which is not let-bound.</span><span>
</span><span id="line-1880"></span><span class="hs-comment">--</span><span>
</span><span id="line-1881"></span><span class="hs-comment">-- And a program like</span><span>
</span><span id="line-1882"></span><span class="hs-comment">--</span><span>
</span><span id="line-1883"></span><span class="hs-comment">-- &gt; {-# LANGUAGE StaticPointers #-}</span><span>
</span><span id="line-1884"></span><span class="hs-comment">-- &gt; module M where</span><span>
</span><span id="line-1885"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-1886"></span><span class="hs-comment">-- &gt; import Data.Typeable</span><span>
</span><span id="line-1887"></span><span class="hs-comment">-- &gt; import GHC.StaticPtr</span><span>
</span><span id="line-1888"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-1889"></span><span class="hs-comment">-- &gt; f :: Typeable a =&gt; a -&gt; StaticPtr TypeRep</span><span>
</span><span id="line-1890"></span><span class="hs-comment">-- &gt; f x = const (static (g undefined)) (h x)</span><span>
</span><span id="line-1891"></span><span class="hs-comment">-- &gt;   where</span><span>
</span><span id="line-1892"></span><span class="hs-comment">-- &gt;     g = h</span><span>
</span><span id="line-1893"></span><span class="hs-comment">-- &gt;     h = typeOf</span><span>
</span><span id="line-1894"></span><span class="hs-comment">--</span><span>
</span><span id="line-1895"></span><span class="hs-comment">-- produces the error</span><span>
</span><span id="line-1896"></span><span class="hs-comment">--</span><span>
</span><span id="line-1897"></span><span class="hs-comment">--    'g' is used in a static form but it is not closed because it</span><span>
</span><span id="line-1898"></span><span class="hs-comment">--    uses 'h' which has a non-closed type because it contains the</span><span>
</span><span id="line-1899"></span><span class="hs-comment">--    type variables: 'a'</span><span>
</span><span id="line-1900"></span><span class="hs-comment">--</span><span>
</span><span id="line-1901"></span><span>
</span><span id="line-1902"></span><span class="hs-comment">-- Note [Checking closedness]</span><span>
</span><span id="line-1903"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1904"></span><span class="hs-comment">--</span><span>
</span><span id="line-1905"></span><span class="hs-comment">-- @checkClosed@ checks if a binding is closed and returns a reason if it is</span><span>
</span><span id="line-1906"></span><span class="hs-comment">-- not.</span><span>
</span><span id="line-1907"></span><span class="hs-comment">--</span><span>
</span><span id="line-1908"></span><span class="hs-comment">-- The bindings define a graph where the nodes are ids, and there is an edge</span><span>
</span><span id="line-1909"></span><span class="hs-comment">-- from @id1@ to @id2@ if the rhs of @id1@ contains @id2@ among its free</span><span>
</span><span id="line-1910"></span><span class="hs-comment">-- variables.</span><span>
</span><span id="line-1911"></span><span class="hs-comment">--</span><span>
</span><span id="line-1912"></span><span class="hs-comment">-- When @n@ is not closed, it has to exist in the graph some node reachable</span><span>
</span><span id="line-1913"></span><span class="hs-comment">-- from @n@ that it is not a let-bound variable or that it has a non-closed</span><span>
</span><span id="line-1914"></span><span class="hs-comment">-- type. Thus, the &quot;reason&quot; is a path from @n@ to this offending node.</span><span>
</span><span id="line-1915"></span><span class="hs-comment">--</span><span>
</span><span id="line-1916"></span><span class="hs-comment">-- When @n@ is not closed, we traverse the graph reachable from @n@ to build</span><span>
</span><span id="line-1917"></span><span class="hs-comment">-- the reason.</span><span>
</span><span id="line-1918"></span><span class="hs-comment">--</span><span>
</span><span id="line-1919"></span></pre></body></html>