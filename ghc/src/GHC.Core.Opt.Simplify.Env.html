<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The AQUA Project, Glasgow University, 1993-1998

\section[GHC.Core.Opt.Simplify.Monad]{The simplifier Monad}
-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Core.Opt.Simplify.Env</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-10"></span><span>        </span><span class="annot"><span class="hs-comment">-- * The simplifier mode</span></span><span>
</span><span id="line-11"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier">SimplMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#updMode"><span class="hs-identifier">updMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#smPedanticBottoms"><span class="hs-identifier">smPedanticBottoms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#smPlatform"><span class="hs-identifier">smPlatform</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Environments</span></span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier">SimplEnv</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#pprSimplEnv"><span class="hs-identifier">pprSimplEnv</span></a></span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Temp not abstract</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seArityOpts"><span class="hs-identifier">seArityOpts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseCase"><span class="hs-identifier">seCaseCase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseFolding"><span class="hs-identifier">seCaseFolding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseMerge"><span class="hs-identifier">seCaseMerge</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCastSwizzle"><span class="hs-identifier">seCastSwizzle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seDoEtaReduction"><span class="hs-identifier">seDoEtaReduction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seEtaExpand"><span class="hs-identifier">seEtaExpand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seFloatEnable"><span class="hs-identifier">seFloatEnable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInline"><span class="hs-identifier">seInline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seNames"><span class="hs-identifier">seNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seOptCoercionOpts"><span class="hs-identifier">seOptCoercionOpts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePedanticBottoms"><span class="hs-identifier">sePedanticBottoms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePhase"><span class="hs-identifier">sePhase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePlatform"><span class="hs-identifier">sePlatform</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePreInline"><span class="hs-identifier">sePreInline</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRuleOpts"><span class="hs-identifier">seRuleOpts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRules"><span class="hs-identifier">seRules</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seUnfoldingOpts"><span class="hs-identifier">seUnfoldingOpts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkSimplEnv"><span class="hs-identifier">mkSimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendIdSubst"><span class="hs-identifier">extendIdSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendTvSubst"><span class="hs-identifier">extendTvSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendCvSubst"><span class="hs-identifier">extendCvSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#zapSubstEnv"><span class="hs-identifier">zapSubstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setSubstEnv"><span class="hs-identifier">setSubstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#bumpCaseDepth"><span class="hs-identifier">bumpCaseDepth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#getInScope"><span class="hs-identifier">getInScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeFromE"><span class="hs-identifier">setInScopeFromE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeFromF"><span class="hs-identifier">setInScopeFromF</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeSet"><span class="hs-identifier">setInScopeSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#modifyInScope"><span class="hs-identifier">modifyInScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addNewInScopeIds"><span class="hs-identifier">addNewInScopeIds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#getSimplRules"><span class="hs-identifier">getSimplRules</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#enterRecGroupRHSs"><span class="hs-identifier">enterRecGroupRHSs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Substitution results</span></span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplSR"><span class="hs-identifier">SimplSR</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkContEx"><span class="hs-identifier">mkContEx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substId"><span class="hs-identifier">substId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#lookupRecBndr"><span class="hs-identifier">lookupRecBndr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Simplifying 'Id' binders</span></span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplNonRecBndr"><span class="hs-identifier">simplNonRecBndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplNonRecJoinBndr"><span class="hs-identifier">simplNonRecJoinBndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplRecBndrs"><span class="hs-identifier">simplRecBndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplRecJoinBndrs"><span class="hs-identifier">simplRecJoinBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplBinder"><span class="hs-identifier">simplBinder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplBinders"><span class="hs-identifier">simplBinders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substTy"><span class="hs-identifier">substTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substTyVar"><span class="hs-identifier">substTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier">getSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substCo"><span class="hs-identifier">substCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substCoVar"><span class="hs-identifier">substCoVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Floats</span></span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier">SimplFloats</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#emptyFloats"><span class="hs-identifier">emptyFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyFloats"><span class="hs-identifier">isEmptyFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkRecFloats"><span class="hs-identifier">mkRecFloats</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkFloatBind"><span class="hs-identifier">mkFloatBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addLetFloats"><span class="hs-identifier">addLetFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFloats"><span class="hs-identifier">addJoinFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addFloats"><span class="hs-identifier">addFloats</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendFloats"><span class="hs-identifier">extendFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#wrapFloats"><span class="hs-identifier">wrapFloats</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyJoinFloats"><span class="hs-identifier">isEmptyJoinFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyLetFloats"><span class="hs-identifier">isEmptyLetFloats</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#doFloatFromRhs"><span class="hs-identifier">doFloatFromRhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#getTopFloatBinds"><span class="hs-identifier">getTopFloatBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><span class="hs-comment">-- * LetFloats</span></span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier">LetFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnable"><span class="hs-identifier">FloatEnable</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#letFloatBinds"><span class="hs-identifier">letFloatBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#emptyLetFloats"><span class="hs-identifier">emptyLetFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#unitLetFloat"><span class="hs-identifier">unitLetFloat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addLetFlts"><span class="hs-identifier">addLetFlts</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mapLetFloats"><span class="hs-identifier">mapLetFloats</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><span class="hs-comment">-- * JoinFloats</span></span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloat"><span class="hs-identifier">JoinFloat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier">JoinFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#emptyJoinFloats"><span class="hs-identifier">emptyJoinFloats</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloats"><span class="hs-identifier">wrapJoinFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloatsX"><span class="hs-identifier">wrapJoinFloatsX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#unitJoinFloat"><span class="hs-identifier">unitJoinFloat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFlts"><span class="hs-identifier">addJoinFlts</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Opt.html"><span class="hs-identifier">GHC.Core.Coercion.Opt</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Opt.html#OptCoercionOpts"><span class="hs-identifier">OptCoercionOpts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier">FamInstEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Arity.html"><span class="hs-identifier">GHC.Core.Opt.Arity</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Arity.html#ArityOpts"><span class="hs-identifier">ArityOpts</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html"><span class="hs-identifier">GHC.Core.Opt.Simplify.Monad</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Rules.Config.html"><span class="hs-identifier">GHC.Core.Rules.Config</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Rules.Config.html#RuleOpts"><span class="hs-identifier">RuleOpts</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unfold.html"><span class="hs-identifier">GHC.Core.Unfold</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#emptyIdSubstEnv"><span class="hs-identifier">emptyIdSubstEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier">Scaled</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html#mkMultMul"><span class="hs-identifier">mkMultMul</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkWildValBinder"><span class="hs-identifier">mkWildValBinder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkCoreLet"><span class="hs-identifier">mkCoreLet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span> </span><span class="hs-keyword">hiding</span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier">substTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTyVar"><span class="hs-identifier">substTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTyVarBndr"><span class="hs-identifier">substTyVarBndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier">substCo</span></a></span><span>
</span><span id="line-66"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier">extendTvSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#extendCvSubst"><span class="hs-identifier">extendCvSubst</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Coercion</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier">substCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVar"><span class="hs-identifier">substCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVarBndr"><span class="hs-identifier">substCoVarBndr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Id</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#pprUniqFM"><span class="hs-identifier">pprUniqFM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Graph.UnVar.html"><span class="hs-identifier">GHC.Data.Graph.UnVar</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier">Platform</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.OldList.html#intersperse/Data.OldList.html#intersperse"><span class="hs-identifier">intersperse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier">mapAccumL</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{The @SimplEnv@ type}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">{-
Note [The environments of the Simplify pass]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The functions of the Simplify pass draw their contextual data from two
environments: `SimplEnv`, which is passed to the functions as an argument, and
`SimplTopEnv`, which is part of the `SimplM` monad. For both environments exist
corresponding configuration records `SimplMode` and `TopEnvConfig` respectively.
A configuration record denotes a unary datatype bundeling the various options
and switches we provide to control the behaviour of the respective part of the
Simplify pass. The value is provided by the driver using the functions found in
the GHC.Driver.Config.Core.Opt.Simplify module.

These configuration records are part in the environment to avoid needless
copying of their values. This raises the question which data value goes in which
of the four datatypes. For each value needed by the pass we ask the following
two questions:

 * Does the value only make sense in a monadic environment?

 * Is it part of the configuration of the pass and provided by the user or is it
   it an internal value?

Examples of values that make only sense in conjunction with `SimplM` are the
logger and the values related to counting. As it does not make sense to use them
in a pure function (the logger needs IO and counting needs access to the
accumulated counts in the monad) we want these to live in `SimplTopEnv`.
Other values, like the switches controlling the behaviour of the pass (e.g.
whether to do case merging or not) are perfectly usable in a non-monadic setting.
Indeed many of those are used in guard expressions and it would be cumbersome to
query them from the monadic environment and feed them to the pure functions as
an argument. Hence we conveniently store them in the `SpecEnv` environment which
can be passed to pure functions as a whole.

Now that we know in which of the two environments a particular value lives we
turn to the second question to determine if the value is part of the
configuration record embedded in the environment or if it is stored in an own
field in the environment type. Some values like the tick factor must be provided
from outside as we can neither derive it from other values provided to us nor
does a constant value make sense. Other values like the maximal number of ticks
are computed on environment initialization and we wish not to expose the field
to the &quot;user&quot; or the pass -- it is an internal value. Therefore the distinction
here is between &quot;freely set by the caller&quot; and &quot;internally managed by the pass&quot;.

Note that it doesn't matter for the decision procedure wheter a value is altered
throughout an iteration of the Simplify pass: The fields sm_phase, sm_inline,
sm_rules, sm_cast_swizzle and sm_eta_expand are updated locally (See the
definitions of `updModeForStableUnfoldings` and `updModeForRules` in
GHC.Core.Opt.Simplify.Utils) but they are still part of `SimplMode` as the
caller of the Simplify pass needs to provide the initial values for those fields.

The decision which value goes into which datatype can be summarized by the
following table:
                                 |          Usable in a           |
                                 | pure setting | monadic setting |
    |----------------------------|--------------|-----------------|
    | Set by user                | SimplMode    | TopEnvConfig    |
    | Computed on initialization | SimplEnv     | SimplTopEnv     |

-}</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-keyword">data</span><span> </span><span id="SimplEnv"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-var">SimplEnv</span></a></span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SimplEnv"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-var">SimplEnv</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-162"></span><span>     </span><span class="hs-comment">----------- Static part of the environment -----------</span><span>
</span><span id="line-163"></span><span>     </span><span class="hs-comment">-- Static in the sense of lexically scoped,</span><span>
</span><span id="line-164"></span><span>     </span><span class="hs-comment">-- wrt the original expression</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-comment">-- See Note [The environments of the Simplify pass]</span><span>
</span><span id="line-167"></span><span>        </span><span id="seMode"><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var hs-var">seMode</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="seFamEnvs"><span class="annot"><span class="annottext">SimplEnv -&gt; (FamInstEnv, FamInstEnv)
</span><a href="GHC.Core.Opt.Simplify.Env.html#seFamEnvs"><span class="hs-identifier hs-var hs-var">seFamEnvs</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-comment">-- The current substitution</span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="seTvSubst"><span class="annot"><span class="annottext">SimplEnv -&gt; TvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var hs-var">seTvSubst</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a></span><span>      </span><span class="hs-comment">-- InTyVar |--&gt; OutType</span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="seCvSubst"><span class="annot"><span class="annottext">SimplEnv -&gt; CvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var hs-var">seCvSubst</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a></span><span>      </span><span class="hs-comment">-- InCoVar |--&gt; OutCoercion</span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="seIdSubst"><span class="annot"><span class="annottext">SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var hs-var">seIdSubst</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplIdSubst"><span class="hs-identifier hs-type">SimplIdSubst</span></a></span><span>    </span><span class="hs-comment">-- InId    |--&gt; OutExpr</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-comment">-- | Fast OutVarSet tracking which recursive RHSs we are analysing.</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-comment">-- See Note [Eta reduction in recursive RHSs] in GHC.Core.Opt.Arity.</span><span>
</span><span id="line-177"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="seRecIds"><span class="annot"><span class="annottext">SimplEnv -&gt; UnVarSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seRecIds"><span class="hs-identifier hs-var hs-var">seRecIds</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.Graph.UnVar.html#UnVarSet"><span class="hs-identifier hs-type">UnVarSet</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>     </span><span class="hs-comment">----------- Dynamic part of the environment -----------</span><span>
</span><span id="line-180"></span><span>     </span><span class="hs-comment">-- Dynamic in the sense of describing the setup where</span><span>
</span><span id="line-181"></span><span>     </span><span class="hs-comment">-- the expression finally ends up</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-comment">-- The current set of in-scope variables</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- They are all OutVars, and all bound in this module</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="seInScope"><span class="annot"><span class="annottext">SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var hs-var">seInScope</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>       </span><span class="hs-comment">-- OutVars only</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="seCaseDepth"><span class="annot"><span class="annottext">SimplEnv -&gt; JoinArity
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCaseDepth"><span class="hs-identifier hs-var hs-var">seCaseDepth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- Depth of multi-branch case alternatives</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seArityOpts"><span class="hs-identifier hs-type">seArityOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Arity.html#ArityOpts"><span class="hs-identifier hs-type">ArityOpts</span></a></span><span>
</span><span id="line-191"></span><span id="seArityOpts"><span class="annot"><span class="annottext">seArityOpts :: SimplEnv -&gt; ArityOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#seArityOpts"><span class="hs-identifier hs-var hs-var">seArityOpts</span></a></span></span><span> </span><span id="local-6989586621681872242"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872242"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; ArityOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_arity_opts"><span class="hs-identifier hs-var">sm_arity_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872242"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseCase"><span class="hs-identifier hs-type">seCaseCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-194"></span><span id="seCaseCase"><span class="annot"><span class="annottext">seCaseCase :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCaseCase"><span class="hs-identifier hs-var hs-var">seCaseCase</span></a></span></span><span> </span><span id="local-6989586621681872244"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872244"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_case_case"><span class="hs-identifier hs-var">sm_case_case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872244"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseFolding"><span class="hs-identifier hs-type">seCaseFolding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-197"></span><span id="seCaseFolding"><span class="annot"><span class="annottext">seCaseFolding :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCaseFolding"><span class="hs-identifier hs-var hs-var">seCaseFolding</span></a></span></span><span> </span><span id="local-6989586621681872246"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872246"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_case_folding"><span class="hs-identifier hs-var">sm_case_folding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872246"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseMerge"><span class="hs-identifier hs-type">seCaseMerge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-200"></span><span id="seCaseMerge"><span class="annot"><span class="annottext">seCaseMerge :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCaseMerge"><span class="hs-identifier hs-var hs-var">seCaseMerge</span></a></span></span><span> </span><span id="local-6989586621681872248"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872248"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_case_merge"><span class="hs-identifier hs-var">sm_case_merge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872248"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCastSwizzle"><span class="hs-identifier hs-type">seCastSwizzle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-203"></span><span id="seCastSwizzle"><span class="annot"><span class="annottext">seCastSwizzle :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCastSwizzle"><span class="hs-identifier hs-var hs-var">seCastSwizzle</span></a></span></span><span> </span><span id="local-6989586621681872250"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872250"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_cast_swizzle"><span class="hs-identifier hs-var">sm_cast_swizzle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872250"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seDoEtaReduction"><span class="hs-identifier hs-type">seDoEtaReduction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-206"></span><span id="seDoEtaReduction"><span class="annot"><span class="annottext">seDoEtaReduction :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seDoEtaReduction"><span class="hs-identifier hs-var hs-var">seDoEtaReduction</span></a></span></span><span> </span><span id="local-6989586621681872252"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872252"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_do_eta_reduction"><span class="hs-identifier hs-var">sm_do_eta_reduction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872252"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seEtaExpand"><span class="hs-identifier hs-type">seEtaExpand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-209"></span><span id="seEtaExpand"><span class="annot"><span class="annottext">seEtaExpand :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seEtaExpand"><span class="hs-identifier hs-var hs-var">seEtaExpand</span></a></span></span><span> </span><span id="local-6989586621681872254"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872254"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_eta_expand"><span class="hs-identifier hs-var">sm_eta_expand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872254"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seFloatEnable"><span class="hs-identifier hs-type">seFloatEnable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnable"><span class="hs-identifier hs-type">FloatEnable</span></a></span><span>
</span><span id="line-212"></span><span id="seFloatEnable"><span class="annot"><span class="annottext">seFloatEnable :: SimplEnv -&gt; FloatEnable
</span><a href="GHC.Core.Opt.Simplify.Env.html#seFloatEnable"><span class="hs-identifier hs-var hs-var">seFloatEnable</span></a></span></span><span> </span><span id="local-6989586621681872256"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872256"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; FloatEnable
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_float_enable"><span class="hs-identifier hs-var">sm_float_enable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872256"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInline"><span class="hs-identifier hs-type">seInline</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-215"></span><span id="seInline"><span class="annot"><span class="annottext">seInline :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInline"><span class="hs-identifier hs-var hs-var">seInline</span></a></span></span><span> </span><span id="local-6989586621681872258"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872258"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_inline"><span class="hs-identifier hs-var">sm_inline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872258"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seNames"><span class="hs-identifier hs-type">seNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-218"></span><span id="seNames"><span class="annot"><span class="annottext">seNames :: SimplEnv -&gt; [String]
</span><a href="GHC.Core.Opt.Simplify.Env.html#seNames"><span class="hs-identifier hs-var hs-var">seNames</span></a></span></span><span> </span><span id="local-6989586621681872260"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872260"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; [String]
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_names"><span class="hs-identifier hs-var">sm_names</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872260"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seOptCoercionOpts"><span class="hs-identifier hs-type">seOptCoercionOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Opt.html#OptCoercionOpts"><span class="hs-identifier hs-type">OptCoercionOpts</span></a></span><span>
</span><span id="line-221"></span><span id="seOptCoercionOpts"><span class="annot"><span class="annottext">seOptCoercionOpts :: SimplEnv -&gt; OptCoercionOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#seOptCoercionOpts"><span class="hs-identifier hs-var hs-var">seOptCoercionOpts</span></a></span></span><span> </span><span id="local-6989586621681872262"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872262"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; OptCoercionOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_co_opt_opts"><span class="hs-identifier hs-var">sm_co_opt_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872262"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePedanticBottoms"><span class="hs-identifier hs-type">sePedanticBottoms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-224"></span><span id="sePedanticBottoms"><span class="annot"><span class="annottext">sePedanticBottoms :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sePedanticBottoms"><span class="hs-identifier hs-var hs-var">sePedanticBottoms</span></a></span></span><span> </span><span id="local-6989586621681872264"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872264"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#smPedanticBottoms"><span class="hs-identifier hs-var">smPedanticBottoms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872264"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePhase"><span class="hs-identifier hs-type">sePhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a></span><span>
</span><span id="line-227"></span><span id="sePhase"><span class="annot"><span class="annottext">sePhase :: SimplEnv -&gt; CompilerPhase
</span><a href="GHC.Core.Opt.Simplify.Env.html#sePhase"><span class="hs-identifier hs-var hs-var">sePhase</span></a></span></span><span> </span><span id="local-6989586621681872265"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872265"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; CompilerPhase
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_phase"><span class="hs-identifier hs-var">sm_phase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872265"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePlatform"><span class="hs-identifier hs-type">sePlatform</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-230"></span><span id="sePlatform"><span class="annot"><span class="annottext">sePlatform :: SimplEnv -&gt; Platform
</span><a href="GHC.Core.Opt.Simplify.Env.html#sePlatform"><span class="hs-identifier hs-var hs-var">sePlatform</span></a></span></span><span> </span><span id="local-6989586621681872267"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872267"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Platform
</span><a href="GHC.Core.Opt.Simplify.Env.html#smPlatform"><span class="hs-identifier hs-var">smPlatform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872267"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sePreInline"><span class="hs-identifier hs-type">sePreInline</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-233"></span><span id="sePreInline"><span class="annot"><span class="annottext">sePreInline :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sePreInline"><span class="hs-identifier hs-var hs-var">sePreInline</span></a></span></span><span> </span><span id="local-6989586621681872268"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872268"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_pre_inline"><span class="hs-identifier hs-var">sm_pre_inline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872268"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRuleOpts"><span class="hs-identifier hs-type">seRuleOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Rules.Config.html#RuleOpts"><span class="hs-identifier hs-type">RuleOpts</span></a></span><span>
</span><span id="line-236"></span><span id="seRuleOpts"><span class="annot"><span class="annottext">seRuleOpts :: SimplEnv -&gt; RuleOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#seRuleOpts"><span class="hs-identifier hs-var hs-var">seRuleOpts</span></a></span></span><span> </span><span id="local-6989586621681872270"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872270"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; RuleOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_rule_opts"><span class="hs-identifier hs-var">sm_rule_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872270"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRules"><span class="hs-identifier hs-type">seRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-239"></span><span id="seRules"><span class="annot"><span class="annottext">seRules :: SimplEnv -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#seRules"><span class="hs-identifier hs-var hs-var">seRules</span></a></span></span><span> </span><span id="local-6989586621681872272"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872272"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_rules"><span class="hs-identifier hs-var">sm_rules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872272"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seUnfoldingOpts"><span class="hs-identifier hs-type">seUnfoldingOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Unfold.html#UnfoldingOpts"><span class="hs-identifier hs-type">UnfoldingOpts</span></a></span><span>
</span><span id="line-242"></span><span id="seUnfoldingOpts"><span class="annot"><span class="annottext">seUnfoldingOpts :: SimplEnv -&gt; UnfoldingOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#seUnfoldingOpts"><span class="hs-identifier hs-var hs-var">seUnfoldingOpts</span></a></span></span><span> </span><span id="local-6989586621681872274"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872274"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; UnfoldingOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_uf_opts"><span class="hs-identifier hs-var">sm_uf_opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872274"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- See Note [The environments of the Simplify pass]</span><span>
</span><span id="line-245"></span><span class="hs-keyword">data</span><span> </span><span id="SimplMode"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-var">SimplMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SimplMode"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-var">SimplMode</span></a></span></span><span> </span><span class="hs-comment">-- See comments in GHC.Core.Opt.Simplify.Monad</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="sm_phase"><span class="annot"><span class="annottext">SimplMode -&gt; CompilerPhase
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_phase"><span class="hs-identifier hs-var hs-var">sm_phase</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Basic.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_names"><span class="annot"><span class="annottext">SimplMode -&gt; [String]
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_names"><span class="hs-identifier hs-var hs-var">sm_names</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Name(s) of the phase</span></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_rules"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_rules"><span class="hs-identifier hs-var hs-var">sm_rules</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Whether RULES are enabled</span></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_inline"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_inline"><span class="hs-identifier hs-var hs-var">sm_inline</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Whether inlining is enabled</span></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_eta_expand"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_eta_expand"><span class="hs-identifier hs-var hs-var">sm_eta_expand</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Whether eta-expansion is enabled</span></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_cast_swizzle"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_cast_swizzle"><span class="hs-identifier hs-var hs-var">sm_cast_swizzle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Do we swizzle casts past lambdas?</span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_uf_opts"><span class="annot"><span class="annottext">SimplMode -&gt; UnfoldingOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_uf_opts"><span class="hs-identifier hs-var hs-var">sm_uf_opts</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.Unfold.html#UnfoldingOpts"><span class="hs-identifier hs-type">UnfoldingOpts</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Unfolding options</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_case_case"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_case_case"><span class="hs-identifier hs-var hs-var">sm_case_case</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Whether case-of-case is enabled</span></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_pre_inline"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_pre_inline"><span class="hs-identifier hs-var hs-var">sm_pre_inline</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Whether pre-inlining is enabled</span></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_float_enable"><span class="annot"><span class="annottext">SimplMode -&gt; FloatEnable
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_float_enable"><span class="hs-identifier hs-var hs-var">sm_float_enable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnable"><span class="hs-identifier hs-type">FloatEnable</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Whether to enable floating out</span></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_do_eta_reduction"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_do_eta_reduction"><span class="hs-identifier hs-var hs-var">sm_do_eta_reduction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_arity_opts"><span class="annot"><span class="annottext">SimplMode -&gt; ArityOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_arity_opts"><span class="hs-identifier hs-var hs-var">sm_arity_opts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.Opt.Arity.html#ArityOpts"><span class="hs-identifier hs-type">ArityOpts</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_rule_opts"><span class="annot"><span class="annottext">SimplMode -&gt; RuleOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_rule_opts"><span class="hs-identifier hs-var hs-var">sm_rule_opts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.Rules.Config.html#RuleOpts"><span class="hs-identifier hs-type">RuleOpts</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_case_folding"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_case_folding"><span class="hs-identifier hs-var hs-var">sm_case_folding</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_case_merge"><span class="annot"><span class="annottext">SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_case_merge"><span class="hs-identifier hs-var hs-var">sm_case_merge</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sm_co_opt_opts"><span class="annot"><span class="annottext">SimplMode -&gt; OptCoercionOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_co_opt_opts"><span class="hs-identifier hs-var hs-var">sm_co_opt_opts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.Coercion.Opt.html#OptCoercionOpts"><span class="hs-identifier hs-type">OptCoercionOpts</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Coercion optimiser options</span></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621681872312"><span class="annot"><span class="annottext">ppr :: SimplMode -&gt; SDoc
</span><a href="#local-6989586621681872312"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sm_phase :: SimplMode -&gt; CompilerPhase
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_phase"><span class="hs-identifier hs-var">sm_phase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872314"><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681872314"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_names :: SimplMode -&gt; [String]
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_names"><span class="hs-identifier hs-var">sm_names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872315"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681872315"><span class="hs-identifier hs-var">ss</span></a></span></span><span>
</span><span id="line-266"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_rules :: SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_rules"><span class="hs-identifier hs-var">sm_rules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872316"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872316"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_inline :: SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_inline"><span class="hs-identifier hs-var">sm_inline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872317"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872317"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-267"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_cast_swizzle :: SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_cast_swizzle"><span class="hs-identifier hs-var">sm_cast_swizzle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872318"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872318"><span class="hs-identifier hs-var">cs</span></a></span></span><span>
</span><span id="line-268"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_eta_expand :: SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_eta_expand"><span class="hs-identifier hs-var">sm_eta_expand</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872319"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872319"><span class="hs-identifier hs-var">eta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_case_case :: SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_case_case"><span class="hs-identifier hs-var">sm_case_case</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872320"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872320"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SimplMode&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-270"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Phase =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681872314"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-271"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#intersperse/Data.OldList.html#intersperse"><span class="hs-identifier hs-var">intersperse</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681872315"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-272"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall {doc}. IsLine doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="#local-6989586621681872329"><span class="hs-identifier hs-var">pp_flag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872317"><span class="hs-identifier hs-var">i</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inline&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-273"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall {doc}. IsLine doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="#local-6989586621681872329"><span class="hs-identifier hs-var">pp_flag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872316"><span class="hs-identifier hs-var">r</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rules&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-274"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall {doc}. IsLine doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="#local-6989586621681872329"><span class="hs-identifier hs-var">pp_flag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872319"><span class="hs-identifier hs-var">eta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;eta-expand&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-275"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall {doc}. IsLine doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="#local-6989586621681872329"><span class="hs-identifier hs-var">pp_flag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872318"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cast-swizzle&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-276"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall {doc}. IsLine doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="#local-6989586621681872329"><span class="hs-identifier hs-var">pp_flag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872320"><span class="hs-identifier hs-var">cc</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;case-of-case&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>         </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>           </span><span id="local-6989586621681872329"><span class="annot"><span class="annottext">pp_flag :: Bool -&gt; doc -&gt; doc
</span><a href="#local-6989586621681872329"><span class="hs-identifier hs-var hs-var">pp_flag</span></a></span></span><span> </span><span id="local-6989586621681872337"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872337"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681872338"><span class="annot"><span class="annottext">doc
</span><a href="#local-6989586621681872338"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; doc -&gt; doc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872337"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">doc -&gt; doc -&gt; doc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">doc
</span><a href="#local-6989586621681872338"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#smPedanticBottoms"><span class="hs-identifier hs-type">smPedanticBottoms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-281"></span><span id="smPedanticBottoms"><span class="annot"><span class="annottext">smPedanticBottoms :: SimplMode -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#smPedanticBottoms"><span class="hs-identifier hs-var hs-var">smPedanticBottoms</span></a></span></span><span> </span><span id="local-6989586621681872340"><span class="annot"><span class="annottext">SimplMode
</span><a href="#local-6989586621681872340"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArityOpts -&gt; Bool
</span><a href="GHC.Core.Opt.Arity.html#ao_ped_bot"><span class="hs-identifier hs-var">ao_ped_bot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplMode -&gt; ArityOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_arity_opts"><span class="hs-identifier hs-var">sm_arity_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SimplMode
</span><a href="#local-6989586621681872340"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#smPlatform"><span class="hs-identifier hs-type">smPlatform</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-284"></span><span id="smPlatform"><span class="annot"><span class="annottext">smPlatform :: SimplMode -&gt; Platform
</span><a href="GHC.Core.Opt.Simplify.Env.html#smPlatform"><span class="hs-identifier hs-var hs-var">smPlatform</span></a></span></span><span> </span><span id="local-6989586621681872342"><span class="annot"><span class="annottext">SimplMode
</span><a href="#local-6989586621681872342"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleOpts -&gt; Platform
</span><a href="GHC.Core.Rules.Config.html#roPlatform"><span class="hs-identifier hs-var">roPlatform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplMode -&gt; RuleOpts
</span><a href="GHC.Core.Opt.Simplify.Env.html#sm_rule_opts"><span class="hs-identifier hs-var">sm_rule_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SimplMode
</span><a href="#local-6989586621681872342"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-keyword">data</span><span> </span><span id="FloatEnable"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnable"><span class="hs-identifier hs-var">FloatEnable</span></a></span></span><span>  </span><span class="hs-comment">-- Controls local let-floating</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="FloatDisabled"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatDisabled"><span class="hs-identifier hs-var">FloatDisabled</span></a></span></span><span>      </span><span class="hs-comment">-- Do no local let-floating</span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FloatNestedOnly"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatNestedOnly"><span class="hs-identifier hs-var">FloatNestedOnly</span></a></span></span><span>    </span><span class="hs-comment">-- Local let-floating for nested (NotTopLevel) bindings only</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FloatEnabled"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnabled"><span class="hs-identifier hs-var">FloatEnabled</span></a></span></span><span>       </span><span class="hs-comment">-- Do local let-floating on all bindings</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">{-
Note [Local floating]
~~~~~~~~~~~~~~~~~~~~~
The Simplifier can perform local let-floating: it floats let-bindings
out of the RHS of let-bindings.  See
  Let-floating: moving bindings to give faster programs (ICFP'96)
  https://www.microsoft.com/en-us/research/publication/let-floating-moving-bindings-to-give-faster-programs/

Here's an example
   x = let y = v+1 in (y,true)

The RHS of x is a thunk.  Much better to float that y-binding out to give
   y = v+1
   x = (y,true)

Not only have we avoided building a thunk, but any (case x of (p,q) -&gt; ...) in
the scope of the x-binding can now be simplified.

This local let-floating is done in GHC.Core.Opt.Simplify.prepareBinding,
controlled by the predicate GHC.Core.Opt.Simplify.Env.doFloatFromRhs.

The `FloatEnable` data type controls where local let-floating takes place;
it allows you to specify that it should be done only for nested bindings;
or for top-level bindings as well; or not at all.

Note that all of this is quite separate from the global FloatOut pass;
see GHC.Core.Opt.FloatOut.

-}</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-keyword">data</span><span> </span><span id="SimplFloats"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-var">SimplFloats</span></a></span></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SimplFloats"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-var">SimplFloats</span></a></span></span><span>
</span><span id="line-323"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Ordinary let bindings</span><span>
</span><span id="line-324"></span><span>        </span><span id="sfLetFloats"><span class="annot"><span class="annottext">SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var hs-var">sfLetFloats</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span>
</span><span id="line-325"></span><span>                </span><span class="hs-comment">-- See Note [LetFloats]</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-comment">-- Join points</span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="sfJoinFloats"><span class="annot"><span class="annottext">SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var hs-var">sfJoinFloats</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span>
</span><span id="line-329"></span><span>                </span><span class="hs-comment">-- Handled separately; they don't go very far</span><span>
</span><span id="line-330"></span><span>                </span><span class="hs-comment">-- We consider these to be /inside/ sfLetFloats</span><span>
</span><span id="line-331"></span><span>                </span><span class="hs-comment">-- because join points can refer to ordinary bindings,</span><span>
</span><span id="line-332"></span><span>                </span><span class="hs-comment">-- but not vice versa</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-comment">-- Includes all variables bound by sfLetFloats and</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-comment">-- sfJoinFloats, plus at least whatever is in scope where</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-comment">-- these bindings land up.</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="sfInScope"><span class="annot"><span class="annottext">SimplFloats -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var hs-var">sfInScope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>  </span><span class="hs-comment">-- All OutVars</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>  </span><span id="local-6989586621681872366"><span class="annot"><span class="annottext">ppr :: SimplFloats -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872367"><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872367"><span class="hs-identifier hs-var">lf</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872368"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872368"><span class="hs-identifier hs-var">jf</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: SimplFloats -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872369"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872369"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SimplFloats&quot;</span></span><span>
</span><span id="line-343"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lets: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LetFloats -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872367"><span class="hs-identifier hs-var">lf</span></a></span><span>
</span><span id="line-344"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;joins:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872368"><span class="hs-identifier hs-var">jf</span></a></span><span>
</span><span id="line-345"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in_scope:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872369"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#emptyFloats"><span class="hs-identifier hs-type">emptyFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span>
</span><span id="line-348"></span><span id="emptyFloats"><span class="annot"><span class="annottext">emptyFloats :: SimplEnv -&gt; SimplFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyFloats"><span class="hs-identifier hs-var hs-var">emptyFloats</span></a></span></span><span> </span><span id="local-6989586621681872371"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872371"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyLetFloats"><span class="hs-identifier hs-var">emptyLetFloats</span></a></span><span>
</span><span id="line-350"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyJoinFloats"><span class="hs-identifier hs-var">emptyJoinFloats</span></a></span><span>
</span><span id="line-351"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872371"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyFloats"><span class="hs-identifier hs-type">isEmptyFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- Precondition: used only when sfJoinFloats is empty</span><span>
</span><span id="line-355"></span><span id="isEmptyFloats"><span class="annot"><span class="annottext">isEmptyFloats :: SimplFloats -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyFloats"><span class="hs-identifier hs-var hs-var">isEmptyFloats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872373"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872373"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-356"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872374"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872374"><span class="hs-identifier hs-var">js</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872374"><span class="hs-identifier hs-var">js</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872374"><span class="hs-identifier hs-var">js</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872373"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#pprSimplEnv"><span class="hs-identifier hs-type">pprSimplEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-361"></span><span class="hs-comment">-- Used for debugging; selective</span><span>
</span><span id="line-362"></span><span id="pprSimplEnv"><span class="annot"><span class="annottext">pprSimplEnv :: SimplEnv -&gt; SDoc
</span><a href="GHC.Core.Opt.Simplify.Env.html#pprSimplEnv"><span class="hs-identifier hs-var hs-var">pprSimplEnv</span></a></span></span><span> </span><span id="local-6989586621681872377"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872377"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TvSubst:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TvSubstEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; TvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872377"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-364"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CvSubst:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CvSubstEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; CvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872377"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-365"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IdSubst:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681872378"><span class="hs-identifier hs-var">id_subst_doc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-366"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InScope:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681872379"><span class="hs-identifier hs-var">in_scope_vars_doc</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-369"></span><span>   </span><span id="local-6989586621681872378"><span class="annot"><span class="annottext">id_subst_doc :: SDoc
</span><a href="#local-6989586621681872378"><span class="hs-identifier hs-var hs-var">id_subst_doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SimplSR -&gt; SDoc) -&gt; SimplIdSubst -&gt; SDoc
forall a key. (a -&gt; SDoc) -&gt; UniqFM key a -&gt; SDoc
</span><a href="GHC.Types.Unique.FM.html#pprUniqFM"><span class="hs-identifier hs-var">pprUniqFM</span></a></span><span> </span><span class="annot"><span class="annottext">SimplSR -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872377"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>   </span><span id="local-6989586621681872379"><span class="annot"><span class="annottext">in_scope_vars_doc :: SDoc
</span><a href="#local-6989586621681872379"><span class="hs-identifier hs-var hs-var">in_scope_vars_doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; ([OutId] -&gt; SDoc) -&gt; SDoc
</span><a href="GHC.Types.Var.Set.html#pprVarSet"><span class="hs-identifier hs-var">pprVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; VarSet
</span><a href="GHC.Types.Var.Env.html#getInScopeVars"><span class="hs-identifier hs-var">getInScopeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872377"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; ([OutId] -&gt; [SDoc]) -&gt; [OutId] -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(OutId -&gt; SDoc) -&gt; [OutId] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; SDoc
</span><a href="#local-6989586621681872383"><span class="hs-identifier hs-var">ppr_one</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>   </span><span id="local-6989586621681872383"><span class="annot"><span class="annottext">ppr_one :: OutId -&gt; SDoc
</span><a href="#local-6989586621681872383"><span class="hs-identifier hs-var hs-var">ppr_one</span></a></span></span><span> </span><span id="local-6989586621681872389"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872389"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isId"><span class="hs-identifier hs-var">isId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872389"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872389"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdUnfoldingFun
</span><a href="GHC.Types.Id.html#idUnfolding"><span class="hs-identifier hs-var">idUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872389"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872389"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-keyword">type</span><span> </span><span id="SimplIdSubst"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplIdSubst"><span class="hs-identifier hs-var">SimplIdSubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplSR"><span class="hs-identifier hs-type">SimplSR</span></a></span><span> </span><span class="hs-comment">-- IdId |--&gt; OutExpr</span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-comment">-- See Note [Extending the IdSubstEnv] in GHC.Core.Subst</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="annot"><span class="hs-comment">-- | A substitution result.</span></span><span>
</span><span id="line-379"></span><span class="hs-keyword">data</span><span> </span><span id="SimplSR"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplSR"><span class="hs-identifier hs-var">SimplSR</span></a></span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DoneEx"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#DoneEx"><span class="hs-identifier hs-var">DoneEx</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>       </span><span class="hs-comment">-- If  x :-&gt; DoneEx e ja   is in the SimplIdSubst</span><span>
</span><span id="line-382"></span><span>       </span><span class="hs-comment">-- then replace occurrences of x by e</span><span>
</span><span id="line-383"></span><span>       </span><span class="hs-comment">-- and  ja = Just a &lt;=&gt; x is a join-point of arity a</span><span>
</span><span id="line-384"></span><span>       </span><span class="hs-comment">-- See Note [Join arity in SimplIdSubst]</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DoneId"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#DoneId"><span class="hs-identifier hs-var">DoneId</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#OutId"><span class="hs-identifier hs-type">OutId</span></a></span><span>
</span><span id="line-388"></span><span>       </span><span class="hs-comment">-- If  x :-&gt; DoneId v   is in the SimplIdSubst</span><span>
</span><span id="line-389"></span><span>       </span><span class="hs-comment">-- then replace occurrences of x by v</span><span>
</span><span id="line-390"></span><span>       </span><span class="hs-comment">-- and  v is a join-point of arity a</span><span>
</span><span id="line-391"></span><span>       </span><span class="hs-comment">--      &lt;=&gt; x is a join-point of arity a</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ContEx"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#ContEx"><span class="hs-identifier hs-var">ContEx</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a></span><span>                 </span><span class="hs-comment">-- A suspended substitution</span><span>
</span><span id="line-394"></span><span>           </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a></span><span>
</span><span id="line-395"></span><span>           </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplIdSubst"><span class="hs-identifier hs-type">SimplIdSubst</span></a></span><span>
</span><span id="line-396"></span><span>           </span><span class="annot"><a href="GHC.Core.html#InExpr"><span class="hs-identifier hs-type">InExpr</span></a></span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-comment">-- If   x :-&gt; ContEx tv cv id e   is in the SimplISubst</span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-comment">-- then replace occurrences of x by (subst (tv,cv,id) e)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplSR"><span class="hs-identifier hs-type">SimplSR</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621681872414"><span class="annot"><span class="annottext">ppr :: SimplSR -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#DoneId"><span class="hs-identifier hs-type">DoneId</span></a></span><span> </span><span id="local-6989586621681872415"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872415"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DoneId&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872415"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#DoneEx"><span class="hs-identifier hs-type">DoneEx</span></a></span><span> </span><span id="local-6989586621681872416"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872416"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681872417"><span class="annot"><span class="annottext">Maybe JoinArity
</span><a href="#local-6989586621681872417"><span class="hs-identifier hs-var">mj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DoneEx&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681872418"><span class="hs-identifier hs-var">pp_mj</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872416"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-404"></span><span>      </span><span id="local-6989586621681872418"><span class="annot"><span class="annottext">pp_mj :: SDoc
</span><a href="#local-6989586621681872418"><span class="hs-identifier hs-var hs-var">pp_mj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe JoinArity
</span><a href="#local-6989586621681872417"><span class="hs-identifier hs-var">mj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>                </span><span class="annot"><span class="annottext">Maybe JoinArity
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-406"></span><span>                </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681872420"><span class="annot"><span class="annottext">JoinArity
</span><a href="#local-6989586621681872420"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinArity -&gt; SDoc
forall doc. IsLine doc =&gt; JoinArity -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">JoinArity
</span><a href="#local-6989586621681872420"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#ContEx"><span class="hs-identifier hs-type">ContEx</span></a></span><span> </span><span id="local-6989586621681872423"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872423"><span class="hs-identifier hs-var">_tv</span></a></span></span><span> </span><span id="local-6989586621681872424"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872424"><span class="hs-identifier hs-var">_cv</span></a></span></span><span> </span><span id="local-6989586621681872425"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872425"><span class="hs-identifier hs-var">_id</span></a></span></span><span> </span><span id="local-6989586621681872426"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872426"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ContEx&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872426"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">{-,
                                ppr (filter_env tv), ppr (filter_env id) -}</span><span class="hs-special">]</span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-comment">-- where</span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-comment">-- fvs = exprFreeVars e</span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-comment">-- filter_env env = filterVarEnv_Directly keep env</span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-comment">-- keep uniq _ = uniq `elemUFM_Directly` fvs</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="hs-comment">{-
Note [SimplEnv invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~~
seInScope:
        The in-scope part of Subst includes *all* in-scope TyVars and Ids
        The elements of the set may have better IdInfo than the
        occurrences of in-scope Ids, and (more important) they will
        have a correctly-substituted type.  So we use a lookup in this
        set to replace occurrences

        The Ids in the InScopeSet are replete with their Rules,
        and as we gather info about the unfolding of an Id, we replace
        it in the in-scope set.

        The in-scope set is actually a mapping OutVar -&gt; OutVar, and
        in case expressions we sometimes bind

seIdSubst:
        The substitution is *apply-once* only, because InIds and OutIds
        can overlap.
        For example, we generally omit mappings
                a77 -&gt; a77
        from the substitution, when we decide not to clone a77, but it's quite
        legitimate to put the mapping in the substitution anyway.

        Furthermore, consider
                let x = case k of I# x77 -&gt; ... in
                let y = case k of I# x77 -&gt; ... in ...
        and suppose the body is strict in both x and y.  Then the simplifier
        will pull the first (case k) to the top; so the second (case k) will
        cancel out, mapping x77 to, well, x77!  But one is an in-Id and the
        other is an out-Id.

        Of course, the substitution *must* applied! Things in its domain
        simply aren't necessarily bound in the result.

* substId adds a binding (DoneId new_id) to the substitution if
        the Id's unique has changed

  Note, though that the substitution isn't necessarily extended
  if the type of the Id changes.  Why not?  Because of the next point:

* We *always, always* finish by looking up in the in-scope set
  any variable that doesn't get a DoneEx or DoneVar hit in the substitution.
  Reason: so that we never finish up with a &quot;old&quot; Id in the result.
  An old Id might point to an old unfolding and so on... which gives a space
  leak.

  [The DoneEx and DoneVar hits map to &quot;new&quot; stuff.]

* It follows that substExpr must not do a no-op if the substitution is empty.
  substType is free to do so, however.

* When we come to a let-binding (say) we generate new IdInfo, including an
  unfolding, attach it to the binder, and add this newly adorned binder to
  the in-scope set.  So all subsequent occurrences of the binder will get
  mapped to the full-adorned binder, which is also the one put in the
  binding site.

* The in-scope &quot;set&quot; usually maps x-&gt;x; we use it simply for its domain.
  But sometimes we have two in-scope Ids that are synonyms, and should
  map to the same target:  x-&gt;x, y-&gt;x.  Notably:
        case y of x { ... }
  That's why the &quot;set&quot; is actually a VarEnv Var

Note [Join arity in SimplIdSubst]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We have to remember which incoming variables are join points: the occurrences
may not be marked correctly yet, and we're in change of propagating the change if
OccurAnal makes something a join point).

Normally the in-scope set is where we keep the latest information, but
the in-scope set tracks only OutVars; if a binding is unconditionally
inlined (via DoneEx), it never makes it into the in-scope set, and we
need to know at the occurrence site that the variable is a join point
so that we know to drop the context. Thus we remember which join
points we're substituting. -}</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkSimplEnv"><span class="hs-identifier hs-type">mkSimplEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-494"></span><span id="mkSimplEnv"><span class="annot"><span class="annottext">mkSimplEnv :: SimplMode -&gt; (FamInstEnv, FamInstEnv) -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#mkSimplEnv"><span class="hs-identifier hs-var hs-var">mkSimplEnv</span></a></span></span><span> </span><span id="local-6989586621681872427"><span class="annot"><span class="annottext">SimplMode
</span><a href="#local-6989586621681872427"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621681872428"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621681872428"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seMode :: SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode
</span><a href="#local-6989586621681872427"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-496"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seFamEnvs :: (FamInstEnv, FamInstEnv)
</span><a href="GHC.Core.Opt.Simplify.Env.html#seFamEnvs"><span class="hs-identifier hs-var">seFamEnvs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621681872428"><span class="hs-identifier hs-var">fam_envs</span></a></span><span>
</span><span id="line-497"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#init_in_scope"><span class="hs-identifier hs-var">init_in_scope</span></a></span><span>
</span><span id="line-498"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seTvSubst :: TvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TvSubstEnv
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-499"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seCvSubst :: CvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CvSubstEnv
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-500"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seIdSubst :: SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplIdSubst
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-501"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seRecIds :: UnVarSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seRecIds"><span class="hs-identifier hs-var">seRecIds</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnVarSet
</span><a href="GHC.Data.Graph.UnVar.html#emptyUnVarSet"><span class="hs-identifier hs-var">emptyUnVarSet</span></a></span><span>
</span><span id="line-502"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seCaseDepth :: JoinArity
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCaseDepth"><span class="hs-identifier hs-var">seCaseDepth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinArity
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-comment">-- The top level &quot;enclosing CC&quot; is &quot;SUBSUMED&quot;.</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#init_in_scope"><span class="hs-identifier hs-type">init_in_scope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-506"></span><span id="init_in_scope"><span class="annot"><span class="annottext">init_in_scope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#init_in_scope"><span class="hs-identifier hs-var hs-var">init_in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unitVarSet"><span class="hs-identifier hs-var">unitVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; OutId
</span><a href="GHC.Core.Make.html#mkWildValBinder"><span class="hs-identifier hs-var">mkWildValBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>              </span><span class="hs-comment">-- See Note [WildCard binders]</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="hs-comment">{-
Note [WildCard binders]
~~~~~~~~~~~~~~~~~~~~~~~
The program to be simplified may have wild binders
    case e of wild { p -&gt; ... }
We want to *rename* them away, so that there are no
occurrences of 'wild-id' (with wildCardKey).  The easy
way to do that is to start of with a representative
Id in the in-scope set

There can be *occurrences* of wild-id.  For example,
GHC.Core.Make.mkCoreApp transforms
   e (a /# b)   --&gt;   case (a /# b) of wild { DEFAULT -&gt; e wild }
This is ok provided 'wild' isn't free in 'e', and that's the delicate
thing. Generally, you want to run the simplifier to get rid of the
wild-ids before doing much else.

It's a very dark corner of GHC.  Maybe it should be cleaned up.
-}</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#updMode"><span class="hs-identifier hs-type">updMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-530"></span><span id="updMode"><span class="annot"><span class="annottext">updMode :: (SimplMode -&gt; SimplMode) -&gt; SimplEnv -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#updMode"><span class="hs-identifier hs-var hs-var">updMode</span></a></span></span><span> </span><span id="local-6989586621681872436"><span class="annot"><span class="annottext">SimplMode -&gt; SimplMode
</span><a href="#local-6989586621681872436"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621681872437"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872437"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Avoid keeping env alive in case inlining fails.</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681872438"><span class="annot"><span class="annottext">mode :: SimplMode
</span><a href="#local-6989586621681872438"><span class="hs-identifier hs-var hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode -&gt; SimplMode
</span><a href="#local-6989586621681872436"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">(SimplMode -&gt; SimplMode) -&gt; SimplMode -&gt; SimplMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplMode
</span><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872437"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872437"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seMode"><span class="hs-identifier hs-var">seMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872438"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#bumpCaseDepth"><span class="hs-identifier hs-type">bumpCaseDepth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-536"></span><span id="bumpCaseDepth"><span class="annot"><span class="annottext">bumpCaseDepth :: SimplEnv -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#bumpCaseDepth"><span class="hs-identifier hs-var hs-var">bumpCaseDepth</span></a></span></span><span> </span><span id="local-6989586621681872440"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872440"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872440"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseDepth"><span class="hs-identifier hs-var">seCaseDepth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCaseDepth"><span class="hs-identifier hs-var">seCaseDepth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872440"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-type">+</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-539"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendIdSubst"><span class="hs-identifier hs-type">extendIdSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplSR"><span class="hs-identifier hs-type">SimplSR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-540"></span><span id="extendIdSubst"><span class="annot"><span class="annottext">extendIdSubst :: SimplEnv -&gt; OutId -&gt; SimplSR -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#extendIdSubst"><span class="hs-identifier hs-var hs-var">extendIdSubst</span></a></span></span><span> </span><span id="local-6989586621681872442"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872442"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">seIdSubst :: SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872443"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872443"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872444"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872444"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621681872445"><span class="annot"><span class="annottext">SimplSR
</span><a href="#local-6989586621681872445"><span class="hs-identifier hs-var">res</span></a></span></span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SimplEnv -&gt; SimplEnv
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isId"><span class="hs-identifier hs-var">isId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872444"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872444"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872444"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SimplEnv -&gt; SimplEnv) -&gt; SimplEnv -&gt; SimplEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-542"></span><span>    </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872442"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-type">extendVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872443"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872444"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872445"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendTvSubst"><span class="hs-identifier hs-type">extendTvSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-545"></span><span id="extendTvSubst"><span class="annot"><span class="annottext">extendTvSubst :: SimplEnv -&gt; OutId -&gt; Kind -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#extendTvSubst"><span class="hs-identifier hs-var hs-var">extendTvSubst</span></a></span></span><span> </span><span id="local-6989586621681872452"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872452"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">seTvSubst :: SimplEnv -&gt; TvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872453"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872453"><span class="hs-identifier hs-var">tsubst</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872454"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872454"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621681872455"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872455"><span class="hs-identifier hs-var">res</span></a></span></span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SimplEnv -&gt; SimplEnv
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872454"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872454"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872455"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SimplEnv -&gt; SimplEnv) -&gt; SimplEnv -&gt; SimplEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-547"></span><span>    </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872452"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-type">extendVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872453"><span class="hs-identifier hs-type">tsubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872454"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872455"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendCvSubst"><span class="hs-identifier hs-type">extendCvSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-550"></span><span id="extendCvSubst"><span class="annot"><span class="annottext">extendCvSubst :: SimplEnv -&gt; OutId -&gt; Coercion -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#extendCvSubst"><span class="hs-identifier hs-var hs-var">extendCvSubst</span></a></span></span><span> </span><span id="local-6989586621681872459"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872459"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">seCvSubst :: SimplEnv -&gt; CvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872460"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872460"><span class="hs-identifier hs-var">csubst</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872461"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872461"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621681872462"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681872462"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-551"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SimplEnv -&gt; SimplEnv
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872461"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SimplEnv -&gt; SimplEnv) -&gt; SimplEnv -&gt; SimplEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872459"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-type">extendVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872460"><span class="hs-identifier hs-type">csubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872461"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872462"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-555"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#getInScope"><span class="hs-identifier hs-type">getInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-556"></span><span id="getInScope"><span class="annot"><span class="annottext">getInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#getInScope"><span class="hs-identifier hs-var hs-var">getInScope</span></a></span></span><span> </span><span id="local-6989586621681872464"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872464"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872464"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeSet"><span class="hs-identifier hs-type">setInScopeSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-559"></span><span id="setInScopeSet"><span class="annot"><span class="annottext">setInScopeSet :: SimplEnv -&gt; InScopeSet -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeSet"><span class="hs-identifier hs-var hs-var">setInScopeSet</span></a></span></span><span> </span><span id="local-6989586621681872465"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872465"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872466"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872466"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872465"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872466"><span class="hs-identifier hs-type">in_scope</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeFromE"><span class="hs-identifier hs-type">setInScopeFromE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-562"></span><span class="hs-comment">-- See Note [Setting the right in-scope set]</span><span>
</span><span id="line-563"></span><span id="setInScopeFromE"><span class="annot"><span class="annottext">setInScopeFromE :: SimplEnv -&gt; SimplEnv -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeFromE"><span class="hs-identifier hs-var hs-var">setInScopeFromE</span></a></span></span><span> </span><span id="local-6989586621681872467"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872467"><span class="hs-identifier hs-var">rhs_env</span></a></span></span><span> </span><span id="local-6989586621681872468"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872468"><span class="hs-identifier hs-var">here_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872467"><span class="hs-identifier hs-var">rhs_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872468"><span class="hs-identifier hs-type">here_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeFromF"><span class="hs-identifier hs-type">setInScopeFromF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-566"></span><span id="setInScopeFromF"><span class="annot"><span class="annottext">setInScopeFromF :: SimplEnv -&gt; SimplFloats -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#setInScopeFromF"><span class="hs-identifier hs-var hs-var">setInScopeFromF</span></a></span></span><span> </span><span id="local-6989586621681872469"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872469"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872470"><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872470"><span class="hs-identifier hs-var">floats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872469"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872470"><span class="hs-identifier hs-type">floats</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addNewInScopeIds"><span class="hs-identifier hs-type">addNewInScopeIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-comment">-- The new Ids are guaranteed to be freshly allocated</span><span>
</span><span id="line-570"></span><span id="addNewInScopeIds"><span class="annot"><span class="annottext">addNewInScopeIds :: SimplEnv -&gt; [OutId] -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#addNewInScopeIds"><span class="hs-identifier hs-var hs-var">addNewInScopeIds</span></a></span></span><span> </span><span id="local-6989586621681872472"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872472"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872473"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872473"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seIdSubst :: SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872474"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872474"><span class="hs-identifier hs-var">id_subst</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872475"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872475"><span class="hs-identifier hs-var">vs</span></a></span></span><span>
</span><span id="line-571"></span><span class="hs-comment">-- See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681872476"><span class="annot"><span class="annottext">in_scope1 :: InScopeSet
</span><a href="#local-6989586621681872476"><span class="hs-identifier hs-var hs-var">in_scope1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872473"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; [OutId] -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#extendInScopeSetList"><span class="hs-operator hs-var">`extendInScopeSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872475"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621681872478"><span class="annot"><span class="annottext">id_subst1 :: SimplIdSubst
</span><a href="#local-6989586621681872478"><span class="hs-identifier hs-var hs-var">id_subst1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872474"><span class="hs-identifier hs-var">id_subst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplIdSubst -&gt; [OutId] -&gt; SimplIdSubst
forall a. VarEnv a -&gt; [OutId] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#delVarEnvList"><span class="hs-operator hs-var">`delVarEnvList`</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872475"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872472"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872476"><span class="hs-identifier hs-type">in_scope1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-576"></span><span>          </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872478"><span class="hs-identifier hs-type">id_subst1</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-comment">-- Why delete?  Consider</span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-comment">--      let x = a*b in (x, \x -&gt; x+3)</span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-comment">-- We add [x |-&gt; a*b] to the substitution, but we must</span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-comment">-- _delete_ it from the substitution when going inside</span><span>
</span><span id="line-581"></span><span>        </span><span class="hs-comment">-- the (\x -&gt; ...)!</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#modifyInScope"><span class="hs-identifier hs-type">modifyInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-584"></span><span class="hs-comment">-- The variable should already be in scope, but</span><span>
</span><span id="line-585"></span><span class="hs-comment">-- replace the existing version with this new one</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- which has more information</span><span>
</span><span id="line-587"></span><span id="modifyInScope"><span class="annot"><span class="annottext">modifyInScope :: SimplEnv -&gt; OutId -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#modifyInScope"><span class="hs-identifier hs-var hs-var">modifyInScope</span></a></span></span><span> </span><span id="local-6989586621681872480"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872480"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">seInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872481"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872481"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872482"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872482"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872480"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#extendInScopeSet"><span class="hs-identifier hs-type">extendInScopeSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872481"><span class="hs-identifier hs-type">in_scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872482"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span id="local-6989586621681871988"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#enterRecGroupRHSs"><span class="hs-identifier hs-type">enterRecGroupRHSs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681871988"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681871988"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-592"></span><span id="enterRecGroupRHSs"><span class="annot"><span class="annottext">enterRecGroupRHSs :: forall r.
SimplEnv
-&gt; [OutId]
-&gt; (SimplEnv -&gt; SimplM (r, SimplEnv))
-&gt; SimplM (r, SimplEnv)
</span><a href="GHC.Core.Opt.Simplify.Env.html#enterRecGroupRHSs"><span class="hs-identifier hs-var hs-var">enterRecGroupRHSs</span></a></span></span><span> </span><span id="local-6989586621681872487"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872487"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872488"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872488"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621681872489"><span class="annot"><span class="annottext">SimplEnv -&gt; SimplM (r, SimplEnv)
</span><a href="#local-6989586621681872489"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-comment">--pprTraceM &quot;enterRecGroupRHSs&quot; (ppr bndrs)</span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681872490"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681872490"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872491"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872491"><span class="hs-identifier hs-var">env''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplM (r, SimplEnv)
</span><a href="#local-6989586621681872489"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872487"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRecIds"><span class="hs-identifier hs-var">seRecIds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Graph.UnVar.html#extendUnVarSetList"><span class="hs-identifier hs-type">extendUnVarSetList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872488"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRecIds"><span class="hs-identifier hs-var">seRecIds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872487"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-595"></span><span>  </span><span class="annot"><span class="annottext">(r, SimplEnv) -&gt; SimplM (r, SimplEnv)
forall a. a -&gt; SimplM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681872490"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872491"><span class="hs-identifier hs-var">env''</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRecIds"><span class="hs-identifier hs-var">seRecIds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seRecIds"><span class="hs-identifier hs-var">seRecIds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872487"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span class="hs-comment">{- Note [Setting the right in-scope set]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  \x. (let x = e in b) arg[x]
where the let shadows the lambda.  Really this means something like
  \x1. (let x2 = e in b) arg[x1]

- When we capture the 'arg' in an ApplyToVal continuation, we capture
  the environment, which says what 'x' is bound to, namely x1

- Then that continuation gets pushed under the let

- Finally we simplify 'arg'.  We want
     - the static, lexical environment binding x :-&gt; x1
     - the in-scopeset from &quot;here&quot;, under the 'let' which includes
       both x1 and x2

It's important to have the right in-scope set, else we may rename a
variable to one that is already in scope.  So we must pick up the
in-scope set from &quot;here&quot;, but otherwise use the environment we
captured along with 'arg'.  This transfer of in-scope set is done by
setInScopeFromE.
-}</span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-622"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#zapSubstEnv"><span class="hs-identifier hs-type">zapSubstEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-623"></span><span id="zapSubstEnv"><span class="annot"><span class="annottext">zapSubstEnv :: SimplEnv -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#zapSubstEnv"><span class="hs-identifier hs-var hs-var">zapSubstEnv</span></a></span></span><span> </span><span id="local-6989586621681872493"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872493"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872493"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-type">emptyVarEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-type">emptyVarEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-type">emptyVarEnv</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#setSubstEnv"><span class="hs-identifier hs-type">setSubstEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplIdSubst"><span class="hs-identifier hs-type">SimplIdSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-626"></span><span id="setSubstEnv"><span class="annot"><span class="annottext">setSubstEnv :: SimplEnv -&gt; TvSubstEnv -&gt; CvSubstEnv -&gt; SimplIdSubst -&gt; SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#setSubstEnv"><span class="hs-identifier hs-var hs-var">setSubstEnv</span></a></span></span><span> </span><span id="local-6989586621681872494"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872494"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872495"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872495"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681872496"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872496"><span class="hs-identifier hs-var">cvs</span></a></span></span><span> </span><span id="local-6989586621681872497"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872497"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872494"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872495"><span class="hs-identifier hs-type">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872496"><span class="hs-identifier hs-type">cvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872497"><span class="hs-identifier hs-type">ids</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkContEx"><span class="hs-identifier hs-type">mkContEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InExpr"><span class="hs-identifier hs-type">InExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplSR"><span class="hs-identifier hs-type">SimplSR</span></a></span><span>
</span><span id="line-629"></span><span id="mkContEx"><span class="annot"><span class="annottext">mkContEx :: SimplEnv -&gt; OutExpr -&gt; SimplSR
</span><a href="GHC.Core.Opt.Simplify.Env.html#mkContEx"><span class="hs-identifier hs-var hs-var">mkContEx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seTvSubst :: SimplEnv -&gt; TvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872498"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872498"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seCvSubst :: SimplEnv -&gt; CvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872499"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872499"><span class="hs-identifier hs-var">cvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seIdSubst :: SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872500"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872500"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872501"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872501"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TvSubstEnv -&gt; CvSubstEnv -&gt; SimplIdSubst -&gt; OutExpr -&gt; SimplSR
</span><a href="GHC.Core.Opt.Simplify.Env.html#ContEx"><span class="hs-identifier hs-var">ContEx</span></a></span><span> </span><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872498"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872499"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872500"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872501"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{LetFloats}
*                                                                      *
************************************************************************

Note [LetFloats]
~~~~~~~~~~~~~~~~
The LetFloats is a bunch of bindings, classified by a FloatFlag.

The `FloatFlag` contains summary information about the bindings, see the data
type declaration of `FloatFlag`

Examples

  NonRec x (y:ys)       FltLifted
  Rec [(x,rhs)]         FltLifted

  NonRec x* (p:q)       FltOKSpec   -- RHS is WHNF.  Question: why not FltLifted?
  NonRec x# (y +# 3)    FltOkSpec   -- Unboxed, but ok-for-spec'n

  NonRec x* (f y)       FltCareful  -- Strict binding; might fail or diverge
  NonRec x# (a /# b)    FltCareful  -- Might fail; does not satisfy let-can-float invariant
  NonRec x# (f y)       FltCareful  -- Might diverge; does not satisfy let-can-float invariant
-}</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span class="hs-keyword">data</span><span> </span><span id="LetFloats"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-var">LetFloats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LetFloats"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-var">LetFloats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#OutBind"><span class="hs-identifier hs-type">OutBind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatFlag"><span class="hs-identifier hs-type">FloatFlag</span></a></span><span>
</span><span id="line-659"></span><span>                 </span><span class="hs-comment">-- See Note [LetFloats]</span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-keyword">type</span><span> </span><span id="JoinFloat"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloat"><span class="hs-identifier hs-var">JoinFloat</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBind"><span class="hs-identifier hs-type">OutBind</span></a></span><span>
</span><span id="line-662"></span><span class="hs-keyword">type</span><span> </span><span id="JoinFloats"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-var">JoinFloats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloat"><span class="hs-identifier hs-type">JoinFloat</span></a></span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span class="hs-keyword">data</span><span> </span><span id="FloatFlag"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatFlag"><span class="hs-identifier hs-var">FloatFlag</span></a></span></span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="FltLifted"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span></span><span>   </span><span class="hs-comment">-- All bindings are lifted and lazy *or*</span><span>
</span><span id="line-666"></span><span>                </span><span class="hs-comment">--     consist of a single primitive string literal</span><span>
</span><span id="line-667"></span><span>                </span><span class="hs-comment">-- Hence ok to float to top level, or recursive</span><span>
</span><span id="line-668"></span><span>                </span><span class="hs-comment">-- NB: consequence: all bindings satisfy let-can-float invariant</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FltOkSpec"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FltOkSpec"><span class="hs-identifier hs-var">FltOkSpec</span></a></span></span><span>   </span><span class="hs-comment">-- All bindings are FltLifted *or*</span><span>
</span><span id="line-671"></span><span>                </span><span class="hs-comment">--      strict (perhaps because unlifted,</span><span>
</span><span id="line-672"></span><span>                </span><span class="hs-comment">--      perhaps because of a strict binder),</span><span>
</span><span id="line-673"></span><span>                </span><span class="hs-comment">--        *and* ok-for-speculation</span><span>
</span><span id="line-674"></span><span>                </span><span class="hs-comment">-- Hence ok to float out of the RHS</span><span>
</span><span id="line-675"></span><span>                </span><span class="hs-comment">-- of a lazy non-recursive let binding</span><span>
</span><span id="line-676"></span><span>                </span><span class="hs-comment">-- (but not to top level, or into a rec group)</span><span>
</span><span id="line-677"></span><span>                </span><span class="hs-comment">-- NB: consequence: all bindings satisfy let-can-float invariant</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FltCareful"><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span></span><span>  </span><span class="hs-comment">-- At least one binding is strict (or unlifted)</span><span>
</span><span id="line-680"></span><span>                </span><span class="hs-comment">--      and not guaranteed cheap</span><span>
</span><span id="line-681"></span><span>                </span><span class="hs-comment">-- Do not float these bindings out of a lazy let!</span><span>
</span><span id="line-682"></span><span>                </span><span class="hs-comment">-- NB: some bindings may not satisfy let-can-float</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-685"></span><span>  </span><span id="local-6989586621681872512"><span class="annot"><span class="annottext">ppr :: LetFloats -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872513"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872513"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621681872514"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872514"><span class="hs-identifier hs-var">ff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872514"><span class="hs-identifier hs-var">ff</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Bind OutId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; [Bind OutId]
forall a. OrdList a -&gt; [a]
</span><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-var">fromOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872513"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatFlag"><span class="hs-identifier hs-type">FloatFlag</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-688"></span><span>  </span><span id="local-6989586621681872520"><span class="annot"><span class="annottext">ppr :: FloatFlag -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FltLifted&quot;</span></span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltOkSpec"><span class="hs-identifier hs-var">FltOkSpec</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FltOkSpec&quot;</span></span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FltCareful&quot;</span></span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#andFF"><span class="hs-identifier hs-type">andFF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatFlag"><span class="hs-identifier hs-type">FloatFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatFlag"><span class="hs-identifier hs-type">FloatFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatFlag"><span class="hs-identifier hs-type">FloatFlag</span></a></span><span>
</span><span id="line-693"></span><span id="andFF"><span class="annot"><span class="annottext">andFF :: FloatFlag -&gt; FloatFlag -&gt; FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#andFF"><span class="hs-identifier hs-var hs-var">andFF</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span>
</span><span id="line-694"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#andFF"><span class="hs-identifier hs-var">andFF</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltOkSpec"><span class="hs-identifier hs-var">FltOkSpec</span></a></span><span>  </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span>
</span><span id="line-695"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#andFF"><span class="hs-identifier hs-var">andFF</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltOkSpec"><span class="hs-identifier hs-var">FltOkSpec</span></a></span><span>  </span><span class="annot"><span class="annottext">FloatFlag
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltOkSpec"><span class="hs-identifier hs-var">FltOkSpec</span></a></span><span>
</span><span id="line-696"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#andFF"><span class="hs-identifier hs-var">andFF</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span><span>  </span><span id="local-6989586621681872522"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872522"><span class="hs-identifier hs-var">flt</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872522"><span class="hs-identifier hs-var">flt</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#doFloatFromRhs"><span class="hs-identifier hs-type">doFloatFromRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnable"><span class="hs-identifier hs-type">FloatEnable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-700"></span><span class="hs-comment">-- If you change this function look also at FloatIn.noFloatIntoRhs</span><span>
</span><span id="line-701"></span><span id="doFloatFromRhs"><span class="annot"><span class="annottext">doFloatFromRhs :: FloatEnable
-&gt; TopLevelFlag
-&gt; RecFlag
-&gt; Bool
-&gt; SimplFloats
-&gt; OutExpr
-&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#doFloatFromRhs"><span class="hs-identifier hs-var hs-var">doFloatFromRhs</span></a></span></span><span> </span><span id="local-6989586621681872523"><span class="annot"><span class="annottext">FloatEnable
</span><a href="#local-6989586621681872523"><span class="hs-identifier hs-var">fe</span></a></span></span><span> </span><span id="local-6989586621681872524"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681872524"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621681872525"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621681872525"><span class="hs-identifier hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621681872526"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872526"><span class="hs-identifier hs-var">strict_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872527"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872527"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621681872528"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872528"><span class="hs-identifier hs-var">ff</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872529"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872529"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; FloatEnable -&gt; Bool
</span><a href="#local-6989586621681872530"><span class="hs-identifier hs-var">floatEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681872524"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">FloatEnable
</span><a href="#local-6989586621681872523"><span class="hs-identifier hs-var">fe</span></a></span><span>
</span><span id="line-703"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872527"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872531"><span class="hs-identifier hs-var">want_to_float</span></a></span><span>
</span><span id="line-705"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872532"><span class="hs-identifier hs-var">can_float</span></a></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-707"></span><span>     </span><span id="local-6989586621681872531"><span class="annot"><span class="annottext">want_to_float :: Bool
</span><a href="#local-6989586621681872531"><span class="hs-identifier hs-var hs-var">want_to_float</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681872524"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">OutExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsCheap"><span class="hs-identifier hs-var">exprIsCheap</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872529"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">OutExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsExpandable"><span class="hs-identifier hs-var">exprIsExpandable</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872529"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-708"></span><span>                     </span><span class="hs-comment">-- See Note [Float when cheap or expandable]</span><span>
</span><span id="line-709"></span><span>     </span><span id="local-6989586621681872532"><span class="annot"><span class="annottext">can_float :: Bool
</span><a href="#local-6989586621681872532"><span class="hs-identifier hs-var hs-var">can_float</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872528"><span class="hs-identifier hs-var">ff</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-710"></span><span>                   </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-711"></span><span>                   </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltOkSpec"><span class="hs-identifier hs-var">FltOkSpec</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isNotTopLevel"><span class="hs-identifier hs-var">isNotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681872524"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">RecFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isNonRec"><span class="hs-identifier hs-var">isNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621681872525"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-712"></span><span>                   </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isNotTopLevel"><span class="hs-identifier hs-var">isNotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681872524"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">RecFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isNonRec"><span class="hs-identifier hs-var">isNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621681872525"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872526"><span class="hs-identifier hs-var">strict_bind</span></a></span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>     </span><span class="hs-comment">-- Whether any floating is allowed by flags.</span><span>
</span><span id="line-715"></span><span>     </span><span class="annot"><a href="#local-6989586621681872530"><span class="hs-identifier hs-type">floatEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnable"><span class="hs-identifier hs-type">FloatEnable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-716"></span><span>     </span><span id="local-6989586621681872530"><span class="annot"><span class="annottext">floatEnabled :: TopLevelFlag -&gt; FloatEnable -&gt; Bool
</span><a href="#local-6989586621681872530"><span class="hs-identifier hs-var hs-var">floatEnabled</span></a></span></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FloatEnable
</span><a href="GHC.Core.Opt.Simplify.Env.html#FloatDisabled"><span class="hs-identifier hs-var">FloatDisabled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-717"></span><span>     </span><span class="annot"><a href="#local-6989586621681872530"><span class="hs-identifier hs-var">floatEnabled</span></a></span><span> </span><span id="local-6989586621681872539"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681872539"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatEnable
</span><a href="GHC.Core.Opt.Simplify.Env.html#FloatNestedOnly"><span class="hs-identifier hs-var">FloatNestedOnly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681872539"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>     </span><span class="annot"><a href="#local-6989586621681872530"><span class="hs-identifier hs-var">floatEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FloatEnable
</span><a href="GHC.Core.Opt.Simplify.Env.html#FloatEnabled"><span class="hs-identifier hs-var">FloatEnabled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">{-
Note [Float when cheap or expandable]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We want to float a let from a let if the residual RHS is
   a) cheap, such as (\x. blah)
   b) expandable, such as (f b) if f is CONLIKE
But there are
  - cheap things that are not expandable (eg \x. expensive)
  - expandable things that are not cheap (eg (f b) where b is CONLIKE)
so we must take the 'or' of the two.
-}</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#emptyLetFloats"><span class="hs-identifier hs-type">emptyLetFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span>
</span><span id="line-733"></span><span id="emptyLetFloats"><span class="annot"><span class="annottext">emptyLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyLetFloats"><span class="hs-identifier hs-var hs-var">emptyLetFloats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; FloatFlag -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-var">LetFloats</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyLetFloats"><span class="hs-identifier hs-type">isEmptyLetFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-736"></span><span id="isEmptyLetFloats"><span class="annot"><span class="annottext">isEmptyLetFloats :: LetFloats -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyLetFloats"><span class="hs-identifier hs-var hs-var">isEmptyLetFloats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872541"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872541"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872541"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#emptyJoinFloats"><span class="hs-identifier hs-type">emptyJoinFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span>
</span><span id="line-739"></span><span id="emptyJoinFloats"><span class="annot"><span class="annottext">emptyJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyJoinFloats"><span class="hs-identifier hs-var hs-var">emptyJoinFloats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyJoinFloats"><span class="hs-identifier hs-type">isEmptyJoinFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-742"></span><span id="isEmptyJoinFloats"><span class="annot"><span class="annottext">isEmptyJoinFloats :: JoinFloats -&gt; Bool
</span><a href="GHC.Core.Opt.Simplify.Env.html#isEmptyJoinFloats"><span class="hs-identifier hs-var hs-var">isEmptyJoinFloats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#unitLetFloat"><span class="hs-identifier hs-type">unitLetFloat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBind"><span class="hs-identifier hs-type">OutBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span>
</span><span id="line-745"></span><span class="hs-comment">-- This key function constructs a singleton float with the right form</span><span>
</span><span id="line-746"></span><span id="unitLetFloat"><span class="annot"><span class="annottext">unitLetFloat :: Bind OutId -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitLetFloat"><span class="hs-identifier hs-var hs-var">unitLetFloat</span></a></span></span><span> </span><span id="local-6989586621681872542"><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872542"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; LetFloats -&gt; LetFloats
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OutId -&gt; Bool) -&gt; [OutId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (OutId -&gt; Bool) -&gt; OutId -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bind OutId -&gt; [OutId]
forall b. Bind b -&gt; [b]
</span><a href="GHC.Core.html#bindersOf"><span class="hs-identifier hs-var">bindersOf</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872542"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LetFloats -&gt; LetFloats) -&gt; LetFloats -&gt; LetFloats
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-747"></span><span>                    </span><span class="annot"><span class="annottext">JoinFloats -&gt; FloatFlag -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-var">LetFloats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bind OutId -&gt; JoinFloats
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872542"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bind OutId -&gt; FloatFlag
</span><a href="#local-6989586621681872547"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872542"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-749"></span><span>    </span><span id="local-6989586621681872547"><span class="annot"><span class="annottext">flag :: Bind OutId -&gt; FloatFlag
</span><a href="#local-6989586621681872547"><span class="hs-identifier hs-var hs-var">flag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span><span>
</span><span id="line-750"></span><span>    </span><span class="annot"><a href="#local-6989586621681872547"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621681872550"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872550"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681872551"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872551"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Id.html#isStrictId"><span class="hs-identifier hs-var">isStrictId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872550"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span><span>
</span><span id="line-752"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OutExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsTickedString"><span class="hs-identifier hs-var">exprIsTickedString</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872551"><span class="hs-identifier hs-var">rhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltLifted"><span class="hs-identifier hs-var">FltLifted</span></a></span><span>
</span><span id="line-753"></span><span>          </span><span class="hs-comment">-- String literals can be floated freely.</span><span>
</span><span id="line-754"></span><span>          </span><span class="hs-comment">-- See Note [Core top-level string literals] in GHC.Core.</span><span>
</span><span id="line-755"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OutExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprOkForSpeculation"><span class="hs-identifier hs-var">exprOkForSpeculation</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872551"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltOkSpec"><span class="hs-identifier hs-var">FltOkSpec</span></a></span><span>  </span><span class="hs-comment">-- Unlifted, and lifted but ok-for-spec (eg HNF)</span><span>
</span><span id="line-756"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#unitJoinFloat"><span class="hs-identifier hs-type">unitJoinFloat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBind"><span class="hs-identifier hs-type">OutBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span>
</span><span id="line-759"></span><span id="unitJoinFloat"><span class="annot"><span class="annottext">unitJoinFloat :: Bind OutId -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitJoinFloat"><span class="hs-identifier hs-var hs-var">unitJoinFloat</span></a></span></span><span> </span><span id="local-6989586621681872555"><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872555"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; JoinFloats -&gt; JoinFloats
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OutId -&gt; Bool) -&gt; [OutId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bind OutId -&gt; [OutId]
forall b. Bind b -&gt; [b]
</span><a href="GHC.Core.html#bindersOf"><span class="hs-identifier hs-var">bindersOf</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872555"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(JoinFloats -&gt; JoinFloats) -&gt; JoinFloats -&gt; JoinFloats
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-760"></span><span>                     </span><span class="annot"><span class="annottext">Bind OutId -&gt; JoinFloats
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872555"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkFloatBind"><span class="hs-identifier hs-type">mkFloatBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBind"><span class="hs-identifier hs-type">OutBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span class="hs-comment">-- Make a singleton SimplFloats, and</span><span>
</span><span id="line-764"></span><span class="hs-comment">-- extend the incoming SimplEnv's in-scope set with its binders</span><span>
</span><span id="line-765"></span><span class="hs-comment">-- These binders may already be in the in-scope set,</span><span>
</span><span id="line-766"></span><span class="hs-comment">-- but may have by now been augmented with more IdInfo</span><span>
</span><span id="line-767"></span><span id="mkFloatBind"><span class="annot"><span class="annottext">mkFloatBind :: SimplEnv -&gt; Bind OutId -&gt; (SimplFloats, SimplEnv)
</span><a href="GHC.Core.Opt.Simplify.Env.html#mkFloatBind"><span class="hs-identifier hs-var hs-var">mkFloatBind</span></a></span></span><span> </span><span id="local-6989586621681872556"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872556"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872557"><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872557"><span class="hs-identifier hs-var">bind</span></a></span></span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872558"><span class="hs-identifier hs-var">floats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872556"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872559"><span class="hs-identifier hs-type">in_scope'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-770"></span><span>    </span><span id="local-6989586621681872558"><span class="annot"><span class="annottext">floats :: SimplFloats
</span><a href="#local-6989586621681872558"><span class="hs-identifier hs-var hs-var">floats</span></a></span></span><span>
</span><span id="line-771"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; Bool
</span><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-var">isJoinBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872557"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-772"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyLetFloats"><span class="hs-identifier hs-var">emptyLetFloats</span></a></span><span>
</span><span id="line-773"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitJoinFloat"><span class="hs-identifier hs-var">unitJoinFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872557"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-774"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872559"><span class="hs-identifier hs-var">in_scope'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-775"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-776"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitLetFloat"><span class="hs-identifier hs-var">unitLetFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872557"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-777"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyJoinFloats"><span class="hs-identifier hs-var">emptyJoinFloats</span></a></span><span>
</span><span id="line-778"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872559"><span class="hs-identifier hs-var">in_scope'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-779"></span><span>    </span><span class="hs-comment">-- See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-780"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872559"><span class="annot"><span class="annottext">in_scope' :: InScopeSet
</span><a href="#local-6989586621681872559"><span class="hs-identifier hs-var hs-var">in_scope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872556"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Bind OutId -&gt; InScopeSet
</span><a href="GHC.Core.Utils.html#extendInScopeSetBind"><span class="hs-operator hs-var">`extendInScopeSetBind`</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872557"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendFloats"><span class="hs-identifier hs-type">extendFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBind"><span class="hs-identifier hs-type">OutBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span>
</span><span id="line-783"></span><span class="hs-comment">-- Add this binding to the floats, and extend the in-scope env too</span><span>
</span><span id="line-784"></span><span id="extendFloats"><span class="annot"><span class="annottext">extendFloats :: SimplFloats -&gt; Bind OutId -&gt; SimplFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#extendFloats"><span class="hs-identifier hs-var hs-var">extendFloats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872562"><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872562"><span class="hs-identifier hs-var">floats</span></a></span></span><span>
</span><span id="line-785"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872563"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872563"><span class="hs-identifier hs-var">jfloats</span></a></span></span><span>
</span><span id="line-786"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: SimplFloats -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872564"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872564"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>             </span><span id="local-6989586621681872565"><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872565"><span class="hs-identifier hs-var">bind</span></a></span></span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; Bool
</span><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-var">isJoinBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872565"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872566"><span class="hs-identifier hs-var">in_scope'</span></a></span><span>
</span><span id="line-790"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872562"><span class="hs-identifier hs-var">floats</span></a></span><span>
</span><span id="line-791"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872567"><span class="hs-identifier hs-var">jfloats'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872566"><span class="hs-identifier hs-var">in_scope'</span></a></span><span>
</span><span id="line-794"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872568"><span class="hs-identifier hs-var">floats'</span></a></span><span>
</span><span id="line-795"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872563"><span class="hs-identifier hs-var">jfloats</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-797"></span><span>    </span><span id="local-6989586621681872566"><span class="annot"><span class="annottext">in_scope' :: InScopeSet
</span><a href="#local-6989586621681872566"><span class="hs-identifier hs-var hs-var">in_scope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872564"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Bind OutId -&gt; InScopeSet
</span><a href="GHC.Core.Utils.html#extendInScopeSetBind"><span class="hs-operator hs-var">`extendInScopeSetBind`</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872565"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-798"></span><span>    </span><span id="local-6989586621681872568"><span class="annot"><span class="annottext">floats' :: LetFloats
</span><a href="#local-6989586621681872568"><span class="hs-identifier hs-var hs-var">floats'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872562"><span class="hs-identifier hs-var">floats</span></a></span><span>  </span><span class="annot"><span class="annottext">LetFloats -&gt; LetFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addLetFlts"><span class="hs-operator hs-var">`addLetFlts`</span></a></span><span>  </span><span class="annot"><span class="annottext">Bind OutId -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitLetFloat"><span class="hs-identifier hs-var">unitLetFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872565"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-799"></span><span>    </span><span id="local-6989586621681872567"><span class="annot"><span class="annottext">jfloats' :: JoinFloats
</span><a href="#local-6989586621681872567"><span class="hs-identifier hs-var hs-var">jfloats'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872563"><span class="hs-identifier hs-var">jfloats</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; JoinFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFlts"><span class="hs-operator hs-var">`addJoinFlts`</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitJoinFloat"><span class="hs-identifier hs-var">unitJoinFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId
</span><a href="#local-6989586621681872565"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addLetFloats"><span class="hs-identifier hs-type">addLetFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span>
</span><span id="line-802"></span><span class="hs-comment">-- Add the let-floats for env2 to env1;</span><span>
</span><span id="line-803"></span><span class="annot"><span class="hs-comment">-- *plus* the in-scope set for env2, which is bigger</span></span><span>
</span><span id="line-804"></span><span class="hs-comment">-- than that for env1</span><span>
</span><span id="line-805"></span><span id="addLetFloats"><span class="annot"><span class="annottext">addLetFloats :: SimplFloats -&gt; LetFloats -&gt; SimplFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addLetFloats"><span class="hs-identifier hs-var hs-var">addLetFloats</span></a></span></span><span> </span><span id="local-6989586621681872569"><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872569"><span class="hs-identifier hs-var">floats</span></a></span></span><span> </span><span id="local-6989586621681872570"><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872570"><span class="hs-identifier hs-var">let_floats</span></a></span></span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872569"><span class="hs-identifier hs-var">floats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872569"><span class="hs-identifier hs-type">floats</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addLetFlts"><span class="hs-operator hs-type">`addLetFlts`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872570"><span class="hs-identifier hs-type">let_floats</span></a></span><span>
</span><span id="line-807"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872569"><span class="hs-identifier hs-type">floats</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendInScopeFromLF"><span class="hs-operator hs-type">`extendInScopeFromLF`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872570"><span class="hs-identifier hs-type">let_floats</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#extendInScopeFromLF"><span class="hs-identifier hs-type">extendInScopeFromLF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-810"></span><span id="extendInScopeFromLF"><span class="annot"><span class="annottext">extendInScopeFromLF :: InScopeSet -&gt; LetFloats -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#extendInScopeFromLF"><span class="hs-identifier hs-var hs-var">extendInScopeFromLF</span></a></span></span><span> </span><span id="local-6989586621681872572"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872572"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872573"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872573"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Bind OutId -&gt; InScopeSet)
-&gt; InScopeSet -&gt; JoinFloats -&gt; InScopeSet
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; OrdList a -&gt; b
</span><a href="GHC.Data.OrdList.html#foldlOL"><span class="hs-identifier hs-var">foldlOL</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Bind OutId -&gt; InScopeSet
</span><a href="GHC.Core.Utils.html#extendInScopeSetBind"><span class="hs-identifier hs-var">extendInScopeSetBind</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872572"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872573"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFloats"><span class="hs-identifier hs-type">addJoinFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span>
</span><span id="line-814"></span><span id="addJoinFloats"><span class="annot"><span class="annottext">addJoinFloats :: SimplFloats -&gt; JoinFloats -&gt; SimplFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFloats"><span class="hs-identifier hs-var hs-var">addJoinFloats</span></a></span></span><span> </span><span id="local-6989586621681872575"><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872575"><span class="hs-identifier hs-var">floats</span></a></span></span><span> </span><span id="local-6989586621681872576"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872576"><span class="hs-identifier hs-var">join_floats</span></a></span></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872575"><span class="hs-identifier hs-var">floats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872575"><span class="hs-identifier hs-type">floats</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFlts"><span class="hs-operator hs-type">`addJoinFlts`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872576"><span class="hs-identifier hs-type">join_floats</span></a></span><span>
</span><span id="line-816"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#foldlOL"><span class="hs-identifier hs-type">foldlOL</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#extendInScopeSetBind"><span class="hs-identifier hs-type">extendInScopeSetBind</span></a></span><span>
</span><span id="line-817"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681872575"><span class="hs-identifier hs-type">floats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681872576"><span class="hs-identifier hs-type">join_floats</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addFloats"><span class="hs-identifier hs-type">addFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span>
</span><span id="line-820"></span><span class="hs-comment">-- Add both let-floats and join-floats for env2 to env1;</span><span>
</span><span id="line-821"></span><span class="annot"><span class="hs-comment">-- *plus* the in-scope set for env2, which is bigger</span></span><span>
</span><span id="line-822"></span><span class="hs-comment">-- than that for env1</span><span>
</span><span id="line-823"></span><span id="addFloats"><span class="annot"><span class="annottext">addFloats :: SimplFloats -&gt; SimplFloats -&gt; SimplFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addFloats"><span class="hs-identifier hs-var hs-var">addFloats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872577"><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872577"><span class="hs-identifier hs-var">lf1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872578"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872578"><span class="hs-identifier hs-var">jf1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872579"><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872579"><span class="hs-identifier hs-var">lf2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872580"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872580"><span class="hs-identifier hs-var">jf2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: SimplFloats -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872581"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872581"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872577"><span class="hs-identifier hs-var">lf1</span></a></span><span> </span><span class="annot"><span class="annottext">LetFloats -&gt; LetFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addLetFlts"><span class="hs-operator hs-var">`addLetFlts`</span></a></span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872579"><span class="hs-identifier hs-var">lf2</span></a></span><span>
</span><span id="line-826"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872578"><span class="hs-identifier hs-var">jf1</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; JoinFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFlts"><span class="hs-operator hs-var">`addJoinFlts`</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872580"><span class="hs-identifier hs-var">jf2</span></a></span><span>
</span><span id="line-827"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872581"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addLetFlts"><span class="hs-identifier hs-type">addLetFlts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span>
</span><span id="line-830"></span><span id="addLetFlts"><span class="annot"><span class="annottext">addLetFlts :: LetFloats -&gt; LetFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addLetFlts"><span class="hs-identifier hs-var hs-var">addLetFlts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872582"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872582"><span class="hs-identifier hs-var">bs1</span></a></span></span><span> </span><span id="local-6989586621681872583"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872583"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872584"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872584"><span class="hs-identifier hs-var">bs2</span></a></span></span><span> </span><span id="local-6989586621681872585"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872585"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; FloatFlag -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-var">LetFloats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872582"><span class="hs-identifier hs-var">bs1</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; JoinFloats -&gt; JoinFloats
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872584"><span class="hs-identifier hs-var">bs2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872583"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag -&gt; FloatFlag -&gt; FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#andFF"><span class="hs-operator hs-var">`andFF`</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872585"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#letFloatBinds"><span class="hs-identifier hs-type">letFloatBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-834"></span><span id="letFloatBinds"><span class="annot"><span class="annottext">letFloatBinds :: LetFloats -&gt; [Bind OutId]
</span><a href="GHC.Core.Opt.Simplify.Env.html#letFloatBinds"><span class="hs-identifier hs-var hs-var">letFloatBinds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872588"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872588"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; [Bind OutId]
forall a. OrdList a -&gt; [a]
</span><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-var">fromOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872588"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFlts"><span class="hs-identifier hs-type">addJoinFlts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span>
</span><span id="line-837"></span><span id="addJoinFlts"><span class="annot"><span class="annottext">addJoinFlts :: JoinFloats -&gt; JoinFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#addJoinFlts"><span class="hs-identifier hs-var hs-var">addJoinFlts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; JoinFloats -&gt; JoinFloats
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-identifier hs-var">appOL</span></a></span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mkRecFloats"><span class="hs-identifier hs-type">mkRecFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span>
</span><span id="line-840"></span><span class="hs-comment">-- Flattens the floats into a single Rec group,</span><span>
</span><span id="line-841"></span><span class="hs-comment">-- They must either all be lifted LetFloats or all JoinFloats</span><span>
</span><span id="line-842"></span><span id="mkRecFloats"><span class="annot"><span class="annottext">mkRecFloats :: SimplFloats -&gt; SimplFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#mkRecFloats"><span class="hs-identifier hs-var hs-var">mkRecFloats</span></a></span></span><span> </span><span id="local-6989586621681872589"><span class="annot"><span class="annottext">floats :: SimplFloats
</span><a href="#local-6989586621681872589"><span class="hs-identifier hs-var">floats</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872590"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872590"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681872591"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872591"><span class="hs-identifier hs-var">_ff</span></a></span></span><span>
</span><span id="line-843"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872592"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872592"><span class="hs-identifier hs-var">jbs</span></a></span></span><span>
</span><span id="line-844"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: SimplFloats -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872593"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872593"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SimplFloats -&gt; SimplFloats
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872590"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872592"><span class="hs-identifier hs-var">jbs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplFloats -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872589"><span class="hs-identifier hs-var">floats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SimplFloats -&gt; SimplFloats) -&gt; SimplFloats -&gt; SimplFloats
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-846"></span><span>    </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872594"><span class="hs-identifier hs-var">floats'</span></a></span><span>
</span><span id="line-847"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872595"><span class="hs-identifier hs-var">jfloats'</span></a></span><span>
</span><span id="line-848"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfInScope :: InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfInScope"><span class="hs-identifier hs-var">sfInScope</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872593"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-comment">-- See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872594"><span class="annot"><span class="annottext">floats' :: LetFloats
</span><a href="#local-6989586621681872594"><span class="hs-identifier hs-var hs-var">floats'</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872590"><span class="hs-identifier hs-var">bs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyLetFloats"><span class="hs-identifier hs-var">emptyLetFloats</span></a></span><span>
</span><span id="line-852"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitLetFloat"><span class="hs-identifier hs-var">unitLetFloat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(OutId, OutExpr)] -&gt; Bind OutId
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bind OutId] -&gt; [(OutId, OutExpr)]
forall b. [Bind b] -&gt; [(b, Expr b)]
</span><a href="GHC.Core.html#flattenBinds"><span class="hs-identifier hs-var">flattenBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; [Bind OutId]
forall a. OrdList a -&gt; [a]
</span><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-var">fromOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872590"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872595"><span class="annot"><span class="annottext">jfloats' :: JoinFloats
</span><a href="#local-6989586621681872595"><span class="hs-identifier hs-var hs-var">jfloats'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872592"><span class="hs-identifier hs-var">jbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#emptyJoinFloats"><span class="hs-identifier hs-var">emptyJoinFloats</span></a></span><span>
</span><span id="line-854"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#unitJoinFloat"><span class="hs-identifier hs-var">unitJoinFloat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(OutId, OutExpr)] -&gt; Bind OutId
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bind OutId] -&gt; [(OutId, OutExpr)]
forall b. [Bind b] -&gt; [(b, Expr b)]
</span><a href="GHC.Core.html#flattenBinds"><span class="hs-identifier hs-var">flattenBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; [Bind OutId]
forall a. OrdList a -&gt; [a]
</span><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-var">fromOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872592"><span class="hs-identifier hs-var">jbs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#wrapFloats"><span class="hs-identifier hs-type">wrapFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span>
</span><span id="line-857"></span><span class="hs-comment">-- Wrap the floats around the expression</span><span>
</span><span id="line-858"></span><span id="wrapFloats"><span class="annot"><span class="annottext">wrapFloats :: SimplFloats -&gt; OutExpr -&gt; OutExpr
</span><a href="GHC.Core.Opt.Simplify.Env.html#wrapFloats"><span class="hs-identifier hs-var hs-var">wrapFloats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872597"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872597"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681872598"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872598"><span class="hs-identifier hs-var">flag</span></a></span></span><span>
</span><span id="line-859"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872599"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872599"><span class="hs-identifier hs-var">jbs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872600"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872600"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-860"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bind OutId -&gt; OutExpr -&gt; OutExpr)
-&gt; OutExpr -&gt; JoinFloats -&gt; OutExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; OrdList a -&gt; b
</span><a href="GHC.Data.OrdList.html#foldrOL"><span class="hs-identifier hs-var">foldrOL</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; OutExpr -&gt; OutExpr
</span><a href="#local-6989586621681872602"><span class="hs-identifier hs-var">mk_let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; OutExpr -&gt; OutExpr
</span><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloats"><span class="hs-identifier hs-var">wrapJoinFloats</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872599"><span class="hs-identifier hs-var">jbs</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872600"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872597"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-861"></span><span>     </span><span class="hs-comment">-- Note: Always safe to put the joins on the inside</span><span>
</span><span id="line-862"></span><span>     </span><span class="hs-comment">-- since the values can't refer to them</span><span>
</span><span id="line-863"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-864"></span><span>    </span><span id="local-6989586621681872602"><span class="annot"><span class="annottext">mk_let :: Bind OutId -&gt; OutExpr -&gt; OutExpr
</span><a href="#local-6989586621681872602"><span class="hs-identifier hs-var hs-var">mk_let</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="GHC.Core.Opt.Simplify.Env.html#FltCareful"><span class="hs-identifier hs-var">FltCareful</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872598"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; OutExpr -&gt; OutExpr
</span><a href="GHC.Core.Make.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a></span><span> </span><span class="hs-comment">-- need to enforce let-can-float-invariant</span><span>
</span><span id="line-865"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; OutExpr -&gt; OutExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span>       </span><span class="hs-comment">-- let-can-float invariant hold</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloatsX"><span class="hs-identifier hs-type">wrapJoinFloatsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span class="hs-comment">-- Wrap the sfJoinFloats of the env around the expression,</span><span>
</span><span id="line-869"></span><span class="hs-comment">-- and take them out of the SimplEnv</span><span>
</span><span id="line-870"></span><span id="wrapJoinFloatsX"><span class="annot"><span class="annottext">wrapJoinFloatsX :: SimplFloats -&gt; OutExpr -&gt; (SimplFloats, OutExpr)
</span><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloatsX"><span class="hs-identifier hs-var hs-var">wrapJoinFloatsX</span></a></span></span><span> </span><span id="local-6989586621681872604"><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872604"><span class="hs-identifier hs-var">floats</span></a></span></span><span> </span><span id="local-6989586621681872605"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872605"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872604"><span class="hs-identifier hs-var">floats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#emptyJoinFloats"><span class="hs-identifier hs-type">emptyJoinFloats</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-872"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; OutExpr -&gt; OutExpr
</span><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloats"><span class="hs-identifier hs-var">wrapJoinFloats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="annot"><span class="annottext">SimplFloats
</span><a href="#local-6989586621681872604"><span class="hs-identifier hs-var">floats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872605"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloats"><span class="hs-identifier hs-type">wrapJoinFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#JoinFloats"><span class="hs-identifier hs-type">JoinFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutExpr"><span class="hs-identifier hs-type">OutExpr</span></a></span><span>
</span><span id="line-875"></span><span class="hs-comment">-- Wrap the sfJoinFloats of the env around the expression,</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- and take them out of the SimplEnv</span><span>
</span><span id="line-877"></span><span id="wrapJoinFloats"><span class="annot"><span class="annottext">wrapJoinFloats :: JoinFloats -&gt; OutExpr -&gt; OutExpr
</span><a href="GHC.Core.Opt.Simplify.Env.html#wrapJoinFloats"><span class="hs-identifier hs-var hs-var">wrapJoinFloats</span></a></span></span><span> </span><span id="local-6989586621681872606"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872606"><span class="hs-identifier hs-var">join_floats</span></a></span></span><span> </span><span id="local-6989586621681872607"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872607"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-878"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bind OutId -&gt; OutExpr -&gt; OutExpr)
-&gt; OutExpr -&gt; JoinFloats -&gt; OutExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; OrdList a -&gt; b
</span><a href="GHC.Data.OrdList.html#foldrOL"><span class="hs-identifier hs-var">foldrOL</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; OutExpr -&gt; OutExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872607"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872606"><span class="hs-identifier hs-var">join_floats</span></a></span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#getTopFloatBinds"><span class="hs-identifier hs-type">getTopFloatBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-881"></span><span id="getTopFloatBinds"><span class="annot"><span class="annottext">getTopFloatBinds :: SimplFloats -&gt; [Bind OutId]
</span><a href="GHC.Core.Opt.Simplify.Env.html#getTopFloatBinds"><span class="hs-identifier hs-var hs-var">getTopFloatBinds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplFloats"><span class="hs-identifier hs-type">SimplFloats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfLetFloats :: SimplFloats -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfLetFloats"><span class="hs-identifier hs-var">sfLetFloats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872608"><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872608"><span class="hs-identifier hs-var">lbs</span></a></span></span><span>
</span><span id="line-882"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfJoinFloats :: SimplFloats -&gt; JoinFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#sfJoinFloats"><span class="hs-identifier hs-var">sfJoinFloats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872609"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872609"><span class="hs-identifier hs-var">jbs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Bind OutId] -&gt; [Bind OutId]
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinFloats -&gt; Bool
forall a. OrdList a -&gt; Bool
</span><a href="GHC.Data.OrdList.html#isNilOL"><span class="hs-identifier hs-var">isNilOL</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872609"><span class="hs-identifier hs-var">jbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Bind OutId] -&gt; [Bind OutId]) -&gt; [Bind OutId] -&gt; [Bind OutId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Can't be any top-level join bindings</span><span>
</span><span id="line-884"></span><span>    </span><span class="annot"><span class="annottext">LetFloats -&gt; [Bind OutId]
</span><a href="GHC.Core.Opt.Simplify.Env.html#letFloatBinds"><span class="hs-identifier hs-var">letFloatBinds</span></a></span><span> </span><span class="annot"><span class="annottext">LetFloats
</span><a href="#local-6989586621681872608"><span class="hs-identifier hs-var">lbs</span></a></span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mapLetFloats"><span class="hs-pragma hs-type">mapLetFloats</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-887"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#mapLetFloats"><span class="hs-identifier hs-type">mapLetFloats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span>
</span><span id="line-888"></span><span id="mapLetFloats"><span class="annot"><span class="annottext">mapLetFloats :: LetFloats -&gt; ((OutId, OutExpr) -&gt; (OutId, OutExpr)) -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#mapLetFloats"><span class="hs-identifier hs-var hs-var">mapLetFloats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-type">LetFloats</span></a></span><span> </span><span id="local-6989586621681872611"><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872611"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621681872612"><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872612"><span class="hs-identifier hs-var">ff</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872613"><span class="annot"><span class="annottext">(OutId, OutExpr) -&gt; (OutId, OutExpr)
</span><a href="#local-6989586621681872613"><span class="hs-identifier hs-var">fun</span></a></span></span><span>
</span><span id="line-889"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinFloats -&gt; FloatFlag -&gt; LetFloats
</span><a href="GHC.Core.Opt.Simplify.Env.html#LetFloats"><span class="hs-identifier hs-var">LetFloats</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872614"><span class="hs-identifier hs-var">fs1</span></a></span><span> </span><span class="annot"><span class="annottext">FloatFlag
</span><a href="#local-6989586621681872612"><span class="hs-identifier hs-var">ff</span></a></span><span>
</span><span id="line-890"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-891"></span><span>    </span><span id="local-6989586621681872615"><span class="annot"><span class="annottext">app :: Bind OutId -&gt; Bind OutId
</span><a href="#local-6989586621681872615"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621681872616"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872616"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681872617"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872617"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(OutId, OutExpr) -&gt; (OutId, OutExpr)
</span><a href="#local-6989586621681872613"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872616"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872617"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681872618"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872618"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681872619"><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872619"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; OutExpr -&gt; Bind OutId
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872618"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">OutExpr
</span><a href="#local-6989586621681872619"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-892"></span><span>    </span><span class="annot"><a href="#local-6989586621681872615"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621681872620"><span class="annot"><span class="annottext">[(OutId, OutExpr)]
</span><a href="#local-6989586621681872620"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(OutId, OutExpr)] -&gt; Bind OutId
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((OutId, OutExpr) -&gt; (OutId, OutExpr))
-&gt; [(OutId, OutExpr)] -&gt; [(OutId, OutExpr)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="annot"><span class="annottext">(OutId, OutExpr) -&gt; (OutId, OutExpr)
</span><a href="#local-6989586621681872613"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[(OutId, OutExpr)]
</span><a href="#local-6989586621681872620"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872614"><span class="annot"><span class="annottext">fs1 :: JoinFloats
</span><a href="#local-6989586621681872614"><span class="hs-identifier hs-var hs-var">fs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Bind OutId -&gt; Bind OutId) -&gt; JoinFloats -&gt; JoinFloats
forall a b. (a -&gt; b) -&gt; OrdList a -&gt; OrdList b
</span><a href="GHC.Data.OrdList.html#mapOL%27"><span class="hs-identifier hs-var">mapOL'</span></a></span><span> </span><span class="annot"><span class="annottext">Bind OutId -&gt; Bind OutId
</span><a href="#local-6989586621681872615"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFloats
</span><a href="#local-6989586621681872611"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Substitution of Vars
*                                                                      *
************************************************************************

Note [Global Ids in the substitution]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We look up even a global (eg imported) Id in the substitution. Consider
   case X.g_34 of b { (a,b) -&gt;  ... case X.g_34 of { (p,q) -&gt; ...} ... }
The binder-swap in the occurrence analyser will add a binding
for a LocalId version of g (with the same unique though):
   case X.g_34 of b { (a,b) -&gt;  let g_34 = b in
                                ... case X.g_34 of { (p,q) -&gt; ...} ... }
So we want to look up the inner X.g_34 in the substitution, where we'll
find that it has been substituted by b.  (Or conceivably cloned.)
-}</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substId"><span class="hs-identifier hs-type">substId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#InId"><span class="hs-identifier hs-type">InId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplSR"><span class="hs-identifier hs-type">SimplSR</span></a></span><span>
</span><span id="line-915"></span><span class="hs-comment">-- Returns DoneEx only on a non-Var expression</span><span>
</span><span id="line-916"></span><span id="substId"><span class="annot"><span class="annottext">substId :: SimplEnv -&gt; OutId -&gt; SimplSR
</span><a href="GHC.Core.Opt.Simplify.Env.html#substId"><span class="hs-identifier hs-var hs-var">substId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872624"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872624"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seIdSubst :: SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872625"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872625"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872626"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872626"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SimplIdSubst -&gt; OutId -&gt; Maybe SimplSR
forall a. VarEnv a -&gt; OutId -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872625"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872626"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Note [Global Ids in the substitution]</span><span>
</span><span id="line-918"></span><span>        </span><span class="annot"><span class="annottext">Maybe SimplSR
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; SimplSR
</span><a href="GHC.Core.Opt.Simplify.Env.html#DoneId"><span class="hs-identifier hs-var">DoneId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#refineFromInScope"><span class="hs-identifier hs-var">refineFromInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872624"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872626"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#DoneId"><span class="hs-identifier hs-type">DoneId</span></a></span><span> </span><span id="local-6989586621681872629"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872629"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; SimplSR
</span><a href="GHC.Core.Opt.Simplify.Env.html#DoneId"><span class="hs-identifier hs-var">DoneId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#refineFromInScope"><span class="hs-identifier hs-var">refineFromInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872624"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872629"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681872630"><span class="annot"><span class="annottext">SimplSR
</span><a href="#local-6989586621681872630"><span class="hs-identifier hs-var">res</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SimplSR
</span><a href="#local-6989586621681872630"><span class="hs-identifier hs-var">res</span></a></span><span>    </span><span class="hs-comment">-- DoneEx non-var, or ContEx</span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-comment">-- Get the most up-to-date thing from the in-scope set</span><span>
</span><span id="line-923"></span><span>        </span><span class="hs-comment">-- Even though it isn't in the substitution, it may be in</span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-comment">-- the in-scope set with better IdInfo.</span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-comment">-- See also Note [In-scope set as a substitution] in GHC.Core.Opt.Simplify.</span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#refineFromInScope"><span class="hs-identifier hs-type">refineFromInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-929"></span><span id="refineFromInScope"><span class="annot"><span class="annottext">refineFromInScope :: InScopeSet -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#refineFromInScope"><span class="hs-identifier hs-var hs-var">refineFromInScope</span></a></span></span><span> </span><span id="local-6989586621681872632"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872632"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span id="local-6989586621681872633"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872633"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-930"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isLocalId"><span class="hs-identifier hs-var">isLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872633"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; OutId -&gt; Maybe OutId
</span><a href="GHC.Types.Var.Env.html#lookupInScope"><span class="hs-identifier hs-var">lookupInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872632"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872633"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-931"></span><span>                  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681872636"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872636"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872636"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-932"></span><span>                  </span><span class="annot"><span class="annottext">Maybe OutId
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; OutId
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;refineFromInScope&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872632"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872633"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>                             </span><span class="hs-comment">-- c.f #19074 for a subtle place where this went wrong</span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872633"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#lookupRecBndr"><span class="hs-identifier hs-type">lookupRecBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#InId"><span class="hs-identifier hs-type">InId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#OutId"><span class="hs-identifier hs-type">OutId</span></a></span><span>
</span><span id="line-937"></span><span class="hs-comment">-- Look up an Id which has been put into the envt by simplRecBndrs,</span><span>
</span><span id="line-938"></span><span class="hs-comment">-- but where we have not yet done its RHS</span><span>
</span><span id="line-939"></span><span id="lookupRecBndr"><span class="annot"><span class="annottext">lookupRecBndr :: SimplEnv -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#lookupRecBndr"><span class="hs-identifier hs-var hs-var">lookupRecBndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872638"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872638"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seIdSubst :: SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872639"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872639"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872640"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872640"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-940"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SimplIdSubst -&gt; OutId -&gt; Maybe SimplSR
forall a. VarEnv a -&gt; OutId -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872639"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872640"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-941"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#DoneId"><span class="hs-identifier hs-type">DoneId</span></a></span><span> </span><span id="local-6989586621681872641"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872641"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872641"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-942"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SimplSR
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; OutId
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupRecBndr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872640"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>        </span><span class="annot"><span class="annottext">Maybe SimplSR
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#refineFromInScope"><span class="hs-identifier hs-var">refineFromInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872638"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872640"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-944"></span><span>
</span><span id="line-945"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\section{Substituting an Id binder}
*                                                                      *
************************************************************************


These functions are in the monad only so that they can be made strict via seq.

Note [Return type for join points]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

   (join j :: Char -&gt; Int -&gt; Int) 77
   (     j x = \y. y + ord x    )
   (in case v of                )
   (     A -&gt; j 'x'             )
   (     B -&gt; j 'y'             )
   (     C -&gt; &lt;blah&gt;            )

The simplifier pushes the &quot;apply to 77&quot; continuation inwards to give

   join j :: Char -&gt; Int
        j x = (\y. y + ord x) 77
   in case v of
        A -&gt; j 'x'
        B -&gt; j 'y'
        C -&gt; &lt;blah&gt; 77

Notice that the &quot;apply to 77&quot; continuation went into the RHS of the
join point.  And that meant that the return type of the join point
changed!!

That's why we pass res_ty into simplNonRecJoinBndr, and substIdBndr
takes a (Just res_ty) argument so that it knows to do the type-changing
thing.

See also Note [Scaling join point arguments].
-}</span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplBinders"><span class="hs-identifier hs-type">simplBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span id="simplBinders"><span class="annot"><span class="annottext">simplBinders :: SimplEnv -&gt; [OutId] -&gt; SimplM (SimplEnv, [OutId])
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplBinders"><span class="hs-identifier hs-var hs-var">simplBinders</span></a></span></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681872643"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872643"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872644"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872644"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SimplEnv -&gt; OutId -&gt; SimplM (SimplEnv, OutId))
-&gt; SimplEnv -&gt; [OutId] -&gt; SimplM (SimplEnv, [OutId])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; SimplM (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplBinder"><span class="hs-identifier hs-var">simplBinder</span></a></span><span>  </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872643"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872644"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-990"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplBinder"><span class="hs-identifier hs-type">simplBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span class="hs-comment">-- Used for lambda and case-bound variables</span><span>
</span><span id="line-992"></span><span class="hs-comment">-- Clone Id if necessary, substitute type</span><span>
</span><span id="line-993"></span><span class="hs-comment">-- Return with IdInfo already substituted, but (fragile) occurrence info zapped</span><span>
</span><span id="line-994"></span><span class="hs-comment">-- The substitution is extended only if the variable is cloned, because</span><span>
</span><span id="line-995"></span><span class="hs-comment">-- we *don't* need to use it to track occurrence info.</span><span>
</span><span id="line-996"></span><span id="simplBinder"><span class="annot"><span class="annottext">simplBinder :: SimplEnv -&gt; OutId -&gt; SimplM (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplBinder"><span class="hs-identifier hs-var hs-var">simplBinder</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681872646"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872646"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872647"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872647"><span class="hs-identifier hs-var">bndr</span></a></span></span><span>
</span><span id="line-997"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872647"><span class="hs-identifier hs-var">bndr</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681872648"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872648"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872649"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872649"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substTyVarBndr"><span class="hs-identifier hs-var">substTyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872646"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872647"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-998"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqTyVar"><span class="hs-identifier hs-var">seqTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872649"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; SimplM (SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">(SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a. a -&gt; SimplM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872648"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872649"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-999"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681872652"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872652"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872653"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872653"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substIdBndr"><span class="hs-identifier hs-var">substIdBndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872646"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872647"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-1000"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqId"><span class="hs-identifier hs-var">seqId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872653"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; SimplM (SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">(SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a. a -&gt; SimplM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872652"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872653"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-1003"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplNonRecBndr"><span class="hs-identifier hs-type">simplNonRecBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- A non-recursive let binder</span><span>
</span><span id="line-1005"></span><span id="simplNonRecBndr"><span class="annot"><span class="annottext">simplNonRecBndr :: SimplEnv -&gt; OutId -&gt; SimplM (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplNonRecBndr"><span class="hs-identifier hs-var hs-var">simplNonRecBndr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681872656"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872656"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872657"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872657"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-1006"></span><span>  </span><span class="hs-comment">-- See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681872658"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872658"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872659"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872659"><span class="hs-identifier hs-var">id1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substIdBndr"><span class="hs-identifier hs-var">substIdBndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872656"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872657"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1008"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqId"><span class="hs-identifier hs-var">seqId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872659"><span class="hs-identifier hs-var">id1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; SimplM (SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">(SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a. a -&gt; SimplM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872658"><span class="hs-identifier hs-var">env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872659"><span class="hs-identifier hs-var">id1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-1011"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplRecBndrs"><span class="hs-identifier hs-type">simplRecBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-1012"></span><span class="hs-comment">-- Recursive let binders</span><span>
</span><span id="line-1013"></span><span id="simplRecBndrs"><span class="annot"><span class="annottext">simplRecBndrs :: SimplEnv -&gt; [OutId] -&gt; SimplM SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplRecBndrs"><span class="hs-identifier hs-var hs-var">simplRecBndrs</span></a></span></span><span> </span><span id="local-6989586621681872660"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872660"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872661"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872661"><span class="hs-identifier hs-var">ids</span></a></span></span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-comment">-- See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-1015"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SimplM SimplEnv -&gt; SimplM SimplEnv
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OutId -&gt; Bool) -&gt; [OutId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (OutId -&gt; Bool) -&gt; OutId -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872661"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SimplM SimplEnv -&gt; SimplM SimplEnv)
-&gt; SimplM SimplEnv -&gt; SimplM SimplEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1016"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681872662"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872662"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872663"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872663"><span class="hs-identifier hs-var">ids1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId))
-&gt; SimplEnv -&gt; [OutId] -&gt; (SimplEnv, [OutId])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substIdBndr"><span class="hs-identifier hs-var">substIdBndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872660"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872661"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-1017"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[OutId] -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqIds"><span class="hs-identifier hs-var">seqIds</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872663"><span class="hs-identifier hs-var">ids1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; SimplM SimplEnv -&gt; SimplM SimplEnv
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplM SimplEnv
forall a. a -&gt; SimplM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872662"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-1020"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substIdBndr"><span class="hs-identifier hs-type">substIdBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span class="hs-comment">-- Might be a coercion variable</span><span>
</span><span id="line-1022"></span><span id="substIdBndr"><span class="annot"><span class="annottext">substIdBndr :: SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substIdBndr"><span class="hs-identifier hs-var hs-var">substIdBndr</span></a></span></span><span> </span><span id="local-6989586621681872665"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872665"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872666"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872666"><span class="hs-identifier hs-var">bndr</span></a></span></span><span>
</span><span id="line-1023"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872666"><span class="hs-identifier hs-var">bndr</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substCoVarBndr"><span class="hs-identifier hs-var">substCoVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872665"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872666"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-1024"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substNonCoVarIdBndr"><span class="hs-identifier hs-var">substNonCoVarIdBndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872665"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872666"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-1027"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substNonCoVarIdBndr"><span class="hs-identifier hs-type">substNonCoVarIdBndr</span></a></span><span>
</span><span id="line-1028"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-1029"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span>    </span><span class="hs-comment">-- Env and binder to transform</span><span>
</span><span id="line-1030"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span class="hs-comment">-- Clone Id if necessary, substitute its type</span><span>
</span><span id="line-1032"></span><span class="hs-comment">-- Return an Id with its</span><span>
</span><span id="line-1033"></span><span class="hs-comment">--      * Type substituted</span><span>
</span><span id="line-1034"></span><span class="hs-comment">--      * UnfoldingInfo, Rules, WorkerInfo zapped</span><span>
</span><span id="line-1035"></span><span class="hs-comment">--      * Fragile OccInfo (only) zapped: Note [Robust OccInfo]</span><span>
</span><span id="line-1036"></span><span class="hs-comment">--      * Robust info, retained especially arity and demand info,</span><span>
</span><span id="line-1037"></span><span class="hs-comment">--         so that they are available to occurrences that occur in an</span><span>
</span><span id="line-1038"></span><span class="hs-comment">--         earlier binding of a letrec</span><span>
</span><span id="line-1039"></span><span class="hs-comment">--</span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- For the robust info, see Note [Arity robustness]</span><span>
</span><span id="line-1041"></span><span class="hs-comment">--</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- Augment the substitution  if the unique changed</span><span>
</span><span id="line-1043"></span><span class="hs-comment">-- Extend the in-scope set with the new Id</span><span>
</span><span id="line-1044"></span><span class="hs-comment">--</span><span>
</span><span id="line-1045"></span><span class="hs-comment">-- Similar to GHC.Core.Subst.substIdBndr, except that</span><span>
</span><span id="line-1046"></span><span class="hs-comment">--      the type of id_subst differs</span><span>
</span><span id="line-1047"></span><span class="hs-comment">--      all fragile info is zapped</span><span>
</span><span id="line-1048"></span><span id="substNonCoVarIdBndr"><span class="annot"><span class="annottext">substNonCoVarIdBndr :: SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substNonCoVarIdBndr"><span class="hs-identifier hs-var hs-var">substNonCoVarIdBndr</span></a></span></span><span> </span><span id="local-6989586621681872669"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872669"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872670"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872670"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (OutId -&gt; OutId) -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#subst_id_bndr"><span class="hs-identifier hs-var">subst_id_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872669"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872670"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681872672"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872672"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872672"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span class="hs-comment">-- Inline to make the (OutId -&gt; OutId) function a known call.</span><span>
</span><span id="line-1051"></span><span class="hs-comment">-- This is especially important for `substNonCoVarIdBndr` which</span><span>
</span><span id="line-1052"></span><span class="hs-comment">-- passes an identity lambda.</span><span>
</span><span id="line-1053"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#subst_id_bndr"><span class="hs-pragma hs-type">subst_id_bndr</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1054"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#subst_id_bndr"><span class="hs-identifier hs-type">subst_id_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-1055"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span>    </span><span class="hs-comment">-- Env and binder to transform</span><span>
</span><span id="line-1056"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#OutId"><span class="hs-identifier hs-type">OutId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#OutId"><span class="hs-identifier hs-type">OutId</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Adjust the type</span><span>
</span><span id="line-1057"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1058"></span><span id="subst_id_bndr"><span class="annot"><span class="annottext">subst_id_bndr :: SimplEnv -&gt; OutId -&gt; (OutId -&gt; OutId) -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#subst_id_bndr"><span class="hs-identifier hs-var hs-var">subst_id_bndr</span></a></span></span><span> </span><span id="local-6989586621681872673"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872673"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872674"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872674"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seIdSubst :: SimplEnv -&gt; SimplIdSubst
</span><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872675"><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872675"><span class="hs-identifier hs-var">id_subst</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>              </span><span id="local-6989586621681872676"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872676"><span class="hs-identifier hs-var">old_id</span></a></span></span><span> </span><span id="local-6989586621681872677"><span class="annot"><span class="annottext">OutId -&gt; OutId
</span><a href="#local-6989586621681872677"><span class="hs-identifier hs-var">adjust_type</span></a></span></span><span>
</span><span id="line-1060"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; (SimplEnv, OutId) -&gt; (SimplEnv, OutId)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872676"><span class="hs-identifier hs-var">old_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872676"><span class="hs-identifier hs-var">old_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872673"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872678"><span class="hs-identifier hs-type">new_in_scope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1062"></span><span>           </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seIdSubst"><span class="hs-identifier hs-var">seIdSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872679"><span class="hs-identifier hs-type">new_subst</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872680"><span class="hs-identifier hs-var">new_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1063"></span><span>    </span><span class="hs-comment">-- It's important that both seInScope and seIdSubst are updated with</span><span>
</span><span id="line-1064"></span><span>    </span><span class="hs-comment">-- the new_id, /after/ applying adjust_type. That's why adjust_type</span><span>
</span><span id="line-1065"></span><span>    </span><span class="hs-comment">-- is done here.  If we did adjust_type in simplJoinBndr (the only</span><span>
</span><span id="line-1066"></span><span>    </span><span class="hs-comment">-- place that gives a non-identity adjust_type) we'd have to fiddle</span><span>
</span><span id="line-1067"></span><span>    </span><span class="hs-comment">-- afresh with both seInScope and seIdSubst</span><span>
</span><span id="line-1068"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1069"></span><span>    </span><span class="hs-comment">-- See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-1070"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872681"><span class="annot"><span class="annottext">id1 :: OutId
</span><a href="#local-6989586621681872681"><span class="hs-identifier hs-var hs-var">id1</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; OutId -&gt; OutId
</span><a href="GHC.Types.Var.Env.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872674"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872676"><span class="hs-identifier hs-var">old_id</span></a></span><span>
</span><span id="line-1071"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872683"><span class="annot"><span class="annottext">id2 :: OutId
</span><a href="#local-6989586621681872683"><span class="hs-identifier hs-var hs-var">id2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#substIdType"><span class="hs-identifier hs-var">substIdType</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872673"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872681"><span class="hs-identifier hs-var">id1</span></a></span><span>
</span><span id="line-1072"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872685"><span class="annot"><span class="annottext">id3 :: OutId
</span><a href="#local-6989586621681872685"><span class="hs-identifier hs-var hs-var">id3</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; OutId
</span><a href="GHC.Types.Id.html#zapFragileIdInfo"><span class="hs-identifier hs-var">zapFragileIdInfo</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872683"><span class="hs-identifier hs-var">id2</span></a></span><span>      </span><span class="hs-comment">-- Zaps rules, worker-info, unfolding</span><span>
</span><span id="line-1073"></span><span>                                      </span><span class="hs-comment">-- and fragile OccInfo</span><span>
</span><span id="line-1074"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872680"><span class="annot"><span class="annottext">new_id :: OutId
</span><a href="#local-6989586621681872680"><span class="hs-identifier hs-var hs-var">new_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; OutId
</span><a href="#local-6989586621681872677"><span class="hs-identifier hs-var">adjust_type</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872685"><span class="hs-identifier hs-var">id3</span></a></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>        </span><span class="hs-comment">-- Extend the substitution if the unique has changed,</span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-comment">-- or there's some useful occurrence information</span><span>
</span><span id="line-1078"></span><span>        </span><span class="hs-comment">-- See the notes with substTyVarBndr for the delSubstEnv</span><span>
</span><span id="line-1079"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872679"><span class="annot"><span class="annottext">new_subst :: SimplIdSubst
</span><a href="#local-6989586621681872679"><span class="hs-identifier hs-var hs-var">new_subst</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872680"><span class="hs-identifier hs-var">new_id</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; OutId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872676"><span class="hs-identifier hs-var">old_id</span></a></span><span>
</span><span id="line-1080"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplIdSubst -&gt; OutId -&gt; SimplSR -&gt; SimplIdSubst
forall a. VarEnv a -&gt; OutId -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872675"><span class="hs-identifier hs-var">id_subst</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872676"><span class="hs-identifier hs-var">old_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; SimplSR
</span><a href="GHC.Core.Opt.Simplify.Env.html#DoneId"><span class="hs-identifier hs-var">DoneId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872680"><span class="hs-identifier hs-var">new_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1082"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplIdSubst -&gt; OutId -&gt; SimplIdSubst
forall a. VarEnv a -&gt; OutId -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#delVarEnv"><span class="hs-identifier hs-var">delVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SimplIdSubst
</span><a href="#local-6989586621681872675"><span class="hs-identifier hs-var">id_subst</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872676"><span class="hs-identifier hs-var">old_id</span></a></span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681872678"><span class="annot"><span class="annottext">new_in_scope :: InScopeSet
</span><a href="#local-6989586621681872678"><span class="hs-identifier hs-var hs-var">new_in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872674"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; OutId -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#extendInScopeSet"><span class="hs-operator hs-var">`extendInScopeSet`</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872680"><span class="hs-identifier hs-var">new_id</span></a></span><span>
</span><span id="line-1085"></span><span>
</span><span id="line-1086"></span><span class="hs-comment">------------------------------------</span><span>
</span><span id="line-1087"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seqTyVar"><span class="hs-identifier hs-type">seqTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1088"></span><span id="seqTyVar"><span class="annot"><span class="annottext">seqTyVar :: OutId -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqTyVar"><span class="hs-identifier hs-var hs-var">seqTyVar</span></a></span></span><span> </span><span id="local-6989586621681872689"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872689"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872689"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seqId"><span class="hs-identifier hs-type">seqId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span id="seqId"><span class="annot"><span class="annottext">seqId :: OutId -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqId"><span class="hs-identifier hs-var hs-var">seqId</span></a></span></span><span> </span><span id="local-6989586621681872690"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872690"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872690"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span>
</span><span id="line-1092"></span><span>           </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; OutId -&gt; IdInfo
OutId -&gt; IdInfo
</span><a href="GHC.Types.Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872690"><span class="hs-identifier hs-var">id</span></a></span><span>            </span><span class="annot"><span class="annottext">IdInfo -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span>
</span><span id="line-1093"></span><span>           </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seqIds"><span class="hs-identifier hs-type">seqIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span id="seqIds"><span class="annot"><span class="annottext">seqIds :: [OutId] -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqIds"><span class="hs-identifier hs-var hs-var">seqIds</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seqIds"><span class="hs-identifier hs-var">seqIds</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681872694"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872694"><span class="hs-identifier hs-var">id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681872695"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872695"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqId"><span class="hs-identifier hs-var">seqId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872694"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[OutId] -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqIds"><span class="hs-identifier hs-var">seqIds</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872695"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span class="hs-comment">{-
Note [Arity robustness]
~~~~~~~~~~~~~~~~~~~~~~~
We *do* transfer the arity from the in_id of a let binding to the
out_id so that its arity is visible in its RHS. Examples:

  * f = \x y. let g = \p q. f (p+q) in Just (...g..g...)
    Here we want to give `g` arity 3 and eta-expand. `findRhsArity` will have a
    hard time figuring that out when `f` only has arity 0 in its own RHS.
  * f = \x y. ....(f `seq` blah)....
    We want to drop the seq.
  * f = \x. g (\y. f y)
    You'd think we could eta-reduce `\y. f y` to `f` here. And indeed, that is true.
    Unfortunately, it is not sound in general to eta-reduce in f's RHS.
    Example: `f = \x. f x`. See Note [Eta reduction in recursive RHSs] for how
    we prevent that.

Note [Robust OccInfo]
~~~~~~~~~~~~~~~~~~~~~
It's important that we *do* retain the loop-breaker OccInfo, because
that's what stops the Id getting inlined infinitely, in the body of
the letrec.
-}</span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Join points
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplNonRecJoinBndr"><span class="hs-identifier hs-type">simplNonRecJoinBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span>
</span><span id="line-1131"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutType"><span class="hs-identifier hs-type">OutType</span></a></span><span>
</span><span id="line-1132"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span>
</span><span id="line-1134"></span><span class="hs-comment">-- A non-recursive let binder for a join point;</span><span>
</span><span id="line-1135"></span><span class="hs-comment">-- context being pushed inward may change the type</span><span>
</span><span id="line-1136"></span><span class="hs-comment">-- See Note [Return type for join points]</span><span>
</span><span id="line-1137"></span><span id="simplNonRecJoinBndr"><span class="annot"><span class="annottext">simplNonRecJoinBndr :: SimplEnv -&gt; OutId -&gt; Kind -&gt; Kind -&gt; SimplM (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplNonRecJoinBndr"><span class="hs-identifier hs-var hs-var">simplNonRecJoinBndr</span></a></span></span><span> </span><span id="local-6989586621681872698"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872698"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872699"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872699"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681872700"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872700"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681872701"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872701"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1138"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681872702"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872702"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872703"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872703"><span class="hs-identifier hs-var">id1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplJoinBndr"><span class="hs-identifier hs-var">simplJoinBndr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872700"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872701"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872698"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872699"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1139"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqId"><span class="hs-identifier hs-var">seqId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872703"><span class="hs-identifier hs-var">id1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; SimplM (SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">(SimplEnv, OutId) -&gt; SimplM (SimplEnv, OutId)
forall a. a -&gt; SimplM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872702"><span class="hs-identifier hs-var">env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872703"><span class="hs-identifier hs-var">id1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplRecJoinBndrs"><span class="hs-identifier hs-type">simplRecJoinBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1142"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutType"><span class="hs-identifier hs-type">OutType</span></a></span><span>
</span><span id="line-1143"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html#SimplM"><span class="hs-identifier hs-type">SimplM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span>
</span><span id="line-1144"></span><span class="hs-comment">-- Recursive let binders for join points;</span><span>
</span><span id="line-1145"></span><span class="hs-comment">-- context being pushed inward may change types</span><span>
</span><span id="line-1146"></span><span class="hs-comment">-- See Note [Return type for join points]</span><span>
</span><span id="line-1147"></span><span id="simplRecJoinBndrs"><span class="annot"><span class="annottext">simplRecJoinBndrs :: SimplEnv -&gt; [OutId] -&gt; Kind -&gt; Kind -&gt; SimplM SimplEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplRecJoinBndrs"><span class="hs-identifier hs-var hs-var">simplRecJoinBndrs</span></a></span></span><span> </span><span id="local-6989586621681872705"><span class="annot"><span class="annottext">env :: SimplEnv
</span><a href="#local-6989586621681872705"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872706"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872706"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621681872707"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872707"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681872708"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872708"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1148"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SimplM SimplEnv -&gt; SimplM SimplEnv
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OutId -&gt; Bool) -&gt; [OutId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872706"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SimplM SimplEnv -&gt; SimplM SimplEnv)
-&gt; SimplM SimplEnv -&gt; SimplM SimplEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1149"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681872709"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872709"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872710"><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872710"><span class="hs-identifier hs-var">ids1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId))
-&gt; SimplEnv -&gt; [OutId] -&gt; (SimplEnv, [OutId])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplJoinBndr"><span class="hs-identifier hs-var">simplJoinBndr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872707"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872708"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872705"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872706"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-1150"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[OutId] -&gt; ()
</span><a href="GHC.Core.Opt.Simplify.Env.html#seqIds"><span class="hs-identifier hs-var">seqIds</span></a></span><span> </span><span class="annot"><span class="annottext">[OutId]
</span><a href="#local-6989586621681872710"><span class="hs-identifier hs-var">ids1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; SimplM SimplEnv -&gt; SimplM SimplEnv
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; SimplM SimplEnv
forall a. a -&gt; SimplM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872709"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-1153"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#simplJoinBndr"><span class="hs-identifier hs-type">simplJoinBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#OutType"><span class="hs-identifier hs-type">OutType</span></a></span><span>
</span><span id="line-1154"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#InBndr"><span class="hs-identifier hs-type">InBndr</span></a></span><span>
</span><span id="line-1155"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#OutBndr"><span class="hs-identifier hs-type">OutBndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1156"></span><span id="simplJoinBndr"><span class="annot"><span class="annottext">simplJoinBndr :: Kind -&gt; Kind -&gt; SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#simplJoinBndr"><span class="hs-identifier hs-var hs-var">simplJoinBndr</span></a></span></span><span> </span><span id="local-6989586621681872711"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872711"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681872712"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872712"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621681872713"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872713"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872714"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872714"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-1157"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplEnv -&gt; OutId -&gt; (OutId -&gt; OutId) -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#subst_id_bndr"><span class="hs-identifier hs-var">subst_id_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872713"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872714"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#adjustJoinPointType"><span class="hs-identifier hs-var">adjustJoinPointType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872711"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872712"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-1160"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#adjustJoinPointType"><span class="hs-identifier hs-type">adjustJoinPointType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>
</span><span id="line-1161"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>     </span><span class="hs-comment">-- New result type</span><span>
</span><span id="line-1162"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>       </span><span class="hs-comment">-- Old join-point Id</span><span>
</span><span id="line-1163"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>       </span><span class="hs-comment">-- Adjusted join-point Id</span><span>
</span><span id="line-1164"></span><span class="hs-comment">-- (adjustJoinPointType mult new_res_ty join_id) does two things:</span><span>
</span><span id="line-1165"></span><span class="hs-comment">--</span><span>
</span><span id="line-1166"></span><span class="hs-comment">--   1. Set the return type of the join_id to new_res_ty</span><span>
</span><span id="line-1167"></span><span class="hs-comment">--      See Note [Return type for join points]</span><span>
</span><span id="line-1168"></span><span class="hs-comment">--</span><span>
</span><span id="line-1169"></span><span class="hs-comment">--   2. Adjust the multiplicity of arrows in join_id's type, as</span><span>
</span><span id="line-1170"></span><span class="hs-comment">--      directed by 'mult'. See Note [Scaling join point arguments]</span><span>
</span><span id="line-1171"></span><span class="hs-comment">--</span><span>
</span><span id="line-1172"></span><span class="hs-comment">-- INVARIANT: If any of the first n binders are foralls, those tyvars</span><span>
</span><span id="line-1173"></span><span class="hs-comment">-- cannot appear in the original result type. See isValidJoinPointType.</span><span>
</span><span id="line-1174"></span><span id="adjustJoinPointType"><span class="annot"><span class="annottext">adjustJoinPointType :: Kind -&gt; Kind -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#adjustJoinPointType"><span class="hs-identifier hs-var hs-var">adjustJoinPointType</span></a></span></span><span> </span><span id="local-6989586621681872716"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872716"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681872717"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872717"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span> </span><span id="local-6989586621681872718"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872718"><span class="hs-identifier hs-var">join_id</span></a></span></span><span>
</span><span id="line-1175"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; OutId -&gt; OutId
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutId -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872718"><span class="hs-identifier hs-var">join_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OutId -&gt; OutId) -&gt; OutId -&gt; OutId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1176"></span><span>    </span><span class="annot"><span class="annottext">OutId -&gt; Kind -&gt; OutId
</span><a href="GHC.Types.Id.html#setIdType"><span class="hs-identifier hs-var">setIdType</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872718"><span class="hs-identifier hs-var">join_id</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872720"><span class="hs-identifier hs-var">new_join_ty</span></a></span><span>
</span><span id="line-1177"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1178"></span><span>    </span><span id="local-6989586621681872721"><span class="annot"><span class="annottext">join_arity :: JoinArity
</span><a href="#local-6989586621681872721"><span class="hs-identifier hs-var hs-var">join_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; JoinArity
</span><a href="GHC.Types.Id.html#idJoinArity"><span class="hs-identifier hs-var">idJoinArity</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872718"><span class="hs-identifier hs-var">join_id</span></a></span><span>
</span><span id="line-1179"></span><span>    </span><span id="local-6989586621681872723"><span class="annot"><span class="annottext">orig_ty :: Kind
</span><a href="#local-6989586621681872723"><span class="hs-identifier hs-var hs-var">orig_ty</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872718"><span class="hs-identifier hs-var">join_id</span></a></span><span>
</span><span id="line-1180"></span><span>    </span><span id="local-6989586621681872724"><span class="annot"><span class="annottext">res_torc :: TypeOrConstraint
</span><a href="#local-6989586621681872724"><span class="hs-identifier hs-var hs-var">res_torc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Kind -&gt; TypeOrConstraint
Kind -&gt; TypeOrConstraint
</span><a href="GHC.Core.Type.html#typeTypeOrConstraint"><span class="hs-identifier hs-var">typeTypeOrConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872717"><span class="hs-identifier hs-var">new_res_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrConstraint"><span class="hs-identifier hs-type">TypeOrConstraint</span></a></span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span>    </span><span id="local-6989586621681872720"><span class="annot"><span class="annottext">new_join_ty :: Kind
</span><a href="#local-6989586621681872720"><span class="hs-identifier hs-var hs-var">new_join_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinArity -&gt; Kind -&gt; Kind
</span><a href="#local-6989586621681872726"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">JoinArity
</span><a href="#local-6989586621681872721"><span class="hs-identifier hs-var">join_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872723"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span>    </span><span class="annot"><a href="#local-6989586621681872726"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1185"></span><span>    </span><span id="local-6989586621681872726"><span class="annot"><span class="annottext">go :: JoinArity -&gt; Kind -&gt; Kind
</span><a href="#local-6989586621681872726"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681872727"><span class="annot"><span class="annottext">JoinArity
</span><a href="#local-6989586621681872727"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681872728"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872728"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1186"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JoinArity
</span><a href="#local-6989586621681872727"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">JoinArity -&gt; JoinArity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">JoinArity
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1187"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872717"><span class="hs-identifier hs-var">new_res_ty</span></a></span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681872729"><span class="annot"><span class="annottext">PiTyBinder
</span><a href="#local-6989586621681872729"><span class="hs-identifier hs-var">arg_bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872730"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872730"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Maybe (PiTyBinder, Kind)
</span><a href="GHC.Core.Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872728"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1190"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681872732"><span class="annot"><span class="annottext">body_ty' :: Kind
</span><a href="#local-6989586621681872732"><span class="hs-identifier hs-var hs-var">body_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinArity -&gt; Kind -&gt; Kind
</span><a href="#local-6989586621681872726"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinArity
</span><a href="#local-6989586621681872727"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">JoinArity -&gt; JoinArity -&gt; JoinArity
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">JoinArity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872730"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-1191"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PiTyBinder
</span><a href="#local-6989586621681872729"><span class="hs-identifier hs-var">arg_bndr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1192"></span><span>          </span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621681872734"><span class="annot"><span class="annottext">ForAllTyBinder
</span><a href="#local-6989586621681872734"><span class="hs-identifier hs-var">b</span></a></span></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyBinder
</span><a href="#local-6989586621681872734"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872732"><span class="hs-identifier hs-var">body_ty'</span></a></span><span>
</span><span id="line-1193"></span><span>          </span><span class="annot"><a href="GHC.Types.Var.html#Anon"><span class="hs-identifier hs-type">Anon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681872738"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872738"><span class="hs-identifier hs-var">arg_mult</span></a></span></span><span> </span><span id="local-6989586621681872739"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872739"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872740"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621681872740"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; FunTyFlag -&gt; Kind -&gt; Kind -&gt; Kind -&gt; Kind
FunTyFlag -&gt; Kind -&gt; Kind -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.TyCo.Rep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621681872742"><span class="hs-identifier hs-var">af'</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872743"><span class="hs-identifier hs-var">arg_mult'</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872739"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872732"><span class="hs-identifier hs-var">body_ty'</span></a></span><span>
</span><span id="line-1194"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-1195"></span><span>                </span><span class="hs-comment">-- Using &quot;!&quot;: See Note [Bangs in the Simplifier]</span><span>
</span><span id="line-1196"></span><span>                </span><span class="hs-comment">-- mkMultMul: see Note [Scaling join point arguments]</span><span>
</span><span id="line-1197"></span><span>                </span><span class="hs-glyph">!</span><span id="local-6989586621681872743"><span class="annot"><span class="annottext">arg_mult' :: Kind
</span><a href="#local-6989586621681872743"><span class="hs-identifier hs-var hs-var">arg_mult'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872738"><span class="hs-identifier hs-var">arg_mult</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.Multiplicity.html#mkMultMul"><span class="hs-operator hs-var">`mkMultMul`</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872716"><span class="hs-identifier hs-var">mult</span></a></span><span>
</span><span id="line-1198"></span><span>
</span><span id="line-1199"></span><span>                </span><span class="hs-comment">-- the new_res_ty might be ConstraintLike while the original</span><span>
</span><span id="line-1200"></span><span>                </span><span class="hs-comment">-- one was TypeLike.  So we may need to adjust the FunTyFlag.</span><span>
</span><span id="line-1201"></span><span>                </span><span class="hs-comment">-- (see #23952)</span><span>
</span><span id="line-1202"></span><span>                </span><span class="hs-glyph">!</span><span id="local-6989586621681872742"><span class="annot"><span class="annottext">af' :: FunTyFlag
</span><a href="#local-6989586621681872742"><span class="hs-identifier hs-var hs-var">af'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeOrConstraint -&gt; TypeOrConstraint -&gt; FunTyFlag
</span><a href="GHC.Types.Var.html#mkFunTyFlag"><span class="hs-identifier hs-var">mkFunTyFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag -&gt; TypeOrConstraint
</span><a href="GHC.Types.Var.html#funTyFlagArgTypeOrConstraint"><span class="hs-identifier hs-var">funTyFlagArgTypeOrConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621681872740"><span class="hs-identifier hs-var">af</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeOrConstraint
</span><a href="#local-6989586621681872724"><span class="hs-identifier hs-var">res_torc</span></a></span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1205"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Kind
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;adjustJoinPointType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JoinArity -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">JoinArity
</span><a href="#local-6989586621681872721"><span class="hs-identifier hs-var">join_arity</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872723"><span class="hs-identifier hs-var">orig_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span class="hs-comment">{- Note [Scaling join point arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a join point which is linear in its variable, in some context E:

E[join j :: a %1 -&gt; a
       j x = x
  in case v of
       A -&gt; j 'x'
       B -&gt; &lt;blah&gt;]

The simplifier changes to:

join j :: a %1 -&gt; a
     j x = E[x]
in case v of
     A -&gt; j 'x'
     B -&gt; E[&lt;blah&gt;]

If E uses its argument in a nonlinear way (e.g. a case['Many]), then
this is wrong: the join point has to change its type to a -&gt; a.
Otherwise, we'd get a linearity error.

See also Note [Return type for join points] and Note [Join points and case-of-case].
-}</span><span>
</span><span id="line-1231"></span><span>
</span><span id="line-1232"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Impedance matching to type substitution
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-type">getSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-1241"></span><span id="getSubst"><span class="annot"><span class="annottext">getSubst :: SimplEnv -&gt; Subst
</span><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-var hs-var">getSubst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872746"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872746"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seTvSubst :: SimplEnv -&gt; TvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872747"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872747"><span class="hs-identifier hs-var">tv_env</span></a></span></span><span>
</span><span id="line-1242"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seCvSubst :: SimplEnv -&gt; CvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872748"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872748"><span class="hs-identifier hs-var">cv_env</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1243"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TvSubstEnv -&gt; CvSubstEnv -&gt; IdSubstEnv -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkSubst"><span class="hs-identifier hs-var">mkSubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872746"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872747"><span class="hs-identifier hs-var">tv_env</span></a></span><span> </span><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872748"><span class="hs-identifier hs-var">cv_env</span></a></span><span> </span><span class="annot"><span class="annottext">IdSubstEnv
</span><a href="GHC.Core.TyCo.Subst.html#emptyIdSubstEnv"><span class="hs-identifier hs-var">emptyIdSubstEnv</span></a></span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substTy"><span class="hs-identifier hs-type">substTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1246"></span><span id="substTy"><span class="annot"><span class="annottext">substTy :: (() :: Constraint) =&gt; SimplEnv -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.Opt.Simplify.Env.html#substTy"><span class="hs-identifier hs-var hs-var">substTy</span></a></span></span><span> </span><span id="local-6989586621681872753"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872753"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872754"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872754"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Kind -&gt; Kind
Subst -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">Type.substTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; Subst
</span><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-var">getSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872753"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872754"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1247"></span><span>
</span><span id="line-1248"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substTyVar"><span class="hs-identifier hs-type">substTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1249"></span><span id="substTyVar"><span class="annot"><span class="annottext">substTyVar :: SimplEnv -&gt; OutId -&gt; Kind
</span><a href="GHC.Core.Opt.Simplify.Env.html#substTyVar"><span class="hs-identifier hs-var hs-var">substTyVar</span></a></span></span><span> </span><span id="local-6989586621681872755"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872755"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872756"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872756"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; OutId -&gt; Kind
</span><a href="GHC.Core.TyCo.Subst.html#substTyVar"><span class="hs-identifier hs-var">Type.substTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; Subst
</span><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-var">getSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872755"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872756"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1250"></span><span>
</span><span id="line-1251"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substTyVarBndr"><span class="hs-identifier hs-type">substTyVarBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1252"></span><span id="substTyVarBndr"><span class="annot"><span class="annottext">substTyVarBndr :: SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substTyVarBndr"><span class="hs-identifier hs-var hs-var">substTyVarBndr</span></a></span></span><span> </span><span id="local-6989586621681872757"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872757"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872758"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872758"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; OutId -&gt; (Subst, OutId)
Subst -&gt; OutId -&gt; (Subst, OutId)
</span><a href="GHC.Core.TyCo.Subst.html#substTyVarBndr"><span class="hs-identifier hs-var">Type.substTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; Subst
</span><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-var">getSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872757"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872758"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1254"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span id="local-6989586621681872760"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872760"><span class="hs-identifier hs-var">in_scope'</span></a></span></span><span> </span><span class="annot"><span class="annottext">IdSubstEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681872761"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872761"><span class="hs-identifier hs-var">tv_env'</span></a></span></span><span> </span><span id="local-6989586621681872762"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872762"><span class="hs-identifier hs-var">cv_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872763"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872763"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872757"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872760"><span class="hs-identifier hs-type">in_scope'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872761"><span class="hs-identifier hs-type">tv_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872762"><span class="hs-identifier hs-type">cv_env'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872763"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span>
</span><span id="line-1257"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substCoVar"><span class="hs-identifier hs-type">substCoVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1258"></span><span id="substCoVar"><span class="annot"><span class="annottext">substCoVar :: SimplEnv -&gt; OutId -&gt; Coercion
</span><a href="GHC.Core.Opt.Simplify.Env.html#substCoVar"><span class="hs-identifier hs-var hs-var">substCoVar</span></a></span></span><span> </span><span id="local-6989586621681872764"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872764"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872765"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872765"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; OutId -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCoVar"><span class="hs-identifier hs-var">Coercion.substCoVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; Subst
</span><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-var">getSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872764"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872765"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1259"></span><span>
</span><span id="line-1260"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substCoVarBndr"><span class="hs-identifier hs-type">substCoVarBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span id="substCoVarBndr"><span class="annot"><span class="annottext">substCoVarBndr :: SimplEnv -&gt; OutId -&gt; (SimplEnv, OutId)
</span><a href="GHC.Core.Opt.Simplify.Env.html#substCoVarBndr"><span class="hs-identifier hs-var hs-var">substCoVarBndr</span></a></span></span><span> </span><span id="local-6989586621681872766"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872766"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872767"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872767"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; OutId -&gt; (Subst, OutId)
Subst -&gt; OutId -&gt; (Subst, OutId)
</span><a href="GHC.Core.TyCo.Subst.html#substCoVarBndr"><span class="hs-identifier hs-var">Coercion.substCoVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; Subst
</span><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-var">getSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872766"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872767"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1263"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span id="local-6989586621681872768"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872768"><span class="hs-identifier hs-var">in_scope'</span></a></span></span><span> </span><span class="annot"><span class="annottext">IdSubstEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681872769"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872769"><span class="hs-identifier hs-var">tv_env'</span></a></span></span><span> </span><span id="local-6989586621681872770"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872770"><span class="hs-identifier hs-var">cv_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681872771"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872771"><span class="hs-identifier hs-var">cv'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872766"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872768"><span class="hs-identifier hs-type">in_scope'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872769"><span class="hs-identifier hs-type">tv_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681872770"><span class="hs-identifier hs-type">cv_env'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872771"><span class="hs-identifier hs-var">cv'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1265"></span><span>
</span><span id="line-1266"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substCo"><span class="hs-identifier hs-type">substCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1267"></span><span id="substCo"><span class="annot"><span class="annottext">substCo :: SimplEnv -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Opt.Simplify.Env.html#substCo"><span class="hs-identifier hs-var hs-var">substCo</span></a></span></span><span> </span><span id="local-6989586621681872772"><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872772"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681872773"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681872773"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Coercion -&gt; Coercion
Subst -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier hs-var">Coercion.substCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplEnv -&gt; Subst
</span><a href="GHC.Core.Opt.Simplify.Env.html#getSubst"><span class="hs-identifier hs-var">getSubst</span></a></span><span> </span><span class="annot"><span class="annottext">SimplEnv
</span><a href="#local-6989586621681872772"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681872773"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1268"></span><span>
</span><span id="line-1269"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-1270"></span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#substIdType"><span class="hs-identifier hs-type">substIdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-1271"></span><span id="substIdType"><span class="annot"><span class="annottext">substIdType :: SimplEnv -&gt; OutId -&gt; OutId
</span><a href="GHC.Core.Opt.Simplify.Env.html#substIdType"><span class="hs-identifier hs-var hs-var">substIdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Simplify.Env.html#SimplEnv"><span class="hs-identifier hs-type">SimplEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seInScope :: SimplEnv -&gt; InScopeSet
</span><a href="GHC.Core.Opt.Simplify.Env.html#seInScope"><span class="hs-identifier hs-var">seInScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872774"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872774"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seTvSubst :: SimplEnv -&gt; TvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seTvSubst"><span class="hs-identifier hs-var">seTvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872775"><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872775"><span class="hs-identifier hs-var">tv_env</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">seCvSubst :: SimplEnv -&gt; CvSubstEnv
</span><a href="GHC.Core.Opt.Simplify.Env.html#seCvSubst"><span class="hs-identifier hs-var">seCvSubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681872776"><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872776"><span class="hs-identifier hs-var">cv_env</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681872777"><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872777"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-1272"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TvSubstEnv -&gt; Bool
forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872775"><span class="hs-identifier hs-var">tv_env</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CvSubstEnv -&gt; Bool
forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872776"><span class="hs-identifier hs-var">cv_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1273"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681872779"><span class="hs-identifier hs-var">no_free_vars</span></a></span><span>
</span><span id="line-1274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872777"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; Kind) -&gt; OutId -&gt; OutId
</span><a href="GHC.Types.Var.html#updateIdTypeAndMult"><span class="hs-identifier hs-var">Id.updateIdTypeAndMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">Type.substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621681872782"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872777"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1276"></span><span>                </span><span class="hs-comment">-- The tyCoVarsOfType is cheaper than it looks</span><span>
</span><span id="line-1277"></span><span>                </span><span class="hs-comment">-- because we cache the free tyvars of the type</span><span>
</span><span id="line-1278"></span><span>                </span><span class="hs-comment">-- in a Note in the id's type itself</span><span>
</span><span id="line-1279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1280"></span><span>    </span><span id="local-6989586621681872779"><span class="annot"><span class="annottext">no_free_vars :: Bool
</span><a href="#local-6989586621681872779"><span class="hs-identifier hs-var hs-var">no_free_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872784"><span class="hs-identifier hs-var">old_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681872785"><span class="hs-identifier hs-var">old_w</span></a></span><span>
</span><span id="line-1281"></span><span>    </span><span id="local-6989586621681872782"><span class="annot"><span class="annottext">subst :: Subst
</span><a href="#local-6989586621681872782"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; IdSubstEnv -&gt; TvSubstEnv -&gt; CvSubstEnv -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681872774"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">IdSubstEnv
</span><a href="GHC.Core.TyCo.Subst.html#emptyIdSubstEnv"><span class="hs-identifier hs-var">emptyIdSubstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681872775"><span class="hs-identifier hs-var">tv_env</span></a></span><span> </span><span class="annot"><span class="annottext">CvSubstEnv
</span><a href="#local-6989586621681872776"><span class="hs-identifier hs-var">cv_env</span></a></span><span>
</span><span id="line-1282"></span><span>    </span><span id="local-6989586621681872784"><span class="annot"><span class="annottext">old_ty :: Kind
</span><a href="#local-6989586621681872784"><span class="hs-identifier hs-var hs-var">old_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872777"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1283"></span><span>    </span><span id="local-6989586621681872785"><span class="annot"><span class="annottext">old_w :: Kind
</span><a href="#local-6989586621681872785"><span class="hs-identifier hs-var hs-var">old_w</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutId -&gt; Kind
</span><a href="GHC.Types.Var.html#varMult"><span class="hs-identifier hs-var">varMult</span></a></span><span> </span><span class="annot"><span class="annottext">OutId
</span><a href="#local-6989586621681872777"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1284"></span></pre></body></html>