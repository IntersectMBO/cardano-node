<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.Parser.PostProcess.Haddock</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.6: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.Parser.PostProcess.Haddock.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.Parser.PostProcess.Haddock</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module implements <code><a href="GHC-Parser-PostProcess-Haddock.html#v:addHaddockToModule" title="GHC.Parser.PostProcess.Haddock">addHaddockToModule</a></code>, which inserts Haddock
    comments accumulated during parsing into the AST (#17544).</p><p>We process Haddock comments in two phases:</p><ol><li value="1"><p>Parse the program (via the Happy parser in <code><a href="Parser.html#v:y" title="Parser">y</a></code>), generating
   an AST, and (quite separately) a list of all the Haddock comments
   found in the file. More precisely, the Haddock comments are
   accumulated in the <code><a href="GHC-Parser-Lexer.html#v:hdk_comments" title="GHC.Parser.Lexer">hdk_comments</a></code> field of the <code><a href="GHC-Parser-Lexer.html#t:PState" title="GHC.Parser.Lexer">PState</a></code>, the parser
   state (see Lexer.x):</p><p>data PState = PState { ...
                      ,  hdk_comments :: [PsLocated HdkComment] }</p></li></ol><p>Each of these Haddock comments has a <code><a href="GHC-Types-SrcLoc.html#t:PsSpan" title="GHC.Types.SrcLoc">PsSpan</a></code>, which gives the <code><a href="GHC-Types-SrcLoc.html#t:BufPos" title="GHC.Types.SrcLoc">BufPos</a></code> of
   the beginning and end of the Haddock comment.</p><ol><li value="2">Walk over the AST, attaching the Haddock comments to the correct
   parts of the tree. This step is called <code><a href="GHC-Parser-PostProcess-Haddock.html#v:addHaddockToModule" title="GHC.Parser.PostProcess.Haddock">addHaddockToModule</a></code>, and is
   implemented in this module.</li></ol><p>See Note [Adding Haddock comments to the syntax tree].</p><p>This approach codifies an important principle:</p><p>The presence or absence of a Haddock comment should never change the parsing
  of a program.</p><p>Alternative approaches that did not work properly:</p><ol><li value="1">Using <code><a href="GHC-Types-SrcLoc.html#t:RealSrcLoc" title="GHC.Types.SrcLoc">RealSrcLoc</a></code> instead of <code><a href="GHC-Types-SrcLoc.html#t:BufPos" title="GHC.Types.SrcLoc">BufPos</a></code>. This led to failures in presence
   of {-# LANGUAGE CPP #-} and other sources of line pragmas. See documentation
   on <code><a href="GHC-Types-SrcLoc.html#t:BufPos" title="GHC.Types.SrcLoc">BufPos</a></code> (in GHC.Types.SrcLoc) for the details.</li><li value="2">In earlier versions of GHC, the Haddock comments were incorporated into the
   Parser.y grammar. The parser constructed the AST and attached comments to it in
   a single pass. See Note [Old solution: Haddock in the grammar] for the details.</li></ol></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:addHaddockToModule">addHaddockToModule</a> :: <a href="GHC-Types-SrcLoc.html#t:Located" title="GHC.Types.SrcLoc">Located</a> (<a href="Language-Haskell-Syntax.html#t:HsModule" title="Language.Haskell.Syntax">HsModule</a> <a href="GHC-Hs-Extension.html#t:GhcPs" title="GHC.Hs.Extension">GhcPs</a>) -&gt; <a href="GHC-Parser-Lexer.html#t:P" title="GHC.Parser.Lexer">P</a> (<a href="GHC-Types-SrcLoc.html#t:Located" title="GHC.Types.SrcLoc">Located</a> (<a href="Language-Haskell-Syntax.html#t:HsModule" title="Language.Haskell.Syntax">HsModule</a> <a href="GHC-Hs-Extension.html#t:GhcPs" title="GHC.Hs.Extension">GhcPs</a>))</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:addHaddockToModule" class="def">addHaddockToModule</a> :: <a href="GHC-Types-SrcLoc.html#t:Located" title="GHC.Types.SrcLoc">Located</a> (<a href="Language-Haskell-Syntax.html#t:HsModule" title="Language.Haskell.Syntax">HsModule</a> <a href="GHC-Hs-Extension.html#t:GhcPs" title="GHC.Hs.Extension">GhcPs</a>) -&gt; <a href="GHC-Parser-Lexer.html#t:P" title="GHC.Parser.Lexer">P</a> (<a href="GHC-Types-SrcLoc.html#t:Located" title="GHC.Types.SrcLoc">Located</a> (<a href="Language-Haskell-Syntax.html#t:HsModule" title="Language.Haskell.Syntax">HsModule</a> <a href="GHC-Hs-Extension.html#t:GhcPs" title="GHC.Hs.Extension">GhcPs</a>)) <a href="src/GHC.Parser.PostProcess.Haddock.html#addHaddockToModule" class="link">Source</a> <a href="#v:addHaddockToModule" class="selflink">#</a></p><div class="doc"><p>Add Haddock documentation accumulated in the parser state
 to a parsed HsModule.</p><p>Reports badly positioned comments when -Winvalid-haddock is enabled.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>