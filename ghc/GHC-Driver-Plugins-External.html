<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.Driver.Plugins.External</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.6: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.Driver.Plugins.External.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.Driver.Plugins.External</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>External plugins</p><p>GHC supports two kinds of &quot;static&quot; plugins:
  1. internal: setup with GHC-API
  2. external: setup as explained below and loaded from shared libraries</p><p>The intended use case for external static plugins is with cross compilers: at
 the time of writing, GHC is mono-target and a GHC cross-compiler (i.e. when
 host /= target) can't build nor load plugins for the host using the
 &quot;non-static&quot; plugin approach. Fixing this is tracked in #14335. If you're not
 using a cross-compiler, you'd better use non-static plugins which are easier
 to build and and safer to use (see below).</p><p>External static plugins can be configured via the command-line with
 the -fplugin-library flag. Syntax is:</p><ul><li>fplugin-library=&#10216;file-path&#10217;;&#10216;unit-id&#10217;;&#10216;module&#10217;;&#10216;args&#10217;</li></ul><p>Example:
    -fplugin-library=path<em>to</em>plugin;package-123;Plugin.Module;[<a href="Argument.html">Argument</a>,<a href="List.html">List</a>]</p><p>Building the plugin library:
  1. link with the libraries used to build the compiler you target.  If you
  target a cross-compiler (stage2), you can't directly use it to build the
  plugin library. Use the stage1 compiler instead.</p><ol><li value="2">if you use cabal to build the library, its unit-id will be set by cabal
  and will contain a hash (e.g. &quot;my-plugin-unit-1345656546ABCDEF&quot;). To force
  the unit id, use GHC's `-this-unit-id` command line flag:
    e.g. -this-unit-id my-plugin-unit
  You can set this in the .cabal file of your library with the following
  stanza: `ghc-options: -this-unit-id my-plugin-unit`</li><li value="3">To make your plugin easier to distribute, you may want to link it
  statically with all its dependencies. You would need to use `-shared`
  without `-dynamic` when building your library.</li></ol><p>However, all the static dependencies have to be built with `-fPIC` and it's
  not done by default. See
  <a href="https://www.hobson.space/posts/haskell-foreign-library/">https://www.hobson.space/posts/haskell-foreign-library/</a> for a way to modify
  the compiler to do it.</p><p>In any case, don't link your plugin library statically with the RTS (e.g.
  use `-fno-link-rts`) as there are some global variables in the RTS that must
  be shared between the plugin and the compiler.</p><p>With external static plugins we don't check the type of the <code>plugin</code> closure
 we look up. If it's not a valid <code>Plugin</code> value, it will probably crash badly.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:ExternalPluginSpec">ExternalPluginSpec</a> = <a href="#v:ExternalPluginSpec">ExternalPluginSpec</a> {<ul class="subs"><li><a href="#v:esp_lib">esp_lib</a> :: !<a href="GHC-Prelude-Basic.html#t:FilePath" title="GHC.Prelude.Basic">FilePath</a></li><li><a href="#v:esp_unit_id">esp_unit_id</a> :: !<a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a></li><li><a href="#v:esp_module">esp_module</a> :: !<a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a></li><li><a href="#v:esp_args">esp_args</a> :: ![<a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a>]</li></ul>}</li><li class="src short"><a href="#v:parseExternalPluginSpec">parseExternalPluginSpec</a> :: <a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Driver-Plugins-External.html#t:ExternalPluginSpec" title="GHC.Driver.Plugins.External">ExternalPluginSpec</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ExternalPluginSpec" class="def">ExternalPluginSpec</a> <a href="src/GHC.Driver.Plugins.External.html#ExternalPluginSpec" class="link">Source</a> <a href="#t:ExternalPluginSpec" class="selflink">#</a></p><div class="doc"><p>External plugin spec</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ExternalPluginSpec" class="def">ExternalPluginSpec</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:esp_lib" class="def">esp_lib</a> :: !<a href="GHC-Prelude-Basic.html#t:FilePath" title="GHC.Prelude.Basic">FilePath</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:esp_unit_id" class="def">esp_unit_id</a> :: !<a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:esp_module" class="def">esp_module</a> :: !<a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:esp_args" class="def">esp_args</a> :: ![<a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a>]</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:parseExternalPluginSpec" class="def">parseExternalPluginSpec</a> :: <a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Driver-Plugins-External.html#t:ExternalPluginSpec" title="GHC.Driver.Plugins.External">ExternalPluginSpec</a> <a href="src/GHC.Driver.Plugins.External.html#parseExternalPluginSpec" class="link">Source</a> <a href="#v:parseExternalPluginSpec" class="selflink">#</a></p><div class="doc"><p>Parser external static plugin specification from command-line flag</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>