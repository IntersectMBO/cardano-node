<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.Stg.Lift.Analysis</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.6: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.Stg.Lift.Analysis.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.Stg.Lift.Analysis</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:when"> When to lift</a></li><li><a href="#g:clogro"> Estimating closure growth</a></li><li><a href="#g:3">AST annotation</a></li><li><a href="#g:4">Lifting decision</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Provides the heuristics for when it's beneficial to lambda lift bindings.
 Most significantly, this employs a cost model to estimate impact on heap
 allocations, by looking at an STG expression's <code><a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></code>.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Skeleton">Skeleton</a><ul class="subs"><li>= <a href="#v:ClosureSk">ClosureSk</a> !<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> !<a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></li><li>| <a href="#v:RhsSk">RhsSk</a> !<a href="GHC-Types-Demand.html#t:Card" title="GHC.Types.Demand">Card</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></li><li>| <a href="#v:AltSk">AltSk</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></li><li>| <a href="#v:BothSk">BothSk</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></li><li>| <a href="#v:NilSk">NilSk</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:BinderInfo">BinderInfo</a><ul class="subs"><li>= <a href="#v:BindsClosure">BindsClosure</a> !<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></li><li>| <a href="#v:BoringBinder">BoringBinder</a> !<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a></li></ul></li><li class="src short"><a href="#v:binderInfoBndr">binderInfoBndr</a> :: <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a> -&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:LlStgBinding">LlStgBinding</a> = <a href="GHC-Stg-Syntax.html#t:GenStgBinding" title="GHC.Stg.Syntax">GenStgBinding</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:LlStgExpr">LlStgExpr</a> = <a href="GHC-Stg-Syntax.html#t:GenStgExpr" title="GHC.Stg.Syntax">GenStgExpr</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:LlStgRhs">LlStgRhs</a> = <a href="GHC-Stg-Syntax.html#t:GenStgRhs" title="GHC.Stg.Syntax">GenStgRhs</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:LlStgAlt">LlStgAlt</a> = <a href="GHC-Stg-Syntax.html#t:GenStgAlt" title="GHC.Stg.Syntax">GenStgAlt</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a></li><li class="src short"><a href="#v:tagSkeletonTopBind">tagSkeletonTopBind</a> :: <a href="GHC-Stg-Syntax.html#t:CgStgBinding" title="GHC.Stg.Syntax">CgStgBinding</a> -&gt; <a href="GHC-Stg-Lift-Analysis.html#t:LlStgBinding" title="GHC.Stg.Lift.Analysis">LlStgBinding</a></li><li class="src short"><a href="#v:goodToLift">goodToLift</a> :: <a href="GHC-Stg-Lift-Config.html#t:StgLiftConfig" title="GHC.Stg.Lift.Config">StgLiftConfig</a> -&gt; <a href="GHC-Types-Basic.html#t:TopLevelFlag" title="GHC.Types.Basic">TopLevelFlag</a> -&gt; <a href="GHC-Types-Basic.html#t:RecFlag" title="GHC.Types.Basic">RecFlag</a> -&gt; (<a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a> -&gt; <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a>) -&gt; [(<a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a>, <a href="GHC-Stg-Lift-Analysis.html#t:LlStgRhs" title="GHC.Stg.Lift.Analysis">LlStgRhs</a>)] -&gt; <a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a></li><li class="src short"><a href="#v:closureGrowth">closureGrowth</a> :: (<a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a> -&gt; <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a>) -&gt; (<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>) -&gt; <a href="GHC-Types-Var-Set.html#t:IdSet" title="GHC.Types.Var.Set">IdSet</a> -&gt; <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a> -&gt; <a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a> -&gt; <a href="GHC-Types-Basic.html#t:IntWithInf" title="GHC.Types.Basic">IntWithInf</a></li></ul></details></div><div id="interface"><a href="#g:when" id="g:when"><h1> When to lift</h1></a><div class="doc"><p>The analysis proceeds in two steps:</p><ol><li value="1">It tags the syntax tree with analysis information in the form of
      <code><a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a></code> at each binder and <code><a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></code>s at each let-binding
      by <code><a href="GHC-Stg-Lift-Analysis.html#v:tagSkeletonTopBind" title="GHC.Stg.Lift.Analysis">tagSkeletonTopBind</a></code> and friends.</li><li value="2">The resulting syntax tree is treated by the <a href="GHC-Stg-Lift.html">GHC.Stg.Lift</a>
      module, calling out to <code><a href="GHC-Stg-Lift-Analysis.html#v:goodToLift" title="GHC.Stg.Lift.Analysis">goodToLift</a></code> to decide if a binding is worthwhile
      to lift.
      <code><a href="GHC-Stg-Lift-Analysis.html#v:goodToLift" title="GHC.Stg.Lift.Analysis">goodToLift</a></code> consults argument occurrence information in <code><a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a></code>
      and estimates <code><a href="GHC-Stg-Lift-Analysis.html#v:closureGrowth" title="GHC.Stg.Lift.Analysis">closureGrowth</a></code>, for which it needs the <code><a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></code>.</li></ol><p>So the annotations from <code><a href="GHC-Stg-Lift-Analysis.html#v:tagSkeletonTopBind" title="GHC.Stg.Lift.Analysis">tagSkeletonTopBind</a></code> ultimately fuel <code><a href="GHC-Stg-Lift-Analysis.html#v:goodToLift" title="GHC.Stg.Lift.Analysis">goodToLift</a></code>,
 which employs a number of heuristics to identify and exclude lambda lifting
 opportunities deemed non-beneficial:</p><dl><dt>Top-level bindings</dt><dd>can't be lifted.</dd><dt>Thunks</dt><dd>and data constructors shouldn't be lifted in order not to destroy
    sharing.</dd><dt>Argument occurrences</dt><dd><a id="arg_occs"></a> of binders prohibit them to be lifted.
    Doing the lift would re-introduce the very allocation at call sites that
    we tried to get rid off in the first place. We capture analysis
    information in <code><a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a></code>. Note that we also consider a nullary
    application as argument occurrence, because it would turn into an n-ary
    partial application created by a generic apply function. This occurs in
    CPS-heavy code like the CS benchmark.</dd><dt>Join points</dt><dd>should not be lifted, simply because there's no reduction in
    allocation to be had.</dd><dt>Abstracting over join points</dt><dd>destroys join points, because they end up as
    arguments to the lifted function.</dd><dt>Abstracting over known local functions</dt><dd>turns a known call into an unknown
    call (e.g. some <code>stg_ap_*</code>), which is generally slower. Can be turned off
    with <code>-fstg-lift-lams-known</code>.</dd><dt>Calling convention</dt><dd>Don't lift when the resulting function would have a
    higher arity than available argument registers for the calling convention.
    Can be influenced with <code>-fstg-lift-(non)rec-args(-any)</code>.</dd><dt>Closure growth</dt><dd>introduced when former free variables have to be available
    at call sites may actually lead to an increase in overall allocations
  resulting from a lift. Estimating closure growth is described in
  <a href="GHC-Stg-Lift-Analysis.html#clogro">GHC.Stg.Lift.Analysis</a> and is what most of this module is ultimately
  concerned with.</dd></dl><p>There's a <a href="https://gitlab.haskell.org/ghc/ghc/wikis/late-lam-lift">wiki page</a> with
 some more background and history.</p></div><a href="#g:clogro" id="g:clogro"><h1> Estimating closure growth</h1></a><div class="doc"><p>We estimate closure growth by abstracting the syntax tree into a <code><a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></code>,
 capturing only syntactic details relevant to <code><a href="GHC-Stg-Lift-Analysis.html#v:closureGrowth" title="GHC.Stg.Lift.Analysis">closureGrowth</a></code>, such as</p><ul><li><code><a href="GHC-Stg-Lift-Analysis.html#v:ClosureSk" title="GHC.Stg.Lift.Analysis">ClosureSk</a></code>, representing closure allocation.</li><li><code><a href="GHC-Stg-Lift-Analysis.html#v:RhsSk" title="GHC.Stg.Lift.Analysis">RhsSk</a></code>, representing a RHS of a binding and how many times it's called
     by an appropriate <code><a href="GHC-Types-Demand.html#t:Card" title="GHC.Types.Demand">Card</a></code>.</li><li><code><a href="GHC-Stg-Lift-Analysis.html#v:AltSk" title="GHC.Stg.Lift.Analysis">AltSk</a></code>, <code><a href="GHC-Stg-Lift-Analysis.html#v:BothSk" title="GHC.Stg.Lift.Analysis">BothSk</a></code> and <code><a href="GHC-Stg-Lift-Analysis.html#v:NilSk" title="GHC.Stg.Lift.Analysis">NilSk</a></code> for choice, sequence and empty element.</li></ul><p>This abstraction is mostly so that the main analysis function <code><a href="GHC-Stg-Lift-Analysis.html#v:closureGrowth" title="GHC.Stg.Lift.Analysis">closureGrowth</a></code>
 can stay simple and focused. Also, skeletons tend to be much smaller than
 the syntax tree they abstract, so it makes sense to construct them once and
 and operate on them instead of the actual syntax tree.</p><p>A more detailed treatment of computing closure growth, including examples,
 can be found in the paper referenced from the
 <a href="https://gitlab.haskell.org/ghc/ghc/wikis/late-lam-lift">wiki page</a>.</p></div><a href="#g:3" id="g:3"><h1>AST annotation</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Skeleton" class="def">Skeleton</a> <a href="src/GHC.Stg.Lift.Analysis.html#Skeleton" class="link">Source</a> <a href="#t:Skeleton" class="selflink">#</a></p><div class="doc"><p>Captures details of the syntax tree relevant to the cost model, such as
 closures, multi-shot lambdas and case expressions.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ClosureSk" class="def">ClosureSk</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src">!<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src">!<a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a></dfn><div class="doc"><p>free vars </p></div></li><li><dfn class="src">!<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr><tr><td class="src"><a id="v:RhsSk" class="def">RhsSk</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src">!<a href="GHC-Types-Demand.html#t:Card" title="GHC.Types.Demand">Card</a></dfn><div class="doc"><p>how often the RHS was entered </p></div></li><li><dfn class="src">!<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr><tr><td class="src"><a id="v:AltSk" class="def">AltSk</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:BothSk" class="def">BothSk</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a> !<a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:NilSk" class="def">NilSk</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Skeleton">Instances</h4><details id="i:Skeleton" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Skeleton:Outputable:1"></span> <a href="GHC-Utils-Outputable.html#t:Outputable" title="GHC.Utils.Outputable">Outputable</a> <a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></span> <a href="src/GHC.Stg.Lift.Analysis.html#line-161" class="link">Source</a> <a href="#t:Skeleton" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Skeleton:Outputable:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Stg-Lift-Analysis.html">GHC.Stg.Lift.Analysis</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:BinderInfo" class="def">BinderInfo</a> <a href="src/GHC.Stg.Lift.Analysis.html#BinderInfo" class="link">Source</a> <a href="#t:BinderInfo" class="selflink">#</a></p><div class="doc"><p>The type used in binder positions in <code><a href="GHC-Stg-Syntax.html#t:GenStgExpr" title="GHC.Stg.Syntax">GenStgExpr</a></code>s.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:BindsClosure" class="def">BindsClosure</a> !<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></td><td class="doc"><p>Let(-no-escape)-bound thing with a flag
   indicating whether it occurs as an argument
   or in a nullary application
   (see <a href="GHC-Stg-Lift-Analysis.html#arg_occs">GHC.Stg.Lift.Analysis</a>).</p></td></tr><tr><td class="src"><a id="v:BoringBinder" class="def">BoringBinder</a> !<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a></td><td class="doc"><p>Every other kind of binder</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:BinderInfo">Instances</h4><details id="i:BinderInfo" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BinderInfo:Outputable:1"></span> <a href="GHC-Utils-Outputable.html#t:Outputable" title="GHC.Utils.Outputable">Outputable</a> <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a></span> <a href="src/GHC.Stg.Lift.Analysis.html#line-178" class="link">Source</a> <a href="#t:BinderInfo" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BinderInfo:Outputable:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Stg-Lift-Analysis.html">GHC.Stg.Lift.Analysis</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BinderInfo:OutputableBndr:2"></span> <a href="GHC-Utils-Outputable.html#t:OutputableBndr" title="GHC.Utils.Outputable">OutputableBndr</a> <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a></span> <a href="src/GHC.Stg.Lift.Analysis.html#line-181" class="link">Source</a> <a href="#t:BinderInfo" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BinderInfo:OutputableBndr:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Stg-Lift-Analysis.html">GHC.Stg.Lift.Analysis</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:pprBndr">pprBndr</a> :: <a href="GHC-Utils-Outputable.html#t:BindingSite" title="GHC.Utils.Outputable">BindingSite</a> -&gt; <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#pprBndr" class="link">Source</a> <a href="#v:pprBndr" class="selflink">#</a></p><p class="src"><a href="#v:pprPrefixOcc">pprPrefixOcc</a> :: <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#pprPrefixOcc" class="link">Source</a> <a href="#v:pprPrefixOcc" class="selflink">#</a></p><p class="src"><a href="#v:pprInfixOcc">pprInfixOcc</a> :: <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#pprInfixOcc" class="link">Source</a> <a href="#v:pprInfixOcc" class="selflink">#</a></p><p class="src"><a href="#v:bndrIsJoin_maybe">bndrIsJoin_maybe</a> :: <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> <a href="src/GHC.Utils.Outputable.html#bndrIsJoin_maybe" class="link">Source</a> <a href="#v:bndrIsJoin_maybe" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:binderInfoBndr" class="def">binderInfoBndr</a> :: <a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a> -&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> <a href="src/GHC.Stg.Lift.Analysis.html#binderInfoBndr" class="link">Source</a> <a href="#v:binderInfoBndr" class="selflink">#</a></p><div class="doc"><p>Gets the bound <code><a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a></code> out a <code><a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LlStgBinding" class="def">LlStgBinding</a> = <a href="GHC-Stg-Syntax.html#t:GenStgBinding" title="GHC.Stg.Syntax">GenStgBinding</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a> <a href="src/GHC.Stg.Syntax.html#LlStgBinding" class="link">Source</a> <a href="#t:LlStgBinding" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LlStgExpr" class="def">LlStgExpr</a> = <a href="GHC-Stg-Syntax.html#t:GenStgExpr" title="GHC.Stg.Syntax">GenStgExpr</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a> <a href="src/GHC.Stg.Syntax.html#LlStgExpr" class="link">Source</a> <a href="#t:LlStgExpr" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LlStgRhs" class="def">LlStgRhs</a> = <a href="GHC-Stg-Syntax.html#t:GenStgRhs" title="GHC.Stg.Syntax">GenStgRhs</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a> <a href="src/GHC.Stg.Syntax.html#LlStgRhs" class="link">Source</a> <a href="#t:LlStgRhs" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LlStgAlt" class="def">LlStgAlt</a> = <a href="GHC-Stg-Syntax.html#t:GenStgAlt" title="GHC.Stg.Syntax">GenStgAlt</a> '<a href="GHC-Stg-Syntax.html#v:LiftLams" title="GHC.Stg.Syntax">LiftLams</a> <a href="src/GHC.Stg.Syntax.html#LlStgAlt" class="link">Source</a> <a href="#t:LlStgAlt" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tagSkeletonTopBind" class="def">tagSkeletonTopBind</a> :: <a href="GHC-Stg-Syntax.html#t:CgStgBinding" title="GHC.Stg.Syntax">CgStgBinding</a> -&gt; <a href="GHC-Stg-Lift-Analysis.html#t:LlStgBinding" title="GHC.Stg.Lift.Analysis">LlStgBinding</a> <a href="src/GHC.Stg.Lift.Analysis.html#tagSkeletonTopBind" class="link">Source</a> <a href="#v:tagSkeletonTopBind" class="selflink">#</a></p><div class="doc"><p>Tags every binder with its <code><a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a></code> and let bindings with their
 <code><a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></code>s.</p></div></div><a href="#g:4" id="g:4"><h1>Lifting decision</h1></a><div class="top"><p class="src"><a id="v:goodToLift" class="def">goodToLift</a> <a href="src/GHC.Stg.Lift.Analysis.html#goodToLift" class="link">Source</a> <a href="#v:goodToLift" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="GHC-Stg-Lift-Config.html#t:StgLiftConfig" title="GHC.Stg.Lift.Config">StgLiftConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Basic.html#t:TopLevelFlag" title="GHC.Types.Basic">TopLevelFlag</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Basic.html#t:RecFlag" title="GHC.Types.Basic">RecFlag</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; (<a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a> -&gt; <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a>)</td><td class="doc"><p>An expander function, turning <code><a href="GHC-Types-Var.html#t:InId" title="GHC.Types.Var">InId</a></code>s into
 <code><a href="GHC-Types-Var.html#t:OutId" title="GHC.Types.Var">OutId</a></code>s. See <code><a href="GHC-Stg-Lift-Monad.html#v:liftedIdsExpander" title="GHC.Stg.Lift.Monad">liftedIdsExpander</a></code>.</p></td></tr><tr><td class="src">-&gt; [(<a href="GHC-Stg-Lift-Analysis.html#t:BinderInfo" title="GHC.Stg.Lift.Analysis">BinderInfo</a>, <a href="GHC-Stg-Lift-Analysis.html#t:LlStgRhs" title="GHC.Stg.Lift.Analysis">LlStgRhs</a>)]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a></td><td class="doc"><p><code>Just abs_ids</code> <a href="=">=</a> This binding is beneficial to
 lift and <code>abs_ids</code> are the variables it would
 abstract over</p></td></tr></table></div><div class="doc"><p>Combines several heuristics to decide whether to lambda-lift a given
 <code>let</code>-binding to top-level. See <a href="GHC-Stg-Lift-Analysis.html#when">GHC.Stg.Lift.Analysis</a> for details.</p></div></div><div class="top"><p class="src"><a id="v:closureGrowth" class="def">closureGrowth</a> <a href="src/GHC.Stg.Lift.Analysis.html#closureGrowth" class="link">Source</a> <a href="#v:closureGrowth" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a> -&gt; <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a>)</td><td class="doc"><p>Expands outer free ids that were lifted to their free vars</p></td></tr><tr><td class="src">-&gt; (<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>)</td><td class="doc"><p>Computes the closure footprint of an identifier</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Var-Set.html#t:IdSet" title="GHC.Types.Var.Set">IdSet</a></td><td class="doc"><p>Binding group for which lifting is to be decided</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Var-Set.html#t:DIdSet" title="GHC.Types.Var.Set">DIdSet</a></td><td class="doc"><p>Free vars of the whole binding group prior to lifting it. These must be
   available at call sites if we decide to lift the binding group.</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Stg-Lift-Analysis.html#t:Skeleton" title="GHC.Stg.Lift.Analysis">Skeleton</a></td><td class="doc"><p>Abstraction of the scope of the function</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Basic.html#t:IntWithInf" title="GHC.Types.Basic">IntWithInf</a></td><td class="doc"><p>Closure growth. <code><a href="GHC-Types-Basic.html#v:infinity" title="GHC.Types.Basic">infinity</a></code> indicates there was growth under a
   (multi-shot) lambda.</p></td></tr></table></div><div class="doc"><p><code>closureGrowth expander sizer f fvs</code> computes the closure growth in words
 as a result of lifting <code>f</code> to top-level. If there was any growing closure
 under a multi-shot lambda, the result will be <code><a href="GHC-Types-Basic.html#v:infinity" title="GHC.Types.Basic">infinity</a></code>.
 Also see <a href="GHC-Stg-Lift-Analysis.html#clogro">GHC.Stg.Lift.Analysis</a>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>