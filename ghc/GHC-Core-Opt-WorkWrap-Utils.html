<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.Core.Opt.WorkWrap.Utils</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.7: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.Core.Opt.WorkWrap.Utils.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.Core.Opt.WorkWrap.Utils</p></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:WwOpts">WwOpts</a> = <a href="#v:MkWwOpts">MkWwOpts</a> {<ul class="subs"><li><a href="#v:wo_fam_envs">wo_fam_envs</a> :: !<a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a></li><li><a href="#v:wo_simple_opts">wo_simple_opts</a> :: !<a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a></li><li><a href="#v:wo_cpr_anal">wo_cpr_anal</a> :: !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></li><li><a href="#v:wo_module">wo_module</a> :: !<a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a></li><li><a href="#v:wo_unlift_strict">wo_unlift_strict</a> :: !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></li></ul>}</li><li class="src short"><a href="#v:mkWwBodies">mkWwBodies</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a> -&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; <a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a> -&gt; [<a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a>] -&gt; <a href="GHC-Types-Cpr.html#t:Cpr" title="GHC.Types.Cpr">Cpr</a> -&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> (<a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> WwResult)</li><li class="src short"><a href="#v:mkWWstr">mkWWstr</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a> -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; [<a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a>] -&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> (WwUse, [(<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>, <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a>)], <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>, [<a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>])</li><li class="src short"><a href="#v:mkWWstr_one">mkWWstr_one</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a> -&gt; <a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a> -&gt; <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a> -&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> (WwUse, [(<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>, <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a>)], <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>, <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>)</li><li class="src short"><a href="#v:needsVoidWorkerArg">needsVoidWorkerArg</a> :: <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:DataConPatContext">DataConPatContext</a> s = <a href="#v:DataConPatContext">DataConPatContext</a> {<ul class="subs"><li><a href="#v:dcpc_dc">dcpc_dc</a> :: !<a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a></li><li><a href="#v:dcpc_tc_args">dcpc_tc_args</a> :: ![<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>]</li><li><a href="#v:dcpc_co">dcpc_co</a> :: !<a href="GHC-Core-Coercion.html#t:Coercion" title="GHC.Core.Coercion">Coercion</a></li><li><a href="#v:dcpc_args">dcpc_args</a> :: ![s]</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:UnboxingDecision">UnboxingDecision</a> unboxing_info<ul class="subs"><li>= <a href="#v:DontUnbox">DontUnbox</a></li><li>| <a href="#v:DoUnbox">DoUnbox</a> !unboxing_info</li><li>| <a href="#v:DropAbsent">DropAbsent</a></li></ul></li><li class="src short"><a href="#v:canUnboxArg">canUnboxArg</a> :: <a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a> -&gt; <a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a> -&gt; <a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a> -&gt; <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:UnboxingDecision" title="GHC.Core.Opt.WorkWrap.Utils">UnboxingDecision</a> (<a href="GHC-Core-Opt-WorkWrap-Utils.html#t:DataConPatContext" title="GHC.Core.Opt.WorkWrap.Utils">DataConPatContext</a> <a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a>)</li><li class="src short"><a href="#v:findTypeShape">findTypeShape</a> :: <a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a> -&gt; <a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a> -&gt; <a href="GHC-Types-Demand.html#t:TypeShape" title="GHC.Types.Demand">TypeShape</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:IsRecDataConResult">IsRecDataConResult</a><ul class="subs"><li>= <a href="#v:DefinitelyRecursive">DefinitelyRecursive</a></li><li>| <a href="#v:NonRecursiveOrUnsure">NonRecursiveOrUnsure</a></li></ul></li><li class="src short"><a href="#v:isRecDataCon">isRecDataCon</a> :: <a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a> -&gt; <a href="GHC-Types-Basic.html#t:IntWithInf" title="GHC.Types.Basic">IntWithInf</a> -&gt; <a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a> -&gt; <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a></li><li class="src short"><a href="#v:mkAbsentFiller">mkAbsentFiller</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a> -&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a></li><li class="src short"><a href="#v:isWorkerSmallEnough">isWorkerSmallEnough</a> :: <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></li><li class="src short"><a href="#v:dubiousDataConInstArgTys">dubiousDataConInstArgTys</a> :: <a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a> -&gt; [<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>] -&gt; [<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>]</li><li class="src short"><a href="#v:boringSplit">boringSplit</a> :: WwUse</li><li class="src short"><a href="#v:usefulSplit">usefulSplit</a> :: WwUse</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:WwOpts" class="def">WwOpts</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#WwOpts" class="link">Source</a> <a href="#t:WwOpts" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:MkWwOpts" class="def">MkWwOpts</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:wo_fam_envs" class="def">wo_fam_envs</a> :: !<a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a></dfn><div class="doc"><p>Environment of type/data family instances</p></div></li><li><dfn class="src"><a id="v:wo_simple_opts" class="def">wo_simple_opts</a> :: !<a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a></dfn><div class="doc"><p>Options for the &quot;Simple optimiser&quot;</p></div></li><li><dfn class="src"><a id="v:wo_cpr_anal" class="def">wo_cpr_anal</a> :: !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></dfn><div class="doc"><p>Whether to enable &quot;Constructed Product Result&quot; analysis.
 (Originally from DOI: 10.1017/S0956796803004751)</p></div></li><li><dfn class="src"><a id="v:wo_module" class="def">wo_module</a> :: !<a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a></dfn><div class="doc"><p>Used for absent argument error message</p></div></li><li><dfn class="src"><a id="v:wo_unlift_strict" class="def">wo_unlift_strict</a> :: !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></dfn><div class="doc"><p>Generate workers even if the only effect is some args get passed
 unlifted. See Note [WW for calling convention]</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:mkWwBodies" class="def">mkWwBodies</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#mkWwBodies" class="link">Source</a> <a href="#v:mkWwBodies" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a></td><td class="doc"><p>The original function</p></td></tr><tr><td class="src">-&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>]</td><td class="doc"><p>Manifest args of original function</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a></td><td class="doc"><p>Result type of the original function,
   after being stripped of args</p></td></tr><tr><td class="src">-&gt; [<a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a>]</td><td class="doc"><p>Strictness of original function</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Cpr.html#t:Cpr" title="GHC.Types.Cpr">Cpr</a></td><td class="doc"><p>Info about function result</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> (<a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> WwResult)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Given a function definition</p><pre>data T = MkT Int Bool Char
f :: (a, b) -&gt; Int -&gt; T
f = \x y -&gt; E</pre><p><code>mkWwBodies _ <code>f</code> ['x::(a,b)','y::Int'] '(a,b)' ['1P(L,L)', '1P(L)'] '1'</code>
 returns</p><ul><li>The wrapper body context for the call to the worker function, lacking
     only the <code><a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a></code> for the worker function:</li></ul><pre>W[_] :: Id -&gt; CoreExpr
W[work_fn] = \x y -&gt;          -- args of the wrapper    (cloned_arg_vars)
  case x of (a, b) -&gt;         -- unbox wrapper args     (wrap_fn_str)
  case y of I# n -&gt;           --
  case &lt;work_fn&gt; a b n of     -- call to the worker fun (call_work)
  (# i, b, c #) -&gt; MkT i b c  -- rebox result           (wrap_fn_cpr)</pre><ul><li>The worker body context that wraps around its hole reboxing defns for x
     and y, as well as returning CPR transit variables of the unboxed MkT
     result in an unboxed tuple:</li></ul><pre>w[_] :: CoreExpr -&gt; CoreExpr
w[fn_rhs] = \a b n -&gt;              -- args of the worker       (work_lam_args)
  let { y = I# n; x = (a, b) } in  -- reboxing wrapper args    (work_fn_str)
  case &lt;fn_rhs&gt; x y of             -- call to the original RHS (call_rhs)
  MkT i b c -&gt; (# i, b, c #)       -- return CPR transit vars  (work_fn_cpr)</pre><p>NB: The wrap_rhs hole is to be filled with the original wrapper RHS
     <code>x y -&gt; E</code>. This is so that we can also use <code>w</code> to transform stable
     unfoldings, the lambda args of which may be different than x and y.</p><ul><li>Id details for the worker function like demands on arguments and its join
     arity.</li></ul><p>All without looking at E (except for beta reduction, see Note [Join points
 and beta-redexes]), which allows us to apply the same split to function body
 and its unfolding(s) alike.</p></div></div><div class="top"><p class="src"><a id="v:mkWWstr" class="def">mkWWstr</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a> -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; [<a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a>] -&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> (WwUse, [(<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>, <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a>)], <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>, [<a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>]) <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#mkWWstr" class="link">Source</a> <a href="#v:mkWWstr" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:mkWWstr_one" class="def">mkWWstr_one</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a> -&gt; <a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a> -&gt; <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a> -&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> (WwUse, [(<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>, <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a>)], <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>, <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>) <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#mkWWstr_one" class="link">Source</a> <a href="#v:mkWWstr_one" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:needsVoidWorkerArg" class="def">needsVoidWorkerArg</a> :: <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#needsVoidWorkerArg" class="link">Source</a> <a href="#v:needsVoidWorkerArg" class="selflink">#</a></p><div class="doc"><p>Whether the worker needs an additional `Void#` arg as per
 Note [Protecting the last value argument] or
 Note [Preserving float barriers].</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DataConPatContext" class="def">DataConPatContext</a> s <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#DataConPatContext" class="link">Source</a> <a href="#t:DataConPatContext" class="selflink">#</a></p><div class="doc"><p>The information needed to build a pattern for a DataCon to be unboxed.
 The pattern can be generated from <code><a href="GHC-Core-Opt-WorkWrap-Utils.html#v:dcpc_dc" title="GHC.Core.Opt.WorkWrap.Utils">dcpc_dc</a></code> and <code><a href="GHC-Core-Opt-WorkWrap-Utils.html#v:dcpc_tc_args" title="GHC.Core.Opt.WorkWrap.Utils">dcpc_tc_args</a></code> via
 <code><a href="GHC-Core-Utils.html#v:dataConRepInstPat" title="GHC.Core.Utils">dataConRepInstPat</a></code>. The coercion <code><a href="GHC-Core-Opt-WorkWrap-Utils.html#v:dcpc_co" title="GHC.Core.Opt.WorkWrap.Utils">dcpc_co</a></code> is for newtype
 wrappers.</p><p>If we get <code>DataConPatContext dc tys co</code> for some type <code>ty</code>
 and <code>dataConRepInstPat ... dc tys = (exs, flds)</code>, then</p><ul><li><code>dc </code>exs flds :: T tys@</li><li><pre>co :: T tys ~ ty</pre></li></ul><p><code>s</code> will be <code><a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a></code> or <code><a href="GHC-Types-Cpr.html#t:Cpr" title="GHC.Types.Cpr">Cpr</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DataConPatContext" class="def">DataConPatContext</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:dcpc_dc" class="def">dcpc_dc</a> :: !<a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dcpc_tc_args" class="def">dcpc_tc_args</a> :: ![<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dcpc_co" class="def">dcpc_co</a> :: !<a href="GHC-Core-Coercion.html#t:Coercion" title="GHC.Core.Coercion">Coercion</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:dcpc_args" class="def">dcpc_args</a> :: ![s]</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:UnboxingDecision" class="def">UnboxingDecision</a> unboxing_info <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#UnboxingDecision" class="link">Source</a> <a href="#t:UnboxingDecision" class="selflink">#</a></p><div class="doc"><p>Describes the outer shape of an argument to be unboxed or left as-is
 Depending on how <code>s</code> is instantiated (e.g., <code><a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a></code> or <code><a href="GHC-Types-Cpr.html#t:Cpr" title="GHC.Types.Cpr">Cpr</a></code>).</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DontUnbox" class="def">DontUnbox</a></td><td class="doc"><p>We ran out of strictness info. Leave untouched.</p></td></tr><tr><td class="src"><a id="v:DoUnbox" class="def">DoUnbox</a> !unboxing_info</td><td class="doc"><p>The argument is used strictly or the
 returned product was constructed, so unbox it.</p></td></tr><tr><td class="src"><a id="v:DropAbsent" class="def">DropAbsent</a></td><td class="doc"><p>The argument/field was absent. Drop it.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:UnboxingDecision">Instances</h4><details id="i:UnboxingDecision" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:UnboxingDecision:Outputable:1"></span> <a href="GHC-Utils-Outputable.html#t:Outputable" title="GHC.Utils.Outputable">Outputable</a> i =&gt; <a href="GHC-Utils-Outputable.html#t:Outputable" title="GHC.Utils.Outputable">Outputable</a> (<a href="GHC-Core-Opt-WorkWrap-Utils.html#t:UnboxingDecision" title="GHC.Core.Opt.WorkWrap.Utils">UnboxingDecision</a> i)</span> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#line-616" class="link">Source</a> <a href="#t:UnboxingDecision" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:UnboxingDecision:Outputable:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Core-Opt-WorkWrap-Utils.html">GHC.Core.Opt.WorkWrap.Utils</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:UnboxingDecision" title="GHC.Core.Opt.WorkWrap.Utils">UnboxingDecision</a> i -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:canUnboxArg" class="def">canUnboxArg</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#canUnboxArg" class="link">Source</a> <a href="#v:canUnboxArg" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a></td><td class="doc"><p>Type of the argument</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a></td><td class="doc"><p>How the arg was used</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:UnboxingDecision" title="GHC.Core.Opt.WorkWrap.Utils">UnboxingDecision</a> (<a href="GHC-Core-Opt-WorkWrap-Utils.html#t:DataConPatContext" title="GHC.Core.Opt.WorkWrap.Utils">DataConPatContext</a> <a href="GHC-Types-Demand.html#t:Demand" title="GHC.Types.Demand">Demand</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Unwraps the <code><a href="Language-Haskell-Syntax-Basic.html#t:Boxity" title="Language.Haskell.Syntax.Basic">Boxity</a></code> decision encoded in the given <code><a href="GHC-Types-Demand.html#t:SubDemand" title="GHC.Types.Demand">SubDemand</a></code> and returns
 a <code><a href="GHC-Core-Opt-WorkWrap-Utils.html#t:DataConPatContext" title="GHC.Core.Opt.WorkWrap.Utils">DataConPatContext</a></code> as well the nested demands on fields of the <code><a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a></code>
 to unbox.</p></div></div><div class="top"><p class="src"><a id="v:findTypeShape" class="def">findTypeShape</a> :: <a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a> -&gt; <a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a> -&gt; <a href="GHC-Types-Demand.html#t:TypeShape" title="GHC.Types.Demand">TypeShape</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#findTypeShape" class="link">Source</a> <a href="#v:findTypeShape" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:IsRecDataConResult" class="def">IsRecDataConResult</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#IsRecDataConResult" class="link">Source</a> <a href="#t:IsRecDataConResult" class="selflink">#</a></p><div class="doc"><p>Returned by <code><a href="GHC-Core-Opt-WorkWrap-Utils.html#v:isRecDataCon" title="GHC.Core.Opt.WorkWrap.Utils">isRecDataCon</a></code>.
 See also Note [Detecting recursive data constructors].</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DefinitelyRecursive" class="def">DefinitelyRecursive</a></td><td class="doc"><p>The algorithm detected a loop</p></td></tr><tr><td class="src"><a id="v:NonRecursiveOrUnsure" class="def">NonRecursiveOrUnsure</a></td><td class="doc"><p>The algorithm detected no loop, went out of fuel
 or hit an .hs-boot file</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:IsRecDataConResult">Instances</h4><details id="i:IsRecDataConResult" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:IsRecDataConResult:Show:1"></span> <a href="GHC-Prelude-Basic.html#t:Show" title="GHC.Prelude.Basic">Show</a> <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a></span> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#line-1343" class="link">Source</a> <a href="#t:IsRecDataConResult" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:IsRecDataConResult:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Core-Opt-WorkWrap-Utils.html">GHC.Core.Opt.WorkWrap.Utils</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> -&gt; <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> -&gt; <a href="GHC-Prelude-Basic.html#t:ShowS" title="GHC.Prelude.Basic">ShowS</a> <a href="../base-4.18.3.0/src/GHC.Show.html#showsPrec" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> -&gt; <a href="GHC-Prelude-Basic.html#t:String" title="GHC.Prelude.Basic">String</a> <a href="../base-4.18.3.0/src/GHC.Show.html#show" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a>] -&gt; <a href="GHC-Prelude-Basic.html#t:ShowS" title="GHC.Prelude.Basic">ShowS</a> <a href="../base-4.18.3.0/src/GHC.Show.html#showList" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:IsRecDataConResult:Outputable:2"></span> <a href="GHC-Utils-Outputable.html#t:Outputable" title="GHC.Utils.Outputable">Outputable</a> <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a></span> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#line-1345" class="link">Source</a> <a href="#t:IsRecDataConResult" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:IsRecDataConResult:Outputable:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Core-Opt-WorkWrap-Utils.html">GHC.Core.Opt.WorkWrap.Utils</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:IsRecDataConResult:Eq:3"></span> <a href="GHC-Prelude-Basic.html#t:Eq" title="GHC.Prelude.Basic">Eq</a> <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a></span> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#line-1343" class="link">Source</a> <a href="#t:IsRecDataConResult" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:IsRecDataConResult:Eq:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Core-Opt-WorkWrap-Utils.html">GHC.Core.Opt.WorkWrap.Utils</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> -&gt; <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> -&gt; <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:isRecDataCon" class="def">isRecDataCon</a> :: <a href="GHC-Core-FamInstEnv.html#t:FamInstEnvs" title="GHC.Core.FamInstEnv">FamInstEnvs</a> -&gt; <a href="GHC-Types-Basic.html#t:IntWithInf" title="GHC.Types.Basic">IntWithInf</a> -&gt; <a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a> -&gt; <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:IsRecDataConResult" title="GHC.Core.Opt.WorkWrap.Utils">IsRecDataConResult</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#isRecDataCon" class="link">Source</a> <a href="#v:isRecDataCon" class="selflink">#</a></p><div class="doc"><p><code>isRecDataCon _ fuel dc</code>, where <code>tc = dataConTyCon dc</code> returns</p><ul><li><code>DefinitelyRecursive</code> if the analysis found that <code>tc</code> is reachable
     through one of <code>dc</code>'s <code>arg_tys</code>.</li><li><code>NonRecursiveOrUnsure</code> if the analysis found that <code>tc</code> is not reachable
     through one of <code>dc</code>'s fields (so surely non-recursive).</li><li><code>NonRecursiveOrUnsure</code> when <code>fuel /= Infinity</code>
     and <code>fuel</code> expansions of nested data TyCons were not enough to prove
     non-recursiveness, nor arrive at an occurrence of <code>tc</code> thus proving
     recursiveness. (So not sure if non-recursive.)</li><li><code>NonRecursiveOrUnsure</code> when we hit an abstract TyCon (one without
     visible DataCons), such as those imported from .hs-boot files.
     Similarly for stuck type and data families.</li></ul><p>If <code>fuel = <code>Infinity</code></code> and there are no boot files involved, then the result
 is never <code>Nothing</code> and the analysis is a depth-first search. If <code>fuel = <code><a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a></code>
 f</code>, then the analysis behaves like a depth-limited DFS and returns <code>Nothing</code>
 if the search was inconclusive.</p><p>See Note [Detecting recursive data constructors] for which recursive DataCons
 we want to flag.</p></div></div><div class="top"><p class="src"><a id="v:mkAbsentFiller" class="def">mkAbsentFiller</a> :: <a href="GHC-Core-Opt-WorkWrap-Utils.html#t:WwOpts" title="GHC.Core.Opt.WorkWrap.Utils">WwOpts</a> -&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; <a href="GHC-Core-DataCon.html#t:StrictnessMark" title="GHC.Core.DataCon">StrictnessMark</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#mkAbsentFiller" class="link">Source</a> <a href="#v:mkAbsentFiller" class="selflink">#</a></p><div class="doc"><p>Tries to find a suitable absent filler to bind the given absent identifier
 to. See Note [Absent fillers].</p><p>If <code>mkAbsentFiller _ id == Just e</code>, then <code>e</code> is an absent filler with the
 same type as <code>id</code>. Otherwise, no suitable filler could be found.</p></div></div><div class="top"><p class="src"><a id="v:isWorkerSmallEnough" class="def">isWorkerSmallEnough</a> :: <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> -&gt; [<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>] -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a> <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#isWorkerSmallEnough" class="link">Source</a> <a href="#v:isWorkerSmallEnough" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:dubiousDataConInstArgTys" class="def">dubiousDataConInstArgTys</a> :: <a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a> -&gt; [<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>] -&gt; [<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>] <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#dubiousDataConInstArgTys" class="link">Source</a> <a href="#v:dubiousDataConInstArgTys" class="selflink">#</a></p><div class="doc"><p>Exactly <code><a href="GHC-Core-DataCon.html#v:dataConInstArgTys" title="GHC.Core.DataCon">dataConInstArgTys</a></code>, but lacks the (ASSERT'ed) precondition that
 the <code><a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a></code> may not have existentials. The lack of cloning the
 existentials this function &quot;dubious&quot;; only use it where type variables
 aren't substituted for!  Why may the data con bind existentials?
    See Note [Which types are unboxed?]</p></div></div><div class="top"><p class="src"><a id="v:boringSplit" class="def">boringSplit</a> :: WwUse <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#boringSplit" class="link">Source</a> <a href="#v:boringSplit" class="selflink">#</a></p><div class="doc"><p>WW split not profitable</p></div></div><div class="top"><p class="src"><a id="v:usefulSplit" class="def">usefulSplit</a> :: WwUse <a href="src/GHC.Core.Opt.WorkWrap.Utils.html#usefulSplit" class="link">Source</a> <a href="#v:usefulSplit" class="selflink">#</a></p><div class="doc"><p>WW split profitable</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>