<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.HsToCore.Pmc</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.6: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.HsToCore.Pmc.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.HsToCore.Pmc</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module coverage checks pattern matches. It finds</p><ul><li>Uncovered patterns, certifying non-exhaustivity</li><li>Redundant equations</li><li>Equations with an inaccessible right-hand-side</li></ul><p>The algorithm is based on the paper
 <a href="https://dl.acm.org/doi/abs/10.1145/3408989">Lower Your Guards: A Compositional Pattern-Match Coverage Checker&quot;</a></p><p>There is an overview Figure 2 in there that's probably helpful.
 Here is an overview of how it's implemented, which follows the structure of
 the entry points such as <code><a href="GHC-HsToCore-Pmc.html#v:pmcMatches" title="GHC.HsToCore.Pmc">pmcMatches</a></code>:</p><ol><li value="1">Desugar source syntax (like <code><a href="Language-Haskell-Syntax-Expr.html#t:LMatch" title="Language.Haskell.Syntax.Expr">LMatch</a></code>) to guard tree variants (like
     <code>GrdMatch</code>), with one of the desugaring functions (like <code>desugarMatch</code>).
     See <a href="GHC-HsToCore-Pmc-Desugar.html">GHC.HsToCore.Pmc.Desugar</a>.
     Follows Section 3.1 in the paper.</li><li value="2">Coverage check guard trees (with a function like <code>checkMatch</code>) to get a
     <code><a href="GHC-HsToCore-Pmc-Types.html#t:CheckResult" title="GHC.HsToCore.Pmc.Types">CheckResult</a></code>. See <a href="GHC-HsToCore-Pmc-Check.html">GHC.HsToCore.Pmc.Check</a>.
     The normalised refinement types <code><a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nabla" title="GHC.HsToCore.Pmc.Solver.Types">Nabla</a></code> are tested for inhabitants by
     <a href="GHC-HsToCore-Pmc-Solver.html">GHC.HsToCore.Pmc.Solver</a>.</li><li value="3">Collect redundancy information into a <code>CIRB</code> with a function such
     as <code>cirbsMatch</code>. Follows the R function from Figure 6 of the paper.</li><li value="4">Format and report uncovered patterns and redundant equations (<code>CIRB</code>)
     with <code>formatReportWarnings</code>. Basically job of the G function, plus proper
     pretty printing of the warnings (Section 5.4 of the paper).</li><li value="5">Return <code><a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a></code> reaching syntactic sub-components for
     Note [Long-distance information]. Collected by functions such as
     <code>ldiMatch</code>. See Section 4.1 of the paper.</li></ol></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:pmcPatBind">pmcPatBind</a> :: <a href="GHC-HsToCore-Monad.html#t:DsMatchContext" title="GHC.HsToCore.Monad">DsMatchContext</a> -&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; <a href="Language-Haskell-Syntax-Pat.html#t:Pat" title="Language.Haskell.Syntax.Pat">Pat</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a> -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> ()</li><li class="src short"><a href="#v:pmcMatches">pmcMatches</a> :: <a href="GHC-HsToCore-Monad.html#t:DsMatchContext" title="GHC.HsToCore.Monad">DsMatchContext</a> -&gt; [<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a>] -&gt; [<a href="Language-Haskell-Syntax-Expr.html#t:LMatch" title="Language.Haskell.Syntax.Expr">LMatch</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a> (<a href="Language-Haskell-Syntax-Expr.html#t:LHsExpr" title="Language.Haskell.Syntax.Expr">LHsExpr</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a>)] -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> [(<a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a>, <a href="../base-4.18.2.1/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a>)]</li><li class="src short"><a href="#v:pmcGRHSs">pmcGRHSs</a> :: <a href="Language-Haskell-Syntax-Expr.html#t:HsMatchContext" title="Language.Haskell.Syntax.Expr">HsMatchContext</a> <a href="GHC-Hs-Extension.html#t:GhcRn" title="GHC.Hs.Extension">GhcRn</a> -&gt; <a href="Language-Haskell-Syntax-Expr.html#t:GRHSs" title="Language.Haskell.Syntax.Expr">GRHSs</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a> (<a href="Language-Haskell-Syntax-Expr.html#t:LHsExpr" title="Language.Haskell.Syntax.Expr">LHsExpr</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a>) -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> (<a href="../base-4.18.2.1/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a>)</li><li class="src short"><a href="#v:isMatchContextPmChecked">isMatchContextPmChecked</a> :: <a href="GHC-Driver-Session.html#t:DynFlags" title="GHC.Driver.Session">DynFlags</a> -&gt; <a href="GHC-Types-Basic.html#t:Origin" title="GHC.Types.Basic">Origin</a> -&gt; <a href="Language-Haskell-Syntax-Expr.html#t:HsMatchContext" title="Language.Haskell.Syntax.Expr">HsMatchContext</a> id -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></li><li class="src short"><a href="#v:addTyCs">addTyCs</a> :: <a href="GHC-Types-Basic.html#t:Origin" title="GHC.Types.Basic">Origin</a> -&gt; <a href="GHC-Data-Bag.html#t:Bag" title="GHC.Data.Bag">Bag</a> <a href="GHC-Types-Var.html#t:EvVar" title="GHC.Types.Var">EvVar</a> -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a</li><li class="src short"><a href="#v:addCoreScrutTmCs">addCoreScrutTmCs</a> :: [<a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>] -&gt; [<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a>] -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a</li><li class="src short"><a href="#v:addHsScrutTmCs">addHsScrutTmCs</a> :: [<a href="Language-Haskell-Syntax-Expr.html#t:LHsExpr" title="Language.Haskell.Syntax.Expr">LHsExpr</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a>] -&gt; [<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a>] -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a</li><li class="src short"><a href="#v:getLdiNablas">getLdiNablas</a> :: <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> <a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:pmcPatBind" class="def">pmcPatBind</a> :: <a href="GHC-HsToCore-Monad.html#t:DsMatchContext" title="GHC.HsToCore.Monad">DsMatchContext</a> -&gt; <a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a> -&gt; <a href="Language-Haskell-Syntax-Pat.html#t:Pat" title="Language.Haskell.Syntax.Pat">Pat</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a> -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> () <a href="src/GHC.HsToCore.Pmc.html#pmcPatBind" class="link">Source</a> <a href="#v:pmcPatBind" class="selflink">#</a></p><div class="doc"><p>Check a pattern binding (let, where) for exhaustiveness.</p></div></div><div class="top"><p class="src"><a id="v:pmcMatches" class="def">pmcMatches</a> <a href="src/GHC.HsToCore.Pmc.html#pmcMatches" class="link">Source</a> <a href="#v:pmcMatches" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="GHC-HsToCore-Monad.html#t:DsMatchContext" title="GHC.HsToCore.Monad">DsMatchContext</a></td><td class="doc"><p>Match context, for warnings messages</p></td></tr><tr><td class="src">-&gt; [<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a>]</td><td class="doc"><p>Match variables, i.e. x and y above</p></td></tr><tr><td class="src">-&gt; [<a href="Language-Haskell-Syntax-Expr.html#t:LMatch" title="Language.Haskell.Syntax.Expr">LMatch</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a> (<a href="Language-Haskell-Syntax-Expr.html#t:LHsExpr" title="Language.Haskell.Syntax.Expr">LHsExpr</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a>)]</td><td class="doc"><p>List of matches</p></td></tr><tr><td class="src">-&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> [(<a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a>, <a href="../base-4.18.2.1/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a>)]</td><td class="doc"><p>One covered <code><a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a></code> per Match and
   GRHS, for long distance info.</p></td></tr></table></div><div class="doc"><p>Check a list of syntactic <code><a href="Language-Haskell-Syntax-Expr.html#t:Match" title="Language.Haskell.Syntax.Expr">Match</a></code>es (part of case, functions, etc.), each
 with a <code><a href="Language-Haskell-Syntax-Pat.html#t:Pat" title="Language.Haskell.Syntax.Pat">Pat</a></code> and one or more <code><a href="Language-Haskell-Syntax-Expr.html#t:GRHSs" title="Language.Haskell.Syntax.Expr">GRHSs</a></code>:</p><pre>  f x y | x == y    = 1   -- match on x and y with two guarded RHSs
        | otherwise = 2
  f _ _             = 3   -- clause with a single, un-guarded RHS
</pre><p>Returns one non-empty <code><a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a></code> for 1.) each pattern of a <code><a href="Language-Haskell-Syntax-Expr.html#t:Match" title="Language.Haskell.Syntax.Expr">Match</a></code> and 2.)
 each of a <code><a href="Language-Haskell-Syntax-Expr.html#t:Match" title="Language.Haskell.Syntax.Expr">Match</a></code>es <code><a href="Language-Haskell-Syntax-Expr.html#t:GRHS" title="Language.Haskell.Syntax.Expr">GRHS</a></code> for Note [Long-distance information].</p><p>Special case: When there are <em>no matches</em>, then the function assumes it
 checks an <code>-XEmptyCase</code> with only a single match variable.
 See Note [Checking EmptyCase].</p></div></div><div class="top"><p class="src"><a id="v:pmcGRHSs" class="def">pmcGRHSs</a> <a href="src/GHC.HsToCore.Pmc.html#pmcGRHSs" class="link">Source</a> <a href="#v:pmcGRHSs" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Language-Haskell-Syntax-Expr.html#t:HsMatchContext" title="Language.Haskell.Syntax.Expr">HsMatchContext</a> <a href="GHC-Hs-Extension.html#t:GhcRn" title="GHC.Hs.Extension">GhcRn</a></td><td class="doc"><p>Match context, for warning messages</p></td></tr><tr><td class="src">-&gt; <a href="Language-Haskell-Syntax-Expr.html#t:GRHSs" title="Language.Haskell.Syntax.Expr">GRHSs</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a> (<a href="Language-Haskell-Syntax-Expr.html#t:LHsExpr" title="Language.Haskell.Syntax.Expr">LHsExpr</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a>)</td><td class="doc"><p>The GRHSs to check</p></td></tr><tr><td class="src">-&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> (<a href="../base-4.18.2.1/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a>)</td><td class="doc"><p>Covered <code><a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a></code> for each RHS, for long
   distance info</p></td></tr></table></div><div class="doc"><p>Exhaustive for guard matches, is used for guards in pattern bindings and
 in <code>MultiIf</code> expressions. Returns the <code><a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a></code> covered by the RHSs.</p></div></div><div class="top"><p class="src"><a id="v:isMatchContextPmChecked" class="def">isMatchContextPmChecked</a> :: <a href="GHC-Driver-Session.html#t:DynFlags" title="GHC.Driver.Session">DynFlags</a> -&gt; <a href="GHC-Types-Basic.html#t:Origin" title="GHC.Types.Basic">Origin</a> -&gt; <a href="Language-Haskell-Syntax-Expr.html#t:HsMatchContext" title="Language.Haskell.Syntax.Expr">HsMatchContext</a> id -&gt; <a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a> <a href="src/GHC.HsToCore.Pmc.Utils.html#isMatchContextPmChecked" class="link">Source</a> <a href="#v:isMatchContextPmChecked" class="selflink">#</a></p><div class="doc"><p>Check whether any part of pattern match checking is enabled for this
 <code><a href="Language-Haskell-Syntax-Expr.html#t:HsMatchContext" title="Language.Haskell.Syntax.Expr">HsMatchContext</a></code> (does not matter whether it is the redundancy check or the
 exhaustiveness check).</p></div></div><div class="top"><p class="src"><a id="v:addTyCs" class="def">addTyCs</a> :: <a href="GHC-Types-Basic.html#t:Origin" title="GHC.Types.Basic">Origin</a> -&gt; <a href="GHC-Data-Bag.html#t:Bag" title="GHC.Data.Bag">Bag</a> <a href="GHC-Types-Var.html#t:EvVar" title="GHC.Types.Var">EvVar</a> -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a <a href="src/GHC.HsToCore.Pmc.html#addTyCs" class="link">Source</a> <a href="#v:addTyCs" class="selflink">#</a></p><div class="doc"><p>Add in-scope type constraints if the coverage checker might run and then
 run the given action.</p></div></div><div class="top"><p class="src"><a id="v:addCoreScrutTmCs" class="def">addCoreScrutTmCs</a> :: [<a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>] -&gt; [<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a>] -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a <a href="src/GHC.HsToCore.Pmc.html#addCoreScrutTmCs" class="link">Source</a> <a href="#v:addCoreScrutTmCs" class="selflink">#</a></p><div class="doc"><p>Add equalities for the <code><a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a></code> scrutinees to the local <code><a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a></code> environment,
 e.g. when checking a case expression:
     case e of x { matches }
 When checking matches we record that (x ~ e) where x is the initial
 uncovered. All matches will have to satisfy this equality.
 This is also used for the Arrows cases command, where these equalities have
 to be added for multiple scrutinees rather than just one.</p></div></div><div class="top"><p class="src"><a id="v:addHsScrutTmCs" class="def">addHsScrutTmCs</a> :: [<a href="Language-Haskell-Syntax-Expr.html#t:LHsExpr" title="Language.Haskell.Syntax.Expr">LHsExpr</a> <a href="GHC-Hs-Extension.html#t:GhcTc" title="GHC.Hs.Extension">GhcTc</a>] -&gt; [<a href="GHC-Types-Var.html#t:Id" title="GHC.Types.Var">Id</a>] -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a -&gt; <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> a <a href="src/GHC.HsToCore.Pmc.html#addHsScrutTmCs" class="link">Source</a> <a href="#v:addHsScrutTmCs" class="selflink">#</a></p><div class="doc"><p><code><a href="GHC-HsToCore-Pmc.html#v:addCoreScrutTmCs" title="GHC.HsToCore.Pmc">addCoreScrutTmCs</a></code>, but desugars the <code><a href="Language-Haskell-Syntax-Expr.html#t:LHsExpr" title="Language.Haskell.Syntax.Expr">LHsExpr</a></code>s first.</p></div></div><div class="top"><p class="src"><a id="v:getLdiNablas" class="def">getLdiNablas</a> :: <a href="GHC-HsToCore-Types.html#t:DsM" title="GHC.HsToCore.Types">DsM</a> <a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a> <a href="src/GHC.HsToCore.Pmc.html#getLdiNablas" class="link">Source</a> <a href="#v:getLdiNablas" class="selflink">#</a></p><div class="doc"><p>A non-empty delta that is initialised from the ambient refinement type
 capturing long-distance information, or the trivially habitable <code><a href="GHC-HsToCore-Pmc-Solver-Types.html#t:Nablas" title="GHC.HsToCore.Pmc.Solver.Types">Nablas</a></code> if
 the former is uninhabited.
 See Note [Recovering from unsatisfiable pattern-matching constraints].</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>