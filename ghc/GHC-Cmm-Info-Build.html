<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.Cmm.Info.Build</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.7: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.Cmm.Info.Build.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.Cmm.Info.Build</p></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:CAFSet">CAFSet</a> = <a href="../containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> CAFfyLabel</li><li class="src short"><span class="keyword">type</span> <a href="#t:CAFEnv">CAFEnv</a> = <a href="GHC-Cmm-Dataflow-Label.html#t:LabelMap" title="GHC.Cmm.Dataflow.Label">LabelMap</a> <a href="GHC-Cmm-Info-Build.html#t:CAFSet" title="GHC.Cmm.Info.Build">CAFSet</a></li><li class="src short"><a href="#v:cafAnal">cafAnal</a> :: <a href="GHC-Platform.html#t:Platform" title="GHC.Platform">Platform</a> -&gt; <a href="GHC-Cmm-Dataflow-Label.html#t:LabelSet" title="GHC.Cmm.Dataflow.Label">LabelSet</a> -&gt; <a href="GHC-Cmm-CLabel.html#t:CLabel" title="GHC.Cmm.CLabel">CLabel</a> -&gt; <a href="GHC-Cmm.html#t:CmmGraph" title="GHC.Cmm">CmmGraph</a> -&gt; <a href="GHC-Cmm-Info-Build.html#t:CAFEnv" title="GHC.Cmm.Info.Build">CAFEnv</a></li><li class="src short"><a href="#v:cafAnalData">cafAnalData</a> :: <a href="GHC-Platform.html#t:Platform" title="GHC.Platform">Platform</a> -&gt; <a href="GHC-Cmm.html#t:CmmStatics" title="GHC.Cmm">CmmStatics</a> -&gt; <a href="GHC-Cmm-Info-Build.html#t:CAFSet" title="GHC.Cmm.Info.Build">CAFSet</a></li><li class="src short"><a href="#v:doSRTs">doSRTs</a> :: <a href="GHC-Cmm-Config.html#t:CmmConfig" title="GHC.Cmm.Config">CmmConfig</a> -&gt; <a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a> -&gt; [(<a href="GHC-Cmm-Info-Build.html#t:CAFEnv" title="GHC.Cmm.Info.Build">CAFEnv</a>, [<a href="GHC-Cmm.html#t:CmmDecl" title="GHC.Cmm">CmmDecl</a>])] -&gt; [(<a href="GHC-Cmm-Info-Build.html#t:CAFSet" title="GHC.Cmm.Info.Build">CAFSet</a>, <a href="GHC-Cmm.html#t:CmmDataDecl" title="GHC.Cmm">CmmDataDecl</a>)] -&gt; <a href="GHC-Prelude-Basic.html#t:IO" title="GHC.Prelude.Basic">IO</a> (<a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a>, [<a href="GHC-Cmm.html#t:CmmDeclSRTs" title="GHC.Cmm">CmmDeclSRTs</a>])</li><li class="src short"><span class="keyword">data</span> <a href="#t:ModuleSRTInfo">ModuleSRTInfo</a> = <a href="#v:ModuleSRTInfo">ModuleSRTInfo</a> {<ul class="subs"><li><a href="#v:thisModule">thisModule</a> :: <a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a></li><li><a href="#v:dedupSRTs">dedupSRTs</a> :: <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> (<a href="../containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> SRTEntry) SRTEntry</li><li><a href="#v:flatSRTs">flatSRTs</a> :: <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> SRTEntry (<a href="../containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> SRTEntry)</li><li><a href="#v:moduleSRTMap">moduleSRTMap</a> :: <a href="GHC-Cmm-Info-Build.html#t:SRTMap" title="GHC.Cmm.Info.Build">SRTMap</a></li></ul>}</li><li class="src short"><a href="#v:emptySRT">emptySRT</a> :: <a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a> -&gt; <a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:SRTMap">SRTMap</a> = <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> CAFfyLabel (<a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> SRTEntry)</li><li class="src short"><a href="#v:srtMapNonCAFs">srtMapNonCAFs</a> :: <a href="GHC-Cmm-Info-Build.html#t:SRTMap" title="GHC.Cmm.Info.Build">SRTMap</a> -&gt; <a href="GHC-Types-Name-Set.html#t:NonCaffySet" title="GHC.Types.Name.Set">NonCaffySet</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:CAFSet" class="def">CAFSet</a> = <a href="../containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> CAFfyLabel <a href="src/GHC.Cmm.Info.Build.html#CAFSet" class="link">Source</a> <a href="#t:CAFSet" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:CAFEnv" class="def">CAFEnv</a> = <a href="GHC-Cmm-Dataflow-Label.html#t:LabelMap" title="GHC.Cmm.Dataflow.Label">LabelMap</a> <a href="GHC-Cmm-Info-Build.html#t:CAFSet" title="GHC.Cmm.Info.Build">CAFSet</a> <a href="src/GHC.Cmm.Info.Build.html#CAFEnv" class="link">Source</a> <a href="#t:CAFEnv" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:cafAnal" class="def">cafAnal</a> <a href="src/GHC.Cmm.Info.Build.html#cafAnal" class="link">Source</a> <a href="#v:cafAnal" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="GHC-Platform.html#t:Platform" title="GHC.Platform">Platform</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Cmm-Dataflow-Label.html#t:LabelSet" title="GHC.Cmm.Dataflow.Label">LabelSet</a></td><td class="doc"><p>The blocks representing continuations, ie. those
 that will get RET info tables.  These labels will
 get their own SRTs, so we don't aggregate CAFs from
 references to these labels, we just use the label.</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Cmm-CLabel.html#t:CLabel" title="GHC.Cmm.CLabel">CLabel</a></td><td class="doc"><p>The top label of the proc</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Cmm.html#t:CmmGraph" title="GHC.Cmm">CmmGraph</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Cmm-Info-Build.html#t:CAFEnv" title="GHC.Cmm.Info.Build">CAFEnv</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>For each code block:
   - collect the references reachable from this code block to FUN,
     THUNK or RET labels for which <code>hasCAF == True</code></p><p>This gives us a <code><a href="GHC-Cmm-Info-Build.html#t:CAFEnv" title="GHC.Cmm.Info.Build">CAFEnv</a></code>: a mapping from code block to sets of labels</p></div></div><div class="top"><p class="src"><a id="v:cafAnalData" class="def">cafAnalData</a> :: <a href="GHC-Platform.html#t:Platform" title="GHC.Platform">Platform</a> -&gt; <a href="GHC-Cmm.html#t:CmmStatics" title="GHC.Cmm">CmmStatics</a> -&gt; <a href="GHC-Cmm-Info-Build.html#t:CAFSet" title="GHC.Cmm.Info.Build">CAFSet</a> <a href="src/GHC.Cmm.Info.Build.html#cafAnalData" class="link">Source</a> <a href="#v:cafAnalData" class="selflink">#</a></p><div class="doc"><p>Collect possible CAFfy references from a <code><a href="GHC-Cmm.html#v:CmmData" title="GHC.Cmm">CmmData</a></code> decl.</p></div></div><div class="top"><p class="src"><a id="v:doSRTs" class="def">doSRTs</a> <a href="src/GHC.Cmm.Info.Build.html#doSRTs" class="link">Source</a> <a href="#v:doSRTs" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="GHC-Cmm-Config.html#t:CmmConfig" title="GHC.Cmm.Config">CmmConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; [(<a href="GHC-Cmm-Info-Build.html#t:CAFEnv" title="GHC.Cmm.Info.Build">CAFEnv</a>, [<a href="GHC-Cmm.html#t:CmmDecl" title="GHC.Cmm">CmmDecl</a>])]</td><td class="doc"><p><code><a href="GHC-Cmm-Info-Build.html#t:CAFEnv" title="GHC.Cmm.Info.Build">CAFEnv</a></code>s and <code><a href="GHC-Cmm.html#t:CmmDecl" title="GHC.Cmm">CmmDecl</a></code>s for code blocks</p></td></tr><tr><td class="src">-&gt; [(<a href="GHC-Cmm-Info-Build.html#t:CAFSet" title="GHC.Cmm.Info.Build">CAFSet</a>, <a href="GHC-Cmm.html#t:CmmDataDecl" title="GHC.Cmm">CmmDataDecl</a>)]</td><td class="doc"><p>static data decls and their <code><a href="GHC-Cmm-Info-Build.html#t:CAFSet" title="GHC.Cmm.Info.Build">CAFSet</a></code>s</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Prelude-Basic.html#t:IO" title="GHC.Prelude.Basic">IO</a> (<a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a>, [<a href="GHC-Cmm.html#t:CmmDeclSRTs" title="GHC.Cmm">CmmDeclSRTs</a>])</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Attach SRTs to all info tables in the <code><a href="GHC-Cmm.html#t:CmmDecl" title="GHC.Cmm">CmmDecl</a></code>s, and add SRT
 declarations to the <code><a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ModuleSRTInfo" class="def">ModuleSRTInfo</a> <a href="src/GHC.Cmm.Info.Build.html#ModuleSRTInfo" class="link">Source</a> <a href="#t:ModuleSRTInfo" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ModuleSRTInfo" class="def">ModuleSRTInfo</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:thisModule" class="def">thisModule</a> :: <a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a></dfn><div class="doc"><p>Current module being compiled. Required for calling labelDynamic.</p></div></li><li><dfn class="src"><a id="v:dedupSRTs" class="def">dedupSRTs</a> :: <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> (<a href="../containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> SRTEntry) SRTEntry</dfn><div class="doc"><p>previous SRTs we've emitted, so we can de-duplicate.
 Used to implement the [Common] optimisation.</p></div></li><li><dfn class="src"><a id="v:flatSRTs" class="def">flatSRTs</a> :: <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> SRTEntry (<a href="../containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> SRTEntry)</dfn><div class="doc"><p>The reverse mapping, so that we can remove redundant
 entries. e.g.  if we have an SRT [a,b,c], and we know that b
 points to [c,d], we can omit c and emit [a,b].
 Used to implement the [Filter] optimisation.</p></div></li><li><dfn class="src"><a id="v:moduleSRTMap" class="def">moduleSRTMap</a> :: <a href="GHC-Cmm-Info-Build.html#t:SRTMap" title="GHC.Cmm.Info.Build">SRTMap</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:ModuleSRTInfo">Instances</h4><details id="i:ModuleSRTInfo" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ModuleSRTInfo:OutputableP:1"></span> <a href="GHC-Utils-Outputable.html#t:OutputableP" title="GHC.Utils.Outputable">OutputableP</a> env <a href="GHC-Cmm-CLabel.html#t:CLabel" title="GHC.Cmm.CLabel">CLabel</a> =&gt; <a href="GHC-Utils-Outputable.html#t:OutputableP" title="GHC.Utils.Outputable">OutputableP</a> env <a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a></span> <a href="src/GHC.Cmm.Info.Build.html#line-687" class="link">Source</a> <a href="#t:ModuleSRTInfo" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ModuleSRTInfo:OutputableP:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Cmm-Info-Build.html">GHC.Cmm.Info.Build</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:pdoc">pdoc</a> :: env -&gt; <a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#pdoc" class="link">Source</a> <a href="#v:pdoc" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:emptySRT" class="def">emptySRT</a> :: <a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a> -&gt; <a href="GHC-Cmm-Info-Build.html#t:ModuleSRTInfo" title="GHC.Cmm.Info.Build">ModuleSRTInfo</a> <a href="src/GHC.Cmm.Info.Build.html#emptySRT" class="link">Source</a> <a href="#v:emptySRT" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:SRTMap" class="def">SRTMap</a> = <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> CAFfyLabel (<a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> SRTEntry) <a href="src/GHC.Cmm.Info.Build.html#SRTMap" class="link">Source</a> <a href="#t:SRTMap" class="selflink">#</a></p><div class="doc"><p>Maps labels from <code><a href="GHC-Cmm-Info-Build.html#v:cafAnal" title="GHC.Cmm.Info.Build">cafAnal</a></code> to the final CLabel that will appear
 in the SRT.
   - closures with singleton SRTs resolve to their single entry
   - closures with larger SRTs map to the label for that SRT
   - CAFs must not map to anything!
   - if a labels maps to Nothing, we found that this label's SRT
     is empty, so we don't need to refer to it from other SRTs.</p></div></div><div class="top"><p class="src"><a id="v:srtMapNonCAFs" class="def">srtMapNonCAFs</a> :: <a href="GHC-Cmm-Info-Build.html#t:SRTMap" title="GHC.Cmm.Info.Build">SRTMap</a> -&gt; <a href="GHC-Types-Name-Set.html#t:NonCaffySet" title="GHC.Types.Name.Set">NonCaffySet</a> <a href="src/GHC.Cmm.Info.Build.html#srtMapNonCAFs" class="link">Source</a> <a href="#v:srtMapNonCAFs" class="selflink">#</a></p><div class="doc"><p>Given <code><a href="GHC-Cmm-Info-Build.html#t:SRTMap" title="GHC.Cmm.Info.Build">SRTMap</a></code> of a module, returns the set of non-CAFFY names in the
 module.  Any <code>Name</code>s not in the set are CAFFY.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>